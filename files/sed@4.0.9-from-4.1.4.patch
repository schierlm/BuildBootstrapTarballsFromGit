--- 4.1.4/basicdefs.h
+++ 4.0.9/basicdefs.h
@@ -15,53 +15,11 @@
     along with this program; if not, write to the Free Software
     Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA. */
 
+/* some basic #defines to support pre-ANSI compilers */
+
 #ifndef BASICDEFS_H
 #define BASICDEFS_H
 
-#if defined(_AIX)
-#pragma alloca
-#else
-# if !defined(alloca)           /* predefined by HP cc +Olibcalls */
-#  ifdef __GNUC__
-#   define alloca(size) __builtin_alloca(size)
-#  else
-#   if HAVE_ALLOCA_H
-#    include <alloca.h>
-#   else
-#    if defined(__hpux)
-        void *alloca ();
-#    else
-#     if !defined(__OS2__) && !defined(WIN32)
-	char *alloca ();
-#     else
-#      include <malloc.h>       /* OS/2 defines alloca in here */
-#     endif
-#    endif
-#   endif
-#  endif
-# endif
-#endif
-
-#ifdef HAVE_WCHAR_H
-# include <wchar.h>
-#endif
-#ifdef HAVE_LOCALE_H
-# include <locale.h>
-#endif
-#ifdef HAVE_WCTYPE_H
-# include <wctype.h>
-#endif
-
-
-#ifdef BOOTSTRAP
-# define false 0
-# define true 1
-# define bool unsigned
-# define __bool_true_false_are_defined 1
-#else
-# include <stdbool.h>
-#endif
-
 #if ENABLE_NLS
 # include <libintl.h>
 #else
@@ -79,6 +37,26 @@
 /* type countT is used to keep track of line numbers, etc. */
 typedef unsigned long countT;
 
+/* type flagT is used for boolean values */
+#if defined FALSE && FALSE != 0
+#error Huh, FALSE is not false?
+#endif
+#if defined TRUE && TRUE != 1
+#error Huh, TRUE is not true?
+#endif
+#undef FALSE
+#undef TRUE
+
+#if __STDC__
+/* Define an enum for debugging */
+typedef enum { FALSE, TRUE } flagT;
+#else
+typedef int flagT;
+#endif
+
+#define FALSE 0
+#define TRUE 1
+
 /* Oftentimes casts are used as an ugly hack to silence warnings
  * from the compiler.  However, sometimes those warnings really
  * do point to something worth avoiding.  I define this
--- 4.1.4/sed/compile.c
+++ 4.0.9/sed/compile.c
@@ -45,6 +45,9 @@
 
 #include <obstack.h>
 
+extern flagT no_default_output;
+extern flagT POSIXLY_CORRECT;
+
 
 #define YMAP_LENGTH		256 /*XXX shouldn't this be (UCHAR_MAX+1)?*/
 #define VECTOR_ALLOC_INCREMENT	40
@@ -93,18 +96,28 @@
 };
 
 struct special_files {
-  struct output outf;
+  char *name;
   FILE **pfp;
 };
 
 FILE *my_stdin, *my_stdout, *my_stderr;
 struct special_files special_files[] = {
-  { { "/dev/stdin", false, NULL, NULL }, &my_stdin },
-  { { "/dev/stdout", false, NULL, NULL }, &my_stdout },
-  { { "/dev/stderr", false, NULL, NULL }, &my_stderr },
-  { { NULL, false, NULL, NULL }, NULL }
+  { "/dev/stdin", &my_stdin },
+  { "/dev/stdout", &my_stdout },
+  { "/dev/stderr", &my_stderr },
+  { NULL, NULL }
 };
 
+/* This structure tracks files opened by the `w' and `s///w' commands
+   so that they may all be closed cleanly at normal program termination.
+   Those marked as `special' are not closed. */
+struct fp_list {
+    char *name;
+    int special;
+    FILE *fp;
+    struct fp_list *link;
+  };
+
 
 /* Where we are in the processing of the input. */
 static struct prog_info prog;
@@ -117,7 +130,7 @@
 
 /* We wish to detect #n magic only in the first input argument;
    this flag tracks when we have consumed the first file of input. */
-static bool first_script = true;
+static flagT first_script = TRUE;
 
 /* Allow for scripts like "sed -e 'i\' -e foo": */
 static struct buffer *pending_text = NULL;
@@ -132,90 +145,55 @@
 
 /* Various error messages we may want to print */
 static const char errors[] =
-  "multiple `!'s\0"
-  "unexpected `,'\0"
-  "invalid usage of +N or ~N as first address\0"
-  "unmatched `{'\0"
-  "unexpected `}'\0"
-  "extra characters after command\0"
-  "expected \\ after `a', `c' or `i'\0"
+  "Multiple `!'s\0"
+  "Unexpected `,'\0"
+  "Cannot use +N or ~N as first address\0"
+  "Unmatched `{'\0"
+  "Unexpected `}'\0"
+  "Extra characters after command\0"
+  "Expected \\ after `a', `c' or `i'\0"
   "`}' doesn't want any addresses\0"
   ": doesn't want any addresses\0"
-  "comments don't accept any addresses\0"
-  "missing command\0"
-  "command only uses one address\0"
-  "unterminated address regex\0"
-  "unterminated `s' command\0"
-  "unterminated `y' command\0"
-  "unknown option to `s'\0"
+  "Comments don't accept any addresses\0"
+  "Missing command\0"
+  "Command only uses one address\0"
+  "Unterminated address regex\0"
+  "Unterminated `s' command\0"
+  "Unterminated `y' command\0"
+  "Unknown option to `s'\0"
   "multiple `p' options to `s' command\0"
   "multiple `g' options to `s' command\0"
   "multiple number options to `s' command\0"
   "number option to `s' command may not be zero\0"
-  "strings for `y' command are different lengths\0"
-  "delimiter character is not a single-byte character\0"
-  "expected newer version of sed\0"
-  "invalid usage of line address 0\0"
-  "unknown command: `%c'";
+  "strings for y command are different lengths\0"
+  "expected newer version of sed";
 
 #define BAD_BANG (errors)
-#define BAD_COMMA (BAD_BANG + sizeof(N_("multiple `!'s")))
-#define BAD_STEP (BAD_COMMA + sizeof(N_("unexpected `,'")))
-#define EXCESS_OPEN_BRACE (BAD_STEP + sizeof(N_("invalid usage of +N or ~N as first address")))
-#define EXCESS_CLOSE_BRACE (EXCESS_OPEN_BRACE + sizeof(N_("unmatched `{'")))
-#define EXCESS_JUNK (EXCESS_CLOSE_BRACE + sizeof(N_("unexpected `}'")))
-#define EXPECTED_SLASH (EXCESS_JUNK + sizeof(N_("extra characters after command")))
-#define NO_CLOSE_BRACE_ADDR (EXPECTED_SLASH + sizeof(N_("expected \\ after `a', `c' or `i'")))
+#define BAD_COMMA (BAD_BANG + sizeof(N_("Multiple `!'s")))
+#define BAD_PLUS (BAD_COMMA + sizeof(N_("Unexpected `,'")))
+#define EXCESS_OPEN_BRACE (BAD_PLUS + sizeof(N_("Cannot use +N or ~N as first address")))
+#define EXCESS_CLOSE_BRACE (EXCESS_OPEN_BRACE + sizeof(N_("Unmatched `{'")))
+#define EXCESS_JUNK (EXCESS_CLOSE_BRACE + sizeof(N_("Unexpected `}'")))
+#define EXPECTED_SLASH (EXCESS_JUNK + sizeof(N_("Extra characters after command")))
+#define NO_CLOSE_BRACE_ADDR (EXPECTED_SLASH + sizeof(N_("Expected \\ after `a', `c' or `i'")))
 #define NO_COLON_ADDR (NO_CLOSE_BRACE_ADDR + sizeof(N_("`}' doesn't want any addresses")))
 #define NO_SHARP_ADDR (NO_COLON_ADDR + sizeof(N_(": doesn't want any addresses")))
-#define NO_COMMAND (NO_SHARP_ADDR + sizeof(N_("comments don't accept any addresses")))
-#define ONE_ADDR (NO_COMMAND + sizeof(N_("missing command")))
-#define UNTERM_ADDR_RE (ONE_ADDR + sizeof(N_("command only uses one address")))
-#define UNTERM_S_CMD (UNTERM_ADDR_RE + sizeof(N_("unterminated address regex")))
-#define UNTERM_Y_CMD (UNTERM_S_CMD + sizeof(N_("unterminated `s' command")))
-#define UNKNOWN_S_OPT (UNTERM_Y_CMD + sizeof(N_("unterminated `y' command")))
-#define EXCESS_P_OPT (UNKNOWN_S_OPT + sizeof(N_("unknown option to `s'")))
+#define NO_COMMAND (NO_SHARP_ADDR + sizeof(N_("Comments don't accept any addresses")))
+#define ONE_ADDR (NO_COMMAND + sizeof(N_("Missing command")))
+#define UNTERM_ADDR_RE (ONE_ADDR + sizeof(N_("Command only uses one address")))
+#define UNTERM_S_CMD (UNTERM_ADDR_RE + sizeof(N_("Unterminated address regex")))
+#define UNTERM_Y_CMD (UNTERM_S_CMD + sizeof(N_("Unterminated `s' command")))
+#define UNKNOWN_S_OPT (UNTERM_Y_CMD + sizeof(N_("Unterminated `y' command")))
+#define EXCESS_P_OPT (UNKNOWN_S_OPT + sizeof(N_("Unknown option to `s'")))
 #define EXCESS_G_OPT (EXCESS_P_OPT + sizeof(N_("multiple `p' options to `s' command")))
 #define EXCESS_N_OPT (EXCESS_G_OPT + sizeof(N_("multiple `g' options to `s' command")))
 #define ZERO_N_OPT (EXCESS_N_OPT + sizeof(N_("multiple number options to `s' command")))
 #define Y_CMD_LEN (ZERO_N_OPT + sizeof(N_("number option to `s' command may not be zero")))
-#define BAD_DELIM (Y_CMD_LEN + sizeof(N_("strings for `y' command are different lengths")))
-#define ANCIENT_VERSION (BAD_DELIM + sizeof(N_("delimiter character is not a single-byte character")))
-#define INVALID_LINE_0 (ANCIENT_VERSION + sizeof(N_("expected newer version of sed")))
-#define UNKNOWN_CMD (INVALID_LINE_0 + sizeof(N_("invalid usage of line address 0")))
-#define END_ERRORS (UNKNOWN_CMD + sizeof(N_("unknown command: `%c'")))
-
-static struct output *file_read = NULL;
-static struct output *file_write = NULL;
+#define ANCIENT_VERSION (Y_CMD_LEN + sizeof(N_("strings for y command are different lengths")))
+#define END_ERRORS (ANCIENT_VERSION + sizeof(N_("expected newer version of sed")))
 
-
-/* Complain about an unknown command and exit. */
-void
-bad_command(ch)
-  char ch;
-{
-  const char *msg = _(UNKNOWN_CMD);
-  char *unknown_cmd = xmalloc(strlen(msg));
-  sprintf(unknown_cmd, msg, ch);
-  bad_prog(unknown_cmd);
-}
-
-/* Complain about a programming error and exit. */
-void
-bad_prog(why)
-  const char *why;
-{
-  if (cur_input.name)
-    fprintf(stderr, _("%s: file %s line %lu: %s\n"),
-	    myname, cur_input.name, CAST(unsigned long)cur_input.line, why);
-  else
-    fprintf(stderr, _("%s: -e expression #%lu, char %lu: %s\n"),
-	    myname,
-	    CAST(unsigned long)cur_input.string_expr_count,
-	    CAST(unsigned long)(prog.cur-prog.base),
-	    why);
-  exit(EXIT_FAILURE);
-}
+static struct fp_list *file_read = NULL;
+static struct fp_list *file_write = NULL;
 
 
 /* Read the next character from the program.  Return EOF if there isn't
@@ -255,7 +233,7 @@
   if (prog.cur)
     {
       if (prog.cur <= prog.base || *--prog.cur != ch)
-	panic("Called savchar() with unexpected pushback (%x)",
+	panic(_("Called savchar() with unexpected pushback (%x)"),
 	      CAST(unsigned char)ch);
     }
   else
@@ -361,29 +339,30 @@
   while (ch != EOF && ch != '\n')
     {
 #if 0 /*XXX ZZZ 1998-09-12 kpp: added, then had second thoughts*/
-      if (posixicity == POSIXLY_EXTENDED)
-	if (ch == ';' || ch == '#')
+      if (!POSIXLY_CORRECT)
+	if (ch == ';' || ch == CLOSE_BRACE || ch == '#')
 	  {
 	    savchar(ch);
 	    break;
 	  }
 #endif
-      ch = add_then_next(b, ch);
+      add1_buffer(b, ch);
+      ch = inchar();
     }
   add1_buffer(b, '\0');
   return b;
 }
 
-static struct output *get_openfile P_((struct output **file_ptrs, char *mode, bool fail));
-static struct output *
+static FILE *get_openfile P_((struct fp_list **file_ptrs, char *mode, flagT fail));
+static FILE *
 get_openfile(file_ptrs, mode, fail)
-     struct output **file_ptrs;
+     struct fp_list **file_ptrs;
      char *mode;
-     bool fail;
+     flagT fail;
 {
   struct buffer *b;
   char *file_name;
-  struct output *p;
+  struct fp_list *p;
   int is_stderr;
 
   b = read_filename();
@@ -392,34 +371,36 @@
     if (strcmp(p->name, file_name) == 0)
       break;
 
-  if (posixicity == POSIXLY_EXTENDED)
+  if (!p)
     {
-      /* Check whether it is a special file (stdin, stdout or stderr) */
-      struct special_files *special = special_files;
+      FILE *fp = NULL;
+      if (!POSIXLY_CORRECT)
+	{
+	  /* Check whether it is a special file (stdin, stdout or stderr) */
+	  struct special_files *special = special_files;
 		  
-      /* std* sometimes are not constants, so they
-         cannot be used in the initializer for special_files */
-      my_stdin = stdin; my_stdout = stdout; my_stderr = stderr;
-      for (special = special_files; special->outf.name; special++)
-        if (strcmp(special->outf.name, file_name) == 0)
-          {
-	    special->outf.fp = *special->pfp;
-	    free_buffer (b);
-	    return &special->outf;
-          }
-    }
+	  /* std* sometimes are not constants, so they
+	     cannot be used in the initializer for special_files */
+	  my_stdin = stdin; my_stdout = stdout; my_stderr = stderr;
+	  for (special = special_files; special->name; special++)
+	    if (strcmp(special->name, file_name) == 0)
+	      {
+		fp = *special->pfp;
+		break;
+	      }
+	}
 
-  if (!p)
-    {
-      p = OB_MALLOC(&obs, 1, struct output);
+      p = OB_MALLOC(&obs, 1, struct fp_list);
       p->name = ck_strdup(file_name);
-      p->fp = ck_fopen(p->name, mode, fail);
-      p->missing_newline = false;
+      p->special = fp != NULL;
+      if (!fp)
+	fp = ck_fopen(p->name, mode, fail);
+      p->fp = fp;
       p->link = *file_ptrs;
       *file_ptrs = p;
     }
   free_buffer(b);
-  return p;
+  return p->fp;
 }
 
 
@@ -441,146 +422,99 @@
   cmd = v->v + v->v_length;
   cmd->a1 = NULL;
   cmd->a2 = NULL;
-  cmd->range_state = RANGE_INACTIVE;
-  cmd->addr_bang = false;
+  cmd->a1_matched = FALSE;
+  cmd->addr_bang = FALSE;
   cmd->cmd = '\0';	/* something invalid, to catch bugs early */
 
   *vectorp  = v;
   return cmd;
 }
 
-static int snarf_char_class P_((struct buffer *b, mbstate_t *cur_stat));
+static int snarf_char_class P_((struct buffer *b));
 static int
-snarf_char_class(b, cur_stat)
+snarf_char_class(b)
   struct buffer *b;
-  mbstate_t *cur_stat;
 {
   int ch;
-  int state = 0;
-  int delim;
-  bool pending_mb = 0;
-  
+
   ch = inchar();
   if (ch == '^')
     ch = add_then_next(b, ch);
-  else if (ch == CLOSE_BRACKET)
+  if (ch == CLOSE_BRACKET)
     ch = add_then_next(b, ch);
-  
-  /* States are:
-	0 outside a collation element, character class or collation class
-	1 after the bracket
-	2 after the opening ./:/=
-	3 after the closing ./:/= */
-
-  for (;; ch = add_then_next (b, ch))
+  while (ch != EOF && ch != '\n' && ch != CLOSE_BRACKET)
     {
-      pending_mb = BRLEN (ch, cur_stat) != 1;
-
-      switch (ch)
+      if (ch == OPEN_BRACKET)
 	{
-	case EOF:
-	case '\n':
-	  return ch;
-
-	case '.':
-	case ':':
-	case '=':
-	  if (pending_mb)
-	    continue;
+	  int prev;
+	  int delim = ch = add_then_next(b, ch);
 
-	  if (state == 1)
+	  if (delim != '.'  &&  delim != ':'  &&  delim != '=')
+	    continue; /* bypass the add_then_next() call at bottom of loop */
+	  for (prev=ch=add_then_next(b, ch);
+		  !(ch==CLOSE_BRACKET && prev==delim); ch=add_then_next(b, ch))
 	    {
-	      delim = ch;
-	      state++;
+	      if (ch == EOF || ch == '\n')
+		return ch;
+	      prev = ch;
 	    }
-	  else if (ch == delim && state == 2)
-	    state++;
-	  else
+	}
+#ifndef REG_PERL
+      else if (ch == '\\')
+	{
+	  ch = inchar();
+	  if (ch == EOF)
 	    break;
-
-	  continue;
-
-	case OPEN_BRACKET:
-	  if (pending_mb)
-	    continue;
-
-	  state++;
-	  continue;
-
-	case CLOSE_BRACKET:
-	  if (pending_mb)
-	    continue;
-
-	  if (state == 0 || state == 1)
-	    return ch;
-	  else if (state == 3)
-	    state = 0;
-
-	  break;
-
-	default:
-	  break;
+	  if (ch != 'n' && ch != '\n')
+	    {
+	      add1_buffer(b, '\\');
+	      continue; /* bypass the add_then_next() call at bottom of loop */
+	    }
+	  ch = '\n';
 	}
-
-      /* Getting a character different from .=: whilst in state 1
-         goes back to state 0, getting a character different from ]
-         whilst in state 3 goes back to state 2.  */
-      state &= ~1;
+#endif
+      ch = add_then_next(b, ch);
     }
+
+  return ch;
 }
 
-static struct buffer *match_slash P_((int slash, bool regex));
+static struct buffer *match_slash P_((int slash, flagT regex, flagT keep_back));
 static struct buffer *
-match_slash(slash, regex)
+match_slash(slash, regex, keep_backwhack)
   int slash;
-  bool regex;
+  flagT regex;
+  flagT keep_backwhack;
 {
   struct buffer *b;
   int ch;
-  bool pending_mb = false;
-  mbstate_t cur_stat;
-
-  memset (&cur_stat, 0, sizeof (mbstate_t));
-
-  if (BRLEN (slash, &cur_stat) == -2)
-  if (BRLEN (slash, &cur_stat) == -2)
-    bad_prog (BAD_DELIM);
-
-  memset (&cur_stat, 0, sizeof (mbstate_t));
 
   b = init_buffer();
-  while ((ch = inchar()) != EOF && ch != '\n')
+  while ((ch = inchar()) != EOF && ch != '\n' && ch != slash)
     {
-      pending_mb = BRLEN (ch, &cur_stat) != 1;
-      pending_mb = BRLEN (ch, &cur_stat) != 1;
-
-      if (!pending_mb)
+      if (ch == '\\')
 	{
-	  if (ch == slash)
-	    return b;
-	  else if (ch == '\\')
-	    {
-	      ch = inchar();
-	      if (ch == EOF)
-	        break;
+	  ch = inchar();
+	  if (ch == EOF)
+	    break;
 #ifndef REG_PERL
-	      else if (ch == 'n' && regex)
-	        ch = '\n';
+	  else if (ch == 'n' && regex)
+	    ch = '\n';
 #endif
-	      else if (ch != '\n' && ch != slash)
-	        add1_buffer(b, '\\');
-	    }
-          else if (ch == OPEN_BRACKET && regex)
-	    {
-	      add1_buffer(b, ch);
-	      ch = snarf_char_class(b, &cur_stat);
-	      if (ch != CLOSE_BRACKET)
-	        break;
-	    }
+	  else if (ch != '\n' && (ch != slash || keep_backwhack))
+	    add1_buffer(b, '\\');
+	}
+      else if (ch == OPEN_BRACKET && regex)
+	{
+	  add1_buffer(b, ch);
+	  ch = snarf_char_class(b);
+	  if (ch != CLOSE_BRACKET)
+	    break;
 	}
-
       add1_buffer(b, ch);
     }
+  if (ch == slash)
+    return b;
 
   if (ch == '\n')
     savchar(ch);	/* for proper line number in error report */
@@ -588,19 +522,19 @@
   return NULL;
 }
 
-static int mark_subst_opts P_((struct subst *cmd));
-static int
+static flagT mark_subst_opts P_((struct subst *cmd));
+static flagT
 mark_subst_opts(cmd)
   struct subst *cmd;
 {
   int flags = 0;
   int ch;
 
-  cmd->global = false;
-  cmd->print = false;
-  cmd->eval = false;
+  cmd->global = FALSE;
+  cmd->print = FALSE;
+  cmd->eval = FALSE;
   cmd->numb = 0;
-  cmd->outf = NULL;
+  cmd->fp = NULL;
 
   for (;;)
     switch ( (ch = in_nonblank()) )
@@ -630,23 +564,23 @@
 	break;
 
       case 'e':
-	cmd->eval = true;
+	cmd->eval = TRUE;
 	break;
 
       case 'p':
 	if (cmd->print)
 	  bad_prog(_(EXCESS_P_OPT));
-	cmd->print |= (1 << cmd->eval); /* 1=before eval, 2=after */
+	cmd->print |= (TRUE << cmd->eval); /* 1=before eval, 2=after */
 	break;
 
       case 'g':
 	if (cmd->global)
 	  bad_prog(_(EXCESS_G_OPT));
-	cmd->global = true;
+	cmd->global = TRUE;
 	break;
 
       case 'w':
-	cmd->outf = get_openfile(&file_write, "w", true);
+	cmd->fp = get_openfile(&file_write, "w", TRUE);
 	return flags;
 
       case '0': case '1': case '2': case '3': case '4':
@@ -693,8 +627,10 @@
 
   while (ch != EOF && ch != '\n'
 	 && !ISBLANK(ch) && ch != ';' && ch != CLOSE_BRACE && ch != '#')
-    ch = add_then_next (b, ch);
-
+    {
+      add1_buffer(b, ch);
+      ch = inchar();
+    }
   savchar(ch);
   add1_buffer(b, '\0');
   ret = ck_strdup(get_buffer(b));
@@ -719,7 +655,7 @@
   ret->v_index = idx;
   ret->name = name;
   if (err_info)
-    MEMCPY(&ret->err_info, err_info, sizeof (ret->err_info));
+    MEMCPY(&ret->err_info, err_info, sizeof ret->err_info);
   ret->next = list;
   return ret;
 }
@@ -773,13 +709,13 @@
   char *base;
   char *p;
   char *text_end;
-  enum replacement_types repl_type = REPL_ASIS, save_type = REPL_ASIS;
+  enum replacement_types repl_type = repl_asis, save_type = repl_asis;
   struct replacement root;
   struct replacement *tail;
 
   sub->max_id = 0;
   base = MEMDUP(text, length, char);
-  length = normalize_text(base, length, TEXT_REPLACEMENT);
+  length = normalize_text(base, length);
 
   text_end = base + length;
   tail = &root;
@@ -794,10 +730,9 @@
 
 	  repl_type = save_type;
 
-	  /* Skip the backslash and look for a numeric back-reference,
-	     or a case-munging escape if not in POSIX mode: */
+	  /* Skip the backslash and look for a numeric back-reference: */
 	  ++p;
-	  if (p < text_end && (posixicity != POSIXLY_BASIC || ISDIGIT (*p)))
+	  if (p<text_end)
 	    switch (*p)
 	      {
 	      case '0': case '1': case '2': case '3': case '4': 
@@ -808,28 +743,28 @@
 		break;
 
 	      case 'L':
-		repl_type = REPL_LOWERCASE;
-		save_type = REPL_LOWERCASE;
+		repl_type = repl_lowercase;
+		save_type = repl_lowercase;
 		break;
 
 	      case 'U':
-		repl_type = REPL_UPPERCASE;
-		save_type = REPL_UPPERCASE;
+		repl_type = repl_uppercase;
+		save_type = repl_uppercase;
 		break;
 		
 	      case 'E':
-		repl_type = REPL_ASIS;
-		save_type = REPL_ASIS;
+		repl_type = repl_asis;
+		save_type = repl_asis;
 		break;
 
 	      case 'l':
 		save_type = repl_type;
-		repl_type |= REPL_LOWERCASE_FIRST;
+		repl_type |= repl_lowercase_first;
 		break;
 
 	      case 'u':
 		save_type = repl_type;
-		repl_type |= REPL_UPPERCASE_FIRST;
+		repl_type |= repl_uppercase_first;
 		break;
 		
 	      default:
@@ -881,34 +816,42 @@
 
   if (leadin_ch == EOF)
     return;
-
+#ifndef NO_INPUT_INDENT
   if (leadin_ch != '\n')
     add1_buffer(pending_text, leadin_ch);
-
   ch = inchar();
-  while (ch != EOF && ch != '\n')
+#else /*NO_INPUT_INDENT*/
+  if (leadin_ch == '\n')
+    ch = in_nonblank();
+  else
     {
-      if (ch == '\\')
-	{
-	  ch = inchar();
-	  if (ch != EOF)
-	    add1_buffer (pending_text, '\\');
-	}
+      add1_buffer(pending_text, leadin_ch);
+      ch = inchar();
+    }
+#endif /*NO_INPUT_INDENT*/
 
+  while (ch!=EOF && ch!='\n')
+    {
+      if (ch == '\\')
+	ch = inchar();
       if (ch == EOF)
 	{
-	  add1_buffer (pending_text, '\n');
+	  add1_buffer(pending_text, '\n');
 	  return;
 	}
-
-      ch = add_then_next (pending_text, ch);
+      add1_buffer(pending_text, ch);
+#ifdef NO_INPUT_INDENT
+      if (ch == '\n')
+	ch = in_nonblank();
+      else
+#endif /*NO_INPUT_INDENT*/
+	ch = inchar();
     }
-
   add1_buffer(pending_text, '\n');
+
   if (!buf)
     buf = old_text_buf;
-  buf->text_length = normalize_text (get_buffer (pending_text),
-				     size_buffer (pending_text), TEXT_BUFFER);
+  buf->text_length = size_buffer(pending_text);
   buf->text = MEMDUP(get_buffer(pending_text), buf->text_length, char);
   free_buffer(pending_text);
   pending_text = NULL;
@@ -919,13 +862,13 @@
    return non-zero and store the resulting address in `*addr'.
    If the input doesn't look like an address read nothing
    and return zero.  */
-static bool compile_address P_((struct addr *addr, int ch));
-static bool
+static flagT compile_address P_((struct addr *addr, int ch));
+static flagT
 compile_address(addr, ch)
   struct addr *addr;
   int ch;
 {
-  addr->addr_type = ADDR_IS_NULL;
+  addr->addr_type = addr_is_null;
   addr->addr_step = 0;
   addr->addr_number = ~(countT)0;  /* extremely unlikely to ever match */
   addr->addr_regex = NULL;
@@ -934,10 +877,10 @@
     {
       int flags = 0;
       struct buffer *b;
-      addr->addr_type = ADDR_IS_REGEX;
+      addr->addr_type = addr_is_regex;
       if (ch == '\\')
 	ch = inchar();
-      if ( !(b = match_slash(ch, true)) )
+      if ( !(b = match_slash(ch, TRUE, TRUE)) )
 	bad_prog(_(UNTERM_ADDR_RE));
 
       for(;;)
@@ -969,14 +912,14 @@
 	      savchar (ch);
 	      addr->addr_regex = compile_regex (b, flags, 0);
 	      free_buffer(b);
-	      return true;
+	      return TRUE;
 	    }
 	}
     }
   else if (ISDIGIT(ch))
     {
       addr->addr_number = in_integer(ch);
-      addr->addr_type = ADDR_IS_NUM;
+      addr->addr_type = addr_is_num;
       ch = in_nonblank();
       if (ch != '~')
 	{
@@ -988,7 +931,7 @@
 	  if (step > 0)
 	    {
 	      addr->addr_step = step;
-	      addr->addr_type = ADDR_IS_NUM_MOD;
+	      addr->addr_type = addr_is_num_mod;
 	    }
 	}
     }
@@ -996,20 +939,20 @@
     {
       addr->addr_step = in_integer(in_nonblank());
       if (addr->addr_step==0)
-	; /* default to ADDR_IS_NULL; forces matching to stop on next line */
+	; /* default to addr_is_null; forces matching to stop on next line */
       else if (ch == '+')
-	addr->addr_type = ADDR_IS_STEP;
+	addr->addr_type = addr_is_step;
       else
-	addr->addr_type = ADDR_IS_STEP_MOD;
+	addr->addr_type = addr_is_step_mod;
     }
   else if (ch == '$')
     {
-      addr->addr_type = ADDR_IS_LAST;
+      addr->addr_type = addr_is_last;
     }
   else
-    return false;
+    return FALSE;
 
-  return true;
+  return TRUE;
 }
 
 /* Read a program (or a subprogram within `{' `}' pairs) in and store
@@ -1047,9 +990,9 @@
       cur_cmd = next_cmd_entry(&vector);
       if (compile_address(&a, ch))
 	{
-	  if (a.addr_type == ADDR_IS_STEP
-	      || a.addr_type == ADDR_IS_STEP_MOD)
-	    bad_prog(_(BAD_STEP));
+	  if (a.addr_type == addr_is_step
+	      || a.addr_type == addr_is_step_mod)
+	    bad_prog(_(BAD_PLUS));
 
 	  cur_cmd->a1 = MEMDUP(&a, 1, struct addr);
 	  ch = in_nonblank();
@@ -1057,39 +1000,24 @@
 	    {
 	      if (!compile_address(&a, in_nonblank()))
 		bad_prog(_(BAD_COMMA));
-
+	      if (a.addr_type == addr_is_num)
+		a.addr_type = addr_is_num2;
 	      cur_cmd->a2 = MEMDUP(&a, 1, struct addr);
 	      ch = in_nonblank();
+	      if ((cur_cmd->a1->addr_type == addr_is_num
+		   || cur_cmd->a1->addr_type == addr_is_num_mod)
+	      	  && cur_cmd->a1->addr_number == 0)
+		cur_cmd->a1_matched = TRUE;
 	    }
-
-	  if (cur_cmd->a1->addr_type == ADDR_IS_NUM
-	      && cur_cmd->a1->addr_number == 0
-	      && (!cur_cmd->a2 || cur_cmd->a2->addr_type != ADDR_IS_REGEX))
-	    bad_prog(_(INVALID_LINE_0));
 	}
       if (ch == '!')
 	{
-	  cur_cmd->addr_bang = true;
+	  cur_cmd->addr_bang = TRUE;
 	  ch = in_nonblank();
 	  if (ch == '!')
 	    bad_prog(_(BAD_BANG));
 	}
 
-      /* Do not accept extended commands in --posix mode.  Also,
-	 a few commands only accept one address in that mode.  */
-      if (posixicity == POSIXLY_BASIC)
-	switch (ch)
-	  {
-	    case 'v': case 'L': case 'Q': case 'T':
-	    case 'R': case 'W':
-	      bad_command(ch);
-
-	    case 'a': case 'i': case 'l':
-	    case '=': case 'r':
-	      if (cur_cmd->a2)
-	        bad_prog(_(ONE_ADDR));
-	  }
-
       cur_cmd->cmd = ch;
       switch (ch)
 	{
@@ -1100,26 +1028,26 @@
 	  if (ch=='n' && first_script && cur_input.line < 2)
 	    if (   (prog.base && prog.cur==2+prog.base)
 		|| (prog.file && !prog.base && 2==ftell(prog.file)))
-	      no_default_output = true;
+	      no_default_output = TRUE;
 	  while (ch != EOF && ch != '\n')
 	    ch = inchar();
 	  continue;	/* restart the for (;;) loop */
 
 	case 'v':
-	  /* This is an extension.  Programs needing GNU sed might start
-	   * with a `v' command so that other seds will stop.
-	   * We compare the version and ignore POSIXLY_CORRECT.
-	   */
-	  {
-	    char *version = read_label ();
-	    char *compared_version;
-	    compared_version = (*version == '\0') ? "4.0" : version;
-	    if (strverscmp (compared_version, SED_FEATURE_VERSION) > 0)
-	      bad_prog(_(ANCIENT_VERSION));
+          /* This is an extension.  Programs needing GNU sed might start
+           * with a `v' command so that other seds will stop.
+           * We compare the version ignore it.
+           */
+          {
+            char *version = read_label ();
+            char *compared_version;
+            compared_version = (*version == '\0') ? "4.0" : version;
+            if (strverscmp (compared_version, SED_FEATURE_VERSION) > 0)
+              bad_prog(_(ANCIENT_VERSION));
 
-	    free (version);
-	    posixicity = POSIXLY_EXTENDED;
-	  }
+            free (version);
+	    POSIXLY_CORRECT = 0;
+          }
 	  continue;
 
 	case '{':
@@ -1154,6 +1082,10 @@
 
 	case 'a':
 	case 'i':
+	  if (POSIXLY_CORRECT && cur_cmd->a2)
+	    bad_prog(_(ONE_ADDR));
+	  /* Fall Through */
+
 	case 'c':
 	  ch = in_nonblank();
 
@@ -1178,20 +1110,23 @@
 	  labels = setup_label(labels, vector->v_length, read_label(), NULL);
 	  break;
 	
-	case 'T':
 	case 'b':
 	case 't':
+	case 'T':
 	  jumps = setup_label(jumps, vector->v_length, read_label(), NULL);
 	  break;
 
-	case 'Q':
 	case 'q':
+	case 'Q':
 	  if (cur_cmd->a2)
 	    bad_prog(_(ONE_ADDR));
 	  /* Fall through */
 
-	case 'L':
 	case 'l':
+	case 'L':
+	  if (POSIXLY_CORRECT && cur_cmd->a2)
+	    bad_prog(_(ONE_ADDR));
+
 	  ch = in_nonblank();
 	  if (ISDIGIT(ch)) 
 	    {
@@ -1209,6 +1144,9 @@
 	  break;
 
 	case '=':
+	  if (POSIXLY_CORRECT && cur_cmd->a2)
+	    bad_prog(_(ONE_ADDR));
+	  /* Fall Through */
 	case 'd':
 	case 'D':
 	case 'g':
@@ -1228,18 +1166,20 @@
 	  break;
 
 	case 'r':
+	  if (POSIXLY_CORRECT && cur_cmd->a2)
+	    bad_prog(_(ONE_ADDR));
 	  b = read_filename();
 	  cur_cmd->x.fname = ck_strdup(get_buffer(b));
 	  free_buffer(b);
 	  break;
 
         case 'R':
-	  cur_cmd->x.fp = get_openfile(&file_read, "r", false)->fp;
+	  cur_cmd->x.fp = get_openfile(&file_read, "r", FALSE);
 	  break;
 
-        case 'W':
 	case 'w':
-	  cur_cmd->x.outf = get_openfile(&file_write, "w", true);
+        case 'W':
+	  cur_cmd->x.fp = get_openfile(&file_write, "w", TRUE);
 	  break;
 
 	case 's':
@@ -1249,9 +1189,9 @@
 	    int slash;
 
 	    slash = inchar();
-	    if ( !(b  = match_slash(slash, true)) )
+	    if ( !(b  = match_slash(slash, TRUE, TRUE)) )
 	      bad_prog(_(UNTERM_S_CMD));
-	    if ( !(b2 = match_slash(slash, false)) )
+	    if ( !(b2 = match_slash(slash, FALSE, TRUE)) )
 	      bad_prog(_(UNTERM_S_CMD));
 
 	    cur_cmd->x.cmd_subst = OB_MALLOC(&obs, 1, struct subst);
@@ -1261,42 +1201,47 @@
 
 	    flags = mark_subst_opts(cur_cmd->x.cmd_subst);
 	    cur_cmd->x.cmd_subst->regx =
-	      compile_regex(b, flags, cur_cmd->x.cmd_subst->max_id + 1);
+	      compile_regex(b, flags, cur_cmd->x.cmd_subst->max_id);
 	    free_buffer(b);
 	  }
 	  break;
 
 	case 'y':
 	  {
-	    size_t len, dest_len;
+	    unsigned char *ustring;
+	    size_t len;
 	    int slash;
-	    struct buffer *b2;
-            char *src_buf, *dest_buf;
-  
+
+#if defined HAVE_MBRTOWC && !defined (REG_PERL)
+	    if (MB_CUR_MAX == 1)
+#endif
+	      {
+	        ustring = OB_MALLOC(&obs, YMAP_LENGTH, unsigned char);
+	        for (len = 0; len < YMAP_LENGTH; len++)
+	          ustring[len] = len;
+	        cur_cmd->x.translate = ustring;
+	      }
+
 	    slash = inchar();
-	    if ( !(b = match_slash(slash, true)) )
+	    if ( !(b = match_slash(slash, FALSE, FALSE)) )
 	      bad_prog(_(UNTERM_Y_CMD));
-            src_buf = get_buffer(b);
-	    len = normalize_text(src_buf, size_buffer (b), TEXT_BUFFER);
-
-            if ( !(b2 = match_slash(slash, true)) )
- 	      bad_prog(_(UNTERM_Y_CMD));
-            dest_buf = get_buffer(b2);
-	    dest_len = normalize_text(dest_buf, size_buffer (b2), TEXT_BUFFER);
 
-            if (mb_cur_max > 1)
+#if defined HAVE_MBRTOWC && !defined (REG_PERL)
+            if (MB_CUR_MAX > 1)
 	      {
-                int i, j, idx, src_char_num;
+                int i, j, idx, src_char_num, len = size_buffer(b);
                 size_t *src_lens = MALLOC(len, size_t);
-                char **trans_pairs;
+                char *src_buf, *dest_buf, **trans_pairs;
                 size_t mbclen;
                 mbstate_t cur_stat;
+	        struct buffer *b2;
 
                 /* Enumerate how many character the source buffer has.  */
                 memset(&cur_stat, 0, sizeof(mbstate_t));
+                src_buf = get_buffer(b);
                 for (i = 0, j = 0; i < len;)
                   {
-                    mbclen = MBRLEN (src_buf + i, len - i, &cur_stat);
+                    mbclen = mbrlen(src_buf + i, len - i, &cur_stat);
                     /* An invalid sequence, or a truncated multibyte character.
                        We treat it as a singlebyte character.  */
                     if (mbclen == (size_t) -1 || mbclen == (size_t) -2
@@ -1308,7 +1253,11 @@
                 src_char_num = j;
 
                 memset(&cur_stat, 0, sizeof(mbstate_t));
+                if ( !(b2 = match_slash(slash, FALSE, FALSE)) )
+ 		  bad_prog(_(UNTERM_Y_CMD));
+                dest_buf = get_buffer(b2);
                 idx = 0;
+                len = size_buffer(b2);
 
                 /* trans_pairs = {src(0), dest(0), src(1), dest(1), ..., NULL}
                      src(i) : pointer to i-th source character.
@@ -1318,7 +1267,7 @@
                 cur_cmd->x.translatemb = trans_pairs;
                 for (i = 0; i < src_char_num; i++)
                   {
-                    if (idx >= dest_len)
+                    if (idx >= len)
                       bad_prog(_(Y_CMD_LEN));
 
                     /* Set the i-th source character.  */
@@ -1328,7 +1277,7 @@
                     src_buf += src_lens[i]; /* Forward to next character.  */
 
                     /* Fetch the i-th destination character.  */
-                    mbclen = MBRLEN (dest_buf + idx, dest_len - idx, &cur_stat);
+                    mbclen = mbrlen(dest_buf + idx, len - idx, &cur_stat);
                     /* An invalid sequence, or a truncated multibyte character.
                        We treat it as a singlebyte character.  */
                     if (mbclen == (size_t) -1 || mbclen == (size_t) -2
@@ -1342,41 +1291,49 @@
                     idx += mbclen; /* Forward to next character.  */
                   }
                 trans_pairs[2 * i] = NULL;
-                if (idx != dest_len)
+                if (idx != len)
                   bad_prog(_(Y_CMD_LEN));
+                free_buffer(b);
+                free_buffer(b2);
               }
             else
+#endif
               {
-	        char *translate = OB_MALLOC(&obs, YMAP_LENGTH, char);
-                unsigned char *ustring = CAST(unsigned char *)src_buf;
-
-		if (len != dest_len)
-                  bad_prog(_(Y_CMD_LEN));
-
-	        for (len = 0; len < YMAP_LENGTH; len++)
-	          translate[len] = len;
-
-                while (dest_len--)
-                  translate[(unsigned char)*ustring++] = *dest_buf++;
+                ustring = CAST(unsigned char *)get_buffer(b);
+                for (len = size_buffer(b); len; --len)
+                  {
+                    ch = inchar();
+                    if (ch == slash)
+                      bad_prog(_(Y_CMD_LEN));
+                    if (ch == '\n')
+                      bad_prog(UNTERM_Y_CMD);
+                    if (ch == '\\')
+                      ch = inchar();
+                    if (ch == EOF)
+                      bad_prog(UNTERM_Y_CMD);
+                    cur_cmd->x.translate[*ustring++] = ch;
+                  }
+                free_buffer(b);
 
-	        cur_cmd->x.translate = translate;
+                if (inchar() != slash)
+		  bad_prog(_(Y_CMD_LEN));
+                else if ((ch = in_nonblank()) != EOF && ch != '\n' && ch != ';')
+                  bad_prog(_(EXCESS_JUNK));
 	      }
-
-            if ((ch = in_nonblank()) != EOF && ch != '\n' && ch != ';')
-              bad_prog(_(EXCESS_JUNK));
-
-            free_buffer(b);
-            free_buffer(b2);
 	  }
 	break;
 
 	case EOF:
 	  bad_prog(_(NO_COMMAND));
 	  /*NOTREACHED*/
-
 	default:
-	  bad_command (ch);
-	  /*NOTREACHED*/
+	  {
+	    const char *msg = _("Unknown command:");
+	    char *unknown_cmd = xmalloc(strlen(msg) + 5);
+	    sprintf(unknown_cmd, "%s `%c'", msg, ch);
+	    bad_prog(unknown_cmd);
+	    /*NOTREACHED*/
+	  }
 	}
 
       /* this is buried down here so that "continue" statements will miss it */
@@ -1386,159 +1343,113 @@
 }
 
 
+/* Complain about a programming error and exit. */
+void
+bad_prog(why)
+  const char *why;
+{
+  if (cur_input.name)
+    fprintf(stderr, _("%s: file %s line %lu: %s\n"),
+	    myname, cur_input.name, CAST(unsigned long)cur_input.line, why);
+  else
+    fprintf(stderr, _("%s: -e expression #%lu, char %lu: %s\n"),
+	    myname,
+	    CAST(unsigned long)cur_input.string_expr_count,
+	    CAST(unsigned long)(prog.cur-prog.base),
+	    why);
+  exit(EXIT_FAILURE);
+}
+
+
 /* deal with \X escapes */
 size_t
-normalize_text(buf, len, buftype)
+normalize_text(buf, len)
   char *buf;
   size_t len;
-  enum text_types buftype;
 {
   const char *bufend = buf + len;
   char *p = buf;
   char *q = buf;
 
-  /* This variable prevents normalizing text within bracket
-     subexpressions when conforming to POSIX.  If 0, we
-     are not within a bracket expression.  If -1, we are within a
-     bracket expression but are not within [.FOO.], [=FOO=],
-     or [:FOO:].  Otherwise, this is the '.', '=', or ':'
-     respectively within these three types of subexpressions.  */
-  int bracket_state = 0;
-
-  int mbclen;
-  mbstate_t cur_stat;
-  memset(&cur_stat, 0, sizeof(mbstate_t));
+  /* I'm not certain whether POSIX.2 allows these escapes.
+     Play it safe for now... */
+  if (POSIXLY_CORRECT && !(extended_regexp_flags))
+    return len;
 
   while (p < bufend)
     {
       int c;
-      mbclen = MBRLEN (p, bufend - p, &cur_stat);
-      if (mbclen != 1)
-	{
-          /* An invalid sequence, or a truncated multibyte character.
-             We treat it as a singlebyte character.  */
-          if (mbclen == (size_t) -1 || mbclen == (size_t) -2 || mbclen == 0)
-            mbclen = 1;
-
-          memmove (q, p, mbclen);
-          q += mbclen;
-          p += mbclen;
-	  continue;
-	}
 
-      if (*p == '\\' && p+1 < bufend && bracket_state == 0)
-	switch ( (c = *++p) )
+      *q = *p++;
+      if (*q == '\\' && p < bufend)
+	switch ( (c = *p++) )
 	  {
 #if defined __STDC__ && __STDC__-0
-	  case 'a': *q++ = '\a'; p++; continue;
+	  case 'a': *q = '\a'; break;
 #else /* Not STDC; we'll just assume ASCII */
-	  case 'a': *q++ = '\007'; p++; continue;
+	  case 'a': *q = '\007'; break;
 #endif
-	  /* case 'b': *q++ = '\b'; p++; continue; --- conflicts with \b RE */
-	  case 'f': *q++ = '\f'; p++; continue;
+	  /* case 'b': *q = '\b'; break; --- conflicts with \b RE */
+	  case 'f': *q = '\f'; break;
 	  case '\n': /*fall through */
-	  case 'n': *q++ = '\n'; p++; continue;
-	  case 'r': *q++ = '\r'; p++; continue;
-	  case 't': *q++ = '\t'; p++; continue;
-	  case 'v': *q++ = '\v'; p++; continue;
+	  case 'n': *q = '\n'; break;
+	  case 'r': *q = '\r'; break;
+	  case 't': *q = '\t'; break;
+	  case 'v': *q = '\v'; break;
 
 	  case 'd': /* decimal byte */
-	    p = convert_number(q, p+1, bufend, 10, 3, 'd');
-	    q++;
-	    continue;
+	    p = convert_number(q, p, bufend, 10, 3, 'd');
+	    break;
 
 	  case 'x': /* hexadecimal byte */
-	    p = convert_number(q, p+1, bufend, 16, 2, 'x');
-	    q++;
-	    continue;
+	    p = convert_number(q, p, bufend, 16, 2, 'x');
+	    break;
 
 #ifdef REG_PERL
 	  case '0': case '1': case '2': case '3':
 	  case '4': case '5': case '6': case '7':
-	    if ((extended_regexp_flags & REG_PERL)
-		&& p+1 < bufend
-		&& p[1] >= '0' && p[1] <= '9')
+	    if ((extended_regexp_flags & REG_PERL) &&
+		p < bufend && isdigit(*p))
 	      {
+		p--;
 		p = convert_number(q, p, bufend, 8, 3, *p);
-		q++;
 	      }
 	    else
-	      {
-		/* we just pass the \ up one level for interpretation */
-	        if (buftype != TEXT_BUFFER)
-		  *q++ = '\\';
-	      }
+	      /* we just pass the \ up one level for interpretation */
+	      *++q = p[-1];
 
-	    continue;
+	    break;
 
 	  case 'o': /* octal byte */
 	    if (!(extended_regexp_flags & REG_PERL))
-	      {
-	        p = convert_number(q, p+1, bufend,  8, 3, 'o');
-		q++;
-	      }
+	      p = convert_number(q, p, bufend,  8, 3, 'o');
 	    else
-	      {
-	        /* we just pass the \ up one level for interpretation */
-	        if (buftype != TEXT_BUFFER)
-		  *q++ = '\\';
-	      }
+	      /* we just pass the \ up one level for interpretation */
+	      *++q = p[-1];
 	    
-	    continue;
+	    break;
+
 #else
 	  case 'o': /* octal byte */
-	    p = convert_number(q, p+1, bufend,  8, 3, 'o');
-	    q++;
-	    continue;
+	    p = convert_number(q, p, bufend,  8, 3, 'o');
+	    break;
 #endif
 
 	  case 'c':
-	    if (++p < bufend)
+	    if (p < bufend)
 	      {
-		*q++ = toupper(*p) ^ 0x40;
+		*q = toupper(*p) ^ 0x40;
 		p++;
-		continue;
-	      }
-	    else
-	      {
-	        /* we just pass the \ up one level for interpretation */
-	        if (buftype != TEXT_BUFFER)
-		  *q++ = '\\';
-	        continue;
+		break;
 	      }
+	    /* else FALLTHROUGH */
 
 	  default:
 	    /* we just pass the \ up one level for interpretation */
-	    if (buftype != TEXT_BUFFER)
-	      *q++ = '\\';
+	    *++q = p[-1];
 	    break;
 	  }
-      else if (buftype == TEXT_REGEX && posixicity != POSIXLY_EXTENDED)
-        switch (*p)
-          {
-          case '[':
-            if (!bracket_state)
-              bracket_state = -1;
-            break;
- 
-	  case ':':
-	  case '.':
-	  case '=':
-            if (bracket_state == -1 && p[-1] == '[')
-              bracket_state = *p;
-            break;
-
-          case ']':
-            if (bracket_state == 0)
-	      ;
-            else if (bracket_state == -1)
-              bracket_state = 0;
-            else if (p[-2] != bracket_state && p[-1] == bracket_state)
-              bracket_state = -1;
-            break;
-          }
-
-      *q++ = *p++;
+      ++q;
     }
     return (size_t)(q - buf);
 }
@@ -1569,7 +1480,7 @@
   prog.cur = NULL;
   prog.end = NULL;
 
-  first_script = false;
+  first_script = FALSE;
   return ret;
 }
 
@@ -1586,7 +1497,7 @@
 
   prog.file = stdin;
   if (cmdfile[0] != '-' || cmdfile[1] != '\0')
-    prog.file = ck_fopen(cmdfile, "rt", true);
+    prog.file = ck_fopen(cmdfile, "rt", TRUE);
 
   cur_input.line = 1;
   cur_input.name = cmdfile;
@@ -1597,7 +1508,7 @@
     ck_fclose(prog.file);
   prog.file = NULL;
 
-  first_script = false;
+  first_script = FALSE;
   return ret;
 }
 
@@ -1615,7 +1526,7 @@
   if (blocks)
     {
       /* update info for error reporting: */
-      MEMCPY(&cur_input, &blocks->err_info, sizeof (cur_input));
+      MEMCPY(&cur_input, &blocks->err_info, sizeof cur_input);
       bad_prog(_(EXCESS_OPEN_BRACE));
     }
 
@@ -1641,7 +1552,7 @@
       else
 	{
 	  if (*go->name)
-	    panic(_("can't find label for jump to `%s'"), go->name);
+	    panic(_("Can't find label for jump to `%s'"), go->name);
 	  program->v[go->v_index].x.jump_index = program->v_length;
 	}
     }
@@ -1653,7 +1564,7 @@
 
   /* There is no longer a need to track file names: */
   {
-    struct output *p;
+    struct fp_list *p;
 
     for (p=file_read; p; p=p->link)
       if (p->name)
@@ -1671,14 +1582,14 @@
   }
 }
 
-/* Rewind all resources which were allocated in this module. */
+/* Release all resources which were allocated in this module. */
 void
 rewind_read_files()
 {
-  struct output *p;
+  struct fp_list *p, *q;
 
   for (p=file_read; p; p=p->link)
-    if (p->fp)
+    if (p->fp && !p->special)
       rewind(p->fp);
 }
 
@@ -1689,11 +1600,11 @@
 {
   /* close all files... */
   {
-    struct output *p, *q;
+    struct fp_list *p, *q;
 
     for (p=file_read; p; p=q)
       {
-	if (p->fp)
+	if (p->fp && !p->special)
 	  ck_fclose(p->fp);
 	q = p->link;
 #if 0
@@ -1704,7 +1615,7 @@
 
     for (p=file_write; p; p=q)
       {
-	if (p->fp)
+	if (p->fp && !p->special)
 	  ck_fclose(p->fp);
 	q = p->link;
 #if 0
--- 4.1.4/sed/execute.c
+++ 4.0.9/sed/execute.c
@@ -79,10 +79,7 @@
   char *active;		/* Pointer to non-consumed part of text. */
   size_t length;	/* Length of text (or active, if used). */
   size_t alloc;		/* Allocated space for active. */
-  bool chomped;		/* Was a trailing newline dropped? */
-#ifdef HAVE_MBRTOWC
-  mbstate_t mbstate;
-#endif
+  flagT chomped;	/* Was a trailing newline dropped? */
 };
 
 /* A queue of text to write out at the end of a cycle
@@ -92,48 +89,35 @@
   char *text;
   size_t textlen;
   struct append_queue *next;
-  bool free;
+  flagT free;
 };
 
 /* State information for the input stream. */
 struct input {
-  /* The list of yet-to-be-opened files.  It is invalid for file_list
-     to be NULL.  When *file_list is NULL we are currently processing
-     the last file.  */
-
-  char **file_list;
-
-  /* Count of files we failed to open. */
-  countT bad_count;	    
-
-  /* Current input line number (over all files).  */
-  countT line_number;	    
-
-  /* True if we'll reset line numbers and addresses before
-     starting to process the next (possibly the first) file.  */
-  bool reset_at_next_file;
-
-  /* Function to read one line.  If FP is NULL, read_fn better not
-     be one which uses fp; in particular, read_always_fail() is
-     recommended. */
-  bool (*read_fn) P_((struct input *));	/* read one line */
+  char **file_list;	/* The list of yet-to-be-opened files.
+			   It is invalid for file_list to be NULL.
+			   When *file_list is NULL we are
+			   currently processing the last file. */
+  countT bad_count;	/* count of files we failed to open */
+  countT line_number;	/* current input line number (over all files) */
+
+  flagT (*read_fn) P_((struct input *));	/* read one line */
+  /* If fp is NULL, read_fn better not be one which uses fp;
+     in particular, read_always_fail() is recommended. */
 
   char *out_file_name;
-
   const char *in_file_name;
 
-  /* if NULL, none of the following are valid */
-  FILE *fp;
-
-  bool no_buffering;
+  FILE *fp;		/* if NULL, none of the following are valid */
+  flagT no_buffering;
 };
 
 
 /* Have we done any replacements lately?  This is used by the `t' command. */
-static bool replaced = false;
+static flagT replaced = FALSE;
 
 /* The current output file (stdout if -i is not being used. */
-static struct output output_file;
+static FILE *output_file;
 
 /* The `current' input line. */
 static struct line line;
@@ -228,28 +212,6 @@
     resize_line(to, new_length);
   MEMCPY(to->active + to->length, string, length);
   to->length = new_length;
-
-#ifdef HAVE_MBRTOWC
-  if (mb_cur_max == 1)
-    return;
-
-  while (length)
-    {
-      int n = MBRLEN (string, length, &to->mbstate);
-
-      /* An invalid sequence is treated like a singlebyte character. */
-      if (n == -1)
-	{
-	  memset (&to->mbstate, 0, sizeof (to->mbstate));
-	  n = 1;
-	}
-
-      if (n > 0)
-	length -= n;
-      else
-	break;
-    }
-#endif
 }
 
 static void str_append_modified P_((struct line *, const char *, size_t,
@@ -267,104 +229,34 @@
   if (length == 0)
     return;
 
-#ifdef HAVE_MBRTOWC
-  {
-    mbstate_t from_stat;
-
-    if (type == REPL_ASIS)
-      {
-	str_append(to, string, length);
-        return;
-      }
-
-    if (to->alloc - to->length < length * mb_cur_max)
-      resize_line(to, to->length + length * mb_cur_max);
-
-    MEMCPY (&from_stat, &to->mbstate, sizeof(mbstate_t));
-    while (length)
-      {
-	wchar_t wc;
-        int n = MBRTOWC (&wc, string, length, &from_stat);
-
-        /* An invalid sequence is treated like a singlebyte character. */
-        if (n == -1)
-          {
-            memset (&to->mbstate, 0, sizeof (from_stat));
-            n = 1;
-          }
-
-        if (n > 0)
-          string += n, length -= n;
-        else
-	  {
-	    /* Incomplete sequence, copy it manually.  */
-	    str_append(to, string, length);
-	    return;
-	  }
-
-	/* Convert the first character specially... */
-        if (type & (REPL_UPPERCASE_FIRST | REPL_LOWERCASE_FIRST))
-	  {
-            if (type & REPL_UPPERCASE_FIRST)
-              wc = towupper(wc);
-            else
-              wc = towlower(wc);
-
-            type &= ~(REPL_LOWERCASE_FIRST | REPL_UPPERCASE_FIRST);
-	    if (type == REPL_ASIS)
-	      {
-		n = WCRTOMB (to->active + to->length, wc, &to->mbstate);
-		to->length += n;
-		str_append(to, string, length);
-	        return;
-	      }
-          }
-
-        else if (type & REPL_UPPERCASE)
-          wc = towupper(wc);
-        else
-          wc = towlower(wc);
-
-	/* Copy the new wide character to the end of the string. */
-	n = WCRTOMB (to->active + to->length, wc, &to->mbstate);
-        to->length += n;
-	if (n == -1)
-	  {
-	    fprintf (stderr, "Case conversion produced an invalid character!");
-	    abort ();
-	  }
-      }
-  }
-#else
   str_append(to, string, length);
   start = to->active + old_length;
   end = start + length;
 
   /* Now do the required modifications.  First \[lu]... */
-  if (type & REPL_UPPERCASE_FIRST)
+  if (type & repl_uppercase_first)
     {
       *start = toupper(*start);
       start++;
-      type &= ~REPL_UPPERCASE_FIRST;
+      type &= ~repl_uppercase_first;
     }
-  else if (type & REPL_LOWERCASE_FIRST)
+  else if (type & repl_lowercase_first)
     {
       *start = tolower(*start);
       start++;
-      type &= ~REPL_LOWERCASE_FIRST;
+      type &= ~repl_lowercase_first;
     }
 
-  if (type == REPL_ASIS)
+  if (type == repl_asis)
     return;
 
   /* ...and then \[LU] */
-  if (type == REPL_UPPERCASE)
+  if (type == repl_uppercase)
     for (; start != end; start++)
       *start = toupper(*start);
   else
     for (; start != end; start++)
       *start = tolower(*start);
-#endif
 }
 
 /* initialize a "struct line" buffer */
@@ -378,12 +270,7 @@
   buf->active = buf->text;
   buf->alloc = initial_size;
   buf->length = 0;
-  buf->chomped = true;
-
-#ifdef HAVE_MBRTOWC
-  memset (&buf->mbstate, 0, sizeof (buf->mbstate));
-#endif
-
+  buf->chomped = TRUE;
 }
 
 /* Copy the contents of the line `from' into the line `to'.
@@ -414,10 +301,6 @@
   to->length = from->length;
   to->chomped = from->chomped;
   MEMCPY(to->active, from->active, from->length);
-
-#ifdef HAVE_MBRTOWC
-  MEMCPY(&to->mbstate, &from->mbstate, sizeof (from->mbstate));
-#endif
 }
 
 /* Append the contents of the line `from' to the line `to'. */
@@ -430,10 +313,6 @@
   str_append(to, "\n", 1);
   str_append(to, from->active, from->length);
   to->chomped = from->chomped;
-
-#ifdef HAVE_MBRTOWC
-  MEMCPY (&to->mbstate, &from->mbstate, sizeof (from->mbstate));
-#endif
 }
 
 /* Exchange the contents of two "struct line" buffers. */
@@ -452,77 +331,56 @@
 
 
 /* dummy function to simplify read_pattern_space() */
-static bool read_always_fail P_((struct input *));
-static bool
+static flagT read_always_fail P_((struct input *));
+static flagT
 read_always_fail(input)
   struct input *input UNUSED;
 {
-  return false;
+  return FALSE;
 }
 
-static bool read_file_line P_((struct input *));
-static bool
+static flagT read_file_line P_((struct input *));
+static flagT
 read_file_line(input)
   struct input *input;
 {
   static char *b;
   static size_t blen;
 
-  long result = ck_getline (&b, &blen, input->fp);
-  if (result <= 0)
-    return false;
+  long result = getline (&b, &blen, input->fp);
 
   /* Remove the trailing new-line that is left by getline. */
-  if (b[result - 1] == '\n')
+  if (result > 0 && b[result - 1] == '\n')
     --result;
   else
-    line.chomped = false;
-
-  str_append(&line, b, result);
-  return true;
-}
-
-
-static inline void output_missing_newline P_((struct output *));
-static inline void
-output_missing_newline(outf)
-  struct output *outf;
-{
-  if (outf->missing_newline)
     {
-      ck_fwrite("\n", 1, 1, outf->fp);
-      outf->missing_newline = false;
+      /* No trailing new line found. */
+      if (!*input->file_list && !POSIXLY_CORRECT)
+	line.chomped = FALSE;
+
+      if (result <= 0)
+	return FALSE;
     }
-}
 
-static inline void flush_output P_((FILE *));
-static inline void
-flush_output(fp)
-  FILE *fp;
-{
-  if (fp != stdout || unbuffered_output)
-    ck_fflush(fp);
+  str_append(&line, b, result);
+  return TRUE;
 }
 
-static void output_line P_((const char *, size_t, bool, struct output *));
+
+static void output_line P_((const char *, size_t, flagT, FILE *));
 static void
-output_line(text, length, nl, outf)
+output_line(text, length, nl, fp)
   const char *text;
   size_t length;
-  bool nl;
-  struct output *outf;
+  flagT nl;
+  FILE *fp;
 {
-  output_missing_newline(outf);
-
   if (length)
-    ck_fwrite(text, 1, length, outf->fp);
-
+    ck_fwrite(text, 1, length, fp);
   if (nl)
-    ck_fwrite("\n", 1, 1, outf->fp);
-  else
-    outf->missing_newline = true;
-
-  flush_output(outf->fp);
+    ck_fwrite("\n", 1, 1, fp);
+  if (fp != stdout || unbuffered_output)
+    ck_fflush(fp);
 }
 
 static struct append_queue *next_append_slot P_((void));
@@ -535,7 +393,7 @@
   n->text = NULL;
   n->textlen = 0;
   n->next = NULL;
-  n->free = false;
+  n->free = FALSE;
 
   if (append_tail)
       append_tail->next = n;
@@ -553,7 +411,7 @@
   for (p=append_head; p; p=q)
     {
       if (p->free)
-        FREE(p->text);
+	FREE(p->text);
 
       q = p->next;
       FREE(p);
@@ -567,12 +425,10 @@
 {
   struct append_queue *p;
 
-  output_missing_newline(&output_file);
   for (p=append_head; p; p=p->next)
     {
       if (p->text)
-        ck_fwrite(p->text, 1, p->textlen, output_file.fp);
-
+	  output_line(p->text, p->textlen, FALSE, output_file);
       if (p->fname)
 	{
 	  char buf[FREAD_BUFFER_SIZE];
@@ -583,17 +439,15 @@
 	     be treated as if it were an empty file, causing no error
 	     condition."  IEEE Std 1003.2-1992
 	     So, don't fail. */
-	  fp = ck_fopen(p->fname, "r", false);
+	  fp = ck_fopen(p->fname, "r", FALSE);
 	  if (fp)
 	    {
 	      while ((cnt = ck_fread(buf, 1, sizeof buf, fp)) > 0)
-		ck_fwrite(buf, 1, cnt, output_file.fp);
+		ck_fwrite(buf, 1, cnt, output_file);
 	      ck_fclose(fp);
 	    }
 	}
     }
-
-  flush_output(output_file.fp);
   release_append_queue();
 }
 
@@ -620,7 +474,7 @@
        asterisk = strchr(old_asterisk, '*');
        old_asterisk = asterisk + 1)
     {
-      MEMCPY (p, old_asterisk, asterisk - old_asterisk);
+      memcpy (p, old_asterisk, asterisk - old_asterisk);
       p += asterisk - old_asterisk;
       strcpy (p, name);
       p += name_length;
@@ -640,12 +494,12 @@
 {
   buffer.length = 0;
 
-  if (name[0] == '-' && name[1] == '\0' && !in_place_extension)
+  if (name[0] == '-' && name[1] == '\0')
     {
       clearerr(stdin);	/* clear any stale EOF indication */
       input->fp = stdin;
     }
-  else if ( ! (input->fp = ck_fopen(name, "r", false)) )
+  else if ( ! (input->fp = ck_fopen(name, "r", FALSE)) )
     {
       const char *ptr = strerror(errno);
       fprintf(stderr, _("%s: can't read %s: %s\n"), myname, name, ptr);
@@ -660,7 +514,6 @@
     {
       int output_fd;
       char *tmpdir = ck_strdup(name), *p;
-      struct stat st;
 
       /* get the base name */
       if (p = strrchr(tmpdir, '/'))
@@ -669,32 +522,27 @@
 	strcpy(tmpdir, ".");
       
       input->in_file_name = name;
-
-      if (isatty (fileno (input->fp)))
-        panic(_("couldn't edit %s: is a terminal"), input->in_file_name);
-
-      fstat (fileno (input->fp), &st);
-      if (!S_ISREG (st.st_mode))
-        panic(_("couldn't edit %s: not a regular file"), input->in_file_name);
-
-      output_file.fp = ck_mkstemp (&input->out_file_name, tmpdir, "sed");
-      output_file.missing_newline = false;
+      input->out_file_name = temp_file_template (tmpdir, "sed");
+      output_fd = mkstemp (input->out_file_name);
       free (tmpdir);
 
-      if (!output_file.fp)
-        panic(_("couldn't open temporary file %s: %s"), input->out_file_name, strerror(errno));
+      if (output_fd == -1)
+        panic(_("Couldn't open temporary file %s: %s"), input->out_file_name, strerror(errno));
 
-      output_fd = fileno (output_file.fp);
 #ifdef HAVE_FCHMOD
-      fchmod (output_fd, st.st_mode);
-#endif
-#ifdef HAVE_FCHOWN
-      if (fchown (output_fd, st.st_uid, st.st_gid) == -1)
-        fchown (output_fd, -1, st.st_gid);
+      {
+	struct stat st;
+	fstat (fileno (input->fp), &st);
+	fchmod (output_fd, st.st_mode);
+      }
 #endif
+
+      output_file = fdopen (output_fd, "w");
+      if (!output_file)
+        panic(_("Couldn't open temporary file %s: %s"), input->out_file_name, strerror(errno));
     }
   else
-    output_file.fp = stdout;
+    output_file = stdout;
 }
 
 
@@ -710,21 +558,26 @@
   if (input->fp != stdin) /* stdin can be reused on tty and tape devices */
     ck_fclose(input->fp);
 
-  if (in_place_extension && output_file.fp != NULL)
+  if (in_place_extension && output_file != NULL)
     {
-      ck_fclose (output_file.fp);
+      int fd = fileno (output_file);
       if (strcmp(in_place_extension, "*") != 0)
         {
           char *backup_file_name = get_backup_file_name(input->in_file_name);
-	  ck_rename (input->in_file_name, backup_file_name, input->out_file_name);
+          rename (input->in_file_name, backup_file_name);
           free (backup_file_name);
-	}
+        }
 
-      ck_rename (input->out_file_name, input->in_file_name, input->out_file_name);
+      ck_fclose (output_file);
+      close (fd);
+      rename (input->out_file_name, input->in_file_name);
       free (input->out_file_name);
     }
 
   input->fp = NULL;
+
+  if (separate_files)
+    rewind_read_files ();
 }
 
 /* Reset range commands so that they are marked as non-matching */
@@ -737,63 +590,58 @@
   int n;
 
   for (cur_cmd = vec->v, n = vec->v_length; n--; cur_cmd++)
-    if (cur_cmd->a1
-	&& (cur_cmd->a1->addr_type == ADDR_IS_NUM
-	    || cur_cmd->a1->addr_type == ADDR_IS_NUM_MOD)
-	&& cur_cmd->a1->addr_number == 0)
-      cur_cmd->range_state = RANGE_ACTIVE;
+    if (cur_cmd->a1)
+      {
+	enum addr_types type = cur_cmd->a1->addr_type;
+        cur_cmd->a1_matched = (type == addr_is_num || type == addr_is_num_mod)
+                              && cur_cmd->a1->addr_number == 0;
+      }
     else
-      cur_cmd->range_state = RANGE_INACTIVE;
+      cur_cmd->a1_matched = FALSE;
 }
 
 /* Read in the next line of input, and store it in the pattern space.
    Return zero if there is nothing left to input. */
-static bool read_pattern_space P_((struct input *, struct vector *, bool));
-static bool
+static flagT read_pattern_space P_((struct input *, struct vector *, flagT));
+static flagT
 read_pattern_space(input, the_program, append)
   struct input *input;
   struct vector *the_program;
-  bool append;
+  flagT append;
 {
   if (append_head) /* redundant test to optimize for common case */
     dump_append_queue();
-  replaced = false;
+  replaced = FALSE;
   if (!append)
     line.length = 0;
-  line.chomped = true;  /* default, until proved otherwise */
+  line.chomped = TRUE;  /* default, until proved otherwise */
 
   while ( ! (*input->read_fn)(input) )
     {
       closedown(input);
 
       if (!*input->file_list)
-	return false;
+	{
+	  line.chomped = FALSE;
+	  return FALSE;
+	}
 
-      if (input->reset_at_next_file)
+      if (separate_files)
 	{
 	  input->line_number = 0;
 	  reset_addresses (the_program);
-	  rewind_read_files ();
-
-	  /* If doing in-place editing, we will never append the
-	     new-line to this file; but if the output goes to stdout,
-	     we might still have to output the missing new-line.  */
-	  if (in_place_extension)
-	    output_file.missing_newline = false;
-
-	  input->reset_at_next_file = separate_files;
 	}
 
       open_next_file (*input->file_list++, input);
     }
 
   ++input->line_number;
-  return true;
+  return TRUE;
 }
 
 
-static bool last_file_with_data_p P_((struct input *));
-static bool
+static flagT last_file_with_data_p P_((struct input *));
+static flagT
 last_file_with_data_p(input)
   struct input *input;
 {
@@ -803,29 +651,29 @@
 
       closedown(input);
       if (!*input->file_list)
-	return true;
+	return TRUE;
       open_next_file(*input->file_list++, input);
       if (input->fp)
 	{
 	  if ((ch = getc(input->fp)) != EOF)
 	    {
 	      ungetc(ch, input->fp);
-	      return false;
+	      return FALSE;
 	    }
 	}
     }
 }
 
 /* Determine if we match the `$' address. */
-static bool test_eof P_((struct input *));
-static bool
+static flagT test_eof P_((struct input *));
+static flagT
 test_eof(input)
   struct input *input;
 {
   int ch;
 
   if (buffer.length)
-    return false;
+    return FALSE;
   if (!input->fp)
     return separate_files || last_file_with_data_p(input);
   if (feof(input->fp))
@@ -833,125 +681,97 @@
   if ((ch = getc(input->fp)) == EOF)
     return separate_files || last_file_with_data_p(input);
   ungetc(ch, input->fp);
-  return false;
+  return FALSE;
 }
 
 /* Return non-zero if the current line matches the address
    pointed to by `addr'. */
-static bool match_an_address_p P_((struct addr *, struct input *));
-static bool
+static flagT match_an_address_p P_((struct addr *, struct input *));
+static flagT
 match_an_address_p(addr, input)
   struct addr *addr;
   struct input *input;
 {
   switch (addr->addr_type)
     {
-    case ADDR_IS_NULL:
-      return true;
+    case addr_is_null:
+      return TRUE;
 
-    case ADDR_IS_REGEX:
+    case addr_is_regex:
       return match_regex(addr->addr_regex, line.active, line.length, 0, NULL, 0);
 
-    case ADDR_IS_NUM_MOD:
-      return (input->line_number >= addr->addr_number
-	      && ((input->line_number - addr->addr_number) % addr->addr_step) == 0);
+    case addr_is_num:
+      return (addr->addr_number == input->line_number);
 
-    case ADDR_IS_STEP:
-    case ADDR_IS_STEP_MOD:
+    case addr_is_num_mod:
+      if (addr->addr_number < addr->addr_step)
+	return (addr->addr_number == input->line_number%addr->addr_step);
+      /* addr_number >= step implies we have an extra initial skip */
+      if (input->line_number < addr->addr_number)
+	return FALSE;
+      /* normalize */
+      addr->addr_number %= addr->addr_step;
+      return (addr->addr_number == 0);
+
+    case addr_is_num2:
+    case addr_is_step:
+    case addr_is_step_mod:
       /* reminder: these are only meaningful for a2 addresses */
       /* a2->addr_number needs to be recomputed each time a1 address
-         matches for the step and step_mod types */
+	 matches for the step and step_mod types */
       return (addr->addr_number <= input->line_number);
 
-    case ADDR_IS_LAST:
+    case addr_is_last:
       return test_eof(input);
 
-      /* ADDR_IS_NUM is handled in match_address_p.  */
-    case ADDR_IS_NUM:
     default:
-      panic("INTERNAL ERROR: bad address type");
+      panic(_("INTERNAL ERROR: bad address type"));
     }
   /*NOTREACHED*/
-  return false;
+  return FALSE;
 }
 
 /* return non-zero if current address is valid for cmd */
-static bool match_address_p P_((struct sed_cmd *, struct input *));
-static bool
+static flagT match_address_p P_((struct sed_cmd *, struct input *));
+static flagT
 match_address_p(cmd, input)
   struct sed_cmd *cmd;
   struct input *input;
 {
-  if (!cmd->a1)
-    return true;
+  flagT addr_matched = cmd->a1_matched;
 
-  if (cmd->range_state != RANGE_ACTIVE)
+  if (addr_matched)
     {
-      /* Find if we are going to activate a range.  Handle ADDR_IS_NUM
-	 specially: it represent an "absolute" state, it should not
-	 be computed like regexes.  */
-      if (cmd->a1->addr_type == ADDR_IS_NUM)
-	{
-	  if (!cmd->a2)
-	    return (input->line_number == cmd->a1->addr_number);
-
-	  if (cmd->range_state == RANGE_CLOSED
-	      || input->line_number < cmd->a1->addr_number)
-	    return false;
-	}
-      else
+      if (match_an_address_p(cmd->a2, input))
+	cmd->a1_matched = FALSE;
+    }
+  else if (!cmd->a1 || match_an_address_p(cmd->a1, input))
+    {
+      addr_matched = TRUE;
+      if (cmd->a2)
 	{
-          if (!cmd->a2)
-	    return match_an_address_p(cmd->a1, input);
-
-	  if (!match_an_address_p(cmd->a1, input))
-            return false;
+	  cmd->a1_matched = TRUE;
+	  switch (cmd->a2->addr_type)
+	    {
+	    case addr_is_regex:
+	      break;
+	    case addr_is_step:
+	      cmd->a2->addr_number = input->line_number + cmd->a2->addr_step;
+	      break;
+	    case addr_is_step_mod:
+	      cmd->a2->addr_number = input->line_number + cmd->a2->addr_step
+				     - (input->line_number%cmd->a2->addr_step);
+	      break;
+	    default:
+	      if (match_an_address_p(cmd->a2, input))
+		cmd->a1_matched = FALSE;
+	      break;
+	    }
 	}
-
-      /* Ok, start a new range.  */
-      cmd->range_state = RANGE_ACTIVE;
-      switch (cmd->a2->addr_type)
-	{
-	case ADDR_IS_REGEX:
-	  /* Always include at least two lines.  */
-	  return true;
-	case ADDR_IS_NUM:
-	  /* Same handling as below, but always include at least one line.  */
-          if (input->line_number >= cmd->a2->addr_number)
-	    cmd->range_state = RANGE_CLOSED;
-          return true;
-	case ADDR_IS_STEP:
-	  cmd->a2->addr_number = input->line_number + cmd->a2->addr_step;
-	  return true;
-	case ADDR_IS_STEP_MOD:
-	  cmd->a2->addr_number = input->line_number + cmd->a2->addr_step
-				 - (input->line_number%cmd->a2->addr_step);
-	  return true;
-	default:
-	  break;
-        }
     }
-
-  /* cmd->range_state == RANGE_ACTIVE.  Check if the range is
-     ending; also handle ADDR_IS_NUM specially in this case.  */
-
-  if (cmd->a2->addr_type == ADDR_IS_NUM)
-    {
-      /* If the second address is a line number, and if we got past
-         that line, fail to match (it can happen when you jump
-	 over such addresses with `b' and `t'.  Use RANGE_CLOSED
-         so that the range is not re-enabled anymore.  */
-      if (input->line_number >= cmd->a2->addr_number)
-	cmd->range_state = RANGE_CLOSED;
-
-      return (input->line_number <= cmd->a2->addr_number);
-   }
-
-  /* Other addresses are treated as usual.  */
-  if (match_an_address_p(cmd->a2, input))
-    cmd->range_state = RANGE_CLOSED;
-
-  return true;
+  if (cmd->addr_bang)
+    return !addr_matched;
+  return addr_matched;
 }
 
 
@@ -966,9 +786,7 @@
   char obuf[180];	/* just in case we encounter a 512-bit char (;-) */
   char *o;
   size_t olen;
-  FILE *fp = output_file.fp;
 
-  output_missing_newline(&output_file);
   for (; len--; ++p) {
       o = obuf;
       
@@ -1005,20 +823,18 @@
       }
       olen = o - obuf;
       if (width+olen >= line_len && line_len > 0) {
-	  ck_fwrite("\\\n", 1, 2, fp);
+	  ck_fwrite("\\\n", 1, 2, output_file);
 	  width = 0;
       }
-      ck_fwrite(obuf, 1, olen, fp);
+      ck_fwrite(obuf, 1, olen, output_file);
       width += olen;
   }
-  ck_fwrite("$\n", 1, 2, fp);
-  flush_output (fp);
+  ck_fwrite("$\n", 1, 2, output_file);
 }
 
-
 static enum replacement_types append_replacement P_((struct line *, struct replacement *,
-						     struct re_registers *,
-						     enum replacement_types));
+				                     struct re_registers *,
+				                     enum replacement_types));
 static enum replacement_types
 append_replacement (buf, p, regs, repl_mod)
   struct line *buf;
@@ -1032,26 +848,26 @@
       enum replacement_types curr_type;
 
       /* Apply a \[lu] modifier that was given earlier, but which we
-         have not had yet the occasion to apply.  But don't do it
-         if this replacement has a modifier of its own. */
-      curr_type = (p->repl_type & REPL_MODIFIERS)
-        ? p->repl_type
-        : p->repl_type | repl_mod;
+	 have not had yet the occasion to apply.  But don't do it
+	 if this replacement has a modifier of its own. */
+      curr_type = (p->repl_type & repl_modifiers)
+	? p->repl_type
+	: p->repl_type | repl_mod;
 
       repl_mod = 0;
       if (p->prefix_length)
-        {
-          str_append_modified(buf, p->prefix, p->prefix_length,
-    			      curr_type);
-          curr_type &= ~REPL_MODIFIERS;
-        }
+	{
+	  str_append_modified(buf, p->prefix, p->prefix_length,
+			      curr_type);
+	  curr_type &= ~repl_modifiers;
+	}
 
       if (0 <= i)
-        if (regs->end[i] == regs->start[i] && p->repl_type & REPL_MODIFIERS)
-          /* Save this modifier, we shall apply it later.
+	if (regs->end[i] == regs->start[i] && p->repl_type & repl_modifiers)
+	  /* Save this modifier, we shall apply it later.
 	     e.g. in s/()([a-z])/\u\1\2/
 	     the \u modifier is applied to \2, not \1 */
-	  repl_mod = curr_type & REPL_MODIFIERS;
+	  repl_mod = curr_type & repl_modifiers;
 
 	else
 	  str_append_modified(buf, line.active + regs->start[i],
@@ -1067,11 +883,12 @@
 do_subst(sub)
   struct subst *sub;
 {
-  size_t start = 0;	/* where to start scan for (next) match in LINE */
+  size_t start = 0;     /* where to start scan for (next) match in LINE */
   size_t last_end = 0;  /* where did the last successful match end in LINE */
-  countT count = 0;	/* number of matches found */
-  bool again = true;
+  countT count = 0;     /* number of matches found */
+  flagT again = TRUE;
 
+#define MAX_BACKREFERENCES 10
   static struct re_registers regs;
 
   if (s_accum.alloc == 0)
@@ -1081,14 +898,14 @@
   /* The first part of the loop optimizes s/xxx// when xxx is at the
      start, and s/xxx$// */
   if (!match_regex(sub->regx, line.active, line.length, start,
-		   &regs, sub->max_id + 1))
+		   &regs, MAX_BACKREFERENCES))
     return;
-  
+
   if (!sub->replacement && sub->numb <= 1)
     if (regs.start[0] == 0 && !sub->global)
       {
 	/* We found a match, set the `replaced' flag. */
-	replaced = true;
+	replaced = TRUE;
 
 	line.active += regs.end[0];
 	line.length -= regs.end[0];
@@ -1098,7 +915,7 @@
     else if (regs.end[0] == line.length)
       {
 	/* We found a match, set the `replaced' flag. */
-	replaced = true;
+	replaced = TRUE;
 
 	line.length = regs.start[0];
 	goto post_subst;
@@ -1116,50 +933,47 @@
 	str_append(&s_accum, line.active + start, offset - start);
 
       /* If we're counting up to the Nth match, are we there yet?
-         And even if we are there, there is another case we have to
+	 And even if we are there, there is another case we have to
 	 skip: are we matching an empty string immediately following
-         another match?
+	 another match?
 
-         This latter case avoids that baaaac, when passed through
-         s,a*,x,g, gives `xbxxcx' instead of xbxcx.  This behavior is
-         unacceptable because it is not consistently applied (for
-         example, `baaaa' gives `xbx', not `xbxx'). */
+	 This latter case avoids that baaaac, when passed through
+	 s,a*,x,g, gives `xbxxcx' instead of xbxcx.  This behavior is
+	 unacceptable because it is not consistently applied (for
+	 example, `baaaa' gives `xbx', not `xbxx'). */
       if ((matched > 0 || count == 0 || offset > last_end)
-	  && ++count >= sub->numb)
-        {
-          /* We found a match, set the `replaced' flag. */
-          replaced = true;
+	  && (last_end = regs.end[0], ++count >= sub->numb))
+	{
+	  /* We found a match, set the `replaced' flag. */
+	  replaced = TRUE;
 
-          /* Now expand the replacement string into the output string. */
-          repl_mod = append_replacement (&s_accum, sub->replacement, &regs, repl_mod);
+	  /* Now expand the replacement string into the output string. */
+	  repl_mod = append_replacement (&s_accum, sub->replacement, &regs, repl_mod);
 	  again = sub->global;
-        }
+	}
       else
 	{
-          /* The match was not replaced.  Copy the text until its
-             end; if it was vacuous, skip over one character and
+	  /* The match was not replaced.  Copy the text until its
+	     end; if it was vacuous, skip over one character and
 	     add that character to the output.  */
 	  if (matched == 0)
 	    {
 	      if (start < line.length)
-	        matched = 1;
+		matched = 1;
 	      else
-	        break;
+		break;
 	    }
 
 	  str_append(&s_accum, line.active + offset, matched);
-        }
+	}
 
-      /* Start after the match.  last_end is the real end of the matched
-	 substring, excluding characters that were skipped in case the RE
-	 matched the empty string.  */
+      /* Start after the match.  */
       start = offset + matched;
-      last_end = regs.end[0];
     }
   while (again
 	 && start <= line.length
 	 && match_regex(sub->regx, line.active, line.length, start,
-			&regs, sub->max_id + 1));
+			&regs, MAX_BACKREFERENCES));
 
   /* Copy stuff to the right of the last match into the output string. */
   if (start < line.length)
@@ -1169,21 +983,21 @@
   /* Exchange line and s_accum.  This can be much cheaper
      than copying s_accum.active into line.text (for huge lines). */
   line_exchange(&line, &s_accum);
-  
+
   /* Finish up. */
   if (count < sub->numb)
     return;
 
  post_subst:
   if (sub->print & 1)
-    output_line(line.active, line.length, line.chomped, &output_file);
-  
-  if (sub->eval) 
+    output_line(line.active, line.length, line.chomped, output_file);
+
+  if (sub->eval)
     {
 #ifdef HAVE_POPEN
       FILE *pipe;
       s_accum.length = 0;
-      
+
       str_append (&line, "", 1);
       pipe = popen(line.active, "r");
       
@@ -1212,9 +1026,9 @@
     } 
   
   if (sub->print & 2)
-    output_line(line.active, line.length, line.chomped, &output_file);
-  if (sub->outf)
-    output_line(line.active, line.length, line.chomped, sub->outf);
+    output_line(line.active, line.length, line.chomped, output_file);
+  if (sub->fp)
+    output_line(line.active, line.length, line.chomped, sub->fp);
 }
 
 #ifdef EXPERIMENTAL_DASH_N_OPTIMIZATION
@@ -1257,12 +1071,12 @@
   countT cmd_cnt;
 
   for (p=v; p < cur_cmd; ++p)
-    if (p->cmd != '#')
+    if (p->cmd != ':')
       MEMCPY(v++, p, sizeof *v);
   cmd_cnt = v - vec->v;
 
   for (; p < last_cmd; ++p)
-    if (p->cmd != '#')
+    if (p->cmd != ':')
       MEMCPY(v++, p, sizeof *v);
   vec->v_length = v - vec->v;
 
@@ -1285,7 +1099,7 @@
   end_cmd = vec->v + vec->v_length;
   while (cur_cmd < end_cmd)
     {
-      if (match_address_p(cur_cmd, input) != cur_cmd->addr_bang)
+      if (match_address_p(cur_cmd, input))
 	{
 	  switch (cur_cmd->cmd)
 	    {
@@ -1303,16 +1117,14 @@
 	      continue;
 
 	    case '}':
-	    case '#':
 	    case ':':
 	      /* Executing labels and block-ends are easy. */
 	      break;
 
 	    case 'c':
-	      if (cur_cmd->range_state != RANGE_ACTIVE)
+	      if (!cur_cmd->a1_matched)
 		output_line(cur_cmd->x.cmd_txt.text,
-			    cur_cmd->x.cmd_txt.text_length - 1, true,
-			    &output_file);
+			    cur_cmd->x.cmd_txt.text_length, FALSE, output_file);
 	      /* POSIX.2 is silent about c starting a new cycle,
 		 but it seems to be expected (and make sense). */
 	      /* Fall Through */
@@ -1323,8 +1135,11 @@
 	      {
 		char *p = memchr(line.active, '\n', line.length);
 		if (!p)
-		  return -1;
-
+		  {
+		    line.length = 0;
+		    line.chomped = FALSE;
+		    return -1;
+		  }
 		++p;
 		line.alloc -= p - line.active;
 		line.length -= p - line.active;
@@ -1352,7 +1167,6 @@
 		{
 		  cur_cmd->x.cmd_txt.text[cmd_length - 1] = 0;
 		  pipe = popen(cur_cmd->x.cmd_txt.text, "r");
-                  output_missing_newline(&output_file);
 		}
 
 	      if (pipe != NULL) 
@@ -1365,7 +1179,7 @@
 			if (!cmd_length)
 			  str_append(&s_accum, buf, n);
 			else
-			  ck_fwrite(buf, 1, n, output_file.fp);
+			  output_line(buf, n, FALSE, output_file);
 		    }
 		  
 		  pclose (pipe);
@@ -1381,9 +1195,6 @@
 			 (for huge lines). */
 		      line_exchange(&line, &s_accum);
 		    }
-                  else
-                    flush_output(output_file.fp);
-
 		}
 	      else
 		panic(_("error in subprocess"));
@@ -1411,8 +1222,7 @@
 
 	    case 'i':
 	      output_line(cur_cmd->x.cmd_txt.text,
-			  cur_cmd->x.cmd_txt.text_length - 1,
-			  true, &output_file);
+			  cur_cmd->x.cmd_txt.text_length, FALSE, output_file);
 	      break;
 
 	    case 'l':
@@ -1422,53 +1232,51 @@
 	      break;
 
 	    case 'L':
-              output_missing_newline(&output_file);
 	      fmt(line.active, line.active + line.length,
 		  cur_cmd->x.int_arg == -1
 		  ? lcmd_out_line_len
 		  : cur_cmd->x.int_arg,
-		  output_file.fp);
-              flush_output(output_file.fp);
+		  output_file);
 	      break;
 
 	    case 'n':
 	      if (!no_default_output)
-		output_line(line.active, line.length, line.chomped, &output_file);
-	      if (test_eof(input) || !read_pattern_space(input, vec, false))
+		output_line(line.active, line.length, line.chomped, output_file);
+	      if (test_eof(input) || !read_pattern_space(input, vec, FALSE))
 		return -1;
 	      break;
 
 	    case 'N':
 	      str_append(&line, "\n", 1);
- 
-              if (test_eof(input) || !read_pattern_space(input, vec, true))
-                {
-                  line.length--;
-                  if (posixicity == POSIXLY_EXTENDED && !no_default_output)
-                     output_line(line.active, line.length, line.chomped,
-                                 &output_file);
-                  return -1;
-                }
+
+	      if (test_eof(input) || !read_pattern_space(input, vec, TRUE))
+		{
+		  line.length--;
+                  if (!POSIXLY_CORRECT && !no_default_output)
+                    output_line(line.active, line.length, line.chomped,
+				output_file);
+		  return -1;
+		}
 	      break;
 
 	    case 'p':
-	      output_line(line.active, line.length, line.chomped, &output_file);
+	      output_line(line.active, line.length, line.chomped, output_file);
 	      break;
 
 	    case 'P':
 	      {
 		char *p = memchr(line.active, '\n', line.length);
 		output_line(line.active, p ? p - line.active : line.length,
-			    p ? true : line.chomped, &output_file);
+			    p ? 1 : line.chomped, output_file);
 	      }
 	      break;
 
             case 'q':
               if (!no_default_output)
-                output_line(line.active, line.length, line.chomped, &output_file);
+                output_line(line.active, line.length, line.chomped, output_file);
 
-	    case 'Q':
-	      return cur_cmd->x.int_arg == -1 ? 0 : cur_cmd->x.int_arg;
+            case 'Q':
+              return cur_cmd->x.int_arg == -1 ? 0 : cur_cmd->x.int_arg;
 
 	    case 'r':
 	      if (cur_cmd->x.fname)
@@ -1486,11 +1294,12 @@
 		  char *text = NULL;
 		  int result;
 
-		  result = ck_getline (&text, &buflen, cur_cmd->x.fp);
+		  result = getline (&text, &buflen, cur_cmd->x.fp);
+
 		  if (result != EOF)
 		    {
 		      aq = next_append_slot();
-		      aq->free = true;
+		      aq->free = TRUE;
 		      aq->text = text;
 		      aq->textlen = result;
 		    }
@@ -1504,7 +1313,7 @@
 	    case 't':
 	      if (replaced)
 		{
-		  replaced = false;
+		  replaced = FALSE;
 		  cur_cmd = vec->v + cur_cmd->x.jump_index;
 		  continue;
 		}
@@ -1517,22 +1326,22 @@
 		  continue;
 		}
 	      else
-		replaced = false;
+		replaced = FALSE;
 	      break;
 
 	    case 'w':
 	      if (cur_cmd->x.fp)
 		output_line(line.active, line.length,
-			    line.chomped, cur_cmd->x.outf);
+			    line.chomped, cur_cmd->x.fp);
 	      break;
 
 	    case 'W':
 	      if (cur_cmd->x.fp)
-	        {
+		{
 		  char *p = memchr(line.active, '\n', line.length);
 		  output_line(line.active, p ? p - line.active : line.length,
-			      p ? true : line.chomped, cur_cmd->x.outf);
-	        }
+			      p ? 1 : line.chomped, cur_cmd->x.fp);
+		}
 	      break;
 
 	    case 'x':
@@ -1541,133 +1350,129 @@
 
 	    case 'y':
 	      {
-#ifdef HAVE_MBRTOWC
-               if (mb_cur_max > 1)
-                 {
-                   int idx, prev_idx; /* index in the input line.  */
-                   char **trans;
-                   mbstate_t mbstate;
-                   memset(&mbstate, 0, sizeof(mbstate_t));
-                   for (idx = 0; idx < line.length;)
-                     {
-                       int mbclen, i;
-                       mbclen = MBRLEN (line.active + idx, line.length - idx,
-                                          &mbstate);
-                       /* An invalid sequence, or a truncated multibyte
-                          character.  We treat it as a singlebyte character.
-                       */
-                       if (mbclen == (size_t) -1 || mbclen == (size_t) -2
-                           || mbclen == 0)
-                         mbclen = 1;
-
-                       trans = cur_cmd->x.translatemb;
-                       /* `i' indicate i-th translate pair.  */
-                       for (i = 0; trans[2*i] != NULL; i++)
-                         {
-                           if (strncmp(line.active + idx, trans[2*i], mbclen) == 0)
-                             {
-                               bool move_remain_buffer = false;
-                               int trans_len = strlen(trans[2*i+1]);
-
-                               if (mbclen < trans_len)
-                                 {
-                                   int new_len;
-                                   new_len = line.length + 1 + trans_len - mbclen;
-                                   /* We must extend the line buffer.  */
-                                   if (line.alloc < new_len)
-                                     {
-                                       /* And we must resize the buffer.  */
-                                       resize_line(&line, new_len);
-                                     }
-                                   move_remain_buffer = true;
-                                 }
-                               else if (mbclen > trans_len)
-                                 {
-                                   /* We must truncate the line buffer.  */
-                                   move_remain_buffer = true;
-                                 }
-                               prev_idx = idx;
-                               if (move_remain_buffer)
-                                 {
-                                   int move_len, move_offset;
-                                   char *move_from, *move_to;
-                                   /* Move the remaining with \0.  */
-                                   move_from = line.active + idx + mbclen;
-                                   move_to = line.active + idx + trans_len;
-                                   move_len = line.length + 1 - idx - mbclen;
-                                   move_offset = trans_len - mbclen;
-                                   memmove(move_to, move_from, move_len);
-                                   line.length += move_offset;
-                                   idx += move_offset;
-                                 }
-                               strncpy(line.active + prev_idx, trans[2*i+1],
-                                       trans_len);
-                               break;
-                             }
-                         }
-                       idx += mbclen;
-                     }
-                 }
-               else
+#if defined HAVE_MBRTOWC && !defined REG_PERL
+	       if (MB_CUR_MAX > 1)
+		 {
+		   int idx, prev_idx; /* index in the input line.  */
+		   char **trans;
+		   mbstate_t cur_stat;
+		   memset(&cur_stat, 0, sizeof(mbstate_t));
+		   for (idx = 0; idx < line.length;)
+		     {
+		       int mbclen, i;
+		       mbclen = mbrlen(line.active + idx, line.length - idx,
+				       &cur_stat);
+		       /* An invalid sequence, or a truncated multibyte
+			  character.  We treat it as a singlebyte character.
+		       */
+		       if (mbclen == (size_t) -1 || mbclen == (size_t) -2
+			   || mbclen == 0)
+			 mbclen = 1;
+
+		       trans = cur_cmd->x.translatemb;
+		       /* `i' indicate i-th translate pair.  */
+		       for (i = 0; trans[2*i] != NULL; i++)
+			 {
+			   if (strncmp(line.active + idx, trans[2*i], mbclen)
+			       == 0)
+			     {
+			       flagT move_remain_buffer = FALSE;
+			       int trans_len = strlen(trans[2*i+1]);
+
+			       if (mbclen < trans_len)
+				 {
+				   int new_len;
+				   new_len = line.length + 1 + trans_len - mbclen;
+				   /* We must extend the line buffer.  */
+				   if (line.alloc < new_len)
+				     {
+				       /* And we must resize the buffer.  */
+				       resize_line(&line, new_len);
+				     }
+				   move_remain_buffer = TRUE;
+				 }
+			       else if (mbclen > trans_len)
+				 {
+				   /* We must truncate the line buffer.  */
+				   move_remain_buffer = TRUE;
+				 }
+			       prev_idx = idx;
+			       if (move_remain_buffer)
+				 {
+				   int move_len, move_offset;
+				   char *move_from, *move_to;
+				   /* Move the remaining with \0.  */
+				   move_from = line.active + idx + mbclen;
+				   move_to = line.active + idx + trans_len;
+				   move_len = line.length + 1 - idx - mbclen;
+				   move_offset = trans_len - mbclen;
+				   memmove(move_to, move_from, move_len);
+				   line.length += move_offset;
+				   idx += move_offset;
+				 }
+			       strncpy(line.active + prev_idx, trans[2*i+1],
+				       trans_len);
+			       break;
+			     }
+			 }
+		       idx += mbclen;
+		     }
+		 }
+	       else
 #endif /* HAVE_MBRTOWC */
-                 {
-                   unsigned char *p, *e;
-                   p = CAST(unsigned char *)line.active;
-                   for (e=p+line.length; p<e; ++p)
-                     *p = cur_cmd->x.translate[*p];
-                 }
+		 {
+		   unsigned char *p, *e;
+		   p = CAST(unsigned char *)line.active;
+		   for (e=p+line.length; p<e; ++p)
+		     *p = cur_cmd->x.translate[*p];
+		 }
 	      }
 	      break;
 
 	    case '=':
-              output_missing_newline(&output_file);
-              fprintf(output_file.fp, "%lu\n",
-                      CAST(unsigned long)input->line_number);
-              flush_output(output_file.fp);
+	      fprintf(output_file, "%lu\n",
+		      CAST(unsigned long)input->line_number);
 	      break;
 
 	    default:
-	      panic("INTERNAL ERROR: Bad cmd %c", cur_cmd->cmd);
+	      panic(_("INTERNAL ERROR: Bad cmd %c"), cur_cmd->cmd);
 	    }
 	}
 
 #ifdef EXPERIMENTAL_DASH_N_OPTIMIZATION
       /* If our top-level program consists solely of commands with
-         ADDR_IS_NUM addresses then once we past the last mentioned
-         line we should be able to quit if no_default_output is true,
-         or otherwise quickly copy input to output.  Now whether this
-         optimization is a win or not depends on how cheaply we can
-         implement this for the cases where it doesn't help, as
-         compared against how much time is saved.  One semantic
-         difference (which I think is an improvement) is that *this*
-         version will terminate after printing line two in the script
-         "yes | sed -n 2p". 
-        
-         Don't use this when in-place editing is active, because line
-         numbers restart each time then. */
-      else if (!separate_files)
+       * addr_is_num addresses then once we past the last mentioned
+       * line we should be able to quit if no_default_output is true,
+       * or otherwise quickly copy input to output.  Now whether this
+       * optimization is a win or not depends on how cheaply we can
+       * implement this for the cases where it doesn't help, as
+       * compared against how much time is saved.  One semantic
+       * difference (which I think is an improvement) is that *this*
+       * version will terminate after printing line two in the script
+       * "yes | sed -n 2p". 
+       *
+       * Don't use this when in-place editing is active, because line
+       * numbers restart each time then. */
+      else if (output_file == stdout)
 	{
-	  if (cur_cmd->a1->addr_type == ADDR_IS_NUM
-	      && (cur_cmd->a2
-		  ? cur_cmd->range_state == RANGE_CLOSED
-		  : cur_cmd->a1->addr_number < input->line_number))
+	  /* can we ever match again? */
+	  if (cur_cmd->a1->addr_type == addr_is_num &&
+	      ((input->line_number < cur_cmd->a1->addr_number)
+	       != !cur_cmd->addr_bang))
 	    {
-	      /* Skip this address next time */
-	      cur_cmd->addr_bang = !cur_cmd->addr_bang;
-	      cur_cmd->a1->addr_type = ADDR_IS_NULL;
-	      if (cur_cmd->a2)
-		cur_cmd->a2->addr_type = ADDR_IS_NULL;
+	      /* skip all this next time */
+	      cur_cmd->a1->addr_type = addr_is_null;
+	      cur_cmd->addr_bang = TRUE;
 
 	      /* can we make an optimization? */
-	      if (cur_cmd->addr_bang)
+	      if (cur_cmd->cmd == 'b' || cur_cmd->cmd == 't'
+		  || cur_cmd->cmd == '{')
+		--branches;
+	      cur_cmd->cmd = ':';	/* replace with no-op */
+	      if (branches == 0)
 		{
-		  if (cur_cmd->cmd == 'b' || cur_cmd->cmd == 't'
-		      || cur_cmd->cmd == 'T' || cur_cmd->cmd == '}')
-		    branches--;
-
-		  cur_cmd->cmd = '#';	/* replace with no-op */
-	          if (branches == 0)
-		    cur_cmd = shrink_program(vec, cur_cmd);
+		  /* whew!  all that just so that we can get to here! */
+		  cur_cmd = shrink_program(vec, cur_cmd);
 		  if (!cur_cmd && no_default_output)
 		    return 0;
 		  end_cmd = vec->v + vec->v_length;
@@ -1684,7 +1489,7 @@
     }
 
     if (!no_default_output)
-      output_line(line.active, line.length, line.chomped, &output_file);
+      output_line(line.active, line.length, line.chomped, output_file);
     return -1;
 }
 
@@ -1709,7 +1514,6 @@
   branches = count_branches(the_program);
 #endif /*EXPERIMENTAL_DASH_N_OPTIMIZATION*/
   input.file_list = stdin_argv;
-  input.reset_at_next_file = true;
   if (argv && *argv)
     input.file_list = argv;
   input.bad_count = 0;
@@ -1718,7 +1522,7 @@
   input.fp = NULL;
 
   status = EXIT_SUCCESS;
-  while (read_pattern_space(&input, the_program, false))
+  while (read_pattern_space(&input, the_program, FALSE))
     {
       status = execute_program(the_program, &input);
       if (status == -1)
--- 4.1.4/sed/fmt.c
+++ 4.0.9/sed/fmt.c
@@ -134,11 +134,12 @@
 
 /* Forward declarations.  */
 
-static bool get_paragraph P_ ((void));
+extern void fmt P_ ((char *line, char *line_end, int max_length, FILE *output_file));
+static flagT get_paragraph P_ ((void));
 static int get_line P_ ((int c));
 static int get_space P_ ((int c));
 static int copy_rest P_ ((int c));
-static bool same_para P_ ((int c));
+static flagT same_para P_ ((int c));
 static void flush_paragraph P_ ((void));
 static void fmt_paragraph P_ ((void));
 static void check_punctuation P_ ((WORD *w));
@@ -157,10 +158,10 @@
 static int max_width;
 
 /* Space for the paragraph text.  */
-static const char *parabuf;
+static char *parabuf;
 
 /* End of space for the paragraph text.  */
-static const char *end_of_parabuf;
+static char *end_of_parabuf;
 
 /* The file on which we output */
 static FILE *outfile;
@@ -204,7 +205,7 @@
 /* read file F and send formatted output to stdout.  */
 
 void
-fmt (const char *line, const char *line_end, int max_length, FILE *output_file)
+fmt (char *line, char *line_end, int max_length, FILE *output_file)
 {
   parabuf = line;
   end_of_parabuf = line_end;
@@ -227,10 +228,10 @@
    maximal number of non-blank (excluding any prefix) lines
    with the same indent.
 
-   Return false if end-of-file was encountered before the start of a
-   paragraph, else true.  */
+   Return FALSE if end-of-file was encountered before the start of a
+   paragraph, else TRUE.  */
 
-static bool
+static flagT
 get_paragraph ()
 {
   register int c;
@@ -246,7 +247,7 @@
       if (c == EOF)
 	{
 	  next_char = EOF;
-	  return false;
+	  return FALSE;
 	}
       putc ('\n', outfile);
       c = GETC();
@@ -264,9 +265,9 @@
   while (same_para (c) && in_column == other_indent)
     c = get_line (c);
 
-  (word_limit - 1)->period = (word_limit - 1)->final = true;
+  (word_limit - 1)->period = (word_limit - 1)->final = TRUE;
   next_char = c;
-  return true;
+  return TRUE;
 }
 
 /* Copy to the output a blank line.  In the latter, C is \n or EOF.
@@ -284,11 +285,11 @@
   return c;
 }
 
-/* Return true if a line whose first non-blank character after the
+/* Return TRUE if a line whose first non-blank character after the
    prefix (if any) is C could belong to the current paragraph,
-   otherwise false.  */
+   otherwise FALSE.  */
 
-static bool
+static flagT
 same_para (register int c)
 {
   return (c != '\n' && c != EOF);
--- 4.1.4/sed/regexp.c
+++ 4.0.9/sed/regexp.c
@@ -1,5 +1,5 @@
 /*  GNU SED, a batch stream editor.
-    Copyright (C) 1999, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+    Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
 
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
@@ -29,125 +29,113 @@
 # define N_(String) (String)
 #endif
 
-extern bool use_extended_syntax_p;
+extern flagT use_extended_syntax_p;
 
 static const char errors[] =
-  "no previous regular expression\0"
-  "cannot specify modifiers on empty regexp";
+  "No previous regular expression\0"
+  "Cannot specify modifiers on empty regexp";
 
 #define NO_REGEX (errors)
-#define BAD_MODIF (NO_REGEX + sizeof(N_("no previous regular expression")))
-#define END_ERRORS (BAD_MODIF + sizeof(N_("cannot specify modifiers on empty regexp")))
+#define BAD_MODIF (NO_REGEX + sizeof(N_("No previous regular expression")))
+#define END_ERRORS (BAD_MODIF + sizeof(N_("Cannot specify modifiers on empty regexp")))
 
 
 
-static void
-compile_regex_1 (new_regex, needed_sub)
-  struct regex *new_regex;
+regex_t *
+compile_regex(b, flags, needed_sub)
+  struct buffer *b;
+  int flags;
   int needed_sub;
 {
-#ifdef REG_PERL
-  int errcode;
-  errcode = regncomp(&new_regex->pattern, new_regex->re, new_regex->sz,
-		     (needed_sub ? 0 : REG_NOSUB)
-		     | new_regex->flags
-		     | extended_regexp_flags);
+  regex_t *new_regex;
+
+  char *last_re = NULL;
+  size_t last_re_len;
 
-  if (errcode)
+  /* // matches the last RE */
+  if (size_buffer(b) == 0)
     {
-      char errorbuf[200];
-      regerror(errcode, NULL, errorbuf, 200);
-      bad_prog(gettext(errorbuf));
+      if (flags > 0)
+	bad_prog(_(BAD_MODIF));
+      return NULL;
     }
+
+  last_re_len = size_buffer(b);
+  last_re = ck_memdup(get_buffer(b), last_re_len);
+
+  new_regex = MALLOC(1, regex_t);
+
+#ifdef REG_PERL
+  {
+    int errcode;
+    errcode = regncomp(new_regex, last_re, last_re_len,
+		       (needed_sub ? 0 : REG_NOSUB)
+		       | flags
+		       | extended_regexp_flags);
+
+    if (errcode)
+      {
+        char errorbuf[200];
+        regerror(errcode, NULL, errorbuf, 200);
+        bad_prog(gettext(errorbuf));
+      }
+  }
 #else
-  const char *error;
-  int syntax = ((extended_regexp_flags & REG_EXTENDED)
-		 ? RE_SYNTAX_POSIX_EXTENDED
-                 : RE_SYNTAX_POSIX_BASIC)
-		 & ~RE_UNMATCHED_RIGHT_PAREN_ORD;
+  new_regex->fastmap = malloc (1 << (sizeof (char) * 8));
+  {
+    const char *error;
+    int syntax = ((extended_regexp_flags & REG_EXTENDED)
+		   ? RE_SYNTAX_POSIX_EXTENDED
+                   : RE_SYNTAX_POSIX_BASIC)
+		   & ~RE_UNMATCHED_RIGHT_PAREN_ORD;
 
-  syntax |= RE_NO_POSIX_BACKTRACKING;
+    syntax |= RE_NO_POSIX_BACKTRACKING;
 #ifdef RE_ICASE
-  syntax |= (new_regex->flags & REG_ICASE) ? RE_ICASE : 0;
+    syntax |= (flags & REG_ICASE) ? RE_ICASE : 0;
 #endif
-#ifdef RE_NO_SUB
-  syntax |= needed_sub ? 0 : RE_NO_SUB;
-#endif
-
-  new_regex->pattern.fastmap = malloc (1 << (sizeof (char) * 8));
-
-  /* If REG_NEWLINE is set, newlines are treated differently.  */
-  if (new_regex->flags & REG_NEWLINE)
-    {
-      /* REG_NEWLINE implies neither . nor [^...] match newline.  */
-      syntax &= ~RE_DOT_NEWLINE;
-      syntax |= RE_HAT_LISTS_NOT_NEWLINE;
-    }
 
-  re_set_syntax (syntax);
-  error = re_compile_pattern (new_regex->re, new_regex->sz,
-			      &new_regex->pattern);
-  new_regex->pattern.newline_anchor = (new_regex->flags & REG_NEWLINE) != 0;
+    /* If REG_NEWLINE is set, newlines are treated differently.  */
+    if (flags & REG_NEWLINE)
+      { /* REG_NEWLINE implies neither . nor [^...] match newline.  */
+        syntax &= ~RE_DOT_NEWLINE;
+        syntax |= RE_HAT_LISTS_NOT_NEWLINE;
+      }
+
+    /* GNU regex does not process \t & co. */
+    last_re_len = normalize_text(last_re, last_re_len);
+    re_set_syntax (syntax);
+    error = re_compile_pattern (last_re, last_re_len, new_regex);
+    new_regex->newline_anchor = (flags & REG_NEWLINE) != 0;
 
-  new_regex->pattern.translate = NULL;
+    new_regex->translate = NULL;
 #ifndef RE_ICASE
-  if (new_regex->flags & REG_ICASE)
-    {
-      static char translate[1 << (sizeof(char) * 8)];
-      int i;
-      for (i = 0; i < sizeof(translate) / sizeof(char); i++)
-	translate[i] = tolower (i);
+    if (flags & REG_ICASE)
+      {
+        static char translate[1 << (sizeof(char) * 8)];
+	int i;
+	for (i = 0; i < sizeof(translate) / sizeof(char); i++)
+	  translate[i] = tolower (i);
 
-      new_regex->pattern.translate = translate;
-    }
+        new_regex->translate = translate;
+      }
 #endif
 
-  if (error)
-    bad_prog(error);
+    if (error)
+      bad_prog(error);
+  }
 #endif
 
+  FREE(last_re);
+
   /* Just to be sure, I mark this as not POSIXLY_CORRECT behavior */
-  if (needed_sub
-      && new_regex->pattern.re_nsub < needed_sub - 1
-      && posixicity == POSIXLY_EXTENDED)
+  if (new_regex->re_nsub < needed_sub && !POSIXLY_CORRECT)
     {
       char buf[200];
-      sprintf(buf, _("invalid reference \\%d on `s' command's RHS"),
+      sprintf(buf, _("Invalid reference \\%d on `s' command's RHS"),
 	      needed_sub);
       bad_prog(buf);
     }
-}
 
-struct regex *
-compile_regex(b, flags, needed_sub)
-  struct buffer *b;
-  int flags;
-  int needed_sub;
-{
-  struct regex *new_regex;
-  size_t re_len;
-
-  /* // matches the last RE */
-  if (size_buffer(b) == 0)
-    {
-      if (flags > 0)
-	bad_prog(_(BAD_MODIF));
-      return NULL;
-    }
-
-  re_len = size_buffer(b);
-  new_regex = ck_malloc(sizeof (struct regex) + re_len - 1);
-  new_regex->flags = flags;
-  memcpy (new_regex->re, get_buffer(b), re_len);
-
-#ifdef REG_PERL
-  new_regex->sz = re_len;
-#else
-  /* GNU regex does not process \t & co. */
-  new_regex->sz = normalize_text(new_regex->re, re_len, TEXT_REGEX);
-#endif
-
-  compile_regex_1 (new_regex, needed_sub);
   return new_regex;
 }
 
@@ -191,7 +179,7 @@
 
 int
 match_regex(regex, buf, buflen, buf_start_offset, regarray, regsize)
-  struct regex *regex;
+  regex_t *regex;
   char *buf;
   size_t buflen;
   size_t buf_start_offset;
@@ -199,11 +187,13 @@
   int regsize;
 {
   int ret;
-  static struct regex *regex_last;
+  static regex_t *regex_last;
 #ifdef REG_PERL
-  regmatch_t rm[10], *regmatch = rm;
-  if (regsize > 10)
+  regmatch_t *regmatch;
+  if (regsize)
     regmatch = (regmatch_t *) alloca (sizeof (regmatch_t) * regsize);
+  else
+    regmatch = NULL;
 #endif
 
   /* printf ("Matching from %d/%d\n", buf_start_offset, buflen); */
@@ -219,23 +209,19 @@
     regex_last = regex;
 
 #ifdef REG_PERL
-  regmatch[0].rm_so = CAST(int)buf_start_offset;
-  regmatch[0].rm_eo = CAST(int)buflen;
-  ret = regexec (&regex->pattern, buf, regsize, regmatch, REG_STARTEND);
+  ret = regexec2(regex, 
+		 buf, CAST(int)buflen, CAST(int)buf_start_offset,
+		 regsize, regmatch, 0);
 
   if (regsize)
     copy_regs (regarray, regmatch, regsize);
 
   return (ret == 0);
 #else
-  if (regex->pattern.no_sub && regsize)
-    compile_regex_1 (regex, regsize);
-
-  regex->pattern.regs_allocated = REGS_REALLOCATE;
-
-  ret = re_search (&regex->pattern, buf, buflen, buf_start_offset,
-		   buflen - buf_start_offset,
-		   regsize ? regarray : NULL);
+  regex->regs_allocated = REGS_REALLOCATE;
+  ret = re_search(regex, buf, buflen, buf_start_offset,
+		  buflen - buf_start_offset,
+		  regsize ? regarray : NULL);
 
   return (ret > -1);
 #endif
@@ -245,9 +231,9 @@
 #ifdef DEBUG_LEAKS
 void
 release_regex(regex)
-  struct regex *regex;
+  regex_t *regex;
 {
-  regfree(&regex->pattern);
+  regfree(regex);
   FREE(regex);
 }
 #endif /*DEBUG_LEAKS*/
--- 4.1.4/sed/sed.c
+++ 4.0.9/sed/sed.c
@@ -22,7 +22,6 @@
 
 #include "sed.h"
 
-
 #include <stdio.h>
 #ifdef HAVE_STRINGS_H
 # include <strings.h>
@@ -45,6 +44,9 @@
 #ifdef HAVE_SYS_TYPES_H
 # include <sys/types.h>
 #endif
+#ifdef HAVE_LOCALE_H
+# include <locale.h>
+#endif
 #include "getopt.h"
 
 #ifndef BOOTSTRAP
@@ -62,19 +64,19 @@
 int extended_regexp_flags = 0;
 
 /* If set, fflush(stdout) on every line output. */
-bool unbuffered_output = false;
+flagT unbuffered_output = FALSE;
 
 /* If set, don't write out the line unless explicitly told to */
-bool no_default_output = false;
+flagT no_default_output = FALSE;
 
 /* If set, reset line counts on every new file. */
-bool separate_files = false;
+flagT separate_files = FALSE;
 
 /* How do we edit files in-place? (we don't if NULL) */
 char *in_place_extension = NULL;
 
 /* Do we need to be pedantically POSIX compliant? */
-enum posixicity_types posixicity;
+flagT POSIXLY_CORRECT;
 
 /* How long should the `l' command's output line be? */
 countT lcmd_out_line_len = 70;
@@ -97,37 +99,33 @@
 
   fprintf(out, _("\
 Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n\
-\n"), myname);
-
-  fprintf(out, _("  -n, --quiet, --silent\n\
-                 suppress automatic printing of pattern space\n"));
-  fprintf(out, _("  -e script, --expression=script\n\
-                 add the script to the commands to be executed\n"));
-  fprintf(out, _("  -f script-file, --file=script-file\n\
-                 add the contents of script-file to the commands to be executed\n"));
-  fprintf(out, _("  -i[SUFFIX], --in-place[=SUFFIX]\n\
-                 edit files in place (makes backup if extension supplied)\n"));
-  fprintf(out, _("  -l N, --line-length=N\n\
-                 specify the desired line-wrap length for the `l' command\n"));
-  fprintf(out, _("  --posix\n\
-                 disable all GNU extensions.\n"));
-  fprintf(out, _("  -r, --regexp-extended\n\
-                 use extended regular expressions in the script.\n"));
-  fprintf(out, PERL_HELP);
-  fprintf(out, _("  -s, --separate\n\
+\n\
+  -n, --quiet, --silent\n\
+                 suppress automatic printing of pattern space\n\
+  -e script, --expression=script\n\
+                 add the script to the commands to be executed\n\
+  -f script-file, --file=script-file\n\
+                 add the contents of script-file to the commands to be executed\n\
+  -i[suffix], --in-place[=suffix]\n\
+                 edit files in place (makes backup if extension supplied)\n\
+  -l N, --line-length=N\n\
+                 specify the desired line-wrap length for the `l' command\n\
+  -r, --regexp-extended\n\
+                 use extended regular expressions in the script.\n%s\
+  -s, --separate\n\
                  consider files as separate rather than as a single continuous\n\
-                 long stream.\n"));
-  fprintf(out, _("  -u, --unbuffered\n\
+                 long stream.\n\
+  -u, --unbuffered\n\
                  load minimal amounts of data from the input files and flush\n\
-                 the output buffers more often\n"));
-  fprintf(out, _("      --help     display this help and exit\n"));
-  fprintf(out, _("      --version  output version information and exit\n"));
-  fprintf(out, _("\n\
+                 the output buffers more often\n\
+      --help     display this help and exit\n\
+  -V, --version  output version information and exit\n\
+\n\
 If no -e, --expression, -f, or --file option is given, then the first\n\
 non-option argument is taken as the sed script to interpret.  All\n\
 remaining arguments are names of input files; if no input files are\n\
 specified, then the standard input is read.\n\
-\n"));
+\n"), myname, PERL_HELP);
   fprintf(out, _("E-mail bug reports to: %s .\n\
 Be sure to include the word ``%s'' somewhere in the ``Subject:'' field.\n"),
 	  BUG_ADDRESS, PACKAGE);
@@ -142,9 +140,9 @@
   char **argv;
 {
 #ifdef REG_PERL
-#define SHORTOPTS "snrRue:f:l:i::V:"
+#define SHORTOPTS "shnrRuVe:f:l:i::"
 #else
-#define SHORTOPTS "snrue:f:l:i::V:"
+#define SHORTOPTS "shnruVe:f:l:i::"
 #endif
 
   static struct option longopts[] = {
@@ -157,48 +155,45 @@
     {"in-place", 2, NULL, 'i'},
     {"line-length", 1, NULL, 'l'},
     {"quiet", 0, NULL, 'n'},
-    {"posix", 0, NULL, 'p'},
     {"silent", 0, NULL, 'n'},
     {"separate", 0, NULL, 's'},
     {"unbuffered", 0, NULL, 'u'},
-    {"version", 0, NULL, 'v'},
+    {"version", 0, NULL, 'V'},
     {"help", 0, NULL, 'h'},
     {NULL, 0, NULL, 0}
   };
 
   int opt;
   int return_code;
-  const char *cols = getenv("COLS");
 
-  initialize_main (&argc, &argv);
+  initialize_main(&argc, &argv);
+
+#if ENABLE_NLS
 #if HAVE_SETLOCALE
   /* Set locale according to user's wishes.  */
   setlocale (LC_ALL, "");
 #endif
-  initialize_mbcs ();
-
-#if ENABLE_NLS
 
   /* Tell program which translations to use and where to find.  */
   bindtextdomain (PACKAGE, LOCALEDIR);
   textdomain (PACKAGE);
 #endif
 
-  if (getenv("POSIXLY_CORRECT") != NULL)
-    posixicity = POSIXLY_CORRECT;
-  else
-    posixicity = POSIXLY_EXTENDED;
+  POSIXLY_CORRECT = (getenv("POSIXLY_CORRECT") != NULL);
 
   /* If environment variable `COLS' is set, use its value for
      the baseline setting of `lcmd_out_line_len'.  The "-1"
      is to avoid gratuitous auto-line-wrap on ttys.
    */
-  if (cols)
-    {
-      countT t = ATOI(cols);
-      if (t > 1)
-	lcmd_out_line_len = t-1;
-    }
+  {
+    const char *p = getenv("COLS");
+    if (p)
+      {
+	countT t = ATOI(p);
+	if (1 < t)
+	  lcmd_out_line_len = t-1;
+      }
+  }
 
   myname = *argv;
   while ((opt = getopt_long(argc, argv, SHORTOPTS, longopts, NULL)) != EOF)
@@ -206,7 +201,7 @@
       switch (opt)
 	{
 	case 'n':
-	  no_default_output = true;
+	  no_default_output = TRUE;
 	  break;
 	case 'e':
 	  the_program = compile_string(the_program, optarg, strlen(optarg));
@@ -216,31 +211,22 @@
 	  break;
 
 	case 'i':
-	  separate_files = true;
+	  separate_files = TRUE;
 	  if (optarg == NULL)
-	    /* use no backups */
-	    in_place_extension = ck_strdup ("*");
-
-	  else if (strchr(optarg, '*') != NULL)
-	    in_place_extension = ck_strdup(optarg);
-
-	  else
+	    in_place_extension = "*";
+	  else if (strchr(optarg, '*') == NULL)
 	    {
-	      in_place_extension = MALLOC (strlen(optarg) + 2, char);
+	      in_place_extension = xmalloc (strlen(optarg) + 2);
 	      in_place_extension[0] = '*';
 	      strcpy (in_place_extension + 1, optarg);
 	    }
-
+	  else
+	    in_place_extension = ck_strdup(optarg);
 	  break;
 
 	case 'l':
 	  lcmd_out_line_len = ATOI(optarg);
 	  break;
-
-	case 'p':
-	  posixicity = POSIXLY_BASIC;
-	  break;
-
 	case 'r':
 	  if (extended_regexp_flags)
 	    usage(4);
@@ -256,17 +242,17 @@
 #endif
 
 	case 's':
-	  separate_files = true;
+	  separate_files = TRUE;
 	  break;
 
 	case 'u':
-	  unbuffered_output = true;
+	  unbuffered_output = TRUE;
 	  break;
 
-	case 'v':
+	case 'V':
 #ifdef REG_PERL
 	  fprintf(stdout, _("super-sed version %s\n"), VERSION);
-	  fprintf(stdout, _("based on GNU sed version %s\n\n"), SED_FEATURE_VERSION);
+	  fprintf(stdout, _("based on GNU sed version 3.02.80\n\n"));
 #else
 	  fprintf(stdout, _("GNU sed version %s\n"), VERSION);
 #endif
--- 4.1.4/sed/sed.h
+++ 4.0.9/sed/sed.h
@@ -16,19 +16,50 @@
     along with this program; if not, write to the Free Software
     Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA. */
 
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
 
-#include "basicdefs.h"
-#include "regex.h"
+#if defined(_AIX)
+#pragma alloca
+#else
+# if !defined(alloca)           /* predefined by HP cc +Olibcalls */
+#  ifdef __GNUC__
+#   define alloca(size) __builtin_alloca(size)
+#  else
+#   if HAVE_ALLOCA_H
+#    include <alloca.h>
+#   else
+#    if defined(__hpux)
+        void *alloca ();
+#    else
+#     if !defined(__OS2__) && !defined(WIN32)
+	char *alloca ();
+#     else
+#      include <malloc.h>       /* OS/2 defines alloca in here */
+#     endif
+#    endif
+#   endif
+#  endif
+# endif
+#endif
 
 #ifndef BOOTSTRAP
 #include <stdio.h>
 #endif
-
+#include "basicdefs.h"
+#include "regex.h"
 #include "utils.h"
 
+#ifdef HAVE_WCHAR_H
+# include <wchar.h>
+#endif
+#ifdef HAVE_WCTYPE_H
+# include <wctype.h>
+#endif
+
+
 /* Struct vector is used to describe a compiled sed program. */
 struct vector {
   struct sed_cmd *v;	/* a dynamically allocated array */
@@ -36,77 +67,43 @@
   size_t v_length;	/* ... number of slots in use */
 };
 
-/* This structure tracks files used by sed so that they may all be
-   closed cleanly at normal program termination.  A flag is kept that tells
-   if a missing newline was encountered, so that it is added on the
-   next line and the two lines are not concatenated.  */
-struct output {
-  char *name;
-  bool missing_newline;
-  FILE *fp;
-  struct output *link;
-};
 
 struct text_buf {
   char *text;
   size_t text_length;
 };
 
-struct regex {
-  regex_t pattern;
-  int flags;
-  size_t sz;
-  char re[1];
-};
-  
 enum replacement_types {
-  REPL_ASIS = 0,
-  REPL_UPPERCASE = 1,
-  REPL_LOWERCASE = 2,
-  REPL_UPPERCASE_FIRST = 4,
-  REPL_LOWERCASE_FIRST = 8,
-  REPL_MODIFIERS = REPL_UPPERCASE_FIRST | REPL_LOWERCASE_FIRST,
+  repl_asis = 0,
+  repl_uppercase = 1,
+  repl_lowercase = 2,
+  repl_uppercase_first = 4,
+  repl_lowercase_first = 8,
+  repl_modifiers = repl_uppercase_first | repl_lowercase_first,
 
   /* These are given to aid in debugging */
-  REPL_UPPERCASE_UPPERCASE = REPL_UPPERCASE_FIRST | REPL_UPPERCASE,
-  REPL_UPPERCASE_LOWERCASE = REPL_UPPERCASE_FIRST | REPL_LOWERCASE,
-  REPL_LOWERCASE_UPPERCASE = REPL_LOWERCASE_FIRST | REPL_UPPERCASE,
-  REPL_LOWERCASE_LOWERCASE = REPL_LOWERCASE_FIRST | REPL_LOWERCASE
-};
-
-enum text_types {
-  TEXT_BUFFER,
-  TEXT_REPLACEMENT,
-  TEXT_REGEX
-};
-
-enum posixicity_types {
-  POSIXLY_EXTENDED,	/* with GNU extensions */
-  POSIXLY_CORRECT,	/* with POSIX-compatible GNU extensions */
-  POSIXLY_BASIC		/* pedantically POSIX */
-};
-
-enum addr_state {
-  RANGE_INACTIVE,	/* never been active */
-  RANGE_ACTIVE,		/* between first and second address */
-  RANGE_CLOSED		/* like RANGE_INACTIVE, but range has ended once */
+  repl_uppercase_uppercase = repl_uppercase_first | repl_uppercase,
+  repl_uppercase_lowercase = repl_uppercase_first | repl_lowercase,
+  repl_lowercase_uppercase = repl_lowercase_first | repl_uppercase,
+  repl_lowercase_lowercase = repl_lowercase_first | repl_lowercase
 };
 
 enum addr_types {
-  ADDR_IS_NULL,		/* null address */
-  ADDR_IS_REGEX,	/* a.addr_regex is valid */
-  ADDR_IS_NUM,		/* a.addr_number is valid */
-  ADDR_IS_NUM_MOD,	/* a.addr_number is valid, addr_step is modulo */
-  ADDR_IS_STEP,		/* address is +N (only valid for addr2) */
-  ADDR_IS_STEP_MOD,	/* address is ~N (only valid for addr2) */
-  ADDR_IS_LAST		/* address is $ */
+  addr_is_null,		/* null address */
+  addr_is_regex,	/* a.addr_regex is valid */
+  addr_is_num,		/* a.addr_number is valid */
+  addr_is_num_mod,	/* a.addr_number is valid, addr_step is modulo */
+  addr_is_num2,		/* a.addr_number is valid (only valid for addr2) */
+  addr_is_step,		/* address is +N (only valid for addr2) */
+  addr_is_step_mod,	/* address is ~N (only valid for addr2) */
+  addr_is_last		/* address is $ */
 };
 
 struct addr {
   enum addr_types addr_type;
   countT addr_number;
   countT addr_step;
-  struct regex *addr_regex;
+  regex_t *addr_regex;
 };
 
 
@@ -119,10 +116,10 @@
 };
 
 struct subst {
-  struct regex *regx;
+  regex_t *regx;
   struct replacement *replacement;
   countT numb;		/* if >0, only substitute for match number "numb" */
-  struct output *outf;	/* 'w' option given */
+  FILE *fp;		/* 'w' option given */
   unsigned global : 1;	/* 'g' option given */
   unsigned print : 2;	/* 'p' option given (before/after eval) */
   unsigned eval : 1;	/* 'e' option given */
@@ -146,39 +143,36 @@
   struct addr *a1;	/* save space: usually is NULL */
   struct addr *a2;
 
-  /* See description the enum, above.  */
-  enum addr_state range_state;
+  /* non-zero if a1 has been matched; apply command until a2 matches */
+  char a1_matched;
 
-  /* Non-zero if command is to be applied to non-matches. */
+  /* non-zero: only apply command to non-matches */
   char addr_bang;
 
-  /* The actual command character. */
+  /* the actual command */
   char cmd;
 
   /* auxiliary data for various commands */
   union {
-    /* This structure is used for a, i, and c commands. */
+    /* This structure is used for a, i, and c commands */
     struct text_buf cmd_txt;
 
-    /* This is used for the l, q and Q commands. */
+    /* This is used for the l, q and Q commands */
     int int_arg;
 
-    /* This is used for the {}, b, and t commands. */
+    /* This is used for {}, b, and t commands */
     countT jump_index;
 
-    /* This is used for the r command. */
+    /* This for r command */
     char *fname;
 
-    /* This is used for the hairy s command. */
+    /* This for the hairy s command */
     struct subst *cmd_subst;
 
-    /* This is used for the w command. */
-    struct output *outf;
-
-    /* This is used for the R command. */
+    /* This for R and w command */
     FILE *fp;
 
-    /* This is used for the y command. */
+    /* This for the y command */
     unsigned char *translate;
     char **translatemb;
   } x;
@@ -187,83 +181,43 @@
 
 
 void bad_prog P_((const char *why));
-size_t normalize_text P_((char *text, size_t len, enum text_types buftype));
+size_t normalize_text P_((char *, size_t));
 struct vector *compile_string P_((struct vector *, char *str, size_t len));
 struct vector *compile_file P_((struct vector *, const char *cmdfile));
 void check_final_program P_((struct vector *));
 void rewind_read_files P_((void));
 void finish_program P_((struct vector *));
 
-struct regex *compile_regex P_((struct buffer *b, int flags, int needed_sub));
-int match_regex P_((struct regex *regex,
+regex_t *compile_regex P_((struct buffer *b, int flags, int needed_sub));
+int match_regex P_((regex_t *regex,
 		    char *buf, size_t buflen, size_t buf_start_offset,
 		    struct re_registers *regarray, int regsize));
 #ifdef DEBUG_LEAKS
-void release_regex P_((struct regex *));
+void release_regex P_((regex_t *));
 #endif
 
 int process_files P_((struct vector *, char **argv));
 
 int main P_((int, char **));
 
-extern void fmt P_ ((const char *line, const char *line_end, int max_length, FILE *output_file));
+extern void fmt P_ ((char *line, char *line_end, int max_length, FILE *output_file));
 
 extern int extended_regexp_flags;
 
 /* If set, fflush(stdout) on every line output. */
-extern bool unbuffered_output;
+extern flagT unbuffered_output;
 
 /* If set, don't write out the line unless explicitly told to. */
-extern bool no_default_output;
+extern flagT no_default_output;
 
 /* If set, reset line counts on every new file. */
-extern bool separate_files;
+extern flagT separate_files;
 
 /* Do we need to be pedantically POSIX compliant? */
-extern enum posixicity_types posixicity;
+extern flagT POSIXLY_CORRECT;
 
 /* How long should the `l' command's output line be? */
 extern countT lcmd_out_line_len;
 
 /* How do we edit files in-place? (we don't if NULL) */
 extern char *in_place_extension;
-
-/* Should we use EREs? */
-extern bool use_extended_syntax_p;
-
-/* Declarations for multibyte character sets.  */
-extern int mb_cur_max;
-
-#ifdef HAVE_MBRTOWC
-#ifdef HAVE_BTOWC
-#define MBRTOWC(pwc, s, n, ps) \
-  (mb_cur_max == 1 ? \
-   (*(pwc) = btowc (*(unsigned char *) (s)), 1) : \
-   mbrtowc ((pwc), (s), (n), (ps)))
-
-#define WCRTOMB(s, wc, ps) \
-  (mb_cur_max == 1 ? \
-   (*(s) = wctob ((wint_t) (wc)), 1) : \
-   wcrtomb ((s), (wc), (ps)))
-#else
-#define MBRTOWC(pwc, s, n, ps) \
-  mbrtowc ((pwc), (s), (n), (ps))
-
-#define WCRTOMB(s, wc, ps) \
-  wcrtomb ((s), (wc), (ps))
-#endif
-
-#define MBRLEN(s, n, ps) \
-  (mb_cur_max == 1 ? 1 : mbrtowc (NULL, s, n, ps))
-
-#define BRLEN(ch, ps) \
-  (mb_cur_max == 1 ? 1 : brlen (ch, ps))
-
-#else
-#define MBRLEN(s, n, ps) 1
-#define BRLEN(ch, ps) 1
-#endif
-
-extern int brlen P_ ((int ch, mbstate_t *ps));
-extern void initialize_mbcs P_ ((void));
-
--- 4.1.4/bootstrap.sh
+++ 4.0.9/bootstrap.sh
@@ -19,8 +19,8 @@
 */
 
 #define PACKAGE "sed"
-#define VERSION "4.1.4-boot"
-#define SED_FEATURE_VERSION "4.1"
+#define VERSION "4.0.9-boot"
+#define SED_FEATURE_VERSION "4.0"
 #define BOOTSTRAP 1
 
 /* Define if your compiler/headers don't support const. */
@@ -76,7 +76,6 @@
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c fmt.c || exit 1
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c compile.c || exit 1
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c execute.c || exit 1
-${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c mbcs.c || exit 1
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c regexp.c || exit 1
 
 ${CC} -o sed *.o ../lib/*.o || exit 1
--- 4.1.4/bootstrap.sh.in
+++ 4.0.9/bootstrap.sh.in
@@ -76,7 +76,6 @@
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c fmt.c || exit 1
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c compile.c || exit 1
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c execute.c || exit 1
-${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c mbcs.c || exit 1
 ${CC} -DHAVE_CONFIG_H -I.. -I. -I../lib -c regexp.c || exit 1
 
 ${CC} -o sed *.o ../lib/*.o || exit 1
--- 4.1.4/BUGS
+++ 4.0.9/BUGS
@@ -28,6 +28,14 @@
 
 * NON-BUGS
 
+`sed -n' and `s/regex/replace/p'
+
+  Some versions of sed ignore the `p' (print) option of an `s' command
+  unless the `-n' command switch has been specified.  Other versions
+  always honor the `p' option.  GNU sed is the latter sort.  (Both
+  approaches are allowed by POSIX.2.)
+
+
 `N' command on the last line
 
   Most versions of sed exit without printing anything when the `N'
@@ -37,7 +45,7 @@
   behind this choice can be found in the Info manual.
 
 
-regex syntax clashes (problems with backslashes)
+regexp syntax clashes
 
   sed uses the Posix basic regular expression syntax.  According to
   the standard, the meaning of some escape sequences is undefined in
@@ -55,16 +63,6 @@
   must be modified by removing the spurious backslashes if they are to
   be used with recent versions of sed (not only GNU sed).
 
-  On the other hand, some scripts use `s|abc\|def||g' to remove occurrences
-  of _either_ `abc' or `def'.  While this worked until sed 4.0.x, newer
-  versions interpret this as removing the string `abc|def'.  This is
-  again undefined behavior according to POSIX, but this interpretation
-  is arguably more robust: the older one, for example, required that
-  the regex matcher parsed `\/' as `/' in the common case of escaping
-  a slash, which is again undefined behavior; the new behavior avoids
-  this, and this is good because the regex matcher is only partially
-  under our control.
-
   In addition, GNU sed supports several escape characters (some of
   which are multi-character) to insert non-printable characters
   in scripts (`\a', `\c', `\d', `\o', `\r', `\t', `\v', `\x').  These
@@ -91,32 +89,14 @@
   bug...).
 
 
-`0a' does not work (gives an error)
+`0a' does not work
 
   There is no line 0.  0 is a special address that is only used to treat
   addresses like `0,/RE/' as active when the script starts: if you
   write `1,/abc/d' and the first line includes the word `abc', then
   that match would be ignored because address ranges must span at least
   two lines (barring the end of the file); but what you probably wanted is
-  to delete every line up to the first one including `abc', and this
+  to delete every line up to the first one including `abc}, and this
   is obtained with `0,/abc/d'.
 
 
-`[a-z]' is case insensitive
-
-  You are encountering problems with locales.  POSIX mandates that `[a-z]'
-  uses the current locale's collation order -- in C parlance, that means
-  strcoll(3) instead of strcmp(3).  Some locales have a case insensitive
-  strcoll, others don't: one of those that have problems is Estonian.
-
-  Another problem is that [a-z] tries to use collation symbols.  This
-  only happens if you are on the GNU system, using GNU libc's regular
-  expression matcher instead of compiling the one supplied with GNU sed.
-  In a Danish locale, for example, the regular expression `^[a-z]$'
-  matches the string `aa', because aa is a single collating symbol that
-  comes after `a' and before `b'; `ll' behaves similarly in Spanish
-  locales, or `ij' in Dutch locales.
-
-  To work around these problems, which may cause bugs in shell scripts,
-  set the LC_ALL environment variable to `C', or set the locale on a
-  more fine-grained basis with the other LC_* environment variables.
--- 4.1.4/ChangeLog
+++ 4.0.9/ChangeLog
@@ -1,196 +1,15 @@
-2005-01-25  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/regexp.c: Fix building on GCC 2.95 and earlier.
-
-2004-12-26  Paolo Bonzini  <bonzini@gnu.org>
-
-	Do not use leftmost-longest matching for addresses.
-
-	* NEWS: Add a note about this.
-	* testsuite/recall2.good, testsuite/recall2.inp,
-	testsuite/recall2.sed: New test.
-	* testsuite/Makefile.am, testsuite/Makefile.tests: Add the
-	recall2 test.
-	* sed/sed.h (struct regex): New.
-	(struct addr, struct subst, compile_regex, match_regex,
-	release_regex): Use it instead of regex_t.
-	* sed/compile.c (compile_program): Update for new meaning of
-	the third parameter of compile_regex.
-	* sed/execute.c (do_subst): Pass less conservative value to
-	the regsize parameter of match_regex.
-	* sed/regexp.c (compile_regex_1): New, extracted out of
-	compile_regex.  The third parameter, needed_sub, now includes
-	\0 (so 10 means that \0 .. \9 are needed).  Pass RE_NO_SUB
-	if needed_sub is zero.
-	(compile_regex): Accept a struct regex instead of a regex_t.
-	Save the regular expression's text.
-	(match_regex): Accept a struct regex instead of a regex_t.
-	Recompile the pattern if it was compiled with RE_NO_SUB.
-	(release_regex): Accept a struct regex instead of a regex_t.
-
-	* doc/Makefile.am: Generate sed.texi correctly when
-	building outside srcdir.
-
-2004-12-26  Paolo Bonzini  <bonzini@gnu.org>
-
-	* BUGS: Add section about [a-z] matching uppercase characters,
-	and other locale issues.
-	* doc/sed-in.texi [!PERL]: Likewise.
-
-2004-11-15  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/execute.c (str_append_modified): Copy the first character
-	when using \l or \u in a multi-byte configuration.  Use
-	WCRTOMB instead of wcrtomb.
-	* sed/sed.h (WCRTOMB): New.
-
-2004-11-11  Paolo Bonzini  <bonzini@gnu.org>
-
-	* tst-rxspecer.c: Do not mix instructions and
-	declarations.
-	* basicdefs.h: Include locale.h before #defining
-	gettext, to avoid breakage under Solaris.
-	* sed/sed.c: do not include locale.h.
-
-2004-11-03  Paolo Bonzini  <bonzini@gnu.org>
-
-	* bug-regex11.c: Improve portability.
-	* bug-regex12.c: Improve portability.
-	* bug-regex13.c: Improve portability.
-	* bug-regex14.c: Improve portability.
-	* bug-regex21.c: Improve portability.
-	* bug-regex9.c: Improve portability.
-	* tst-boost.c: Improve portability.
-	* tst-pcre.c: Improve portability.
-	* tst-regex.c: Improve portability.
-	* tst-rxspencer.c: Improve portability.
-
-2004-10-08  Paolo Bonzini  <bonzini@gnu.org>
-
-	* lib/utils.c (utils_id_s): Renamed to open_files.
-	(struct id): Renamed to struct open_file.
-
-2004-10-08  Jakub Jelinek  <jakub@redhat.com>
-
-	* testsuite/Makefile.tests (bug-regex*, run-tests,
-	run-ptests): Use $(SED).
-	(version): Likewise; prepend $(SED) invocation with $(SEDENV).
-
-2004-08-16  Paolo Bonzini  <bonzini@gnu.org>
-
-	*** Version 4.1.2 released.
-
-2004-08-06  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/compile.c (bad_command): Fix off-by-one error.
-	(snarf_char_class): Fix problem with [.....[] (i.e.
-	last char in class is a bracket.
-
-2004-06-30  Paolo Bonzini  <bonzini@gnu.org>
-
-	*** Version 4.1.1 released.
-
-2004-06-29  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/compile.c (mark_subst_opts): Return int.
-	* sed/execute.c (open_next_file): Fix uninitialized
-	variable.
-
-2004-06-10  Paolo Bonzini  <bonzini@gnu.org>
-
-	*** Version 4.1 released.
-
-2004-03-25  Paolo Bonzini  <bonzini@gnu.org>
-
-	* lib/obstack.h: Get current version.
-
-2004-03-13  Paolo Bonzini  <bonzini@gnu.org>
-
-	Exit as soon as possible on an I/O error, and with
-	a better error message.
-
-	* lib/utils.c (ck_mkstemp, ck_rename, ck_getline): New
-	functions.  Save temporary files into utils_id_s.
-	(struct id): Add a field named temp.
-	(ck_fopen): Init the new temp field of struct id.
-	(panic): Unlink temporary files before exiting.
-	* sed/execute.c (read_file_line): Use ck_getline.
-	(closedown): Use ck_rename.
-	(open_next_file): Use ck_mkstemp.
-
-2004-01-20  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/sed.h (enum addr_state): New definition.
-	(enum addr_type): Remove ADDR_IS_NUM2.
-	(struct sed_cmd): Replace a1_matched with range_state.
-	* sed/compile.c (next_cmd_entry): Use range_state.
-	(compile_program): Death to ADDR_IS_NUM2.  Compile
-	N,Mp as Np if N>=M.
-	* sed/execute.c (match_address_p): Rewritten.  Handle
-	ADDR_IS_NUM here.
-	(match_an_address_p): Suit to new match_address_p.
-	(execute_program): Adjust to use range_state in `c'.
-	Handle addr_bang here.
-	(reset_addresses): Use range_state.
-
-	(struct input): New field "reset_at_next_file".
-	(read_pattern_space): Use it instead of "separate_files".
-	(process_files): Initialize it.
-	
-2004-01-17  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/sed.h: Do not include wchar.h and wctype.h, and do
-	not include the alloca stuff.
-	* basicdefs.h: Move all that here.
-
-2004-01-15  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/regexp.c [REG_PERL]: Use REG_STARTEND instead of regexec2.
-
-2004-01-09  Paul Eggert  <eggert@twinsun.com>
-	    Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/sed.h (posixicity): New variable, replaces POSIXLY_CORRECT.
-	* sed/sed.c (main): Set it.
-	* sed/compile.c: Use it instead of POSIXLY_CORRECT.
-	* sed/execute.c: Use it instead of POSIXLY_CORRECT.
-	* doc/sed-in.texi: Document it and --posix.
-
-2004-01-05  Paul Eggert  <eggert@twinsun.com>
-	    Paolo Bonzini  <bonzini@gnu.org>
-
-        * NEWS: Fix [\n] to match either backslash or n in POSIXLY_CORRECT mode.
-        * doc/sed-in.texi: Document this.  Also, document regular expressions
-        a bit better overall, using terminology that's more similar to POSIX.
-	* sed/sed.h (enum text_types): New definition.
-	* sed/compile.c (normalize_text): Replace final parameter with one of
-	type normalize_text.  If TEXT_REGEX and in POSIXLY_CORRECT mode,
-	grok character classes without replacing \n inside them.
-
 2004-01-03  Paolo Bonzini  <bonzini@gnu.org>
 
-        * sed/execute.c (execute_program): print final line
-        after executing N, if not POSIXLY_CORRECT.
+	* sed/execute.c (execute_program): print final line
+	after executing N, if not POSIXLY_CORRECT.
 
 2003-12-28  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c: fix "\\\n" in RHS of s command.
-	Reported by Mike Castle.
-	* testsuite/bkslashes.inp, testsuite/bkslashes.good,
-	testsuite/bkslashes.sed: New files.
-	* testsuite/Makefile.am, testsuite/Makefile.tests: Add
-	the bkslashes test.
-
-2003-12-16  Paolo Bonzini  <bonzini@gnu.org>
-
-	*** Version 4.0b released.
-
-	* sed/mbcs.c: New file.
-	* sed/sed.h: Declare macros for mbcs.c.
-	* sed/compile.c: Use them.
-	(brlen): Moved to mbcs.c.
-	* sed/execute.c: Use them.
-	* sed/sed.c: call initialize_mbcs ().
+        * testsuite/bkslashes.inp, testsuite/bkslashes.good,
+        testsuite/bkslashes.sed: New files, for a bug in
+	sed 4.0b.
+        * testsuite/Makefile.am, testsuite/Makefile.tests: Add
+        the bkslashes test.
 
 2003-12-14  Paolo Bonzini  <bonzini@gnu.org>
 
@@ -198,69 +17,23 @@
 
 2003-11-27  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/execute.c (reset_addresses): leave addresses 0
-	and 0~STEP enabled.
+        * sed/execute.c (reset_addresses): leave addresses 0
+        and 0~STEP enabled.
 
 2003-11-15  Jakub Jelinek  <jakub@redhat.com>
 
 	* sed/regex.c: Use fastmap.
 
-2003-09-21  Paolo Bonzini  <bonzini@gnu.org>
+2003-09-18  Stepan Kasal  <kasal@ucw.cz>
 
-	*** Version 4.0a released.
+	*** Version 4.0.8 released.
 
-	* sed/execute.c (struct line): Add mbstate field.
-	(str_append): Keep mbstate up to date.
-	(str_append_modified): Likewise, and use towupper/towlower.
-	(line_init): Initialize mbstate.
-	(line_copy): Copy mbstate.
-	(line_append): Copy mbstate.
-
-2003-07-15  Stepan Kasal  <kasal@ucw.cz>
-	    Paolo Bonzini  <bonzini@fnu.org>
-
-	Change the way we treat lines which are not terminated by a newline.
-	Such lines are printed without the terminating newline (as before)
-	but as soon as more text is sent to the same output stream, the
-	missing newline is printed, so that the two lines don't concatenate.
-
-	* sed/execute.c (output_file): Is now struct output; users adjusted
-	to access the fp field, call output_missing_newline before, and
-	call flush_output afterwards.
-	(read_file_line): Set line.chomped FALSE each time we encounter a
-	line without the newline terminator, no matter whether this is the
-	last input file or not, and no matter whether we are in
-	POSIXLY_CORRECT mode or not.
-	(output_missing_newline): New function which prints the suppressed
-	newline, if necessary.
-	(flush_output): New function for a common pattern.
-	(output_line): Use struct output, set its flag accordingly.
-	(dump_append_queue): Use `ck_fwrite' instead of output_line.
-	(do_list): Flush the output stream at the end.
-	(closedown): The code ``if(separate_files) rewind_read_files();''
-	(read_pattern_space): ... has been moved here.
-	(process_files): Don't do the default `p' at the end, ...
-	(execute_program): ... as this function is now responsible for it;
-	add the code to the end of the function and to the command `q';
-	the commands `d', `D' and `Q' thus no longer have to forge an empty
-	line.
-	(execute_program): Commands `c' and `i' no longer call the
-	function output_line with chomped==FALSE; instead, they chomp
-	the text and call the function with chomped==TRUE.
-	(execute_program): Command `e' no longer uses output_line; it
-	calls ck_fwrite directly.  Commands `e', `L' and `=' flush
-	the output stream at the end.
-	* sed/compile.c (special_files): Use `struct output' instead of the
-	file name.
-	(get_openfile): ... special files are no longer copied to file_read
-	or file_write.
-	(fp_list): Move to sed.h (users adjusted) and rename as...
-	* sed/sed.h (struct output): ...this.  New flag missing_newline
-	associated to the output stream.
-	(struct sed_cmd, struct subst): Use `struct output *' instead of mere
-	`FILE *'; adjust compile.c and execute.c.
-	* testsuite/noeolw.sed, testsuite/noeolw.good, testsuite/noeolw.1good,
-	testsuite/noeolw.2good: New tests
+        * sed/execute.c (process_files): Don't do the default `p' at the
+	end, ...
+        (execute_program): ... as this function is now responsible for it;
+        add the code to the end of the function and to the command `q';
+        the commands `d', `D' and `Q' thus no longer have to forge an empty
+        line.
 
 2003-07-15  Stepan Kasal  <kasal@ucw.cz>
 
@@ -270,149 +43,101 @@
 
 2003-06-11  Paolo Bonzini  <bonzini@gnu.org>
 
-	* lib/getline.c: Don't realloc with first param = NULL.
-
-2003-05-07  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/execute.c: Make treatment of ADDR_IS_NUM_MOD
-	simpler, and fix bugs in 0~5,+1
-	* sed/compile.c: Complain about addresses like 0
-	and 0,3 which are sources of misunderstandings.
-	Reported by Akim Demaille <akim@epita.fr>
+	* lib/getline.c: don't realloc with first param = NULL.
 
 2003-03-25  Paolo Bonzini  <bonzini@gnu.org>
 
 	*** Version 4.0.7 released
 
-	* sed/execute.c (append_replacement): Extract from
-	do_subst
-	(do_subst): Don't update count when a match was
-	skipped.
-	* testsuite/xbxcx3.good, testsuite/xbxcx3.sed, 
-	testsuite/xbxcx3.inp: Regression tests
+        * sed/execute.c (append_replacement): extract from
+        do_subst
+        (do_subst): don't update count when a match was
+        skipped.
+        * testsuite/xbxcx3.good, testsuite/xbxcx3.sed,
+        testsuite/xbxcx3.inp: regression tests
 
 2003-03-23  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/execute.c (do_subst): Fix several bugs with
-	numbered matches
-	* testsuite/numsub2.good, testsuite/numsub2.inp,
-	testsuite/numsub2.sed, testsuite/numsub3.good,
-	testsuite/numsub3.inp, testsuite/numsub3.sed,
-	testsuite/numsub4.good, testsuite/numsub4.inp,
-	testsuite/numsub4.sed, testsuite/numsub5.good,
-	testsuite/numsub5.inp, testsuite/numsub5.sed:
-	regression tests for the bugs
+        * sed/execute.c (do_subst): fix several bugs with
+        numbered matches
+        * testsuite/numsub2.good, testsuite/numsub2.inp,
+        testsuite/numsub2.sed, testsuite/numsub3.good,
+        testsuite/numsub3.inp, testsuite/numsub3.sed,
+        testsuite/numsub4.good, testsuite/numsub4.inp,
+        testsuite/numsub4.sed, testsuite/numsub5.good,
+        testsuite/numsub5.inp, testsuite/numsub5.sed:
+        regression tests for the bugs
 
 2003-03-15  Paolo Bonzini  <bonzini@gnu.org>
 
 	*** Version 4.0.6 released
 
-	* lib/mkstemp.c: Include sys/file.h if available for the
+	* basicdefs.h: undefine temporarily FALSE and TRUE
+	* lib/mkstemp.c: include sys/file.h if available for the
 	benefit of Ultrix
 
-2003-03-14  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/compile.c: Replace flagT with bool
-	* sed/execute.c: Replace flagT with bool
-	* sed/fmt.c: Replace flagT with bool
-	* sed/sed.c: Replace flagT with bool
-	* sed/regex.c: Replace flagT with bool
-
 2003-03-13  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (compile_program): Understand parameter
+	* sed/compile.c (compile_program): understand parameter
 	of `v'.
 
-	* sed/sed.c (usage): Split help message into multiple
-	strings
-	(main): Don't understand -h and -V
-
-2003-03-12  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/compile.c (match_slash, snarf_char_class):  More
-	multibyte character support
-	(brlen): New function
-	* testsuite/classes.good, testsuite/classes.inp,
-	testsuite/classes.sed: New files
-
-2003-03-10  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/compile.c (match_slash): Strip the \ in front of
-	slashes (so that the matcher sees x/ for s/x\///).  Don't
-	match / and [ unless at the start of a character.
-
-2003-02-18  Paolo Bonzini  <bonzini@gnu.org>
-
-	* sed/regex.c (compile_regex): // matches the last regular
-	expression even in POSIXLY_CORRECT mode.
-	* sed/compile.c (normalize_text): Treat multibyte character
-	sets correctly
-	(read_text): Don't swallow backslash sequences, run text
-	through normalize_text
-	(compile_program): Ditto for y command
-
-	* sed/compile.c (normalize_text): Add parameter that says
-	whether the text will be processed further to remove more
-	backslash escapes.  Callers adjusted
-	(match_slash): Remove same parameter from here.  Callers adjusted.
-
 2003-02-15  Paolo Bonzini  <bonzini@gnu.org>
 
-        * sed/sed.h: Fix prototype for match_regex, declare re_registers
+        * sed/sed.h: fix prototype for match_regex, declare re_registers
         if REG_PERL
-        * sed/execute.c (do_subst): Use re_registers
-        * sed/regex.c (copy_regs): New function
-        [REG_PERL]: Use re_registers
-        [!REG_PERL]: Avoid using internal entry points, support pre-glibc
+        * sed/execute.c (do_subst): use re_registers
+        * sed/regex.c (copy_regs): new function
+        [REG_PERL]: use re_registers
+        [!REG_PERL]: avoid using internal entry points, support pre-glibc
 	2.3 regex for the sake of --without-included-regex.
 
 2003-01-04  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/sed.h: Move some stuff from here...
+	* sed/sed.h: move some stuff from here...
 	* sed/basicdefs.h: ...to here
-	* lib/utils.c (ck_fopen): Add FAIL parameter
-	* lib/utils.h: Adjust parameter
-	* sed/compile.c, sed/execute.c, sed/sed.c: Adjust callers
-
-	* sed/basicdefs.h: Add TRUE/FALSE
-	* sed/compile.c, sed/execute.c, sed/sed.c: Use them
-	* sed/fmt.c: Do not redefine them
+	* lib/utils.c (ck_fopen): add FAIL parameter
+	* lib/utils.h: adjust parameter
+	* sed/compile.c, sed/execute.c, sed/sed.c: adjust callers
+
+	* sed/basicdefs.h: add TRUE/FALSE
+	* sed/compile.c, sed/execute.c, sed/sed.c: use them
+	* sed/fmt.c: do not redefine them
 
 2003-01-02  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/sed.c: Bump copyright year
+	* sed/sed.c: bump copyright year
 
 2002-12-24  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/sed.c: Use bindtextdomain
-	* sed/basicdefs.h [__EMX__]: Define initialize_main
-	* lib/getline.c [__EMX__]: Strip trailing CR
+	* sed/sed.c: use bindtextdomain
+	* sed/basicdefs.h [__EMX__]: define initialize_main
+	* lib/getline.c [__EMX__]: strip trailing CR
 
-	* sed/regex.c: Don't use N_ on the lines that define
+	* sed/regex.c: don't use N_ on the lines that define
 	error messages, some compilers complain.
 
 2002-12-18  Paolo Bonzini  <bonzini@gnu.org>
 
 	*** Version 4.0.5 released
 
-	* sed/compile.c: Don't use N_ on the lines that define
+	* sed/compile.c: don't use N_ on the lines that define
 	error messages, some compilers complain.
 
 2002-12-16  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c: Improvements to some error messages;
+	* sed/compile.c: improvements to some error messages;
 	`a', `i', `l', `L', `r' accept two addresses except in
 	POSIXLY_CORRECT mode.
 
 2002-12-14  Paolo Bonzini  <bonzini@gnu.org>
 
-	* lib/regex_internal.c: Fix problem on non-glibc
+	* lib/regex_internal.c: fix problem on non-glibc
 	systems, from Jakub Jelinek
-	* lib/regex.c (RE_ENABLE_I18N): Conditionalize on
+	* lib/regex.c (RE_ENABLE_I18N): conditionalize on
 	HAVE_MBRTOWC and HAVE_WCRTOMB.
-	* lib/getline.c: Fix compilation on non-glibc system
-	* lib/snprintf.c: Fix compilation on non-glibc system
-	* lib/basicdefs.h [P_]: Make more portable
+	* lib/getline.c: fix compilation on non-glibc system
+	* lib/snprintf.c: fix compilation on non-glibc system
+	* lib/basicdefs.h [P_]: make more portable
 
 2002-12-12  Paolo Bonzini  <bonzini@gnu.org>
 
@@ -436,12 +161,12 @@
 
 2002-10-28  Paolo Bonzini  <bonzini@gnu.org>
 
-	* lib/utils.c: Don't fail for EBADF in fflush
+	* lib/utils.c: don't fail for EBADF in fflush
 	* src/sed.c: the_program is now a global
 
 2002-10-19  Paolo Bonzini  <bonzini@gnu.org>
 
-	* src/sed.c: Print GNU sed in --version for GNU sed,
+	* src/sed.c: print GNU sed in --version for GNU sed,
 	and super-sed for super-sed (thanks to Bruno Haible)
 
 2002-10-17  Paolo Bonzini  <bonzini@gnu.org>
@@ -450,9 +175,9 @@
 
 2002-10-16  Isamu Hasegawa  <isamu@yamato.ibm.com>
 
-	* src/execute.c (execute_program): Multibyte 'y'
-	* src/compile.c (compile_program): Likewise
-	* src/sed.h: Likewise
+	* src/execute.c (execute_program): multibyte 'y'
+	* src/compile.c (compile_program): likewise
+	* src/sed.h: likewise
 
 2002-10-08  Paolo Bonzini  <bonzini@gnu.org>
 
@@ -461,112 +186,112 @@
 2002-07-15  Paolo Bonzini  <bonzini@gnu.org>
 
 	* src/sed.h: rfile --> fname, wfile --> fp
-	* src/compile.c (compile_command): Parse 'R' like 'w', use
+	* src/compile.c (compile_command): parse 'R' like 'w', use
 	separate lists for file read and file write
-	* src/compile.c (get_openfile): New name of get_writefile
-	* src/compile.c (rewind_read_files): New function
-	* src/sed.h: Declared here
-	* src/execute.c (closedown): And called here
-	* src/execute.c (append_queue): Added 'free' field
-	* src/execute.c (execute_program): Implement 'R'
+	* src/compile.c (get_openfile): new name of get_writefile
+	* src/compile.c (rewind_read_files): new function
+	* src/sed.h: declared here
+	* src/execute.c (closedown): and called here
+	* src/execute.c (append_queue): added 'free' field
+	* src/execute.c (execute_program): implement 'R'
 
 2002-06-09  Paolo Bonzini  <bonzini@gnu.org>
 
-	* src/execute.c (do_subst): Replaced flag was set on every
+	* src/execute.c (do_subst): replaced flag was set on every
 	regexp match, while the first matches should not set it
 	for s///N.
 
 2002-06-08  Paolo Bonzini  <bonzini@gnu.org>
 
-	* src/compile.c (compile_file): Open the script in text mode
-	* lib/utils.c (utils_fp_name): Shorten the output
-	* lib/utils.c (ck_fread, ck_fwrite, ck_fflush): Clearerr
+	* src/compile.c (compile_file): open the script in text mode
+	* lib/utils.c (utils_fp_name): shorten the output
+	* lib/utils.c (ck_fread, ck_fwrite, ck_fflush): clearerr
 	after printing an error.
-	* lib/utils.c (ck_fclose): Work on stdout as well if stream == NULL
+	* lib/utils.c (ck_fclose): work on stdout as well if stream == NULL
 	and flush before closing to check for errors
 
 2002-05-30  Paolo Bonzini  <bonzini@gnu.org>
 
-	* src/compile.c (compile_program): Implement W
-	* src/execute.c (execute_program): Likewise
+	* src/compile.c (compile_program): implement W
+	* src/execute.c (execute_program): likewise
 
 2002-04-23  Paolo Bonzini  <bonzini@gnu.org>
 
-	* src/sed.c (usage, main): Parse -s
-	* src/sed.h (separate_files): New variable
-	* src/execute.c (separate_files): New variable
-	* src/execute.c (reset_addresses): New function to make range
+	* src/sed.c (usage, main): parse -s
+	* src/sed.h (separate_files): new variable
+	* src/execute.c (separate_files): new variable
+	* src/execute.c (reset_addresses): new function to make range
 	addresses work separately on each file when using in-place
 	editing
-	* src/execute.c (execute_program): The `n' and `N' use test_eof
+	* src/execute.c (execute_program): the `n' and `N' use test_eof
 	so that the script restarts at end of file, not at end of input
-	* src/execute.c (test_dollar_EOF): Make $ work separately
+	* src/execute.c (test_dollar_EOF): make $ work separately
 	on each file when using -s; renamed to test_eof
 	
 2002-02-28  Paolo Bonzini  <bonzini@gnu.org>
 
 	* src/sed.h (struct sed_cmd): exit_status -> int_arg
-	* src/compile.c: Likewise
-	* src/execute.c: Likewise
+	* src/compile.c: likewise
+	* src/execute.c: likewise
 
-	* src/compile.c (compile_command): Parse `l' like
+	* src/compile.c (compile_command): parse `l' like
 	`q' and `Q'; default for int_arg is -1
-	* src/execute.c (do_list): New argument, used instead
+	* src/execute.c (do_list): new argument, used instead
 	of lcmd_out_line_len
-	(execute_program): Interpret int_arg for the `l' command;
+	(execute_program): interpret int_arg for the `l' command;
 	return 0 for `q' and `Q' if int_arg is -1
 
-	* src/fmt.c: New file, looted from GNU textutils
-	* src/compile.c: Parse `L'
-	* src/execute.c: Execute `L'
+	* src/fmt.c: new file, looted from GNU textutils
+	* src/compile.c: parse `L'
+	* src/execute.c: execute `L'
 	
 2002-02-14  Paolo Bonzini  <bonzini@gnu.org>
 
-	* src/execute.c (str_append_modified): Fixed a stupid
+	* src/execute.c (str_append_modified): fixed a stupid
 	bug (stop condition was *start == *end, meant to be
 	start == end)
 
 2002-02-05  Paolo Bonzini  <bonzini@gnu.org>
 
-	* lib/utils.c: Added directory parameter to
+	* lib/utils.c: added directory parameter to
 	temp_file_template
-	* lib/utils.h: Adjusted
-	* src/execute.c: Adjusted
+	* lib/utils.h: adjusted
+	* src/execute.c: adjusted
 
 2002-01-29  Paolo Bonzini  <bonzini@gnu.org>
 
-	* src/compile.c (mark_subst_opts): Signal an error if
+	* src/compile.c (mark_subst_opts): signal an error if
 	there are multiple g or p options
-	* src/compile.c (compile_program): Raise appropriate
+	* src/compile.c (compile_program): raise appropriate
 	error if second string in y command is longer than
 	first (used to be "excess junk after command")
 
 2001-12-31  Paolo Bonzini  <bonzini@gnu.org>
 
-	* lib/getline.c: Strip the terminating \r under Windows
+	* lib/getline.c: strip the terminating \r under Windows
 	or MS-DOS.
 	
 	* testsuite/xemacs.sed, testsuite/xemacs.inp,
-	testsuite/xemacs.good: Submitted by John Fremlin
+	testsuite/xemacs.good: submitted by John Fremlin
 	(john@fremlin.de)
 
 2001-12-27  Paolo Bonzini  <bonzini@gnu.org>
 	
-	* sed/execute.c (do_subst): Flags in optimized s/^xx/
+	* sed/execute.c (do_subst): flags in optimized s/^xx/
 	commands were discarded (see the change below)
 
 2001-12-19  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/execute.c (resize_line): Limit inactive space to two
+	* sed/execute.c (resize_line): limit inactive space to two
 	thirds of a buffer
-	* sed/execute.c (line_init): Initialize buf->active
+	* sed/execute.c (line_init): initialize buf->active
 	* sed/execute.c (str_append, str_append_modified, line_copy,
-	do_list, do_subst, execute_program, process_files): Operate
+	do_list, do_subst, execute_program, process_files): operate
 	on active space
 
-	* sed/execute.c (do_subst): Optimize s/^xx// by making a part
+	* sed/execute.c (do_subst): optimize s/^xx// by making a part
 	of the buffer inactive and s/xx$// by truncating it.
-	* sed/execute.c (execute_program): Optimize D by making a part
+	* sed/execute.c (execute_program): optimize D by making a part
 	of the buffer inactive
 	
 	* testsuite/uniq.sed, testsuite/uniq.inp, testsuite/uniq.good:
@@ -576,45 +301,45 @@
 
 2001-12-17  Paolo Bonzini  <bonzini@gnu.org>
 
-	* testsuite/dc.inp: Also compute Easter of 2002 :-)
+	* testsuite/dc.inp: also compute Easter of 2002 :-)
 
-	* sed/execute.c [!HAVE_FCHMOD]: Don't chmod the output file
+	* sed/execute.c [!HAVE_FCHMOD]: don't chmod the output file
 	if working in-place
 
 2001-11-12  Paolo Bonzini  <bonzini@gnu.org>
 
 	* sed/sed.h (struct sed_cmd): a1 is a pointer too
-	* sed/compile.c: Likewise
-	* sed/execute.c: Likewise
+	* sed/compile.c: likewise
+	* sed/execute.c: likewise
 
-	* sed/compile.c: Use obstacks
-	* sed/execute.c: Likewise
+	* sed/compile.c: use obstacks
+	* sed/execute.c: likewise
 
 2001-11-09  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (mark_subst_opts): Parse option `e',
+	* sed/compile.c (mark_subst_opts): parse option `e',
 	preserve two occurrences of the `e' and `p' options.
-	* sed/execute.c (do_subst) [HAVE_POPEN]: Interpret option
+	* sed/execute.c (do_subst) [HAVE_POPEN]: interpret option
 	`e' (evaluate, like Perl's but uses Bourne shell).
-	* sed/sed.h (struct subst): Add an `eval' flag.
+	* sed/sed.h (struct subst): add an `eval' flag.
 
-	* sed/compile.c (compile_program): Compile command `e'
+	* sed/compile.c (compile_program): compile command `e'
 	like `c'.
-	* sed/execute.c (execute_program): Execute command `e'.
+	* sed/execute.c (execute_program): execute command `e'.
 
 2001-09-25  Paolo Bonzini  <bonzini@gnu.org>
 
 	* sed/compile.c (get_writefile) [!POSIXLY_CORRECT]:
 	support /dev/stdout
-	* sed/execute.c (open_next_file, closedown): Support
+	* sed/execute.c (open_next_file, closedown): support
 	in-place editing
-	* sed/execute.c (backup_file_name): New function to
+	* sed/execute.c (backup_file_name): new function to
 	support in-place editing
-	* sed/main.c (usage, main): Parse -i.
-	* sed/utils.c: Moved to lib directory
+	* sed/main.c (usage, main): parse -i.
+	* sed/utils.c: moved to lib directory
 	
-	* lib/utils.c (temp_file_template): New function.
-	* sed/utils.h: Declared temp_file_template.
+	* lib/utils.c (temp_file_template): new function.
+	* sed/utils.h: declared temp_file_template.
 
 2001-09-05  Paolo Bonzini  <bonzini@gnu.org>
 
@@ -622,131 +347,131 @@
 	s/a*/x/g, gave `xbxxcx' rather than `xbxcx' (because an
 	empty string matched before the `c'.  Fixed.
 
-	* sed/execute.c: Removed mmap support, I/O is done using
+	* sed/execute.c: removed mmap support, I/O is done using
 	getline (slower but more bug-proof).
-	* sed/utils.c: Likewise.
-	* lib/getline.c: New file
+	* sed/utils.c: likewise.
+	* lib/getline.c: new file
 
 2001-03-22  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (normalize_text) [POSIXLY_CORRECT]: Enable
+	* sed/compile.c (normalize_text) [POSIXLY_CORRECT]: enable
 	escapes in modes other than BRE.
 
 2001-03-21  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (normalize_text): Support \XXX in Perl mode,
+	* sed/compile.c (normalize_text): support \XXX in Perl mode,
 	\oXXX in non-Perl mode.
 
 2001-03-18  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (compile_program): Fixed missing break when
+	* sed/compile.c (compile_program): fixed missing break when
 	compiling 'q' and 'Q'.
 
-	* sed/compile.c (check_final_program): Removed now spurious
+	* sed/compile.c (check_final_program): removed now spurious
 	call to compile_regex
-	* sed/regex.c (compile_regex): Don't track the last compiled
+	* sed/regex.c (compile_regex): don't track the last compiled
 	regex
-	* sed/regex.c (execute_regex): Track here the last compiled
+	* sed/regex.c (execute_regex): track here the last compiled
 	regex
 	
 2001-03-02  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (setup_replacement): Support \[lLuUE] like
+	* sed/compile.c (setup_replacement): support \[lLuUE] like
 	Perl and vi.
-	* sed/compile.c (new_replacement): Accept new parameter
+	* sed/compile.c (new_replacement): accept new parameter
 	to support \[lLUuE].
-	* sed/sed.h (enum replacement_types): New declaration
-	* sed/execute.c (do_subst): Use new function str_append_modified
+	* sed/sed.h (enum replacement_types): new declaration
+	* sed/execute.c (do_subst): use new function str_append_modified
 	to apply the changes required via \[lLUuE].
-	* sed/execute.c (str_append_modified): New function
+	* sed/execute.c (str_append_modified): new function
 
 2001-03-02  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (setup_replacement): Count the number of backreferences
+	* sed/compile.c (setup_replacement): count the number of backreferences
 	that the RHS needs
-	* sed/regex.c (compile_regex): Check if there is a sufficient number
+	* sed/regex.c (compile_regex): check if there is a sufficient number
 	of backreferences (new argument needed_sub replaces nosub)
 	* sed/compile.c (compile_address, compile_program,
-	check_final_program): Callers adjusted
+	check_final_program): callers adjusted
 
 2001-02-08  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (compile_program): Added `Q' (quit without output)
-	* sed/execute.c (execute_program): Ditto
+	* sed/compile.c (compile_program): added `Q' (quit without output)
+	* sed/execute.c (execute_program): ditto
 
-	* sed/compile.c (compile_program): Fill in exit_status for `q' and `Q'
-	* sed/execute.c (execute_program): Return -1 for `go on', 0..255
+	* sed/compile.c (compile_program): fill in exit_status for `q' and `Q'
+	* sed/execute.c (execute_program): return -1 for `go on', 0..255
 	to set the exit status
-	* sed/execute.c (process_files): Interpret new convention for
+	* sed/execute.c (process_files): interpret new convention for
 	execute_program, return sed's exit code
-	* sed/sed.c (main): Return process_files's exit code
-	* sed/sed.h (struct sed_cmd): Declare exit_status
+	* sed/sed.c (main): return process_files's exit code
+	* sed/sed.h (struct sed_cmd): declare exit_status
 	
 2001-01-07  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c (compile_program): Added `T' (branch if failed)
-	* sed/execute.c (shrink_program, execute_program): Ditto
+	* sed/compile.c (compile_program): added `T' (branch if failed)
+	* sed/execute.c (shrink_program, execute_program): ditto
 
 2001-01-04  Paolo Bonzini  <bonzini@gnu.org>
 
-	* testsuite/Makefile.am: Use automake's implementation
+	* testsuite/Makefile.am: use automake's implementation
 	of `make check'.  Removed the test targets
-	* testsuite/Makefile.tests: Moved the test targets here
+	* testsuite/Makefile.tests: moved the test targets here
 	(new file).
-	* testsuite/runtest: New file
+	* testsuite/runtest: new file
 
 	* testsuite/Makefile.tests: `khadafy' test uses EREs.
 
-	* testsuite/spencer.inp: Removed the ^* test
+	* testsuite/spencer.inp: removed the ^* test
 
-	* testsuite/spencer.sh: Don't rely on awk; more comments too
+	* testsuite/spencer.sh: don't rely on awk; more comments too
 	
 2001-01-03  Paolo Bonzini  <bonzini@gnu.org>
    
-	* sed/compile.c(snarf_char_class) [REG_PERL]: Don't parse
+	* sed/compile.c(snarf_char_class) [REG_PERL]: don't parse
 	`\n' specially
-	* sed/compile.c(match_slash) [REG_PERL]: Ditto
+	* sed/compile.c(match_slash) [REG_PERL]: ditto
 
-	* sed/compile.c(read_text) [REG_PERL]: Support [xX] modifiers
-	* sed/compile.c(mark_subst_opts) [REG_PERL]: Ditto
+	* sed/compile.c(read_text) [REG_PERL]: support [xX] modifiers
+	* sed/compile.c(mark_subst_opts) [REG_PERL]: ditto
 
 2000-12-21  Paolo Bonzini  <bonzini@gnu.org>
 
-	* lib/snprintf.c [BOOTSTRAP]: Don't include stdio.h
-	* lib/strerror.c [BOOTSTRAP]: Don't include stdio.h
-	* sed/execute.c [!HAVE_ISATTY]: Don't buffer stdin
+	* lib/snprintf.c [BOOTSTRAP]: don't include stdio.h
+	* lib/strerror.c [BOOTSTRAP]: don't include stdio.h
+	* sed/execute.c [!HAVE_ISATTY]: don't buffer stdin
 
 2000-12-11  Paolo Bonzini  <bonzini@gnu.org>
 
-	* sed/compile.c(mark_subst_opts): Support [mMsS] flags
-	* sed/compile.c(read_text): Support [MS] flags for 
+	* sed/compile.c(mark_subst_opts): support [mMsS] flags
+	* sed/compile.c(read_text): support [MS] flags for 
 	addresses
-	* sed/regex.c(compile_regex): Support arbitrary flags for
+	* sed/regex.c(compile_regex): support arbitrary flags for
 	regncomp.
 
-	* sed/regex.c(compile_regex) [REG_PERL]: Don't call
+	* sed/regex.c(compile_regex) [REG_PERL]: don't call
 	normalize_text.
 
 2000-12-08  Paolo Bonzini  <bonzini@gnu.org>
 
-	* basicdefs.h: Moved here from the `sed' subdirectory.
+	* basicdefs.h: moved here from the `sed' subdirectory.
 	
-	* configure.in: Removed crap to pick a regex engine.
+	* configure.in: removed crap to pick a regex engine.
 	Added snprintf to the AC_REPLACE_FUNCS call.
 
-	* lib/snprintf.c: New file.
+	* lib/snprintf.c: new file.
 	
-	* sed/regex.c(compile_regex): Use regncomp
-	* sed/regex.c(match_regex): Use regexec2
+	* sed/regex.c(compile_regex): use regncomp
+	* sed/regex.c(match_regex): use regexec2
 
-	* sed/compile.c(compile_program): Implemented the `v' command.
+	* sed/compile.c(compile_program): implemented the `v' command.
 
-	* sed/sed.c(main): Implemented the `r' and `R' options
+	* sed/sed.c(main): implemented the `r' and `R' options
 
-	* sed/sed.h: Replaced use_extended_syntax_t with
+	* sed/sed.h: replaced use_extended_syntax_t with
 	extended_regexp_flags to support Perl regular expressions.
 
-	* sed/execute.c(open_next_file): Don't mmap stdin (because
+	* sed/execute.c(open_next_file): don't mmap stdin (because
 	we cannot seek into it, so a redirected stdin's contents
 	would not be "eaten" by sed)
 
@@ -755,20 +480,20 @@
 	*** Version 3.02.80 released
 	
 	* sed/execute.c(do_subst): lib/regex.c(re_search_2) seems to
-	want one extra backreference register; humor it.
+	  want one extra backreference register; humor it.
 
 	* sed/regex.c(compile_regex): work around some odd assumptions
-	that lib/regex.c(re_compile_pattern) makes about our desired
-	RE syntax.
+	  that lib/regex.c(re_compile_pattern) makes about our desired
+	  RE syntax.
 
 	* configure.in: tweaked version to 3.02.80; added new entries
-	to the ALL_LINGUAS definition.
+	  to the ALL_LINGUAS definition.
 
 	* doc/sed.1, doc/sed.texi, BUGS: explicitly request the output
-	of sed --version in bug-reporting instructions.
+	  of sed --version in bug-reporting instructions.
 
 	* doc/sed.texi: the old "informal seders list" is dead; document
-	the new sed-users mailing list instead (under Other Resources).
+	  the new sed-users mailing list instead (under Other Resources).
 
 
 Thu Aug 19 23:27:54 PDT 1999  Ken Pizzini <ken@gnu.org>
@@ -781,180 +506,180 @@
 	 match_regex(), and release_regex(); drop rx_testing variable.
 
 	* sed/compile.c: move the compile_regex() function to regex.c;
-	export bad_prog() and normalize_text() functions; eliminate the
-	rx_testing debris; rename the NOLEAKS symbol to more descriptive
-	DEBUG_LEAKS; make cmd_regex to cmd_subst fixes (see above);
-	make use of newly abstracted release_regex() function.
+	  export bad_prog() and normalize_text() functions; eliminate the
+	  rx_testing debris; rename the NOLEAKS symbol to more descriptive
+	  DEBUG_LEAKS; make cmd_regex to cmd_subst fixes (see above);
+	  make use of newly abstracted release_regex() function.
 
 	* sed/execute.c: abstract out the regex matching to
-	regex.c:match_regex(); NOLEAKS to DEBUG_LEAKS change;
-	cmd_regex to cmd_subst structure member name change.
+	  regex.c:match_regex(); NOLEAKS to DEBUG_LEAKS change;
+	  cmd_regex to cmd_subst structure member name change.
 
 	* sed/execute.c(do_subst): use re_registers/regoff_t instead of
-	regmatch_t to hold the backreference registers, make "offset"
-	always be relative to the beginning of the string (rather than
-	a delta from "start"), defer some matching bookkeeping (e.g.,
-	not_bol_p) to match_regex().
+	  regmatch_t to hold the backreference registers, make "offset"
+	  always be relative to the beginning of the string (rather than
+	  a delta from "start"), defer some matching bookkeeping (e.g.,
+	  not_bol_p) to match_regex().
 
 	* sed/sed.c(main): loose rx_testing variable; NOLEAKS
-	(aka DEBUG_LEAKS) code attempting to release
-	_nl_current_default_domain is problematic, so omit it.
+	  (aka DEBUG_LEAKS) code attempting to release
+	  _nl_current_default_domain is problematic, so omit it.
 
 	* sed/regex.c: new file --- abstracts out the interface to the
-	regex engine so that less conditional code is required in
-	compile.c and execute.c, and so as to make a change of engine
-	easier; implements compile_regex() (which looks an awful lot
-	like the one that used to live in compile.c), match_regex(),
-	and (if DEBUG_LEAKS is set) release_regex().
+	  regex engine so that less conditional code is required in
+	  compile.c and execute.c, and so as to make a change of engine
+	  easier; implements compile_regex() (which looks an awful lot
+	  like the one that used to live in compile.c), match_regex(),
+	  and (if DEBUG_LEAKS is set) release_regex().
 
 Sun Apr 18 04:40:46 PDT 1999  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c(main): conditionalize calls to setlocale() and
-	textdomain() to only occur if their support is needed/wanted.
+	  textdomain() to only occur if their support is needed/wanted.
 
 Sun Apr 18 03:01:46 PDT 1999  Ken Pizzini <ken@gnu.org>
 
 	* bootstrap.sh: "foo || bar && baz" was not grouping like I
-	expected ("foo || (bar && baz)") under at least one shell,
-	so change the test for a pre-existing config.h file to an
-	if statement.
+	  expected ("foo || (bar && baz)") under at least one shell,
+	  so change the test for a pre-existing config.h file to an
+	  if statement.
 
 	* bootstrap.sh: added -DUSE_REGEX_GNU_H option to the
-	compiler invocation, to ensure that we get a usable
-	regex library included.
+	  compiler invocation, to ensure that we get a usable
+	  regex library included.
 
 Sun Apr 18 02:59:42 PDT 1999  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.h, sed/utils.c: conditionalized inclusion of <libintl.h>
-	to occur only if ENABLE_NLS is defined.
+	  to occur only if ENABLE_NLS is defined.
 
 Sun Apr 18 01:48:45 PDT 1999  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(xofa,normalize_text,convert_number): change
-	name of xofa() function to convert_number(); change semantics
-	to do all of the work of the text->number conversion.
+	  name of xofa() function to convert_number(); change semantics
+	  to do all of the work of the text->number conversion.
 
 	* sed/compile.c(normalize_text): add new \dDDD decimal
-	and \oOOO octal escapes.
+	  and \oOOO octal escapes.
 
 Sun Mar 28 21:05:07 PST 1999  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c(main): if NOLEAKS is set, free up a word that
-	the call to textdomain() allocated.
+	  the call to textdomain() allocated.
 
 	* sed/execute.c(read_file_line): plug up (minor) memory leak:
-	if buffer.alloc==0 we may have malloc()'d 1 byte anyway,
-	so be sure to FREE(buffer.text) before calling line_init();
+	  if buffer.alloc==0 we may have malloc()'d 1 byte anyway,
+	  so be sure to FREE(buffer.text) before calling line_init();
 
 Fri Mar 26 16:52:10 PST 1999  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(match_slash): somewhere between 3.02
-	and 3.02a we lost the ability to use a newline as
-	the s/// delimiter; restore this ability.
+	  and 3.02a we lost the ability to use a newline as
+	  the s/// delimiter; restore this ability.
 
 	* sed/compile.c(compile_regex): forget about trying
-	to cache the compiled form of the last RE --- it
-	causes more problems than its worth.  We now only
-	cache the source form.
+	  to cache the compiled form of the last RE --- it
+	  causes more problems than its worth.  We now only
+	  cache the source form.
 
 	* testsuite/help.good: update to reflect output containing
-	new options.
+	  new options.
 
 Sun Dec  6 00:51:23 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/utils.c(ck_fwrite): fix i18n bug of using a printf
-	fragment of "item%s" to handle plural text.
+	  fragment of "item%s" to handle plural text.
 
 Mon Nov 23 11:03:40 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* doc/sed.1, doc/sed.texi: ran ispell over these
-	files to catch the more obvious typos...
+	  files to catch the more obvious typos...
 
 Sun Nov  1 00:09:07 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/execute.c(do_list): make a `lcmd_out_line_len'
-	(--line-length) of zero mean "infinite length",
-	i.e., "never wrap".
+	  (--line-length) of zero mean "infinite length",
+	  i.e., "never wrap".
 
 Sat Oct 31 23:06:50 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* execute.c(match_an_address_p,process_files),
-	compile.c(compile_program): back out the "zero-address"
-	changes of 1998-09-27.  It was a neat idea, but there are
-	too many dark corners which don't work well.  The
-	special code for handling line ranges starting at
-	address zero (from 1998-08-31) are still there though:
-	this seems to work fine with no surprises.
+	  compile.c(compile_program): back out the "zero-address"
+	  changes of 1998-09-27.  It was a neat idea, but there are
+	  too many dark corners which don't work well.  The
+	  special code for handling line ranges starting at
+	  address zero (from 1998-08-31) are still there though:
+	  this seems to work fine with no surprises.
 
 Sat Oct 31 22:18:59 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c, sed/sed.h, sed/execute.c: added new
-	`lcmd_out_line_len' variable.  (Idea suggested by
-	Carlos J. G. Duarte <l38076@alfa.ist.utl.pt>.)
-	Also added ATOI macro (which uses strtoul() if available,
-	with fall-back to atoi()).
+	  `lcmd_out_line_len' variable.  (Idea suggested by
+	  Carlos J. G. Duarte <l38076@alfa.ist.utl.pt>.)
+	  Also added ATOI macro (which uses strtoul() if available,
+	  with fall-back to atoi()).
 	* sed/sed.c(main): attempt to use COLS environment variable
-	to set a reasonable `lcmd_out_line_len'; added -l/--line-length
-	command-line options to set the new `lcmd_out_line_len' flag.
+	  to set a reasonable `lcmd_out_line_len'; added -l/--line-length
+	  command-line options to set the new `lcmd_out_line_len' flag.
 	* sed/sed.c(usage): documented new -l/--line-length options.
 	* sed/execute.c(do_list): use `lcmd_out_line_len' variable
-	instead of `LCMD_OUT_LINE_LEN'.
+	  instead of `LCMD_OUT_LINE_LEN'.
 	* sed/execute.c: deleted now obsolete LCMD_OUT_LINE_LEN define.
 	* configure.in: added strtoul to the AC_CHECK_FUNCS call.
 
 Sat Oct 31 21:37:17 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c, sed/sed.h, sed/execute.c: added new `force_unbuffered'
-	flag.  (Idea suggested by Frank Strauss <strauss@escape.de>.)
+	  flag.  (Idea suggested by Frank Strauss <strauss@escape.de>.)
 	* sed/sed.c(main): added -u/--unbuffered command-line options
-	to set the new `force_unbuffered' flag.
+	  to set the new `force_unbuffered' flag.
 	* sed/sed.c(usage): documented new -u/--unbuffered options.
 	* sed/execute.c: changed the name of the `is_tty' flag in struct
-	input to a more generic `no_buffering'; also removed HAVE_ISATTY
-	conditional on this member.
+	  input to a more generic `no_buffering'; also removed HAVE_ISATTY
+	  conditional on this member.
 	* sed/execute.c(slow_getline): removed HAVE_ISATTY conditonal
-	compilation of this function.
+	  compilation of this function.
 	* sed/execute.c(output_line): if force_unbuffered is set,
-	then force a fflush() even if writing to stdout.
+	  then force a fflush() even if writing to stdout.
 	* sed/execute.c(open_next_file): added handling of the
-	new `force_unbuffered' flag so that slow_getline()
-	will always be used for input.
+	  new `force_unbuffered' flag so that slow_getline()
+	  will always be used for input.
 	* sed/execute.c(read_file_line): changed the (conditionally
-	compiled) test of `input->is_tty' to (unconditionally)
-	use the new spelling `input->no_buffering'.
+	  compiled) test of `input->is_tty' to (unconditionally)
+	  use the new spelling `input->no_buffering'.
 
 Thu Oct 15 12:08:09 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* configure.in: deleted AC_ARG_PROGRAM call; this is already
-	done for us by AM_INIT_AUTOMAKE, and we were winding up
-	with a doubled-transform.
+	  done for us by AM_INIT_AUTOMAKE, and we were winding up
+	  with a doubled-transform.
 
 Sun Sep 27 01:42:42 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* compile.c(compile_program): remove special-case code for matching
-	address range with a `0' beginning.
+	  address range with a `0' beginning.
 
 	* compile.c(compile_address): change default addr_number to
-	be a pragmatically impossible countT value, instead of zero.
+	  be a pragmatically impossible countT value, instead of zero.
 
 	* execute.c: spell macro REGNEXEC() unconditionally instead of
-	playing with conditional definition of regnexec() macro.
+	  playing with conditional definition of regnexec() macro.
 
 	* execute.c(match_an_address_p): added third argument (and changed
-	callers in match_address_p).  Added special code to ignore
-	non-numeric matches when processing "line zero".
+	  callers in match_address_p).  Added special code to ignore
+	  non-numeric matches when processing "line zero".
 
 	* execute.c(process_files): added a "line zero" pass through the
-	commands script.
+	  commands script.
 
 Sun Sep 27 00:20:53 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* compile.c(xofa,normalize_text): new functions.
 	* compile.c(compile_regex): cache last_compiled_re (with its
-	associated flags); add POSIXLY_CORRECT behavior for empty RE.
-	Make use of the new normalize_text() function.
+	  associated flags); add POSIXLY_CORRECT behavior for empty RE.
+	  Make use of the new normalize_text() function.
 	* compile.c(setup_replacement): Make use of the new normalize_text()
-	function.
+	  function.
 
 Sat Sep 26 22:59:13 PDT 1998  Ken Pizzini <ken@gnu.org>
 
@@ -963,16 +688,16 @@
 Mon Sep 14 20:47:23 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c(main): use EXIT_SUCCESS instead of 0, in case
-	we are built on a system (such as VMS) where EXIT_SUCCESS
-	is distinct from 0.
+	  we are built on a system (such as VMS) where EXIT_SUCCESS
+	  is distinct from 0.
 
 Wed Sep  9 22:17:28 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/Makefile.am: added -I../intl the INCLUDES line; if we are
-	building in a directory outside the source tree and the system
-	we are building on does not have a <libintl.h> header, then
-	the build was failing, because libintl.h is a build-time
-	constructed source file.
+	  building in a directory outside the source tree and the system
+	  we are building on does not have a <libintl.h> header, then
+	  the build was failing, because libintl.h is a build-time
+	  constructed source file.
 
 	* configure.in: tweaked version to be 3.02b.
 
@@ -981,309 +706,309 @@
 	*** Version 3.02a released
 	
 	* sed/compile.c(mark_subst_opts,read_label,compile_program):
-	wherever we accept a ; as a command terminator, also allow a } or
-	a # to appear.  (This allows for less cluttered-looking scripts,
-	such as: sed '/foo/{x;G}' (instead of: sed '/foo/{x;G;}').)
+	  wherever we accept a ; as a command terminator, also allow a } or
+	  a # to appear.  (This allows for less cluttered-looking scripts,
+	  such as: sed '/foo/{x;G}' (instead of: sed '/foo/{x;G;}').)
 
 Wed Sep  9 18:17:07 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(compile_regex): use regncomp() instead
-	of regcomp(), so that a script with NULs in its REs
-	will work in the expected manner.
+	  of regcomp(), so that a script with NULs in its REs
+	  will work in the expected manner.
 
 	* sed/compile.c(ADDNUL,REGNCOMP): added support macros
-	for above.
+	  for above.
 
 	* lib/regex.c(regncomp,regcomp): added regncomp() and
-	made regcomp() a simple wrapper function.
+	  made regcomp() a simple wrapper function.
 
 Mon Aug 31 21:48:30 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c(compile_program): if the first address of
-	a range is the number 0 (or a 0~N sequence), start
-	out in the "a1_matched" state.  This allows one
-	to match an initial chunk of a file without undue
-	convolutions for handling the case where the match
-	for the end of the sequence happens to be the first
-	line.
+	  a range is the number 0 (or a 0~N sequence), start
+	  out in the "a1_matched" state.  This allows one
+	  to match an initial chunk of a file without undue
+	  convolutions for handling the case where the match
+	  for the end of the sequence happens to be the first
+	  line.
 
 Sun Aug 16 03:34:25 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(snarf_char_class,match_slash): simplify
-	handling of "premature newline" error. Also, get the
-	line number right in the error message if we encounter
-	a "premature newline" during char-class snarfing.
+	  handling of "premature newline" error. Also, get the
+	  line number right in the error message if we encounter
+	  a "premature newline" during char-class snarfing.
 
 Sun Aug 16 02:59:20 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c: added N_() markers and corresponding gettext()
-	(er, _()) calls.
+	  (er, _()) calls.
 
 	* Merged in i18n contribution from Erick Branderhorst
-	<Erick.Branderhorst@asml.nl>.  His ChangeLog entry
-	for the changes I've incorporated so far:
+	  <Erick.Branderhorst@asml.nl>.  His ChangeLog entry
+	  for the changes I've incorporated so far:
 
 1998-07-24  Erick Branderhorst  <Erick.Branderhorst@asml.nl>
 	* configure.in (ALL_LINGUAS, AM_GNU_GETTEXT): nl
 	* sed/{sed.h,utils.c}: #include <libintl.h> #define _(String)
-	gettext (String)
+	  gettext (String)
 	* sed/sed.c: #include <locale.h>
 	* po/POTFILES.in: sed/{compile,execute,sed,utils}.c
 	* run gettextize -f
 	* acconfig.h: #undef LOCALEDIR ENABLE_NLS HAVE_CATGETS
-	HAVE_GETTEXT HAVE_LC_MESSAGES HAVE_STPCPY
+	  HAVE_GETTEXT HAVE_LC_MESSAGES HAVE_STPCPY
 
 Fri Aug 14 13:52:57 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* Merged code from 3.02 with a branched development
-	tree from late May; the following (out-of-order)
-	changelog entry is from the branched tree.
+	  tree from late May; the following (out-of-order)
+	  changelog entry is from the branched tree.
 
 Sat May 30 12:23:16 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c, sed/execute.c: added (conditional on NOLEAKS macro)
-	code to free all dynamically allocated memory.
+	  code to free all dynamically allocated memory.
 
 	* sed/sed.c, sed/compile.c, sed/execute.c: much shuffling
-	of code --- ordered functions such that no forward
-	declarations are necessary, and placed all static prototypes
-	immediately before the actual function definition.
-	This accomplished two things: first, I find the new ordering
-	a more natural way to read the code than the previous
-	ordering, and second, the new ordering give the compiler
-	a better opportunity to discover inlining possibilities.
-	(The odd "prototype declaration+old-style definition"
-	style is used because I feel it is the least ugly way
-	of supporting K&R1 C while still getting the benefit of
-	prototypes when they are available.)
+	  of code --- ordered functions such that no forward
+	  declarations are necessary, and placed all static prototypes
+	  immediately before the actual function definition.
+	  This accomplished two things: first, I find the new ordering
+	  a more natural way to read the code than the previous
+	  ordering, and second, the new ordering give the compiler
+	  a better opportunity to discover inlining possibilities.
+	  (The odd "prototype declaration+old-style definition"
+	  style is used because I feel it is the least ugly way
+	  of supporting K&R1 C while still getting the benefit of
+	  prototypes when they are available.)
 
 	* sed/basicdefs.h: added MEMCPY() macro to hide the VCAST()s
-	that ought to be used with memcpy().
+	  that ought to be used with memcpy().
 
 	* sed/execute.c: Change calls to memcpy() to go through the
-	new MEMCPY() macro.  Various prototypes: elide variable name
-	if it does not add any human-useful documentary information
-	to the bare type.
+	  new MEMCPY() macro.  Various prototypes: elide variable name
+	  if it does not add any human-useful documentary information
+	  to the bare type.
 
 	* sed/sed.c(main): Updated calls to compile_string() to add third
-	(length) argument.  Changed call to obsolete close_all_files()
-	to a call to the new finish_program().
+	  (length) argument.  Changed call to obsolete close_all_files()
+	  to a call to the new finish_program().
 
 	* sed/sed.c(map_file): Attempt to clean-up how "size" gets
-	cast and tested; remove spurious S_ISREG test (just let
-	mmap() fail if it doesn't support the underlying file type).
+	  cast and tested; remove spurious S_ISREG test (just let
+	  mmap() fail if it doesn't support the underlying file type).
 
 	* sed/sed.c: Deleted old RX library stub declarations.
 
 	* sed/sed.c(map_file,unmap_file): added VCAST()s to the
-	mmap()/munmap() calls.
+	  mmap()/munmap() calls.
 
 	* sed/utils.c(ck_fclose): added support for ANSI C
-	functionality where passing a NULL argument means
-	to fclose() _all_ open streams.  (Well, almost.
-	Only closes streams which were previously ck_fopen()ed,
-	as I don't care to figure out how to autoconf-detect
-	whether fclose(NULL) is properly supported on a given
-	platform.)
+	  functionality where passing a NULL argument means
+	  to fclose() _all_ open streams.  (Well, almost.
+	  Only closes streams which were previously ck_fopen()ed,
+	  as I don't care to figure out how to autoconf-detect
+	  whether fclose(NULL) is properly supported on a given
+	  platform.)
 
 	* sed/sed.h: Renamed `struct text_buf' member `text_len'
-	to `text_length'.  Abstracted out `enum addr_types'
-	from `struct addr'; added new enum types num2,step,step_mod;
-	renamed mod to num_mod.  De-unionized the regex,number,
-	{modulo-offset/step} components of `struct addr', in
-	anticipation of new features.  Changed type of `a2' member
-	of `struct sed_cmd': now a pointer to save space.
-	Abstracted out `struct replacement' from `struct subst'.
-	Cleaned up declaration of `x' union of `struct addr'.
-	Fixed prototype for compile_string().  Replaced prototype
-	for old close_all_files() with one for new finish_program().
+	  to `text_length'.  Abstracted out `enum addr_types'
+	  from `struct addr'; added new enum types num2,step,step_mod;
+	  renamed mod to num_mod.  De-unionized the regex,number,
+	  {modulo-offset/step} components of `struct addr', in
+	  anticipation of new features.  Changed type of `a2' member
+	  of `struct sed_cmd': now a pointer to save space.
+	  Abstracted out `struct replacement' from `struct subst'.
+	  Cleaned up declaration of `x' union of `struct addr'.
+	  Fixed prototype for compile_string().  Replaced prototype
+	  for old close_all_files() with one for new finish_program().
 
 	* sed/sed.h, sed/compile.c, sed/execute.c: changed to
-	simplify the data structures used for branches and
-	command blocks: simplified `struct vector'; made
-	`struct label' local to compile.c; `struct sed_cmd'
-	was modified to support a simpler design for branches
-	and blocks.
+	  simplify the data structures used for branches and
+	  command blocks: simplified `struct vector'; made
+	  `struct label' local to compile.c; `struct sed_cmd'
+	  was modified to support a simpler design for branches
+	  and blocks.
 
 	* sed/execute.c: Conditionally added ADDNUL() macro so that
-	the function call overhead is only incurred if nul_append()
-	_must_ be called.  Made some commentary edits, including
-	typo fixes.
+	  the function call overhead is only incurred if nul_append()
+	  _must_ be called.  Made some commentary edits, including
+	  typo fixes.
 	* sed/execute.c(resize_line): changed semantics of "len" argument
-	from "additional length" to "target length"; made
-	INITIAL_BUFFER_SIZE a minimum allocation length.
+	  from "additional length" to "target length"; made
+	  INITIAL_BUFFER_SIZE a minimum allocation length.
 	* sed/execute.c(str_append): adjusted to new resize_line()
-	semantics.
+	  semantics.
 	* sed/execute.c(line_copy): use FREE()+MALLOC() instead of
-	REALLOC() to avoid unnecessary copying of old text; add the
-	"try doubling first" allocation heuristic (just like
-	resize_line() does).
+	  REALLOC() to avoid unnecessary copying of old text; add the
+	  "try doubling first" allocation heuristic (just like
+	  resize_line() does).
 	* sed/execute.c(line_exchange): new function.
 	* sed/execute.c(nul_append): make whole function (not just its
-	body) conditional on HAVE_REGNEXEC macro; adjust to new
-	resize_line() semantics.
+	  body) conditional on HAVE_REGNEXEC macro; adjust to new
+	  resize_line() semantics.
 	* sed/execute.c(read_mem_line): use str_append() instead if
-	custom in-line code; compensate for new default of
-	"line.chomped = 0" in read_pattern_space() by setting
-	"line.chomped = 1" where appropriate.
+	  custom in-line code; compensate for new default of
+	  "line.chomped = 0" in read_pattern_space() by setting
+	  "line.chomped = 1" where appropriate.
 	* sed/execute.c(read_file_line): use different trigger to
-	determine that "buffer" is uninitialized, and do a full
-	initialization if required; use str_append() instead of custom
-	in-line code in two places; compensate for new default of
-	"line.chomped = 0" in read_pattern_space() by setting
-	"line.chomped = 1" where appropriate.
+	  determine that "buffer" is uninitialized, and do a full
+	  initialization if required; use str_append() instead of custom
+	  in-line code in two places; compensate for new default of
+	  "line.chomped = 0" in read_pattern_space() by setting
+	  "line.chomped = 1" where appropriate.
 	* sed/execute.c(output_line): don't bother calling ck_fwrite()
-	if length==0.
+	  if length==0.
 	* sed/execute.c(release_append_queue): new function.
 	* sed/execute.c(dump_append_queue): use release_append_queue()
-	instead of in-line equivalent.
+	  instead of in-line equivalent.
 	* sed/execute.c(read_pattern_space): conditionalize call to
-	dump_append_queue() for alleged performance reasons; changed
-	default "line.chomped" value to more common "1", and added an
-	assignment of "0" where this made a difference.
+	  dump_append_queue() for alleged performance reasons; changed
+	  default "line.chomped" value to more common "1", and added an
+	  assignment of "0" where this made a difference.
 	* sed/execute.c(match_an_address_p): deleted "is_addr2_p"
-	argument; reorder cases to match order in enum declaration; add
-	cases for new "addr_is_num2", "addr_is_step", and
-	"addr_is_step_mod" address types; alter nul_append() call to be
-	through ADDNUL() macro; fix to new struct member and enum
-	spellings in (formerly addr_is_mod); addr_is_num_mod case.
+	  argument; reorder cases to match order in enum declaration; add
+	  cases for new "addr_is_num2", "addr_is_step", and
+	  "addr_is_step_mod" address types; alter nul_append() call to be
+	  through ADDNUL() macro; fix to new struct member and enum
+	  spellings in (formerly addr_is_mod); addr_is_num_mod case.
 	* sed/execute.c(match_address_p): remove oblsolete third argument
-	to calls to match_address_p(); alter references to sed_cmd
-	member a2 to reflect new pointer status; add new support for
-	a2->addr_type addr_is_step and addr_is_step_mod cases.
+	  to calls to match_address_p(); alter references to sed_cmd
+	  member a2 to reflect new pointer status; add new support for
+	  a2->addr_type addr_is_step and addr_is_step_mod cases.
 	* sed/execute.c(do_subst): add NOLEAKS support logic; use
-	ADDNUL() wrapper to nul_append(); simplify replacement
-	expansion by using the new "struct replacement" data structure;
-	use line_exchange() function instead of custom in-line code.
+	  ADDNUL() wrapper to nul_append(); simplify replacement
+	  expansion by using the new "struct replacement" data structure;
+	  use line_exchange() function instead of custom in-line code.
 	* sed/execute.c(process_files): added NOLEAKS code.
 	* sed/execute.c(execute_program): updated implementations
-	of the `{', `}', `:', `b', and `t' commands; modified
-	`c' command gratuituosly; fixed potential memory
-	overrun in `D' command.  Simplified how nonstandard
-	`loop increments' work.  Use line_exchange() instead of
-	custom in-line code in 'x' case.
+	  of the `{', `}', `:', `b', and `t' commands; modified
+	  `c' command gratuituosly; fixed potential memory
+	  overrun in `D' command.  Simplified how nonstandard
+	  `loop increments' work.  Use line_exchange() instead of
+	  custom in-line code in 'x' case.
 	* sed/execute.c[EXPERIMENTAL_DASH_N_OPTIMIZATION conditional
-	code]: various modifications intended to keep this
-	code in sync with the new changes, but the code still
-	retains its previous bugs.
+	  code]: various modifications intended to keep this
+	  code in sync with the new changes, but the code still
+	  retains its previous bugs.
 
 	* sed/compile.c: use "exit(EXIT_FAILURE) instead of "exit(1)",
-	just in case we get compiled under VMS.
+	  just in case we get compiled under VMS.
 	* sed/compile.c: Change type of prog_info.base to decrease needs
-	for casting; then elimiated the casts in question ;-).
+	  for casting; then elimiated the casts in question ;-).
 	* sed/compile.c: Added struct sed_label (moved from sed.h, then
-	modified).
+	  modified).
 	* sed/compile.c: Removed "readit_p" flag from struct fp_list.
 	* sed/compile.c: Added module-global "blocks" variable.
 	* sed/compile.c: Extracted more error-message constant strings
-	to named variables.
+	  to named variables.
 	* sed/compile.c(check_final_program): updated to
-	reflect new data structures and use new fucntions.
-	Added call to compile_regex() to release unneeded
-	memory.
+	  reflect new data structures and use new fucntions.
+	  Added call to compile_regex() to release unneeded
+	  memory.
 	* sed/compile.c: deleted obsolete new_vector() function;
-	abstracted new read_label() function; abstracted new
-	release_label() function; added new `blocks' module-static
-	variable.
+	  abstracted new read_label() function; abstracted new
+	  release_label() function; added new `blocks' module-static
+	  variable.
 	* sed/compile.c(compile_program): updated implementations
-	of the `{', `}', `:', `b', and `t' commands; modified
-	initialization from NULL vector.
+	  of the `{', `}', `:', `b', and `t' commands; modified
+	  initialization from NULL vector.
 	* sed/compile.c(compile_regex): added mechanism to
-	release memory consumed by the cached `last' RE.
+	  release memory consumed by the cached `last' RE.
 	* sed/compile.c(setup_jump,setup_label): updated
-	name (from setup_jump to setup_label) and prototype;
-	changed body to reflect data structure changes.
+	  name (from setup_jump to setup_label) and prototype;
+	  changed body to reflect data structure changes.
 	* sed/compile.c: Add OPEN_BRACE and CLOSE_BRACE macros for better
-	"vi" editing behavior.
+	  "vi" editing behavior.
 	* sed/compile.c(compile_filename,read_filename,get_writefile):
-	Replaced function compile_filename() with more orthogonal functions
-	read_filename(), get_writefile().
+	  Replaced function compile_filename() with more orthogonal functions
+	  read_filename(), get_writefile().
 	* sed/compile.c(compile_regex): Added ability to free the remembered
-	"last RE" in compile_regex (for benifit of "NOLEAKS" code).
+	  "last RE" in compile_regex (for benifit of "NOLEAKS" code).
 	* Made adjustments dictated by the change to struct sed_cmd which made
-	the a2 member a pointer-to-addr instead of an addr.
+	  the a2 member a pointer-to-addr instead of an addr.
 	* sed/compile.c(setup_jump,read_label,setup_label,release_label):
-	Added functions read_label(), setup_label(), release_label(); deleted
-	function setup_jump().
+	  Added functions read_label(), setup_label(), release_label(); deleted
+	  function setup_jump().
 	* sed/compile.c(new_replacement,setup_replacement,release_replacement):
-	new functions.
+	  new functions.
 	* sed/compile.c: Adjusted to new spelling of text_buf member
-	("text_length" instead of "text_len").
+	  ("text_length" instead of "text_len").
 	* sed/compile.c(new_vector): deleted function.  (Due to new handling
-	of blocks, only one instance remained, and that one was just as
-	clear in-lined.)
+	  of blocks, only one instance remained, and that one was just as
+	  clear in-lined.)
 	* sed/compile.c(compile_string): Added third argument; it now
-	takes a counted string instead of a NUL-terminated string.
+	  takes a counted string instead of a NUL-terminated string.
 	* sed/compile.c(compile_file): added variable "map_base" to
-	compensate for new type of prog_info.base.
+	  compensate for new type of prog_info.base.
 	* sed/compile.c(check_final_program): reflect new style of
-	handling blocks and struct sed_label.
+	  handling blocks and struct sed_label.
 	* sed/compile.c(close_all_files,finish_program): replaced function
-	close_all_files() with more generic finish_program().
+	  close_all_files() with more generic finish_program().
 	* sed/compile.c(read_text): added new feature: if first non-blank
-	character after the {a,i,c} command character is not "\", then
-	use the trailing text on that line as the (first) line of text.
-	Also added code conditional on NO_INPUT_INDENT to support the
-	"feature" of stripping leading blanks from each input line; I
-	do not read POSIX as permitting this behavior, nor do I think
-	it is a good idea, so it is disabled by default, but some have
-	argued that this blank-stripping is the "correct" behavior, so
-	I offer them the option of building their sed that way.
+	  character after the {a,i,c} command character is not "\", then
+	  use the trailing text on that line as the (first) line of text.
+	  Also added code conditional on NO_INPUT_INDENT to support the
+	  "feature" of stripping leading blanks from each input line; I
+	  do not read POSIX as permitting this behavior, nor do I think
+	  it is a good idea, so it is disabled by default, but some have
+	  argued that this blank-stripping is the "correct" behavior, so
+	  I offer them the option of building their sed that way.
 	* sed/compile.c(compile_address): added xxx,+n and xxx,~n addressing;
-	simplified code.
+	  simplified code.
 	* sed/compile.c(compile_program): added BAD_PLUS error detection;
-	adjusted to new cur_cmd->a2 pointer status; added addr_is_num2
-	detection; deleted pointless "a2->addr_number < a1.addr_number"
-	check (addr_is_num2 semantics handle this just fine); updated
-	code for '{', '}', ':', 'b', and 't' to reflect new design
-	of branch handling, including making use of new functions
-	related to the new design); added support for feature already
-	mentioned in read_text() where {a,i,c} commands are able to have
-	their text start on the same line as the command; changed some
-	error messages (hopefully for the better); localized variables
-	specific to individual commands (particularly 's' and 'y');
-	made use of new setup_replacement() function in 's' command.
+	  adjusted to new cur_cmd->a2 pointer status; added addr_is_num2
+	  detection; deleted pointless "a2->addr_number < a1.addr_number"
+	  check (addr_is_num2 semantics handle this just fine); updated
+	  code for '{', '}', ':', 'b', and 't' to reflect new design
+	  of branch handling, including making use of new functions
+	  related to the new design); added support for feature already
+	  mentioned in read_text() where {a,i,c} commands are able to have
+	  their text start on the same line as the command; changed some
+	  error messages (hopefully for the better); localized variables
+	  specific to individual commands (particularly 's' and 'y');
+	  made use of new setup_replacement() function in 's' command.
 
 Mon Aug 10 19:58:49 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* doc/sed.texi, doc/sed.1: sedtut10.txt is apparently dead.
-	Deleted references to it and added a pointer to
-	http://seders.icheme.org/tutorials/.  (Pointed out by
-	Joerg Heitkoetter <joerg@de.uu.net>.)
+	  Deleted references to it and added a pointer to
+	  http://seders.icheme.org/tutorials/.  (Pointed out by
+	  Joerg Heitkoetter <joerg@de.uu.net>.)
 
 Sat Aug  8 18:11:57 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* djgpp/config.btm: per request by Michel de Ruiter
-	 <mdruiter@cs.vu.nl>, added "%1" to "%9" parameters.
+	   <mdruiter@cs.vu.nl>, added "%1" to "%9" parameters.
 
 Mon Aug  3 11:44:55 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* doc/sed.texi: fix a couple of typos.  (Submitted by
-	Alan Modra <alan@spri.levels.unisa.edu.au>.)
+	  Alan Modra <alan@spri.levels.unisa.edu.au>.)
 
 Sat Aug 01 17:49:06 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.02 released
 	
 	* configure.in: Because of code change in 3.01a, bump the
-	minor revision number for the release (now 3.02).
+	  minor revision number for the release (now 3.02).
 
 Sun Jul 26 16:07:55 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.01a released
 	
 	* sed/compile.c(snarf_char_class):  the POSIX char-class
-	recognition loop forgot to update its concept of "prev"
-	as the loop progressed.
+	  recognition loop forgot to update its concept of "prev"
+	  as the loop progressed.
 
 	* testsuite/Makefile.am: The dependency of version.good
-	on [testsuite/]Makefile introduced in the previous
-	release was botched -- it referred to "Makefile"
-	as "$(srcdir)/Makefile, which of course doesn't work
-	if you aren't building in the source tree.
+	  on [testsuite/]Makefile introduced in the previous
+	  release was botched -- it referred to "Makefile"
+	  as "$(srcdir)/Makefile, which of course doesn't work
+	  if you aren't building in the source tree.
 
 	* djgpp/Makefile.am: add forgotten "config.btm" EXTRA_DIST
-	member.
+	  member.
 
 	* configure.in: update version.
 
@@ -1296,20 +1021,20 @@
 	* Makefile.am: add BUGS and THANKS to the EXTRA_DIST target.
 
 	* testsuite/Makefile.am: add dependency of version.good
-	on [testsuite/]Makefile.
+	  on [testsuite/]Makefile.
 
 Mon Jul 20 12:38:10 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* djgpp/config.btm: New file to support the 4DOS alternative
-	to command.com.  (Sumitted by Eli Zaretskii on behalf of
-	an anonymous 4DOS user.)
+	  to command.com.  (Sumitted by Eli Zaretskii on behalf of
+	  an anonymous 4DOS user.)
 
 Fri Jul 17 00:36:34 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.01-beta18 released
 	
 	* djgpp/config.sed: my "tweak" in beta17 was too
-	hastily considered.  Back it out.
+	  hastily considered.  Back it out.
 
 	* configure.in: update to beta18.
 
@@ -1324,67 +1049,67 @@
 1998-07-14  Eli Zaretskii  <eliz@is.elta.co.il>
 
 	* djgpp/config.sed: Edit all the occurences of = in the context of
-	--option=value, including in the help messages, into
-	--option:value, but leave DOS-style d:/foo/bar file names intact.
+	  --option=value, including in the help messages, into
+	  --option:value, but leave DOS-style d:/foo/bar file names intact.
 
 	* djgpp/config.bat: Use --srcdir:foo instead of --srcdir=foo.
 
 	* testsuite/Makefile.am (help, version): Remove temporary files
-	explicitly, don't use shell wildcards, so it works under DOS 8+3
-	limits.
+	  explicitly, don't use shell wildcards, so it works under DOS 8+3
+	  limits.
 
 Thu Jul  9 13:06:00 PDT 1998 16:51:43 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.01-beta16 released
 	
 	* djgpp/config.sed: tweak the configure script to use :
-	instead of = for --with-foo=bar option parsing, to
-	work around problems with how command.com handles =s.
+	  instead of = for --with-foo=bar option parsing, to
+	  work around problems with how command.com handles =s.
 
 Wed Jul  8 16:51:43 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* djgpp/config.bat: correct inappropriate behavior that I
-	introduced in the beta13 changes (if first argument is
-	a directory, it needs to be handled as the --srcdir).
+	  introduced in the beta13 changes (if first argument is
+	  a directory, it needs to be handled as the --srcdir).
 
 	* testsuite/version.gin, testsuite/version.good, testsuite/Makefile.am:
-	Add target to automake to automatically update version.good
-	from (new file) version.gin, instead of hand-editing the version
-	number each release.
+	  Add target to automake to automatically update version.good
+	  from (new file) version.gin, instead of hand-editing the version
+	  number each release.
 
 	* testsuite/Makefile.am: miscellaneous gratuitious tweakage --
-	mainly adding $(RM) commands just because I didn't like
-	leaving the tmp* files from successful runs laying about.
-	Also some editorial comments.
+	  mainly adding $(RM) commands just because I didn't like
+	  leaving the tmp* files from successful runs laying about.
+	  Also some editorial comments.
 
 	* configure.in: update to beta16.  Added and commented out
-	experiment with AC_OUTPUT() for testsuite/version.good.
-	Added code to properly handle bare (without =xxx)
-	"--with-regex" option.
+	  experiment with AC_OUTPUT() for testsuite/version.good.
+	  Added code to properly handle bare (without =xxx)
+	  "--with-regex" option.
 
 Sun Jul  5 21:02:16 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.01-beta15 released
 	
 	* sed/utils.c(ck_fflush), sed/utils.h, sed/execute.c(output_line):
-	add and use new ck_fflush() function.
+	  add and use new ck_fflush() function.
 
 Sun Jul  5 15:23:47 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(bad_prog): add more detail to error
-	messages about -e strings.
+	  messages about -e strings.
 
 Sun Jul  5 14:29:45 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(mark_subst_opts), sed/execute.c(do_subst):
-	Define better semantics for interaction of the `g' flag
-	with a numeric flag to the s/// command.  It used to
-	be that the `g' command siezed control; now the first
-	(number-1) matches are skipped and then `g' gets control
-	after that.  (It is not clear whether this is a feature
-	sneaking in during late beta, or a bug fix; the changes
-	involved were trivial, so I decided to treat it as a bug
-	fix.)
+	  Define better semantics for interaction of the `g' flag
+	  with a numeric flag to the s/// command.  It used to
+	  be that the `g' command siezed control; now the first
+	  (number-1) matches are skipped and then `g' gets control
+	  after that.  (It is not clear whether this is a feature
+	  sneaking in during late beta, or a bug fix; the changes
+	  involved were trivial, so I decided to treat it as a bug
+	  fix.)
 
 	* configure.in, testsuite/version.good: update to beta15.
 
@@ -1393,11 +1118,11 @@
 	*** Version 3.01-beta14 released
 	
 	* sed/basicdefs.h, sed/compile.c, sed/execute.c:
-	per report by "Kaveh R. Ghazi" <ghazi@caip.rutgers.edu>,
-	copied the ISXXX macros from lib/regex.c so that
-	silly machines which require isascii() to be true
-	before the other isXXX() macros are valid will
-	still work.
+	  per report by "Kaveh R. Ghazi" <ghazi@caip.rutgers.edu>,
+	  copied the ISXXX macros from lib/regex.c so that
+	  silly machines which require isascii() to be true
+	  before the other isXXX() macros are valid will
+	  still work.
 
 	* configure.in, testsuite/version.good: update to beta14.
 
@@ -1406,47 +1131,47 @@
 	*** Version 3.01-beta13 released
 	
 	* configure.in, acconfig.h: set USE_REGEX_GNU_H symbol if we
-	are going to be using lib/regex.c.
+	  are going to be using lib/regex.c.
 
 	* lib/Makefile.am, lib/regex.h, lib/regex-gnu.h, lib/regex.c:
-	rename lib/regex.h to lib/regex-gnu.h, so that those who
-	choose to use a different regex implementation will not
-	pick-up lib/regex.h when doing "#include <regex.h>".
+	  rename lib/regex.h to lib/regex-gnu.h, so that those who
+	  choose to use a different regex implementation will not
+	  pick-up lib/regex.h when doing "#include <regex.h>".
 
 	* sed/regex-sed.h, sed/Makefile.am, sed/compile.c, sed/execute.c,
-	sed/sed.c: create sed/regex-sed.h which acts as a switch
-	to choose either lib/regex.h or the user-supplied <regex.h>,
-	depending on the value passed to configure's --with-regex=
-	option.
+	  sed/sed.c: create sed/regex-sed.h which acts as a switch
+	  to choose either lib/regex.h or the user-supplied <regex.h>,
+	  depending on the value passed to configure's --with-regex=
+	  option.
 
 Thu Jul  2 17:22:31 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* configure.in: if an alternative --with-regex= is given,
-	do an AC_CHECK_FUNCS(regnexec regexec) to ensure that
-	at least one of these functions is available.  Also,
-	parallel changes for the default case.
+	  do an AC_CHECK_FUNCS(regnexec regexec) to ensure that
+	  at least one of these functions is available.  Also,
+	  parallel changes for the default case.
 
 	* sed/execute.c, acconfig.h: retire use of the WITH_REGNEXEC
-	test macro in favor of HAVE_REGNEXEC test macro created
-	by above change.
+	  test macro in favor of HAVE_REGNEXEC test macro created
+	  by above change.
 
 	* djgpp/config.bat: Play games to handle "install-sh",
-	DOS filename restrictions, GNU makefile default rules,
-	and getting a correct run of "configure" (contributed
-	by Eli Zaretskii <eliz@is.elta.co.il>).
+	  DOS filename restrictions, GNU makefile default rules,
+	  and getting a correct run of "configure" (contributed
+	  by Eli Zaretskii <eliz@is.elta.co.il>).
 
 	* djgpp/Makefile.am, testsuite/Makefile.am, testsuite/Makefile.in,
-	Makefile.am, configure.in: Various automake targets
-	(such as distcheck) failed with old configuration.
-	The simplest solution was to just add these .am
-	files.  (The testsuite/Makefile.in was just renamed to
-	testsuite/Makefile.am, then various redundant defines and
-	targets were deleted.)  (Reported by Erick Branderhorst
-	<Erick.Branderhorst@asml.nl>.)
+	  Makefile.am, configure.in: Various automake targets
+	  (such as distcheck) failed with old configuration.
+	  The simplest solution was to just add these .am
+	  files.  (The testsuite/Makefile.in was just renamed to
+	  testsuite/Makefile.am, then various redundant defines and
+	  targets were deleted.)  (Reported by Erick Branderhorst
+	  <Erick.Branderhorst@asml.nl>.)
 
 	* testsuite/dc.good, testsuite/dc.inp: per suggestion from
-	Greg Ubben <gsu@romulus.ncsc.mil>, use base 16 output to
-	exercise even more of the dc.sed script.
+	  Greg Ubben <gsu@romulus.ncsc.mil>, use base 16 output to
+	  exercise even more of the dc.sed script.
 
 	* configure.in, testsuite/version.good: update to beta13.
 
@@ -1455,20 +1180,20 @@
 	*** Version 3.01-beta12 released
 	
 	* doc/sed.texi: Avoid mixing @code and @samp markups together:
-	they look ugly in Info.  Use @url and @email instead of @example.
-	Add indexes.  (Basis of changes contributed by Eli Zaretskii.)
+	  they look ugly in Info.  Use @url and @email instead of @example.
+	  Add indexes.  (Basis of changes contributed by Eli Zaretskii.)
 
 	* djgpp/*, Makefile.am: add support for the DJGPP compiler,
-	contributed by Eli Zaretskii <eliz@is.elta.co.il>.
+	  contributed by Eli Zaretskii <eliz@is.elta.co.il>.
 
 	* dc.sed, testsuite/Makefile.in, testsuite/dc.inp, testsuite/dc.good:
-	added this remarkable script, written and contributed
-	by Greg Ubben <gsu@romulus.ncsc.mil>, both as a work of
-	art for general admiration, and also for use in regression
-	testing.
+	  added this remarkable script, written and contributed
+	  by Greg Ubben <gsu@romulus.ncsc.mil>, both as a work of
+	  art for general admiration, and also for use in regression
+	  testing.
 
 	* configure.in, lib/Makefile.am: add --with-regex=regexlib
-	option, which overrides the use of lib/regex.c.
+	  option, which overrides the use of lib/regex.c.
 
 	* configure.in, testsuite/version.good: update to beta12.
 
@@ -1477,42 +1202,42 @@
 	*** Version 3.01-beta11 released
 	
 	* sed/compile.c: add module-static variables first_script
-	(for #n change below) and pending_text (for a/c/i change
-	below).
+	  (for #n change below) and pending_text (for a/c/i change
+	  below).
 
 	* sed/compile.c(compile_file), sed/compile.c(compile_program):
-	Instead of having #n trigger the -n option in *any file*,
-	have #n trigger the -n option only if they are the first
-	two bytes of the first script or script-file.
+	  Instead of having #n trigger the -n option in *any file*,
+	  have #n trigger the -n option only if they are the first
+	  two bytes of the first script or script-file.
 
 	* sed/compile.c(compile_string), sed/compile.c(compile_file):
-	clear the first_script variable at end of these functions.
+	  clear the first_script variable at end of these functions.
 
 	* sed/sed.h: tease out the struct text_buf declaration from
-	struct sed_cmd, so that a pointer to such can be passed
-	to new sed/compile.c(read_text) function.
+	  struct sed_cmd, so that a pointer to such can be passed
+	  to new sed/compile.c(read_text) function.
 
 	* sed/compile.c(compile_program), sed/compile.c(read_text):
-	Tease out handling of text to a/c/i commands to new
-	read_text() function.  Handle (via aid of pending_text
-	variable) texts which span more than one script/script-file
-	option.  In particular, restore the ability to have this
-	work:  sed -e '1i\' -e 'foo'
+	  Tease out handling of text to a/c/i commands to new
+	  read_text() function.  Handle (via aid of pending_text
+	  variable) texts which span more than one script/script-file
+	  option.  In particular, restore the ability to have this
+	  work:  sed -e '1i\' -e 'foo'
 
 	* sed/compile.c(check_final_program): close off any dangling
-	pending_text allocation.
+	  pending_text allocation.
 
 Thu Jun 11 11:17:46 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/execute.c(do_subst): fixed two bugs: s/ */X/g was failing
-	to match the final empty string after the end of the pattern
-	space; and /^foo$/s/o/x/3p was printing, despite the failure
-	to do a substition.
+	  to match the final empty string after the end of the pattern
+	  space; and /^foo$/s/o/x/3p was printing, despite the failure
+	  to do a substition.
 
 Fri Jun  5 04:40:24 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* configure.in: change the AC_ARG_WITH(regnexec, ...)
-	to be the more appropriate AC_ARG_ENABLE(regnexec, ...).
+	  to be the more appropriate AC_ARG_ENABLE(regnexec, ...).
 
 	* configure.in, testsuite/version.good: update to beta11.
 
@@ -1521,65 +1246,65 @@
 	*** Version 3.01-beta10 released
 	
 	* sed/execute.c: forgot to P_() the prototype and
-	old-style the declaration for bootstrap_memchr()!
+	  old-style the declaration for bootstrap_memchr()!
 
 Thu Jun  4 18:42:30 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(snarf_char_class): added code to
-	recognize \n or \<newline> sequence within a
-	char-class as the newline character.
+	  recognize \n or \<newline> sequence within a
+	  char-class as the newline character.
 
 Tue Jun  2 11:56:02 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* configure.in: added check for <sys/types.h> and
-	a AC_ARG_WITH(regnexec,...) check, to simplify use
-	of other regex libraries which have regexec() but
-	not regnexec(), with the corresponding loss of
-	functionality (regexps will not work right against
-	input lines which contain NULs).
+	  a AC_ARG_WITH(regnexec,...) check, to simplify use
+	  of other regex libraries which have regexec() but
+	  not regnexec(), with the corresponding loss of
+	  functionality (regexps will not work right against
+	  input lines which contain NULs).
 
 	* sed/execute.c: add nul_append() function, a #define
-	for a regnexec() -> regexec() macro (conditional on
-	the lack of the WITH_REGNEXEC symbol), and a couple
-	of calls to nul_append() (in match_an_address_p()
-	and do_subst()) to permit the use of the POSIX standard
-	regexec() function call instead of the suggested
-	regnexec() call.
+	  for a regnexec() -> regexec() macro (conditional on
+	  the lack of the WITH_REGNEXEC symbol), and a couple
+	  of calls to nul_append() (in match_an_address_p()
+	  and do_subst()) to permit the use of the POSIX standard
+	  regexec() function call instead of the suggested
+	  regnexec() call.
 
 	* sed/compile.c, sed/execute.c, sed/sed.c: check for
-	<sys/types.h> and include it (before "regex.h") if
-	available.  This makes it simpler to use the system's
-	regex library instead of the one in lib/regex.c, should
-	that be desired.
+	  <sys/types.h> and include it (before "regex.h") if
+	  available.  This makes it simpler to use the system's
+	  regex library instead of the one in lib/regex.c, should
+	  that be desired.
 
 Tue Jun  2 08:41:05 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/basicdefs.h: define VCAST macros to allow sed to
-	compile on systems which predate the definition
-	of "void *", and yet still get feedback about
-	stupid programming errors from systems which *do*
-	know about "void *"s.  Also define MALLOC, REALLOC,
-	MEMDUP, and FREE macros to keep under control the
-	degree of code ugliness which would otherwise be
-	introduced in making use of the VCAST macro.
+	  compile on systems which predate the definition
+	  of "void *", and yet still get feedback about
+	  stupid programming errors from systems which *do*
+	  know about "void *"s.  Also define MALLOC, REALLOC,
+	  MEMDUP, and FREE macros to keep under control the
+	  degree of code ugliness which would otherwise be
+	  introduced in making use of the VCAST macro.
 
 	* sed/compile.c, sed/execute.c, sed/sed.c, sed/utils.c:
-	pervasively use the new VCAST, MALLOC, REALLOC, MEMDUP,
-	and FREE macros wherever appropriate.
+	  pervasively use the new VCAST, MALLOC, REALLOC, MEMDUP,
+	  and FREE macros wherever appropriate.
 
 	* sed/utils.c, sed/utils.h: correct type of first arguments
-	to ck_fread() and ck_fwrite() to be [const] VOID *.
+	  to ck_fread() and ck_fwrite() to be [const] VOID *.
 
 	* sed/basicdefs.h, sed/execute.c: protect against
-	the rumored systems which stupidly #define __STDC__ 0.
+	  the rumored systems which stupidly #define __STDC__ 0.
 
 	* testsuite/help.good, testsuite/Makefile.in: make
-	the ``help'' test insensitive to the spelling of
-	the executable's name.  Also, enhanced `make clean'
-	target.
+	  the ``help'' test insensitive to the spelling of
+	  the executable's name.  Also, enhanced `make clean'
+	  target.
 
 	* doc/sed.texi, doc/sed.1: correct documentation of `q'
-	command; fix typos.
+	  command; fix typos.
 
 	* configure, testsuite/version.good: update to beta10.
 
@@ -1590,55 +1315,55 @@
 	* Makefile.am: make testsuite a normal SUBDIR.
 
 	* configure.in: discontinue using AC_ISC_POSIX --
-	check for -lcposix library instead; added
-	testsuite/Makefile to AC_OUTPUT list.
+	  check for -lcposix library instead; added
+	  testsuite/Makefile to AC_OUTPUT list.
 
 	* lib/memmove.c(memmove): fixed wrong sense used
-	for HAVE_BCOPY test.
+	  for HAVE_BCOPY test.
 
 	* sed/execute.c: checked more specifically for a version
-	of gcc which supports __attribute__ (i.e., >= 2.7).
+	  of gcc which supports __attribute__ (i.e., >= 2.7).
 
 	* testsuite/*: renamed files to fit 14 char limit.
 
 	* testsuite/Makefile, testsuite/Makefile.in: Makefile
-	renamed to Makefile.in and then modified so that
-	"make -j check" from top directory will work.
+	  renamed to Makefile.in and then modified so that
+	  "make -j check" from top directory will work.
 
 	* testsuite/subwrite.sed, testsuite/writeout.sed: changed
-	file name of the "w" command to be consistent with the
-	new naming used in testsuite/Makefile.in.
+	  file name of the "w" command to be consistent with the
+	  new naming used in testsuite/Makefile.in.
 
 	* doc/sed.1, doc/sed.texi: fixed some typos, formatting
-	glitches, and poor wordings.
+	  glitches, and poor wordings.
 
 Sat May 30 04:02:29 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* configure.in: specify that config.h is to be derived
-	from config_h.in in order to avoid the braindead
-	DOS filesystem limitations.
+	  from config_h.in in order to avoid the braindead
+	  DOS filesystem limitations.
 
 Fri May 29 21:56:30 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(compile_address), doc/sed.texi: gave
-	a better definition to the meaning of N~0 address
-	forms -- N~M addresses now mean that lines match
-	when there exists a non-negative x such that
-	lineno == N+x*M.
+	  a better definition to the meaning of N~0 address
+	  forms -- N~M addresses now mean that lines match
+	  when there exists a non-negative x such that
+	  lineno == N+x*M.
 
 Fri May 29 12:07:38 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(compile_address),
-	sed/execute.c(match_an_address_p): update semantics of
-	N~M address form: now N is the first line which will
-	match and M is the step between succeeding matches.
-	If N<M this works out to the same as before, but the
-	new behavior for N>=M seems more useful.
+	  sed/execute.c(match_an_address_p): update semantics of
+	  N~M address form: now N is the first line which will
+	  match and M is the step between succeeding matches.
+	  If N<M this works out to the same as before, but the
+	  new behavior for N>=M seems more useful.
 
 	* doc/sed.1, doc/sed.texi: update documentation of N~M
-	address form; added "Other Resources" node to sed.texi;
-	minor formatting changes to some items in sed.1 with
-	an eye to improving clarity.
+	  address form; added "Other Resources" node to sed.texi;
+	  minor formatting changes to some items in sed.1 with
+	  an eye to improving clarity.
 
 	* configure.in, testsuite/version.good: update to beta9.
 
@@ -1647,18 +1372,18 @@
 	*** Version 3.01-beta8 released
 	
 	* sed/compile.c(compile_regex): forgot to make last_re be
-	a *copy* of the buffered text in today's earlier fix.
+	  a *copy* of the buffered text in today's earlier fix.
 
 	* sed/execute.c(read_file_line): EOF check was wrong --
-	it forgot to allow for the possibility that we were
-	appending to the end of the ``line'' (instead of merely
-	reading a fresh line).
+	  it forgot to allow for the possibility that we were
+	  appending to the end of the ``line'' (instead of merely
+	  reading a fresh line).
 
 Sat May 23 18:07:18 HST 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/compile.c(compile_regex): don't track compiled version
-	of regex -- the modifiers may change.  Track the regex
-	source instead.  (For "last regex" (aka //) notation.)
+	  of regex -- the modifiers may change.  Track the regex
+	  source instead.  (For "last regex" (aka //) notation.)
 
 	* configure.in, testsuite/version.good: update to beta8.
 
@@ -1667,21 +1392,21 @@
 	*** Version 3.01-beta7 released
 	
 	* sed/execute.c: #undef'd EXPERIMENTAL_DASH_N_OPTIMIZATION
-	because its code is buggy.
+	  because its code is buggy.
 
 Tue May 19 17:03:52 HST 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c: label rx library code as such with #ifdefs
-	(instead of just #if 0).
+	  (instead of just #if 0).
 
 	* sed/compile.c(compile_program): make incremental
-	improvement to the "Unknown command" error message.
+	  improvement to the "Unknown command" error message.
 
 Sat May 16 23:16:26 HST 1998  Ken Pizzini <ken@gnu.org>
 
 	* testsuite/Makefile: simplify: get rid of automatic run
-	against system's sed; don't time by default; allow for
-	alternative comparison command.
+	  against system's sed; don't time by default; allow for
+	  alternative comparison command.
 
 	* configure.in, testsuite/version.good: update to beta7.
 
@@ -1690,7 +1415,7 @@
 	*** Version 3.01-beta6 released
 	
 	* lib/Makefile.am: fix spelling of libsed_a_LIBADD in
-	libsed_a_DEPENDENCIES.
+	  libsed_a_DEPENDENCIES.
 
 	* configure.in, testsuite/version.good: update to beta6.
 
@@ -1699,47 +1424,47 @@
 	*** Version 3.01-beta5 released
 	
 	* sed/execute.c(do_subst): added not_bol_p variable to track when
-	we have iterated past the beginning of the pattern.
-	[Thanks to Jim Meyering <meyering@ascend.com> for the bug report.]
+	  we have iterated past the beginning of the pattern.
+	  [Thanks to Jim Meyering <meyering@ascend.com> for the bug report.]
 
 Wed May 13 13:54:04 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/execute.c(bootstrap_memchr): new function.  When
-	bootstrapping we don't know if we are on a 64-bit machine,
-	so lib/memchr.c breaks.  Supply this (slow) implementation
-	just to get us bootstrapped.
+	  bootstrapping we don't know if we are on a 64-bit machine,
+	  so lib/memchr.c breaks.  Supply this (slow) implementation
+	  just to get us bootstrapped.
 
 	* bootstrap.sh: add a #define BOOTSTRAP symbol; add -I.
-	for emphasis for the compiles in sed/; be explicit
-	about what files we're bothering to compile.
+	  for emphasis for the compiles in sed/; be explicit
+	  about what files we're bothering to compile.
 
 	* configure.in, testsuite/version.good: update version
-	to beta5.
+	  to beta5.
 
 Wed May 13 06:39:06 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.01-beta4 released
 	
 	* rename writeout.good? to wrtout?.good and subwrite.good? to
-	subwrt?.good to comply with DOS 8+3 file name restrictions.
-	[Eli Zaretskii <eliz@is.elta.co.il> suggested this to
-	simplify DJGPP ports, and it was easy.]
+	  subwrt?.good to comply with DOS 8+3 file name restrictions.
+	  [Eli Zaretskii <eliz@is.elta.co.il> suggested this to
+	  simplify DJGPP ports, and it was easy.]
 
 	* testsuite/Makefile: reflect above name changes.
 
 Wed May 12 21:09:32 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/sed.c(usage): fix non-portable omission of \n\ at end of
-	lines within long string.
+	  lines within long string.
 
 	* sed/sed.c(main): remove spurious argument to fprintf() in the
-	'V'ersion output.
+	  'V'ersion output.
 
 	* sed/execute.c(line_append): embed newline between the two
-	text fragments unconditionally.
+	  text fragments unconditionally.
 
 	* sed/execute.c(do_subst): change structure assignment to memcpy()
-	(for portability reasons).
+	  (for portability reasons).
 
 	* README.bootstrap: suggest using -w option.
 
@@ -1748,7 +1473,7 @@
 	* configure.in: use AC_REPLACE_FUNCS where appropriate.
 
 	* lib/Makefile.am: updated to reflect AC_REPLACE_FUNCS change in
-	configure.in.
+	  configure.in.
 
 	* lib/memchr.c lib/memcmp.c: revert to standard GNU versions.
 
@@ -1761,93 +1486,93 @@
 	*** Version 3.01-beta3 released
 	
 	* sed/Makefile.am: fix INCLUDES to work right with VPATH.
-	[Thanks to Jim Meyering <meyering@ascend.com> for the bug report.]
+	  [Thanks to Jim Meyering <meyering@ascend.com> for the bug report.]
 
 	* sed/sed.c(usage): make --help output more user-friendly?
 
 	* sed/execute.c(execute_program): fix bug in 'x' command introduced
-	in the alleged portability fix of May 9.
+	  in the alleged portability fix of May 9.
 
 	* configure.in: update version to 3.01-beta3.
 
 	* testsuite/version.good, testsuite/help.good: freshen with
-	latest output.
+	  latest output.
 
 Sat May  9 22:35:45 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.01-beta2 released
 	
 	* sed/sed.c: add #include <sys/types.h> in HAVE_MMAP
-	block (needed on some machines).
+	  block (needed on some machines).
 
 	* lib/memmove.c: #include <memory.h>, if HAVE_MEMORY_H.
 
 Sat May  9 21:29:00 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* configure.in: remove dangling references to rx library;
-	added HEADER and FUNC checks for items used by source in
-	lib/.
+	  added HEADER and FUNC checks for items used by source in
+	  lib/.
 
 	* lib/ansidecl.h, lib/memcopy.h, lib/pagecopy.h, lib/string.h
-	lib/memcpy.c, lib/memmove.c: deletes these files.  There
-	are still pieces of glibc missing to support these, and
-	it isn't worth the headache right now.
+	  lib/memcpy.c, lib/memmove.c: deletes these files.  There
+	  are still pieces of glibc missing to support these, and
+	  it isn't worth the headache right now.
 
 	* lib/memmove.c: de novo, simpler version.  Uses bcopy()
-	if available, and slow-but-simple code if not.
+	  if available, and slow-but-simple code if not.
 
 	* lib/Makefile.am: remove references to deleted files.
-	Added forgotten reference to memcpy.c.  Re-ordered
-	SOURCE entries to reflect dependencies for systems
-	which lack ranlib.
+	  Added forgotten reference to memcpy.c.  Re-ordered
+	  SOURCE entries to reflect dependencies for systems
+	  which lack ranlib.
 
 	* sed/basicdefs.h: updated to reflect above changes to lib/,
-	and experience with non-STDC compilers.
+	  and experience with non-STDC compilers.
 
 	* lib/regex.c: made regerror() function publicly visible.
 
 	* lib/strerror.c: use old-style function declaration.
 
 	* sed/compile.c, sed/execute.c, sed/sed.c, sed/utils.c,
-	sed/sed.h, sed/utils.h: ensure that private definitions of
-	some symbols do not cause problems when #include'ing system
-	headers (mainly by re-ordering the #include directives).
-	(This is particularly an issue for bootstrap.sh runs.)
+	  sed/sed.h, sed/utils.h: ensure that private definitions of
+	  some symbols do not cause problems when #include'ing system
+	  headers (mainly by re-ordering the #include directives).
+	  (This is particularly an issue for bootstrap.sh runs.)
 
 	* sed/execute.c (execute_program): use memcpy() instead of
-	structure assingment ('x' command), for portablility to
-	old compilers.
+	  structure assingment ('x' command), for portablility to
+	  old compilers.
 
 	* sed/execute.c (slow_getline): use old-style function
-	declaration, with a P_ prototype.
+	  declaration, with a P_ prototype.
 
 	* sed/sed.c: change the type of the fallback MAP_FAILED
-	definition to work on archaic systems.  (Modern systems
-	should be defining it themselves, so the change from
-	void * shouldn't be a problem.)
+	  definition to work on archaic systems.  (Modern systems
+	  should be defining it themselves, so the change from
+	  void * shouldn't be a problem.)
 
 	* bootstrap.sh, README.bootstrap: actual testing of bootstrap
-	code revealed that I was too optimistic.  Redesigned and
-	replaced implementation.
+	  code revealed that I was too optimistic.  Redesigned and
+	  replaced implementation.
 
 	* testsuite/Makefile: ignore errors from reference-implementation
-	seds that aren't up to snuff.
+	  seds that aren't up to snuff.
 
 	* testsuite/help.good, testsuite/version.good: update to
-	current version's output.
+	  current version's output.
 
 Fri May  8 15:08:28 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	*** Version 3.01-beta1 released
 	
 	* sed/sed.c (main, usage): once again tweak the --help and
-	--version output to bettery comply with GNU coding standards.
+	  --version output to bettery comply with GNU coding standards.
 
 	* testsuite/help.good, testsuite/version.good: update to
-	reflect above change.
+	  reflect above change.
 
 	* doc/sed.texi: fix "Invoking" node's spelling to comply
-	with GNU standards.
+	  with GNU standards.
 
 Fri May  8 11:43:10 PDT 1998  Ken Pizzini <ken@gnu.org>
 
@@ -1856,207 +1581,207 @@
 Thu May  7 20:40:21 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* lib/Makefile.am, lib/memmove.c, lib/memchr.c, lib/regex.c,
-	lib/memcpy.c, lib/regex.h, lib/memcopy.h, lib/string.h,
-	lib/pagecopy.h, lib/ansidecl.h: grab yet-another-version
-	from gnu.org for baseline and/or edit copyright boilerplate
-	using official lgpl2gpl.sed script.  Take care not to
-	loose regnexec() interface or special conditional-compilation
-	code.
+	  lib/memcpy.c, lib/regex.h, lib/memcopy.h, lib/string.h,
+	  lib/pagecopy.h, lib/ansidecl.h: grab yet-another-version
+	  from gnu.org for baseline and/or edit copyright boilerplate
+	  using official lgpl2gpl.sed script.  Take care not to
+	  loose regnexec() interface or special conditional-compilation
+	  code.
 
 Wed May  6 23:35:12 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* lib/regex.c, lib/regex.h: take from grep-2.1 distribution,
-	then trivially added the regnexec() interface.
+	  then trivially added the regnexec() interface.
 
 	* sed/sed.c, sed/compile.c, sed/execute.c: made modifications
-	to work with regex instead of rx.
+	  to work with regex instead of rx.
 
 	* rx/*: deleted directory; the code is just too slow.
-	I think it will be easier to extend regex to fully
-	support POSIX.2 than to tune rx to be reasonable.
-	Even if this supposition is wrong, I'd rather make
-	the 3.01 release with the slightly deficient regex.
+	  I think it will be easier to extend regex to fully
+	  support POSIX.2 than to tune rx to be reasonable.
+	  Even if this supposition is wrong, I'd rather make
+	  the 3.01 release with the slightly deficient regex.
 
 	* Makefile.am lib/Makefile.am, sed/Makefile.am: made changes
-	related to the substitution of regex for rx.
+	  related to the substitution of regex for rx.
 
 	* lib/Makefile.am, sed/Makefile.am: since regex is not a
-	``compatability'' module, changed name of library to
-	``libsed.a''.
+	  ``compatability'' module, changed name of library to
+	  ``libsed.a''.
 
 	* lib/memchr.c, lib/memcpy.c, lib/memmove.c: add conditional
-	compilation code to leave zero-sized .o file if system
-	already supports the implemented function.
+	  compilation code to leave zero-sized .o file if system
+	  already supports the implemented function.
 
 	* testsuite/help.good, testsuite/version.good: brought
-	up-to-date (once again).
+	  up-to-date (once again).
 
 	* NEWS, ANNOUNCE: changes to reflect this batch of changes.
 
 Wed May  6 18:40:47 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/execute.c: discovered awful bug in '}' handling:
-	it could read past the end of vec (because `n' was
-	being decremented below zero)!  Needed to "continue"
-	instead of "break".
+	  it could read past the end of vec (because `n' was
+	  being decremented below zero)!  Needed to "continue"
+	  instead of "break".
 
 Tue May  5 14:34:38 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* doc/sed.texi, doc/version.texi: wrote some rudimentary
-	texinfo documentation.
+	  texinfo documentation.
 
 	* ANNOUNCE, NEWS, README, README.rx, Makefile.am:
-	more updates for the upcoming beta-release.
+	  more updates for the upcoming beta-release.
 
 	* sed/compile.c, sed/execute.c, sed/sed.c, sed/utils.c,
-	sed/sed.h, lib/strerror.c: update copyright notice text.
+	  sed/sed.h, lib/strerror.c: update copyright notice text.
 
 Fri May  1 15:41:37 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed/execute.c (match_an_address_p, match_address_p): if
-	the second element of an address range is a line number,
-	and that line number is *less than* (or equal to) the
-	current line number, we only match the one line (per
-	POSIX.2, section 4.55.7.1).  [Bug discovered as reported
-	in the seders mailing list FAQ.]
+	  the second element of an address range is a line number,
+	  and that line number is *less than* (or equal to) the
+	  current line number, we only match the one line (per
+	  POSIX.2, section 4.55.7.1).  [Bug discovered as reported
+	  in the seders mailing list FAQ.]
 
 	* AUTHORS, NEWS, acconfig.h, configure.in, doc/Makefile.am,
-	lib/Makefile.am, sed/Makefile.am, lib/README,
-	testsuite/help.good, testsuite/version.good:
-	Updated in anticipation of the 3.01-beta1 release.
-	Reorganized development source tree to make creation
-	of a distribution simpler.  Most notable changes were
-	to the various Makefile.am files and configure.in, but
-	some minor edits (such as deleting or changing #include
-	directives) have been made in many other source files.
+	  lib/Makefile.am, sed/Makefile.am, lib/README,
+	  testsuite/help.good, testsuite/version.good:
+	  Updated in anticipation of the 3.01-beta1 release.
+	  Reorganized development source tree to make creation
+	  of a distribution simpler.  Most notable changes were
+	  to the various Makefile.am files and configure.in, but
+	  some minor edits (such as deleting or changing #include
+	  directives) have been made in many other source files.
 
 	* bootstrap.sh, README.bootstrap: created a mechanism for
-	creating sed on a system which lacks a working sed.
+	  creating sed on a system which lacks a working sed.
 
 Thu Apr 16 23:52:11 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed.h, sed.c, execute.c, compile.c: did a spell-check on
-	the comments; fixed several typos.
+	  the comments; fixed several typos.
 
 Thu Apr 16 13:43:01 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* execute.c (do_subst): fixed bug where the "replaced" flag
-	was being set to one inappropriately when at least one
-	but fewer than sub->numb matches of the regexp were found.
-	(Thanks to Simon Taylor <staylor@hermes.iaccess.com.au>
-	for the bug report.)
+	  was being set to one inappropriately when at least one
+	  but fewer than sub->numb matches of the regexp were found.
+	  (Thanks to Simon Taylor <staylor@hermes.iaccess.com.au>
+	  for the bug report.)
 
 Wed Apr 15 11:35:31 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed.h, sed.c, compile.c, execute.c: having a concern that
-	a cast was being done inappropriately, and realizing that
-	there is no quick way to locate all casts in a program, I
-	went through and marked all casts with a simple macro.
-	Now it is a simple matter to locate the casts, and it is
-	also a simple matter to turn of casts for a lint session
-	(if it should be desired).
+	  a cast was being done inappropriately, and realizing that
+	  there is no quick way to locate all casts in a program, I
+	  went through and marked all casts with a simple macro.
+	  Now it is a simple matter to locate the casts, and it is
+	  also a simple matter to turn of casts for a lint session
+	  (if it should be desired).
 
 Wed Apr 15 10:29:21 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* compile.c, sed.c: redo compile phase so that brace
-	expressions can be spread across multiple files.
-	For example:
-	  printf '{' >a; printf 'l;d' >b; printf '}' >c
-	  sed -f a -f b -f c foo
-	will now compile (and work), instead of complaining
-	about an unmatched '{'.  The mess created in compile.c
-	allowed a little simplification to the command-line
-	processing of "-e" options in sed.c.
+	  expressions can be spread across multiple files.
+	  For example:
+	    printf '{' >a; printf 'l;d' >b; printf '}' >c
+	    sed -f a -f b -f c foo
+	  will now compile (and work), instead of complaining
+	  about an unmatched '{'.  The mess created in compile.c
+	  allowed a little simplification to the command-line
+	  processing of "-e" options in sed.c.
 
-	sed.h: added (opaque) err_info member to struct vector;
-	added comments to the members of struct vector.
+	  sed.h: added (opaque) err_info member to struct vector;
+	  added comments to the members of struct vector.
 
 Wed Apr 14 23:50:50 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* sed.h, sed.c, compile.c, execute.c: added types countT and
-	flagT in order to clarify what various "int"s were doing.
-	Also makes it easy to change the type used for counts
-	(for example, to "unsigned long long") if desired, although
-	there are still some gotchas (such as the printf() format
-	for the '=' command).
+	  flagT in order to clarify what various "int"s were doing.
+	  Also makes it easy to change the type used for counts
+	  (for example, to "unsigned long long") if desired, although
+	  there are still some gotchas (such as the printf() format
+	  for the '=' command).
 
 Tue Apr 14 17:34:54 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* execute.c (execute_program, process_files, count_branches,
-	shrink_program): Added a first attempt at program optimization.
-	We now can quit early if we are running with the "-n"
-	and all of the commands are known to be valid only for
-	lines less than the current line.  Thus the "sed" in
-	"foo | sed -n 1,2p" will print read three lines, printint
-	the first two, and then quit, regardless of how much longer
-	"foo" might run or output.  This optimization does not buy
-	much in most cases (it sometimes even costs a little),
-	but when it does help it can help big.  The code is
-	all conditionally compiled based on the
-	EXPERIMENTAL_DASH_N_OPTIMIZATION symbol being #defined,
-	so it can be easily omitted if it causes problems.
+	  shrink_program): Added a first attempt at program optimization.
+	  We now can quit early if we are running with the "-n"
+	  and all of the commands are known to be valid only for
+	  lines less than the current line.  Thus the "sed" in
+	  "foo | sed -n 1,2p" will print read three lines, printint
+	  the first two, and then quit, regardless of how much longer
+	  "foo" might run or output.  This optimization does not buy
+	  much in most cases (it sometimes even costs a little),
+	  but when it does help it can help big.  The code is
+	  all conditionally compiled based on the
+	  EXPERIMENTAL_DASH_N_OPTIMIZATION symbol being #defined,
+	  so it can be easily omitted if it causes problems.
 
 Tue Apr 14 12:25:06 PDT 1998  Ken Pizzini <ken@gnu.org>
 
 	* execute.c (test_dollar_EOF, last_file_with_data_p):
-	test_dollar_EOF() was incorrectly returning a false (0)
-	when there were unprocessed files, none of which had any
-	data (either unopenable or zero-length).  Created
-	last_file_with_data_p() to detect this situation, and
-	modified test_dollar_EOF() to make use of it.
+	  test_dollar_EOF() was incorrectly returning a false (0)
+	  when there were unprocessed files, none of which had any
+	  data (either unopenable or zero-length).  Created
+	  last_file_with_data_p() to detect this situation, and
+	  modified test_dollar_EOF() to make use of it.
 
 Thu Apr  2 23:02:18 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* compile.c (match_slash): match_slash() did not handle
-	[.coll.], [=equiv=], and [:class:] sequences within a
-	character class.  Added snarf_char_class() [which is a
-	remote derivative of parse_char_class() from GNU ed-0.2]
-	to deal with the details, and altered match_slash()
-	to make use of it.  Also created the trivial
-	add_then_next() to avoid clutter in snarf_char_class().
+	  [.coll.], [=equiv=], and [:class:] sequences within a
+	  character class.  Added snarf_char_class() [which is a
+	  remote derivative of parse_char_class() from GNU ed-0.2]
+	  to deal with the details, and altered match_slash()
+	  to make use of it.  Also created the trivial
+	  add_then_next() to avoid clutter in snarf_char_class().
 
 Thu Apr  2 20:34:42 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* execute.c, sed.c, sed.h: There was a severe bug in
-	how the code handled "sed 5n a b" when "a" consists
-	of exactly five lines -- it behaved like "sed 5q a b"!
+	  how the code handled "sed 5n a b" when "a" consists
+	  of exactly five lines -- it behaved like "sed 5q a b"!
 
-	Rearranged where files get opened -- large scale
-	changes primarily involving main(), process_files(),
-	and read_pattern_space(), but also touching on several
-	other parts of execute.c.  The read_pattern_space()
-	function became unwieldly and parts were split into
-	open_next_file(), closedown(), read_always_fail(),
-	read_mem_line(), and read_file_line().  The
-	at_end_of_file_p() function became obsolete and was
-	eliminated; test_dollar_EOF_p() was updated.  A few
-	global and module-static variables were elminated, and
-	"struct line" was extended; comments were added to the
-	"struct line" declartation to document some important
-	dependencies in it.
-
-	I undertook the reorganization with dread, but I
-	feel that the new organization is an improvement
-	well beyond just fixing the bug that inspired it.
+	  Rearranged where files get opened -- large scale
+	  changes primarily involving main(), process_files(),
+	  and read_pattern_space(), but also touching on several
+	  other parts of execute.c.  The read_pattern_space()
+	  function became unwieldly and parts were split into
+	  open_next_file(), closedown(), read_always_fail(),
+	  read_mem_line(), and read_file_line().  The
+	  at_end_of_file_p() function became obsolete and was
+	  eliminated; test_dollar_EOF_p() was updated.  A few
+	  global and module-static variables were elminated, and
+	  "struct line" was extended; comments were added to the
+	  "struct line" declartation to document some important
+	  dependencies in it.
+
+	  I undertook the reorganization with dread, but I
+	  feel that the new organization is an improvement
+	  well beyond just fixing the bug that inspired it.
 
 Thu Apr  2 01:16:25 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* execute.c (read_file_line, slow_getline): the fread()
-	buffering code gives insufficient feedback to a user
-	running sed with a tty input device, so I created
-	slow_getline() for reading from a tty device.
-	Additionally, EOF detection has been made a little more
-	sensitive to avoid requiring multiple EOFs to be entered
-	from a tty.
+	  buffering code gives insufficient feedback to a user
+	  running sed with a tty input device, so I created
+	  slow_getline() for reading from a tty device.
+	  Additionally, EOF detection has been made a little more
+	  sensitive to avoid requiring multiple EOFs to be entered
+	  from a tty.
 
 	* configure.in: added isatty() check.
 
 Wed Apr  1 11:04:30 PST 1998  Ken Pizzini <ken@gnu.org>
 
 	* configure.in (CPPFLAGS, LDFLAGS, LIBS):
-	Set to appropriate values if large file support needs
-	explicit enabling.  Code fragment taken from a 1997-10-25
-	patch to gawk by Paul Eggert <eggert@twinsun.com>
+	  Set to appropriate values if large file support needs
+	  explicit enabling.  Code fragment taken from a 1997-10-25
+	  patch to gawk by Paul Eggert <eggert@twinsun.com>
 
 Thu Aug 14 17:43:27 PDT 1997  Ken Pizzini <ken@gnu.org>
 
@@ -2065,87 +1790,87 @@
 Thu Aug 14 12:08:45 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* execute.c: tweaked execute_program() to eliminate
-	gratuitous "goto" usage.
+	  gratuitous "goto" usage.
 
 Thu Aug 14 11:30:04 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* compile.c: added case-insensitive modifier ('I') to
-	address and s/// regexps.  The s/// case also accepts
-	the more popular 'i' modifier.  (The address regexp
-	cannot use 'i' as a modifier, as that conflicts with
-	the use of the 'i'nsert command.)
+	  address and s/// regexps.  The s/// case also accepts
+	  the more popular 'i' modifier.  (The address regexp
+	  cannot use 'i' as a modifier, as that conflicts with
+	  the use of the 'i'nsert command.)
 
 Thu Aug 14 09:29:06 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* compile.c: abstracted out match_slash() from the s///, y///,
-	and address-regexp special-case codes.
+	  and address-regexp special-case codes.
 
 	* execute.c: made dump_append_queue() use ck_fread() instead
-	of hand-rolled error checking.
+	  of hand-rolled error checking.
 
 Mon Jul 28 10:50:41 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* sed.c, sed.h, execute.c: POSIX.2, section 4.55.7, says that
-	a newline must end *every* output line.  But I think that
-	it is useful (when seding a binary file) to omit a trailing
-	newline if the input lacks one.  Thus the addition of
-	POSIXLY_CORRECT behavior.
+	  a newline must end *every* output line.  But I think that
+	  it is useful (when seding a binary file) to omit a trailing
+	  newline if the input lacks one.  Thus the addition of
+	  POSIXLY_CORRECT behavior.
 
 	* execute.c: however, when seding multiple files my feeling
-	is that it makes sense to have each file but the last
-	behave as-if it ended in a newline.  Modified read_pattern_space()
-	accordingly.
+	  is that it makes sense to have each file but the last
+	  behave as-if it ended in a newline.  Modified read_pattern_space()
+	  accordingly.
 
 	* utils.c: realized that add1_buffer(), for performance reasons,
-	shouldn't be calling memcpy() (indirectly via add_buffer()),
-	so rewrote it.
+	  shouldn't be calling memcpy() (indirectly via add_buffer()),
+	  so rewrote it.
 
 Sat Jul 26 23:08:28 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* execute.c: attempted to make read_pattern_space more
-	efficient for the the non-mmap() case.
+	  efficient for the the non-mmap() case.
 
 	* utils.c, utils.h, execute.c: new function ck_fread()
-	created and used.
+	  created and used.
 
 Sat Jul 26 20:22:14 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* execute.c, compile.c, sed.c: abstracted the mmap()
-	interface into map_file()/unmap_file() [sed.c], and
-	changed the ad-hoc code in compile_file() [compile.c]
-	and process_file() [execute.c] to make use of the new
-	interface.
+	  interface into map_file()/unmap_file() [sed.c], and
+	  changed the ad-hoc code in compile_file() [compile.c]
+	  and process_file() [execute.c] to make use of the new
+	  interface.
 
 Sat Jul 26 19:45:46 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* execute.c, compile.c, configure.in: Check to see if mmap()
-	is available; if so make use of it on regular files.
+	  is available; if so make use of it on regular files.
 
 	* compile.c: compile_file() now closes the input file
-	when it is through!
+	  when it is through!
 
 Sun Jul 20 23:57:02 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* compile.c: modified parsing to permit whitespace in more
-	places where it makes sense;
-	added backslash escaping to the y/// command, per POSIX.
+	  places where it makes sense;
+	  added backslash escaping to the y/// command, per POSIX.
 
 	* execute.c: Merged append_pattern_space() into read_pattern_space();
-	moved body of 's' command to new function do_subst();
-	moved body of 'l' command to new function do_list();
-	changed output of 'l' command to conform to POSIX.2;
-	made line handling conform to POSIX; added output_line() function;
-	redesigned append-space algorithm; added append_queue structure and
-	the next_append_slot() and dump_append_queue() functions.
+	  moved body of 's' command to new function do_subst();
+	  moved body of 'l' command to new function do_list();
+	  changed output of 'l' command to conform to POSIX.2;
+	  made line handling conform to POSIX; added output_line() function;
+	  redesigned append-space algorithm; added append_queue structure and
+	  the next_append_slot() and dump_append_queue() functions.
 
 	* sed.h: moved the definition of what is now struct subst
-	outside of the definition of struct sed_cmd.
+	  outside of the definition of struct sed_cmd.
 
 Sat Jul 19 16:29:09 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* sed.c, execute.c, sed.h, Makefile.am: Separated out the
-	pieces dealing with executing the program from the top-level
-	parameter parsing and control.
+	  pieces dealing with executing the program from the top-level
+	  parameter parsing and control.
 
 Sat Jul 19 01:16:35 PDT 1997  Ken Pizzini <ken@gnu.org>
 
@@ -2154,80 +1879,80 @@
 	dealing with interpreting the result.
 
 	* compile.c: add functions in_nonblank() and in_integer(),
-	and change interface to compile_address() with an eye
-	to making code clearer.
+	  and change interface to compile_address() with an eye
+	  to making code clearer.
 
 Fri Jul 18 13:35:50 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* utils.c: attempt at a quasi-unification of the
-	STDC and traditional C approaches to panic().
+	  STDC and traditional C approaches to panic().
 
 	* sed.c: eliminate some gratuitous bit twiddling.
-	(Using flag bits can be a useful technique, but
-	this code is cleaner without them.)
+	  (Using flag bits can be a useful technique, but
+	  this code is cleaner without them.)
 
 	* sed.c: place mutually exclusive members of struct addr
-	within a union, mainly to document the exclusivity;
-	eliminate unused structure members from struct fp_list;
-	eliminate unnecessary module-global variables;
-	remove some #if 0 code that is too odd to keep;
-	allegedly simplified the 'l' case of execute_program();
-	allegedly simplified inchar();
-	localized some static variables;
-	renamed some variables to better document their purpose;
-	removed some goto-s rendered obsolete by other changes.
+	  within a union, mainly to document the exclusivity;
+	  eliminate unused structure members from struct fp_list;
+	  eliminate unnecessary module-global variables;
+	  remove some #if 0 code that is too odd to keep;
+	  allegedly simplified the 'l' case of execute_program();
+	  allegedly simplified inchar();
+	  localized some static variables;
+	  renamed some variables to better document their purpose;
+	  removed some goto-s rendered obsolete by other changes.
 
 Thu Jul 17 15:30:44 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* utils.c, utils.h, sed.c: added and made use of
-	ck_free() function.
+	  ck_free() function.
 
 	* utils.c, utils.h, sed.c: changed all the *_buffer()
-	functions to take/return an incomplete type
-	"struct buffer *" instead of using VOID *.
+	  functions to take/return an incomplete type
+	  "struct buffer *" instead of using VOID *.
 
 	* utils.c, utils.h, sed.c: renamed "finish_buffer()"
-	to "free_buffer()", on the premise that the new
-	name better describes the function's purpose.
+	  to "free_buffer()", on the premise that the new
+	  name better describes the function's purpose.
 
 Wed Jul 16 13:52:14 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* utils.c, utils.h, sed.c: added and made use of
-	ck_memdup() function.
+	  ck_memdup() function.
 
 	* sed.c: protected a call to add1_buffer() in
-	compile_program() which could have tried to
-	push an EOF if a a/i/c command ended with
-	a '\', EOF sequence.
+	  compile_program() which could have tried to
+	  push an EOF if a a/i/c command ended with
+	  a '\', EOF sequence.
 
 	* utils.c: added sanity check to add1_buffer() so that
-	EOF will not be added to the buffer.
+	  EOF will not be added to the buffer.
 
 Wed Jul 16 03:56:26 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* configure.in, compat.h, compat.c: added memchr.
 
 	* sed.c: got rid of arbitrary NUM_FPS limit;
-	made global functions and variables "static" where appropriate;
-	make various cosmetic changes, hopefully improving readability;
-	simplified some redundant predicates;
-	simplified some code, but nothing fundamental (yet?).
+	  made global functions and variables "static" where appropriate;
+	  make various cosmetic changes, hopefully improving readability;
+	  simplified some redundant predicates;
+	  simplified some code, but nothing fundamental (yet?).
 
 Wed Jul 16 00:24:54 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* alloca.c, getopt.c, getopt.h, getopt1.c: updated from
-	versions in textutils-1.22.
+	  versions in textutils-1.22.
 
 	* Makefile.in, Makefile.am, configure.in: put in automake support.
 
 	* basicdefs.h, compat.h, compat.c [, sed.c, utils.c]: took out
-	some very ugly compatibility #ifdefs and packaged into one
-	place.
+	  some very ugly compatibility #ifdefs and packaged into one
+	  place.
 
 	* sed.c, utils.c: some gratuitous formatting changes.
 
 	* utils.c: changed datatype of utils_id_s in order to
-	eliminate arbitrary array size.
+	  eliminate arbitrary array size.
 
 Sun Jul 13 17:00:26 PDT 1997  Ken Pizzini <ken@gnu.org>
 
@@ -2236,8 +1961,8 @@
 Sun Jul 13 00:46:48 PDT 1997  Ken Pizzini <ken@gnu.org>
 
 	* sed.c: fixed bug which caused SEGV for files missing a
-	final newline.  Corrected calls to regnexec to pass the
-	proper parameters, in the proper order.
+	  final newline.  Corrected calls to regnexec to pass the
+	  proper parameters, in the proper order.
 
 Sat Dec 30 20:16:59 1995  Tom Lord  <lord@beehive>
 
@@ -2263,23 +1988,23 @@
 	*** Version 2.04 released
 
 	* sed.c: applied a patch from
-	 From: kap1@tao.cpe.uchicago.edu (Dietrich Kappe)
+	   From: kap1@tao.cpe.uchicago.edu (Dietrich Kappe)
 
-	 Dietrich writes:
+	   Dietrich writes:
 
-	 As my contribution to the creeping feature creature in sed,
-	 here is a new type of address. The address has form n~m,
-	 which means "the line number is equal to n modulo m." The
-	 modifications to sed are trivial, and the general
-	 usefulness of this address should be obvious. If m is 0 or
-	 missing, 1 is used in its place (could be a bug or a
-	 feature :-).
+	   As my contribution to the creeping feature creature in sed,
+	   here is a new type of address. The address has form n~m,
+	   which means "the line number is equal to n modulo m." The
+	   modifications to sed are trivial, and the general
+	   usefulness of this address should be obvious. If m is 0 or
+	   missing, 1 is used in its place (could be a bug or a
+	   feature :-).
 
 Sat Apr 30 17:17:38 1994  Tom Lord  (lord@x1.cygnus.com)
 
 	* rx.c (solve_destination): protect `solution' more carefully.
 	This is a cleanup of a patch from Kevin Buettner
-	 (kev@cujo.geg.mot.com).
+	   (kev@cujo.geg.mot.com).
 
 Sat Apr 30 17:17:38 1994  Tom Lord  (lord@x1.cygnus.com)
 
@@ -2343,19 +2068,19 @@
 Fri May 21 00:39:22 1993  Tom Lord  (lord@unix8.andrew.cmu.edu)
 
 	* sed.c (execute_program): apply gaumondp's patch
-	to fix '\xabcxs/foo/bar/'.
+	  to fix '\xabcxs/foo/bar/'.
 
 	* sed.c (execute_program):
-	If a second address is a regexp, never match it on the
-	same line as the first address.
+	  If a second address is a regexp, never match it on the
+	  same line as the first address.
 
 	* sed.c (compile_regexp):
-	Numeric ranges  x,y s.t. y < x are now treated as x,x.
-	There was a bug in that they were being handled like x,x+1.
+	  Numeric ranges  x,y s.t. y < x are now treated as x,x.
+	  There was a bug in that they were being handled like x,x+1.
 
 	* sed.c (execute_program, read_pattern_space,
-	append_pattern_space) don't add newlines to lines
-	that don't have them.
+	  append_pattern_space) don't add newlines to lines
+	  that don't have them.
 
 Wed May 19 13:34:45 1993  Tom Lord  (lord@unix9.andrew.cmu.edu)
 
@@ -2422,13 +2147,13 @@
 	(Francois Pinard) for pointing out this and many other bugs.
 
 	* sed.c (execute_program): Fixed a case of `D' command.
-	Thanks Chris Weber <weber@bucknell.edu>
+	  Thanks Chris Weber <weber@bucknell.edu>
 
 	* sed.c: added new tests of no_default_output to make -n work.
-	Thanks Andrew Herbert <andrew@werple.apana.org.au>
+	  Thanks Andrew Herbert <andrew@werple.apana.org.au>
 
 	* sed.c, configure.in,Makefile.in: autoconfed bcopy and const.
-	Thanks "J.T. Conklin" <jtc@gain.com>
+	  Thanks "J.T. Conklin" <jtc@gain.com>
 
 	* sed.c: made prog_cur, prog_start, and prog_end unsigned so
 	that users could write  `sed -e s//foo/g'.
@@ -2459,14 +2184,14 @@
 	* sed.c (compile_address) added \?regexp? syntax for addresses.
 
 	* sed.c (main) added {} intervals to the obscure regexp
-	syntax.
+	  syntax.
 
 	* sed.c (compile_program)  after calling compile_address,
-	normalize numeric addresses (make a2.addr_number > a1.addr_number).
-	This is necessary because line numbers must match exactly,
-	but sed does not try to match a2 until after a1 has matched,
-	yet a1,a2 where a2 <= a1 is defined to be equivelent to
-	a1,a1+1
+	  normalize numeric addresses (make a2.addr_number > a1.addr_number).
+	  This is necessary because line numbers must match exactly,
+	  but sed does not try to match a2 until after a1 has matched,
+	  yet a1,a2 where a2 <= a1 is defined to be equivelent to
+	  a1,a1+1
 
 Sat Feb 29 10:55:54 1992  David J. MacKenzie  (djm@nutrimat)
 
--- 4.1.4/config/texi2dvi
+++ 4.0.9/config/texi2dvi
@@ -1,9 +1,9 @@
 #! /bin/sh
 # texi2dvi --- produce DVI (or PDF) files from Texinfo (or LaTeX) sources.
-# $Id: texi2dvi,v 1.14 2003/02/05 00:42:33 karl Exp $
+# $Id: texi2dvi,v 0.51 2002/04/01 14:20:59 karl Exp $
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2001,
-# 2002, 2003 Free Software Foundation, Inc.
+# Copyright (C) 1992, 93, 94, 95, 96, 97, 98, 99, 2001, 02
+# Free Software Foundation, Inc.
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -27,12 +27,12 @@
 # the `--debug' option when making a bug report.
 
 # This string is expanded by rcs automatically when this file is checked out.
-rcs_revision='$Revision: 1.14 $'
+rcs_revision='$Revision: 0.51 $'
 rcs_version=`set - $rcs_revision; echo $2`
 program=`echo $0 | sed -e 's!.*/!!'`
-version="texi2dvi (GNU Texinfo 4.5) $rcs_version
+version="texi2dvi (GNU Texinfo 4.2) $rcs_version
 
-Copyright (C) 2003 Free Software Foundation, Inc.
+Copyright (C) 2002 Free Software Foundation, Inc.
 There is NO warranty.  You may redistribute this software
 under the terms of the GNU General Public License.
 For more information about these matters, see the files named COPYING."
@@ -61,7 +61,7 @@
 
 TeX tuning:
   -@                   use @input instead of \input; for preloaded Texinfo
-  -e, -E, --expand     force macro expansion using makeinfo
+  -e, --expand         force macro expansion using makeinfo
   -I DIR               search DIR for Texinfo files
   -l, --language=LANG  specify the LANG of FILE (LaTeX or Texinfo)
   -p, --pdf            use pdftex or pdflatex for processing
@@ -86,12 +86,12 @@
 expand=         # t for expansion via makeinfo
 miincludes=     # makeinfo include path
 oformat=dvi
-oname=          # --output
+oname=		# --output
 quiet=          # by default let the tools' message be displayed
 set_language=
 textra=
 tmpdir=${TMPDIR:-/tmp}/t2d$$  # avoid collisions on 8.3 filesystems.
-txincludes=     # TEXINPUTS extensions, with trailing colon
+txincludes=     # TEXINPUTS extensions
 txiprereq=19990129 # minimum texinfo.tex version to have macro expansion
 verbose=false   # echo for verbose mode
 
@@ -105,12 +105,6 @@
   path_sep=":"
 fi
 
-# Pacify verbose cds.
-CDPATH=${ZSH_VERSION+.}$path_sep
-
-# In case someone crazy insists on using grep -E.
-: ${EGREP=egrep}
-
 # Save this so we can construct a new TEXINPUTS path for each file.
 TEXINPUTS_orig="$TEXINPUTS"
 # Unfortunately makeindex does not read TEXINPUTS.
@@ -149,12 +143,12 @@
     -q | -s | --q* | --s*) quiet=t; batch=eval;;
     -c | --c*) clean=t;;
     -D | --d*) debug=t;;
-    -e | -E | --e*) expand=t;;
+    -e | --e*) expand=t;;
     -h | --h*) echo "$usage"; exit 0;;
     -I | --I*)
       shift
       miincludes="$miincludes -I $1"
-      txincludes="$txincludes$1$path_sep"
+      txincludes="$txincludes$path_sep$1"
       ;;
     -l | --l*) shift; set_language=$1;;
     -o | --o*)
@@ -268,7 +262,7 @@
 # Get list of xref files (indexes, tables and lists).
 # Find all files having root filename with a two-letter extension,
 # saves the ones that are really Texinfo-related files.  .?o? catches
-# many files: .toc, .log, LaTeX tables and lists, FiXme's .lox, maybe more.
+# LaTeX tables and lists.
 for this_file in "$1".?o? "$1".aux "$1".?? "$1".idx; do
   # If file is empty, skip it.
   test -s "$this_file" || continue
@@ -311,7 +305,7 @@
 
   # If the COMMAND_LINE_FILENAME is not absolute (e.g., --debug.tex),
   # prepend `./' in order to avoid that the tools take it as an option.
-  echo "$command_line_filename" | $EGREP '^(/|[A-z]:/)' >/dev/null \
+  echo "$command_line_filename" | egrep '^(/|[A-z]:/)' >/dev/null \
   || command_line_filename="./$command_line_filename"
 
   # See if the file exists.  If it doesn't we're in trouble since, even
@@ -352,67 +346,22 @@
   # Make all those directories and give up if we can't succeed.
   mkdir $tmpdir_src $tmpdir_xtr $tmpdir_bak || exit 1
 
-  # Source file might include additional sources.
-  # We want `.:$orig_pwd' before anything else.  (We'll add `.:' later
-  # after all other directories have been turned into absolute paths.)
-  # `.' goes first to ensure that any old .aux, .cps,
+  # Source file might include additional sources.  Put `.' and
+  # directory where source file(s) reside in TEXINPUTS before anything
+  # else.  `.' goes first to ensure that any old .aux, .cps,
   # etc. files in ${directory} don't get used in preference to fresher
   # files in `.'.  Include orig_pwd in case we are in clean mode, where
   # we've cd'd to a temp directory.
-  common="$orig_pwd$path_sep$filename_dir$path_sep$txincludes"
+  common=".$path_sep$orig_pwd$path_sep$filename_dir$path_sep$txincludes$path_sep"
    TEXINPUTS="$common$TEXINPUTS_orig"
   INDEXSTYLE="$common$INDEXSTYLE_orig"
 
-  # Convert relative paths to absolute paths, so we can run in another
-  # directory (e.g., in --clean mode, or during the macro-support
-  # detection.)
-  #
-  # Empty path components are meaningful to tex.  We rewrite them
-  # as `EMPTY' so they don't get lost when we split on $path_sep.
-   TEXINPUTS=`echo $TEXINPUTS  |sed 's/^:/EMPTY:/;s/:$/:EMPTY/;s/::/:EMPTY:/g'`
-  INDEXSTYLE=`echo $INDEXSTYLE |sed 's/^:/EMPTY:/;s/:$/:EMPTY/;s/::/:EMPTY:/g'`
-  save_IFS=$IFS
-  IFS=$path_sep
-  set x $TEXINPUTS; shift
-  TEXINPUTS=.
-  for dir
-  do
-    case $dir in
-      EMPTY)
-        TEXINPUTS=$TEXINPUTS$path_sep
-        ;;
-      [\\/]* | ?:[\\/]*)        # Absolute paths don't need to be expansed.
-        TEXINPUTS=$TEXINPUTS$path_sep$dir
-        ;;
-      *)
-        abs=`cd "$dir" && pwd` && TEXINPUTS=$TEXINPUTS$path_sep$abs
-        ;;
-    esac
-  done
-  set x $INDEXSTYLE; shift
-  INDEXSTYLE=.
-  for dir
-  do
-    case $dir in
-      EMPTY)
-        INDEXSTYLE=$INDEXSTYLE$path_sep
-        ;;
-      [\\/]* | ?:[\\/]*)        # Absolute paths don't need to be expansed.
-        INDEXSTYLE=$INDEXSTYLE$path_sep$dir
-        ;;
-      *)
-        abs=`cd "$dir" && pwd` && INDEXSTYLE=$INDEXSTYLE$path_sep$abs
-        ;;
-    esac
-  done
-  IFS=$save_IFS
-
   # If the user explicitly specified the language, use that.
   # Otherwise, if the first line is \input texinfo, assume it's texinfo.
   # Otherwise, guess from the file extension.
   if test -n "$set_language"; then
     language=$set_language
-  elif sed 1q "$command_line_filename" | grep 'input texinfo' >/dev/null; then
+  elif sed 1q "$command_line_filename" | fgrep 'input texinfo' >/dev/null; then
     language=texinfo
   else
     language=
@@ -550,14 +499,10 @@
 
     # What we'll run texindex on -- exclude non-index files.
     # Since we know index files are last, it is correct to remove everything
-    # before .aux and .?o?.  But don't really do <anything>o<anything>
-    # -- don't match whitespace as <anything>.
-    # Otherwise, if orig_xref_files contains something like
-    #   foo.xo foo.whatever
-    # the space after the o will get matched.
+    # before .aux and .?o?.
     index_files=`echo "$orig_xref_files" \
                  | sed "s!.*\.aux!!g;
-                        s!./$filename_noext\.[^ ]o[^ ]!!g;
+                        s!./$filename_noext\..o.!!g;
                         s/^[ ]*//;s/[ ]*$//"`
     # Run texindex (or makeindex) on current index files.  If they
     # already exist, and after running TeX a first time the index
@@ -595,7 +540,7 @@
     # subdirs, since texi2dvi does not try to compare xref files in
     # subdirs.  Performing xref files test is still good since LaTeX
     # does not report changes in xref files.
-    if grep "Rerun to get" "$filename_noext.log" >/dev/null 2>&1; then
+    if fgrep "Rerun to get" "$filename_noext.log" >/dev/null 2>&1; then
       finished=
     fi
 
--- 4.1.4/configure.ac
+++ 4.0.9/configure.ac
@@ -1,12 +1,12 @@
 dnl Process this file with -*- autoconf -*- to produce a configure script.
-AC_INIT(sed, 4.1.4, bonzini@gnu.org, sed)
+AC_INIT(sed, 4.0.9, bonzini@gnu.org, sed)
 AC_CONFIG_AUX_DIR(config)
 AC_CONFIG_SRCDIR([sed/sed.c])
 AM_CONFIG_HEADER(config.h:config_h.in)
-AC_PREREQ(2.59)
+AC_PREREQ(2.53)
 AM_INIT_AUTOMAKE
 
-SED_FEATURE_VERSION=4.1
+SED_FEATURE_VERSION=4.0
 AC_DEFINE_UNQUOTED(SED_FEATURE_VERSION, "$SED_FEATURE_VERSION",
   [Define to the version of GNU sed whose features are supported by this sed.])
 AC_SUBST(SED_FEATURE_VERSION)
@@ -18,7 +18,6 @@
 AC_MINIX
 AC_ISC_POSIX
 AC_SYS_LARGEFILE
-AC_SYS_LONG_FILE_NAMES
 
 AC_MSG_CHECKING([whether -lcP is needed])
 AC_TRY_RUN([
@@ -31,7 +30,7 @@
   int result;
   errno = 0;
   fp = fopen ("conftest.c", "r");
-  if (!fp) return 0;	   /* error, assume not needed */
+  if (!fp) return 0;       /* error, assume not needed */
   result = fflush (fp) == EOF && errno == 0;
   fclose (fp);
   return result;
@@ -41,47 +40,33 @@
     [AC_MSG_RESULT([assuming no])
 ])
 
-AC_HEADER_DIRENT
-AC_CHECK_HEADERS(io.h limits.h locale.h stdarg.h alloca.h stddef.h errno.h \
-		 wchar.h wctype.h sys/file.h mcheck.h, [], [],
-		 [AC_INCLUDES_DEFAULT])
+AC_HEADER_STDC
+AC_CHECK_HEADERS(string.h strings.h stdlib.h unistd.h io.h \
+		 limits.h locale.h stdarg.h alloca.h stddef.h errno.h \
+		 wchar.h wctype.h sys/file.h)
 AC_C_CONST
 AC_TYPE_SIZE_T
 AC_CHECK_TYPE(ssize_t, int)
 
-AC_HEADER_STDBOOL
-if test "$ac_cv_type__Bool" = no; then
-  HAVE__BOOL=0
-else
-  HAVE__BOOL=1
-fi
-AC_SUBST(HAVE__BOOL)
-if test "$ac_cv_header_stdbool_h" = no; then
-  AC_CONFIG_FILES(lib/stdbool.h:lib/stdbool_.h)
-fi
-
 AC_FUNC_ALLOCA
 AC_FUNC_VPRINTF
 AM_FUNC_GETLINE
 AC_FUNC_OBSTACK
+gl_FUNC_STRVERSCMP
 AC_FUNC_MBRTOWC
 AC_TYPE_MBSTATE_T
-gl_FUNC_STRVERSCMP
 AC_REPLACE_FUNCS(memchr memcmp memmove strerror mkstemp)
 AC_CHECK_FUNCS(isatty bcopy bzero isascii memcpy memset strchr strtoul popen \
-		pathconf isblank fchown fchmod setlocale wcrtomb wcscoll btowc)
-
-AC_ARG_ENABLE(i18n,
-[  --disable-i18n          disable internationalization (default=yes)], ,
-enable_i18n=yes)
-if test "x$enable_i18n" = xno; then
-  ac_cv_func_wcscoll=false
-fi
+		isblank fchmod setlocale wcrtomb wcscoll)
 
 AC_ARG_WITH(included-regex, 
 [  --with-included-regex   use included regex matcher (default=yes)], ,
 with_included_regex=yes)
 
+AC_ARG_ENABLE(regex-tests,
+[  --enable-regex-tests    enable regex matcher regression tests (default=no)], ,
+enable_regex_tests=no)
+
 if test "x$with_included_regex" = xno; then
   AC_CHECK_HEADERS(regex.h)
   AC_CHECK_LIB(regex, re_search)
@@ -92,22 +77,15 @@
   fi
 fi
 
-AC_ARG_ENABLE(regex-tests, 
-[  --enable-regex-tests    enable regex matcher regression tests (default=yes)],
-[if test "x$with_included_regex" = xno; then
+if test "x$with_included_regex" = xno; then
   enable_regex_tests=no
-fi],
-enable_regex_tests=$with_included_regex)
+fi
 
 AM_CONDITIONAL(TEST_REGEX, test "x$enable_regex_tests" != xno)
 if test "x$with_included_regex" != xno; then
   AC_CONFIG_LINKS(lib/regex.h:lib/regex_.h)
   AC_LIBOBJ(regex)
 fi
-if test "x$enable_regex_tests" = xyes; then
-  AC_DEFINE_UNQUOTED(_REGEX_RE_COMP, 1,
-    [Include BSD functions in regex, used by the testsuite])
-fi
 
 AC_ARG_ENABLE(html, 
 [  --enable-html           build HTML manual (default=no)], ,
@@ -139,16 +117,9 @@
 AM_CONDITIONAL(TEXI2HTML_HTML, test "x$enable_html" = xtexi2html)
 
 
-AC_DEFUN([AM_MKINSTALLDIRS], [MKINSTALLDIRS="$mkdir_p" AC_SUBST(MKINSTALLDIRS)])
-AM_GNU_GETTEXT_VERSION(0.14)
-AM_GNU_GETTEXT(no-libtool, need-ngettext, ../intl)
-AC_CONFIG_COMMANDS([gettext-fix], [
-  sed -e 's/^mkinstalldirs *=.*/mkinstalldirs=$(MKINSTALLDIRS)/' \
-      intl/Makefile > intl/Makefile.tmp
-  mv intl/Makefile.tmp intl/Makefile
-  sed -e 's/^mkinstalldirs *=.*/mkinstalldirs=$(MKINSTALLDIRS)/' \
-      po/Makefile > po/Makefile.tmp
-  mv po/Makefile.tmp po/Makefile])
+ALL_LINGUAS="ca cs da de el eo es et fi fr ga gl he hr hu id it ja ko nl pl pt_BR ro ru sk sl sr sv tr zh_CN"
+AM_GNU_GETTEXT_VERSION(0.11)
+AM_GNU_GETTEXT(, need-ngettext)
 
 AC_CONFIG_FILES([bootstrap.sh], chmod +x bootstrap.sh)
 AC_CONFIG_FILES([Makefile doc/Makefile \
--- 4.1.4/doc/Makefile.am
+++ 4.0.9/doc/Makefile.am
@@ -13,12 +13,11 @@
 # scripts we group comments with lines following them;
 # since mantaining the "@group...@end group" manually
 # is a burden, we do this automatically
-$(srcdir)/sed.texi: sed-in.texi $(srcdir)/groupify.sed
-	sed -nf $(srcdir)/groupify.sed \
-	  < $(srcdir)/sed-in.texi > $(srcdir)/sed.texi
+sed.texi: sed-in.texi groupify.sed
+	sed -nf groupify.sed < $(srcdir)/sed-in.texi > $(srcdir)/sed.texi
 
-sed.1: $(top_srcdir)/sed/sed.c $(top_srcdir)/configure.ac $(srcdir)/sed.x
-	$(HELP2MAN) -p sed --include $(srcdir)/sed.x $(SED) > $(srcdir)/sed.1
+sed.1: $(top_srcdir)/sed/sed.c $(top_srcdir)/configure.ac sed.x
+	$(HELP2MAN) -p sed --include sed.x $(SED) > $(srcdir)/sed.1
 
 dist-hook:
 	touch $(distdir)/sed.1
@@ -27,12 +26,9 @@
 # sed.html dependant on sed.texi and all the included
 # sources
 if MAKEINFO_HTML
-docdir = $(datadir)/doc
-doc_DATA = sed.html
-
 sed.html: sed.texi sed.info
-	builddir=`pwd` && cd $(srcdir) && \
-	  $(MAKEINFO) --html --no-split -o $$builddir/sed.html sed.texi
+	cd $(srcdir) \
+	  && $(MAKEINFO) --html `echo $< | sed 's,.*/,,'`
 
 html: sed.html
 
@@ -41,13 +37,9 @@
 
 # These rules are used together with TEXI2HTML
 if TEXI2HTML_HTML
-docdir = $(datadir)/doc
-doc_DATA = sed.html
-
 sed.html: sed.texi sed.info
-	cp $(srcdir)/*.texi . && \
-	  $(TEXI2HTML) sed.texi && \
-	  rn *.texi
+	cd $(srcdir) \
+	  && $(TEXI2HTML) `echo $< | sed 's,.*/,,'`
 
 html: sed.html
 
--- 4.1.4/doc/sed.1
+++ 4.0.9/doc/sed.1
@@ -1,7 +1,7 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.28.
-.TH SED "1" "January 2005" "sed version 4.1.3" "User Commands"
+.TH SED "1" "January 2004" "sed version 4.0.9" "User Commands"
 .SH NAME
-sed \- manual page for sed version 4.1.3
+sed \- manual page for sed version 4.0.9
 .SH SYNOPSIS
 .B sed
 [\fIOPTION\fR]... \fI{script-only-if-no-other-script} \fR[\fIinput-file\fR]...
@@ -32,7 +32,7 @@
 .IP
 add the contents of script-file to the commands to be executed
 .HP
-\fB\-i[SUFFIX]\fR, \fB\-\-in\-place\fR[=\fISUFFIX\fR]
+\fB\-i[suffix]\fR, \fB\-\-in\-place\fR[=\fIsuffix\fR]
 .IP
 edit files in place (makes backup if extension supplied)
 .HP
@@ -40,10 +40,6 @@
 .IP
 specify the desired line-wrap length for the `l' command
 .HP
-\fB\-\-posix\fR
-.IP
-disable all GNU extensions.
-.HP
 \fB\-r\fR, \fB\-\-regexp\-extended\fR
 .IP
 use extended regular expressions in the script.
@@ -61,7 +57,7 @@
 \fB\-\-help\fR
 display this help and exit
 .TP
-\fB\-\-version\fR
+\fB\-V\fR, \fB\-\-version\fR
 output version information and exit
 .PP
 If no \fB\-e\fR, \fB\-\-expression\fR, \fB\-f\fR, or \fB\-\-file\fR option is given, then the first
--- 4.1.4/doc/sed-in.texi
+++ 4.0.9/doc/sed-in.texi
@@ -37,14 +37,13 @@
 Copyright @copyright{} 1998, 1999, 2001, 2002, 2003, 2004 Free
 Software Foundation, Inc.
 
-This document is released under the terms of the @acronym{GNU} Free
-Documentation License as published by the Free Software Foundation;
-either version 1.1, or (at your option) any later version.
-
-You should have received a copy of the @acronym{GNU} Free Documentation
-License along with @value{SSED}; see the file @file{COPYING.DOC}.
-If not, write to the Free Software Foundation, 59 Temple Place - Suite
-330, Boston, MA 02111-1307, USA.
+This document is released under the terms of the GNU Free Documentation
+License as published by the Free Software Foundation; either version 1.1, or
+(at your option) any later version.
+
+You should have received a copy of the GNU Free Documentation License along
+with @value{SSED}; see the file @file{COPYING.DOC}.  If not, write to the Free
+Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 
 There are no Cover Texts and no Invariant Sections; this text, along
 with its equivalent in the printed manual, constitutes the Title Page.
@@ -98,9 +97,9 @@
 --- The detailed node listing ---
 
 sed Programs:
-* Execution Cycle::                 How @command{sed} works
 * Addresses::                       Selecting lines with @command{sed}
 * Regular Expressions::             Overview of regular expression syntax
+* Data Spaces::                     Where @command{sed} buffers data
 * Common Commands::                 Often used commands
 * The "s" Command::                 @command{sed}'s Swiss Army Knife
 * Other Commands::                  Less frequently used commands
@@ -167,35 +166,20 @@
 @node Invoking sed
 @chapter Invocation
 
-Normally @command{sed} is invoked like this:
-
-@example
-sed SCRIPT INPUTFILE...
-@end example
-
-The full format for invoking @command{sed} is:
-
-@example
-sed OPTIONS... [SCRIPT] [INPUTFILE...]
-@end example
-
-If you do not specify @var{INPUTFILE}, or if @var{INPUTFILE} is @file{-},
-@command{sed} filters the contents of the standard input.  The @var{script}
-is actually the first non-option parameter, which @command{sed} specially
-considers a script and not an input file if (and only if) none of the
-other @var{options} specifies a script to be executed, that is if neither
-of the @option{-e} and @option{-f} options is specified.
-
 @command{sed} may be invoked with the following command-line options:
 
 @table @code
-@item --version
+@item -V
+@itemx --version
+@opindex -V
 @opindex --version
 @cindex Version, printing
 Print out the version of @command{sed} that is being run and a copyright notice,
 then exit.
 
-@item --help
+@item -h
+@itemx --help
+@opindex -h
 @opindex --help
 @cindex Usage summary, printing
 Print a usage message briefly summarizing these command-line options
@@ -219,7 +203,7 @@
 @itemx --in-place[=@var{SUFFIX}]
 @opindex -i
 @opindex --in-place
-@cindex In-place editing, activating
+@cindex In-place editing
 @cindex @value{SSEDEXT}, in-place editing
 This option specifies that files are to be edited in-place.
 @value{SSED} does this by creating a temporary file and
@@ -229,29 +213,27 @@
 still write to the standard output by using the @code{w}
 @cindex @value{SSEDEXT}, @file{/dev/stdout} file
 or @code{W} commands together with the @file{/dev/stdout}
-special file}.
-
-This option implies @option{-s}.
+special file}
 
 When the end of the file is reached, the temporary file is
-renamed to the output file's original name.  The extension,
-if supplied, is used to modify the name of the old file
-before renaming the temporary file, thereby making a backup
-copy@footnote{Note that @value{SSED} creates the backup
-    file whether or not any output is actually changed.}).
-
-@cindex In-place editing, Perl-style backup file names
-This rule is followed: if the extension doesn't contain a @code{*},
-then it is appended to the end of the current filename as a
-suffix; if the extension does contain one or more @code{*}
-characters, then @emph{each} asterisk is replaced with the
-current filename.  This allows you to add a prefix to the
-backup file, instead of (or in addition to) a suffix, or
-even to place backup copies of the original files into another
-directory (provided the directory already exists).
+renamed to the output file's original name.
 
-If no extension is supplied, the original file is
-overwritten without making a backup.
+The extension, if supplied, is used to modify the name of
+the old file before renaming the temporary file (thereby
+making a backup copy@footnote{Note that @value{SSED}
+    creates the backup file whether
+    or not any output is actually changed.}) following
+this rule: if the extension doesn't contain a @code{*},
+then it is appended to the end of the current filename
+as a suffix; if the extension does contain one or more
+@code{*} characters, then @emph{each} asterisk is
+replaced with the current filename.  This allows
+you to add a prefix to the backup file, instead of (or in
+addition to) a suffix, or even to place backup copies of
+the original files into another directory (provided the
+directory already exists).
+
+This option implies @option{-s}.
 
 @item -l @var{N}
 @itemx --line-length=@var{N}
@@ -262,21 +244,6 @@
 A length of 0 (zero) means to never wrap long lines.  If
 not specified, it is taken to be 70.
 
-@item --posix
-@cindex @value{SSEDEXT}, disabling
-@value{SSED} includes several extensions to @acronym{POSIX}
-sed.  In order to simplify writing portable scripts, this
-option disables all the extensions that this manual documents,
-including additional commands.
-@cindex @code{POSIXLY_CORRECT} behavior, enabling
-Most of the extensions accept @command{sed} programs that
-are outside the syntax mandated by @acronym{POSIX}, but some
-of them (such as the behavior of the @command{N} command
-described in @pxref{Reporting Bugs}) actually violate the
-standard.  If you want to disable only the latter kind of
-extension, you can set the @code{POSIXLY_CORRECT} variable
-to a non-empty value.
-
 @item -r
 @itemx --regexp-extended
 @opindex -r
@@ -377,9 +344,9 @@
 and any additional command-specific code.
 
 @menu
-* Execution Cycle::          How @command{sed} works
 * Addresses::                Selecting lines with @command{sed}
 * Regular Expressions::      Overview of regular expression syntax
+* Data Spaces::              Where @command{sed} buffers data
 * Common Commands::          Often used commands
 * The "s" Command::          @command{sed}'s Swiss Army Knife
 * Other Commands::           Less frequently used commands
@@ -389,40 +356,6 @@
 @end menu
 
 
-@node Execution Cycle
-@section How @command{sed} Works
-
-@cindex Buffer spaces, pattern and hold
-@cindex Spaces, pattern and hold
-@cindex Pattern space, definition
-@cindex Hold space, definition
-@command{sed} maintains two data buffers: the active @emph{pattern} space,
-and the auxiliary @emph{hold} space. Both are initially empty.
-
-@command{sed} operates by performing the following cycle on each
-lines of input: first, @command{sed} reads one line from the input
-stream, removes any trailing newline, and places it in the pattern space.
-Then commands are executed; each command can have an address associated
-to it: addresses are a kind of condition code, and a command is only
-executed if the condition is verified before the command is to be
-executed.
-
-When the end of the script is reached, unless the @option{-n} option
-is in use, the contents of pattern space are printed out to the output
-stream, adding back the trailing newline if it was removed.@footnote{Actually,
-  if @command{sed} prints a line without the terminating newline, it will
-  nevertheless print the missing newline as soon as more text is sent to
-  the same output stream, which gives the ``least expected surprise''
-  even though it does not make commands like @samp{sed -n p} exactly
-  identical to @command{cat}.} Then the next cycle starts for the next
-input line.
-
-Unless special commands (like @samp{D}) are used, the pattern space is
-deleted between two cycles. The hold space, on the other hand, keeps
-its data between cycles (see commands @samp{h}, @samp{H}, @samp{x},
-@samp{g}, @samp{G} to move data between both buffers).
-
-
 @node Addresses
 @section Selecting lines with @command{sed}
 @cindex Addresses, in @command{sed} scripts
@@ -467,12 +400,19 @@
 each must be escaped by a backslash (@code{\}).
 
 @cindex empty regular expression
+@cindex @code{POSIXLY_CORRECT} behavior, empty regular expression
+@cindex @acronym{GNU} extensions, modifiers and the empty regular expression
 @cindex @value{SSEDEXT}, modifiers and the empty regular expression
-The empty regular expression @samp{//} repeats the last regular
-expression match (the same holds if the empty regular expression is
-passed to the @code{s} command).  Note that modifiers to regular expressions
-are evaluated when the regular expression is compiled, thus it is invalid to
-specify them together with the empty regular expression.
+Unless @code{POSIXLY_CORRECT} is set, the empty regular expression
+@samp{//} repeats the last regular expression match (the same holds
+if the empty regular expression is passed to the @code{s} command).
+Note that modifiers to regular expressions are evaluated
+when the regular expression is compiled, thus it is illegal to specify
+them together with the empty regular expression.
+@c *** CHECK CURRENT POSIX, I'M NOT SURE THIS IS STILL TRUE. ADR.
+If @code{POSIXLY_CORRECT} is set, instead, @samp{//} is the null match:
+this behavior is mandated by @sc{posix}, but it would break too many legacy
+@command{sed} scripts to blithely change @value{SSED}'s default behavior.
 
 @item \%@var{regexp}%
 (The @code{%} may be replaced by any other single character.)
@@ -547,20 +487,22 @@
 
 @cindex Range of lines
 @cindex Several lines, selecting
+@cindex @acronym{GNU} extensions, @code{0} address
 An address range can be specified by specifying two addresses
-separated by a comma (@code{,}).  An address range matches lines
-starting from where the first address matches, and continues
-until the second address matches (inclusively).
-
+separated by a comma (@code{,}).
+An address range matches lines starting from where the first
+address matches, and continues until the second address matches
+(inclusively).
 If the second address is a @var{regexp}, then checking for the
 ending match will start with the line @emph{following} the
-line which matched the first address: a range will always
-span at least two lines (except of course if the input stream
-ends).
+line which matched the first address.  As a @acronym{GNU} extension, a
+line number of @code{0} can be used in an address specification
+like @samp{0,/@var{regexp}/} so that @var{regexp} will be
+matched in the first input line too.
 
 If the second address is a @var{number} less than (or equal to)
-the line matching the first address, then only the one line is
-matched.
+the line matching the first address,
+then only the one line is matched.
 
 @cindex Special addressing forms
 @cindex Range with start address of zero
@@ -568,27 +510,18 @@
 @cindex @var{addr1},+N
 @cindex @var{addr1},~N
 @cindex @acronym{GNU} extensions, special two-address forms
-@cindex @acronym{GNU} extensions, @code{0} address
 @cindex @acronym{GNU} extensions, 0,@var{addr2} addressing
 @cindex @acronym{GNU} extensions, @var{addr1},+@var{N} addressing
 @cindex @acronym{GNU} extensions, @var{addr1},~@var{N} addressing
-@value{SSED} also supports some special two-address forms; all these
-are @acronym{GNU} extensions:
+@value{SSED} also supports some special two-address forms:
 @table @code
-@item 0,/@var{regexp}/
-A line number of @code{0} can be used in an address specification like
-@code{0,/@var{regexp}/} so that @command{sed} will try to match
-@var{regexp} in the first input line too.  In other words,
-@code{0,/@var{regexp}/} is similar to @code{1,/@var{regexp}/},
-except that if @var{addr2} matches the very first line of input the
-@code{0,/@var{regexp}/} form will consider it to end the range, whereas
-the @code{1,/@var{regexp}/} form will match the beginning of its range and
-hence make the range span up to the @emph{second} occurrence of the
-regular expression.
-
-Note that this is the only place where the @code{0} address makes
-sense; there is no 0-th line and commands which are given the @code{0}
-address in any other way will give an error.
+@item 0,@var{addr2}
+Start out in ``matched first address'' state,
+until @var{addr2} is found.
+This is similar to @samp{1,@var{addr2}},
+except that if @var{addr2} matches the very first line of input
+the 0,@var{addr2} form will be at the end of its range,
+whereas the 1,@var{addr2} form will still be at the beginning of its range.
 
 @item @var{addr1},+@var{N}
 Matches @var{addr1} and the @var{N} lines following @var{addr1}.
@@ -674,22 +607,21 @@
 
 @itemize @bullet
 @item
-@cindex @acronym{GNU} extensions, to basic regular expressions
 Apply postfix operators, like @code{\(abcd\)*}:
 this will search for zero or more whole sequences 
 of @samp{abcd}, while @code{abcd*} would search
 for @samp{abc} followed by zero or more occurrences
-of @samp{d}.  Note that support for @code{\(abcd\)*} is
-required by @acronym{POSIX} 1003.1-2001, but many non-@acronym{GNU}
+of @samp{d}.  Note that support for @code{\(abcd\)*} is required by
+@acronym{POSIX} 1003.1-2001, but many non-@acronym{GNU}
 implementations do not support it and hence it is not universally
-portable.         
+portable.
 
 @item
 Use back references (see below).
 @end itemize
 
 @item .
-Matches any character, including newline.
+Matches any single character, including newline.
 
 @item ^
 Matches the null string at beginning of line, i.e. what
@@ -698,12 +630,11 @@
 lines where @samp{#include} is the first thing on line---if
 there are spaces before, for example, the match fails.
 @code{^} acts as a special character only at the beginning
-of the regular expression or subexpression (that is,
-after @code{\(} or @code{\|}).  Portable scripts should avoid
-@code{^} at the beginning of a subexpression, though, as
-@acronym{POSIX} allows implementations that treat @code{^} as
-an ordinary character in that context.
-
+of the regular expression or subexpression (that is, after @code{\(}
+or @code{\|}).  Portable scripts should avoid @code{^} at the
+beginning of a subexpression, though, as @acronym{POSIX} allows
+implementations that treat @code{^} as an ordinary character in that
+context.
 
 @item $
 It is the same as @code{^}, but refers to end of line.
@@ -712,7 +643,6 @@
 or @code{\|}), and its use at the end of a subexpression is not
 portable.
 
-
 @item [@var{list}]
 @itemx [^@var{list}]
 Matches any single character in @var{list}: for example,
@@ -736,9 +666,9 @@
 @code{[:space:]} are special within @var{list} and represent collating
 symbols, equivalence classes, and character classes, respectively, and
 @code{[} is therefore special within @var{list} when it is followed by
-@code{.}, @code{=}, or @code{:}.  Also, when not in
-@env{POSIXLY_CORRECT} mode, special escapes like @code{\n} and
-@code{\t} are recognized within @var{list}.  @xref{Escapes}.
+@code{.}, @code{=}, or @code{:}.  Special escapes like @code{\n} and
+@code{\t} are recognized within @var{list}; this will change in a
+future version in @code{POSIXLY_CORRECT} mode.  @xref{Escapes}.
 
 @item @var{regexp1}\|@var{regexp2}
 @cindex @acronym{GNU} extensions, to basic regular expressions
@@ -775,9 +705,10 @@
 @end table
 
 @cindex Greedy regular expression matching
-Note that the regular expression matcher is greedy, i.e., matches
-are attempted from left to right and, if two or more matches are
-possible starting at the same character, it selects the longest.
+Note that the regular expression matcher is greedy, i.e., if
+two or more matches are detected, it selects the longest; if
+there are two or more selected with the same size, it
+selects the first in text.
 
 @noindent
 Examples:
@@ -806,7 +737,7 @@
 at least one character.
 
 @item ^main.*(.*)
-his matches a string starting with @samp{main},
+This matches a string starting with @samp{main},
 followed by an opening and closing
 parenthesis.  The @samp{n}, @samp{(} and @samp{)} need not
 be adjacent.
@@ -846,6 +777,23 @@
 
 
 
+@node Data Spaces
+@section Where @command{sed} Buffers Data
+
+@cindex Buffer spaces, pattern and hold
+@cindex Spaces, pattern and hold
+@cindex Pattern space, definition
+@cindex Hold space, definition
+@command{sed} maintains two data buffers: the active @emph{pattern} space,
+and the auxiliary @emph{hold} space.
+In ``normal'' operation, @command{sed} reads in one line from the
+input stream and places it in the pattern space.
+This pattern space is where text manipulations occur.
+The hold space is initially empty, but there are commands
+for moving data between the pattern and hold spaces.
+@c XXX FIXME: explain why this is useful/interesting to know.
+
+
 @node Common Commands
 @section Often-Used Commands
 
@@ -901,6 +849,21 @@
 This command is usually only used in conjunction with the @option{-n}
 command-line option.
 
+Note: some implementations of @command{sed}, such as this one, will
+double-print lines when auto-print is not disabled and the @code{p}
+command is given.
+Other implementations will only print the line once.
+@c *** CHECK CURRENT STANDARD. I THINK NOT DOUBLE-PRINTING IS HOW IT WORKS. ADR.
+Both ways conform with the @sc{posix} standard, and so neither
+way can be considered to be in error.
+
+@cindex Non-bugs, @code{p} command and @option{-n} flag
+@cindex Portability, @code{p} command and @option{-n} flag
+Portable @command{sed} scripts should thus avoid relying on either behavior;
+either use the @option{-n} option and explicitly print what you want,
+or avoid use of the @code{p} command (and also the @code{p} flag to the
+@code{s} command).
+
 @item n
 @findex n (next-line) command
 @cindex Next input line, replace pattern space with
@@ -949,7 +912,7 @@
 characters which reference the whole matched portion
 of the pattern space.
 @cindex @value{SSEDEXT}, case modifiers in @code{s} commands
-Finally, as a @value{SSED} extension, you can include a
+Finally (this is a @value{SSED} extension) you can include a
 special sequence made of a backslash and one of the letters
 @code{L}, @code{l}, @code{U}, @code{u}, or @code{E}.
 The meaning is as follows:
@@ -1128,8 +1091,9 @@
 
 @item a\
 @itemx @var{text}
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex a (append text lines) command
 @cindex Appending text after a line
@@ -1140,9 +1104,6 @@
 to be output at the end of the current cycle,
 or when the next input line is read.
 
-Escape sequences in @var{text} are processed, so you should
-use @code{\\} in @var{text} to print a single backslash.
-
 As a @acronym{GNU} extension, if between the @code{a} and the newline there is
 other than a whitespace-@code{\} sequence, then the text of this line,
 starting at the first non-whitespace character after the @code{a},
@@ -1152,8 +1113,9 @@
 
 @item i\
 @itemx @var{text}
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex i (insert text lines) command
 @cindex Inserting text before a line
@@ -1176,8 +1138,9 @@
 since the pattern space will have been deleted.
 
 @item =
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex = (print line number) command
 @cindex Printing line number
@@ -1202,8 +1165,9 @@
 parameter is a @value{SSED} extension.
 
 @item r @var{filename}
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex r (read file) command
 @cindex Read text from a file
@@ -1362,6 +1326,10 @@
 executed contains a @sc{nul} character.
 
 @item L @var{n}
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
+
 @findex L (fLow paragraphs) command
 @cindex Reformat pattern space
 @cindex Reformatting paragraphs
@@ -1370,11 +1338,8 @@
 This @value{SSED} extension fills and joins lines in pattern space
 to produce output lines of (at most) @var{n} characters, like
 @code{fmt} does; if @var{n} is omitted, the default as specified
-on the command line is used.  This command is considered a failed
-experiment and unless there is enough request (which seems unlikely)
-will be removed in future versions.
+on the command line is used.
 
-@ignore
 Blank lines, spaces between words, and indentation are
 preserved in the output; successive input lines with different
 indentation are not joined; tabs are expanded to 8 columns.
@@ -1386,7 +1351,6 @@
 
 @var{n} specifies the desired line-wrap length; if omitted,
 the default as specified on the command line is used.
-@end ignore
 
 @item Q [@var{exit-code}]
 This command only accepts a single address.
@@ -1450,8 +1414,8 @@
 requires, such as @code{4.0.5}.  The default is @code{4.0}
 because that is the first version that implemented this command.
 
-This command enables all @value{SSEDEXT} even if
-@env{POSIXLY_CORRECT} is set in the environment.
+This commands also enables @value{SSEDEXT} unconditionally, even
+if @env{POSIXLY_CORRECT} is set in the environment.
 
 @item W @var{filename}
 @findex W (write first line) command
@@ -1475,9 +1439,7 @@
 @cindex @code{POSIXLY_CORRECT} behavior, escapes
 This chapter introduces another kind of escape@footnote{All
 the escapes introduced here are @acronym{GNU}
-extensions, with the exception of @code{\n}.  In basic regular
-expression mode, setting @code{POSIXLY_CORRECT} disables them inside
-bracket expressions.}---that
+extensions, with the exception of @code{\n}.}---that
 is, escapes that are applied to a character or sequence of characters
 that ordinarily are taken literally, and that @command{sed} replaces
 with a special character.  This provides a way
@@ -1566,15 +1528,6 @@
 @item \'
 Matches only at the end of pattern space.  This is different
 from @code{$} in multi-line mode.
-
-@ifset PERL
-@item \G
-Match only at the start of pattern space or, when doing a global
-substitution using the @code{s///g} command and option, at
-the end-of-match position of the prior match.  For example,
-@samp{s/\Ga/Z/g} will change an initial run of @code{a}s to
-a run of @code{Z}s
-@end ifset
 @end table
 
 @node Examples
@@ -1747,14 +1700,14 @@
 @}
 
 apply_cmd='sh'
-finder='echo "$@@" | tr " " "\n"'
+finder='echo "$@" | tr " " "\n"'
 files_only=
 
 while :
 do
     case "$1" in 
         -n) apply_cmd='cat' ;;
-        -R) finder='find "$@@" -type f';;
+        -R) finder='find "$@" -type f';;
         -h) help ; exit 1 ;;
         *) break ;;
     esac
@@ -2605,6 +2558,23 @@
 Here are a few commonly reported bugs that are not bugs.
 
 @table @asis
+@item @samp{sed -n} and @samp{s/@var{regex}/@samp{replace}/p}
+@cindex Portability, @code{p} command and @option{-n} flag
+@cindex Non-bugs, @code{p} command and @option{-n} flag
+Some versions of @command{sed} ignore the @code{p} (print) option of an @code{s} command
+unless the @option{-n} command-line option has been specified.  Other versions
+always honor the @code{p} option.
+@c *** CHECK THE CURRENT STANDARD. ADR.
+Both approaches are allowed by @sc{posix}
+and @acronym{GNU} @command{sed}
+@ifset PERL
+(on which @value{SSED} is based)
+@end ifset
+is the
+better when you write complex scripts and also more intuitive, but
+portable scripts should be written to work correctly with either
+behavior.
+
 @item @code{N} command on the last line
 @cindex Portability, @code{N} command on the last line
 @cindex Non-bugs, @code{N} command on the last line
@@ -2640,7 +2610,7 @@
 scripts that rely on the traditional behavior, or to set
 the @code{POSIXLY_CORRECT} variable to a non-empty value.
 
-@item Regex syntax clashes (problems with backslashes)
+@item Regex syntax clashes
 @cindex @acronym{GNU} extensions, to basic regular expressions
 @cindex Non-bugs, regex syntax clashes
 @command{sed} uses the @sc{posix} basic regular expression syntax.  According to
@@ -2649,10 +2619,10 @@
 @code{\+}, @code{\?}, @code{\`}, @code{\'}, @code{\<},
 @code{\>}, @code{\b}, @code{\B}, @code{\w}, and @code{\W}.
 
-As in all @acronym{GNU} programs that use @sc{posix} basic regular
-expressions, @command{sed} interprets these escape sequences as special
-characters.  So, @code{x\+} matches one or more occurrences of @samp{x}.
-@code{abc\|def} matches either @samp{abc} or @samp{def}.
+As in all GNU programs that use @sc{posix} basic regular expressions, @command{sed}
+interprets these escape sequences as special characters.  So, @code{x\+}
+matches one or more occurrences of @samp{x}.  @code{abc\|def} matches
+either @samp{abc} or @samp{def}.
 
 This syntax may cause problems when running scripts written for other
 @command{sed}s.  Some @command{sed} programs have been written with the
@@ -2665,16 +2635,6 @@
 @end ifset
 @acronym{GNU} @command{sed}.
 
-On the other hand, some scripts use s|abc\|def||g to remove occurrences
-of @emph{either} @code{abc} or @code{def}.  While this worked until
-@command{sed} 4.0.x, newer versions interpret this as removing the
-string @code{abc|def}.  This is again undefined behavior according to
-@acronym{POSIX}, and this interpretation is arguably more robust: older
-@command{sed}s, for example, required that the regex matcher parsed
-@code{\/} as @code{/} in the common case of escaping a slash, which is
-again undefined behavior; the new behavior avoids this, and this is good
-because the regex matcher is only partially under our control.
-
 @cindex @acronym{GNU} extensions, special escapes
 In addition, this version of @command{sed} supports several escape characters
 (some of which are multi-character) to insert non-printable characters
@@ -2704,39 +2664,8 @@
 reason, @command{sed} does not let you use @option{-i} on a writeable file
 in a read-only directory (but unbelievably nobody reports that as a
 bug@dots{}).
-
-@item @code{0a} does not work (gives an error)
-There is no line 0.  0 is a special address that is only used to treat
-addresses like @code{0,/@var{RE}/} as active when the script starts: if
-you write @code{1,/abc/d} and the first line includes the word @samp{abc},
-then that match would be ignored because address ranges must span at least
-two lines (barring the end of the file); but what you probably wanted is
-to delete every line up to the first one including @samp{abc}, and this
-is obtained with @code{0,/abc/d}.
-
-@ifclear PERL
-@item @code{[a-z]} is case insensitive
-You are encountering problems with locales.  POSIX mandates that @code{[a-z]}
-uses the current locale's collation order -- in C parlance, that means using
-@code{strcoll(3)} instead of @code{strcmp(3)}.  Some locales have a
-case-insensitive collation order, others don't: one of those that have
-problems is Estonian.
-
-Another problem is that @code{[a-z]} tries to use collation symbols.
-This only happens if you are on the @acronym{GNU} system, using
-@acronym{GNU} libc's regular expression matcher instead of compiling the
-one supplied with @acronym{GNU} sed.  In a Danish locale, for example,
-the regular expression @code{^[a-z]$} matches the string @samp{aa},
-because this is a single collating symbol that comes after @samp{a}
-and before @samp{b}; @samp{ll} behaves similarly in Spanish
-locales, or @samp{ij} in Dutch locales.
-
-To work around these problems, which may cause bugs in shell scripts, set
-the @env{LC_COLLATE} and @env{LC_CTYPE} environment variables to @samp{C}.
-@end ifclear
 @end table
 
-
 @node Extended regexps
 @appendix Extended regular expressions
 @cindex Extended regular expressions, syntax
@@ -2919,8 +2848,9 @@
 as the backspace character (hex 08). Outside a character
 class it has a different meaning (see below).
 
-In addition, there are four additional escapes specifying
-generic character classes (like @code{\w} and @code{\W} do):
+In addition, there are two additional escapes specifying
+generic character classes (like @code{\s}, @code{\S}, @code{\w}
+and @code{\W} do):
 
 @cindex Perl-style regular expressions, character classes
 @table @samp
@@ -2933,8 +2863,9 @@
 
 In Perl mode, these character type sequences can appear both inside and
 outside character classes. Instead, in @sc{posix} mode these sequences
-(as well as @code{\w} and @code{\W}) are treated as two literal characters
-(a backslash and a letter) inside square brackets.
+(as well as @code{\s}, @code{\S}, @code{\w}, @code{\W}) are treated
+as two literal characters (a backslash and a letter) inside square
+brackets.
 
 Escaped sequences specifying assertions are also different in
 Perl mode.  An assertion specifies a condition that has to be met
@@ -3124,9 +3055,10 @@
 are non-special in character classes, but it does no harm
 if they are escaped.
 
-Perl 5.6 supports the @sc{posix} notation for character classes, which
+Perl 5.6 (not yet released at the time of writing) is going
+to support the @sc{posix} notation for character classes, which
 uses names enclosed by @code{[:} and @code{:]} within the enclosing
-square brackets, and @value{SSED} supports this notation as well.
+square brackets. @value{SSED} supports this notation.
 For example,
 
 @example
@@ -3876,6 +3808,11 @@
 sequences of non-digits cannot be broken, and failure happens
 quickly.
 
+If changed to
+
+@example
+@end example
+
 @node Conditional subpatterns
 @appendixsec Conditional subpatterns
 @cindex Perl-style regular expressions, conditional subpatterns
--- 4.1.4/doc/sed.texi
+++ 4.0.9/doc/sed.texi
@@ -38,14 +38,13 @@
 Copyright @copyright{} 1998, 1999, 2001, 2002, 2003, 2004 Free
 Software Foundation, Inc.
 
-This document is released under the terms of the @acronym{GNU} Free
-Documentation License as published by the Free Software Foundation;
-either version 1.1, or (at your option) any later version.
-
-You should have received a copy of the @acronym{GNU} Free Documentation
-License along with @value{SSED}; see the file @file{COPYING.DOC}.
-If not, write to the Free Software Foundation, 59 Temple Place - Suite
-330, Boston, MA 02111-1307, USA.
+This document is released under the terms of the GNU Free Documentation
+License as published by the Free Software Foundation; either version 1.1, or
+(at your option) any later version.
+
+You should have received a copy of the GNU Free Documentation License along
+with @value{SSED}; see the file @file{COPYING.DOC}.  If not, write to the Free
+Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 
 There are no Cover Texts and no Invariant Sections; this text, along
 with its equivalent in the printed manual, constitutes the Title Page.
@@ -99,9 +98,9 @@
 --- The detailed node listing ---
 
 sed Programs:
-* Execution Cycle::                 How @command{sed} works
 * Addresses::                       Selecting lines with @command{sed}
 * Regular Expressions::             Overview of regular expression syntax
+* Data Spaces::                     Where @command{sed} buffers data
 * Common Commands::                 Often used commands
 * The "s" Command::                 @command{sed}'s Swiss Army Knife
 * Other Commands::                  Less frequently used commands
@@ -168,35 +167,20 @@
 @node Invoking sed
 @chapter Invocation
 
-Normally @command{sed} is invoked like this:
-
-@example
-sed SCRIPT INPUTFILE...
-@end example
-
-The full format for invoking @command{sed} is:
-
-@example
-sed OPTIONS... [SCRIPT] [INPUTFILE...]
-@end example
-
-If you do not specify @var{INPUTFILE}, or if @var{INPUTFILE} is @file{-},
-@command{sed} filters the contents of the standard input.  The @var{script}
-is actually the first non-option parameter, which @command{sed} specially
-considers a script and not an input file if (and only if) none of the
-other @var{options} specifies a script to be executed, that is if neither
-of the @option{-e} and @option{-f} options is specified.
-
 @command{sed} may be invoked with the following command-line options:
 
 @table @code
-@item --version
+@item -V
+@itemx --version
+@opindex -V
 @opindex --version
 @cindex Version, printing
 Print out the version of @command{sed} that is being run and a copyright notice,
 then exit.
 
-@item --help
+@item -h
+@itemx --help
+@opindex -h
 @opindex --help
 @cindex Usage summary, printing
 Print a usage message briefly summarizing these command-line options
@@ -220,7 +204,7 @@
 @itemx --in-place[=@var{SUFFIX}]
 @opindex -i
 @opindex --in-place
-@cindex In-place editing, activating
+@cindex In-place editing
 @cindex @value{SSEDEXT}, in-place editing
 This option specifies that files are to be edited in-place.
 @value{SSED} does this by creating a temporary file and
@@ -230,29 +214,27 @@
 still write to the standard output by using the @code{w}
 @cindex @value{SSEDEXT}, @file{/dev/stdout} file
 or @code{W} commands together with the @file{/dev/stdout}
-special file}.
-
-This option implies @option{-s}.
+special file}
 
 When the end of the file is reached, the temporary file is
-renamed to the output file's original name.  The extension,
-if supplied, is used to modify the name of the old file
-before renaming the temporary file, thereby making a backup
-copy@footnote{Note that @value{SSED} creates the backup
-    file whether or not any output is actually changed.}).
-
-@cindex In-place editing, Perl-style backup file names
-This rule is followed: if the extension doesn't contain a @code{*},
-then it is appended to the end of the current filename as a
-suffix; if the extension does contain one or more @code{*}
-characters, then @emph{each} asterisk is replaced with the
-current filename.  This allows you to add a prefix to the
-backup file, instead of (or in addition to) a suffix, or
-even to place backup copies of the original files into another
-directory (provided the directory already exists).
+renamed to the output file's original name.
 
-If no extension is supplied, the original file is
-overwritten without making a backup.
+The extension, if supplied, is used to modify the name of
+the old file before renaming the temporary file (thereby
+making a backup copy@footnote{Note that @value{SSED}
+    creates the backup file whether
+    or not any output is actually changed.}) following
+this rule: if the extension doesn't contain a @code{*},
+then it is appended to the end of the current filename
+as a suffix; if the extension does contain one or more
+@code{*} characters, then @emph{each} asterisk is
+replaced with the current filename.  This allows
+you to add a prefix to the backup file, instead of (or in
+addition to) a suffix, or even to place backup copies of
+the original files into another directory (provided the
+directory already exists).
+
+This option implies @option{-s}.
 
 @item -l @var{N}
 @itemx --line-length=@var{N}
@@ -263,21 +245,6 @@
 A length of 0 (zero) means to never wrap long lines.  If
 not specified, it is taken to be 70.
 
-@item --posix
-@cindex @value{SSEDEXT}, disabling
-@value{SSED} includes several extensions to @acronym{POSIX}
-sed.  In order to simplify writing portable scripts, this
-option disables all the extensions that this manual documents,
-including additional commands.
-@cindex @code{POSIXLY_CORRECT} behavior, enabling
-Most of the extensions accept @command{sed} programs that
-are outside the syntax mandated by @acronym{POSIX}, but some
-of them (such as the behavior of the @command{N} command
-described in @pxref{Reporting Bugs}) actually violate the
-standard.  If you want to disable only the latter kind of
-extension, you can set the @code{POSIXLY_CORRECT} variable
-to a non-empty value.
-
 @item -r
 @itemx --regexp-extended
 @opindex -r
@@ -378,9 +345,9 @@
 and any additional command-specific code.
 
 @menu
-* Execution Cycle::          How @command{sed} works
 * Addresses::                Selecting lines with @command{sed}
 * Regular Expressions::      Overview of regular expression syntax
+* Data Spaces::              Where @command{sed} buffers data
 * Common Commands::          Often used commands
 * The "s" Command::          @command{sed}'s Swiss Army Knife
 * Other Commands::           Less frequently used commands
@@ -390,40 +357,6 @@
 @end menu
 
 
-@node Execution Cycle
-@section How @command{sed} Works
-
-@cindex Buffer spaces, pattern and hold
-@cindex Spaces, pattern and hold
-@cindex Pattern space, definition
-@cindex Hold space, definition
-@command{sed} maintains two data buffers: the active @emph{pattern} space,
-and the auxiliary @emph{hold} space. Both are initially empty.
-
-@command{sed} operates by performing the following cycle on each
-lines of input: first, @command{sed} reads one line from the input
-stream, removes any trailing newline, and places it in the pattern space.
-Then commands are executed; each command can have an address associated
-to it: addresses are a kind of condition code, and a command is only
-executed if the condition is verified before the command is to be
-executed.
-
-When the end of the script is reached, unless the @option{-n} option
-is in use, the contents of pattern space are printed out to the output
-stream, adding back the trailing newline if it was removed.@footnote{Actually,
-  if @command{sed} prints a line without the terminating newline, it will
-  nevertheless print the missing newline as soon as more text is sent to
-  the same output stream, which gives the ``least expected surprise''
-  even though it does not make commands like @samp{sed -n p} exactly
-  identical to @command{cat}.} Then the next cycle starts for the next
-input line.
-
-Unless special commands (like @samp{D}) are used, the pattern space is
-deleted between two cycles. The hold space, on the other hand, keeps
-its data between cycles (see commands @samp{h}, @samp{H}, @samp{x},
-@samp{g}, @samp{G} to move data between both buffers).
-
-
 @node Addresses
 @section Selecting lines with @command{sed}
 @cindex Addresses, in @command{sed} scripts
@@ -468,12 +401,19 @@
 each must be escaped by a backslash (@code{\}).
 
 @cindex empty regular expression
+@cindex @code{POSIXLY_CORRECT} behavior, empty regular expression
+@cindex @acronym{GNU} extensions, modifiers and the empty regular expression
 @cindex @value{SSEDEXT}, modifiers and the empty regular expression
-The empty regular expression @samp{//} repeats the last regular
-expression match (the same holds if the empty regular expression is
-passed to the @code{s} command).  Note that modifiers to regular expressions
-are evaluated when the regular expression is compiled, thus it is invalid to
-specify them together with the empty regular expression.
+Unless @code{POSIXLY_CORRECT} is set, the empty regular expression
+@samp{//} repeats the last regular expression match (the same holds
+if the empty regular expression is passed to the @code{s} command).
+Note that modifiers to regular expressions are evaluated
+when the regular expression is compiled, thus it is illegal to specify
+them together with the empty regular expression.
+@c *** CHECK CURRENT POSIX, I'M NOT SURE THIS IS STILL TRUE. ADR.
+If @code{POSIXLY_CORRECT} is set, instead, @samp{//} is the null match:
+this behavior is mandated by @sc{posix}, but it would break too many legacy
+@command{sed} scripts to blithely change @value{SSED}'s default behavior.
 
 @item \%@var{regexp}%
 (The @code{%} may be replaced by any other single character.)
@@ -548,20 +488,22 @@
 
 @cindex Range of lines
 @cindex Several lines, selecting
+@cindex @acronym{GNU} extensions, @code{0} address
 An address range can be specified by specifying two addresses
-separated by a comma (@code{,}).  An address range matches lines
-starting from where the first address matches, and continues
-until the second address matches (inclusively).
-
+separated by a comma (@code{,}).
+An address range matches lines starting from where the first
+address matches, and continues until the second address matches
+(inclusively).
 If the second address is a @var{regexp}, then checking for the
 ending match will start with the line @emph{following} the
-line which matched the first address: a range will always
-span at least two lines (except of course if the input stream
-ends).
+line which matched the first address.  As a @acronym{GNU} extension, a
+line number of @code{0} can be used in an address specification
+like @samp{0,/@var{regexp}/} so that @var{regexp} will be
+matched in the first input line too.
 
 If the second address is a @var{number} less than (or equal to)
-the line matching the first address, then only the one line is
-matched.
+the line matching the first address,
+then only the one line is matched.
 
 @cindex Special addressing forms
 @cindex Range with start address of zero
@@ -569,27 +511,18 @@
 @cindex @var{addr1},+N
 @cindex @var{addr1},~N
 @cindex @acronym{GNU} extensions, special two-address forms
-@cindex @acronym{GNU} extensions, @code{0} address
 @cindex @acronym{GNU} extensions, 0,@var{addr2} addressing
 @cindex @acronym{GNU} extensions, @var{addr1},+@var{N} addressing
 @cindex @acronym{GNU} extensions, @var{addr1},~@var{N} addressing
-@value{SSED} also supports some special two-address forms; all these
-are @acronym{GNU} extensions:
+@value{SSED} also supports some special two-address forms:
 @table @code
-@item 0,/@var{regexp}/
-A line number of @code{0} can be used in an address specification like
-@code{0,/@var{regexp}/} so that @command{sed} will try to match
-@var{regexp} in the first input line too.  In other words,
-@code{0,/@var{regexp}/} is similar to @code{1,/@var{regexp}/},
-except that if @var{addr2} matches the very first line of input the
-@code{0,/@var{regexp}/} form will consider it to end the range, whereas
-the @code{1,/@var{regexp}/} form will match the beginning of its range and
-hence make the range span up to the @emph{second} occurrence of the
-regular expression.
-
-Note that this is the only place where the @code{0} address makes
-sense; there is no 0-th line and commands which are given the @code{0}
-address in any other way will give an error.
+@item 0,@var{addr2}
+Start out in ``matched first address'' state,
+until @var{addr2} is found.
+This is similar to @samp{1,@var{addr2}},
+except that if @var{addr2} matches the very first line of input
+the 0,@var{addr2} form will be at the end of its range,
+whereas the 1,@var{addr2} form will still be at the beginning of its range.
 
 @item @var{addr1},+@var{N}
 Matches @var{addr1} and the @var{N} lines following @var{addr1}.
@@ -675,22 +608,21 @@
 
 @itemize @bullet
 @item
-@cindex @acronym{GNU} extensions, to basic regular expressions
 Apply postfix operators, like @code{\(abcd\)*}:
 this will search for zero or more whole sequences 
 of @samp{abcd}, while @code{abcd*} would search
 for @samp{abc} followed by zero or more occurrences
-of @samp{d}.  Note that support for @code{\(abcd\)*} is
-required by @acronym{POSIX} 1003.1-2001, but many non-@acronym{GNU}
+of @samp{d}.  Note that support for @code{\(abcd\)*} is required by
+@acronym{POSIX} 1003.1-2001, but many non-@acronym{GNU}
 implementations do not support it and hence it is not universally
-portable.         
+portable.
 
 @item
 Use back references (see below).
 @end itemize
 
 @item .
-Matches any character, including newline.
+Matches any single character, including newline.
 
 @item ^
 Matches the null string at beginning of line, i.e. what
@@ -699,12 +631,11 @@
 lines where @samp{#include} is the first thing on line---if
 there are spaces before, for example, the match fails.
 @code{^} acts as a special character only at the beginning
-of the regular expression or subexpression (that is,
-after @code{\(} or @code{\|}).  Portable scripts should avoid
-@code{^} at the beginning of a subexpression, though, as
-@acronym{POSIX} allows implementations that treat @code{^} as
-an ordinary character in that context.
-
+of the regular expression or subexpression (that is, after @code{\(}
+or @code{\|}).  Portable scripts should avoid @code{^} at the
+beginning of a subexpression, though, as @acronym{POSIX} allows
+implementations that treat @code{^} as an ordinary character in that
+context.
 
 @item $
 It is the same as @code{^}, but refers to end of line.
@@ -713,7 +644,6 @@
 or @code{\|}), and its use at the end of a subexpression is not
 portable.
 
-
 @item [@var{list}]
 @itemx [^@var{list}]
 Matches any single character in @var{list}: for example,
@@ -737,9 +667,9 @@
 @code{[:space:]} are special within @var{list} and represent collating
 symbols, equivalence classes, and character classes, respectively, and
 @code{[} is therefore special within @var{list} when it is followed by
-@code{.}, @code{=}, or @code{:}.  Also, when not in
-@env{POSIXLY_CORRECT} mode, special escapes like @code{\n} and
-@code{\t} are recognized within @var{list}.  @xref{Escapes}.
+@code{.}, @code{=}, or @code{:}.  Special escapes like @code{\n} and
+@code{\t} are recognized within @var{list}; this will change in a
+future version in @code{POSIXLY_CORRECT} mode.  @xref{Escapes}.
 
 @item @var{regexp1}\|@var{regexp2}
 @cindex @acronym{GNU} extensions, to basic regular expressions
@@ -776,9 +706,10 @@
 @end table
 
 @cindex Greedy regular expression matching
-Note that the regular expression matcher is greedy, i.e., matches
-are attempted from left to right and, if two or more matches are
-possible starting at the same character, it selects the longest.
+Note that the regular expression matcher is greedy, i.e., if
+two or more matches are detected, it selects the longest; if
+there are two or more selected with the same size, it
+selects the first in text.
 
 @noindent
 Examples:
@@ -807,7 +738,7 @@
 at least one character.
 
 @item ^main.*(.*)
-his matches a string starting with @samp{main},
+This matches a string starting with @samp{main},
 followed by an opening and closing
 parenthesis.  The @samp{n}, @samp{(} and @samp{)} need not
 be adjacent.
@@ -847,6 +778,23 @@
 
 
 
+@node Data Spaces
+@section Where @command{sed} Buffers Data
+
+@cindex Buffer spaces, pattern and hold
+@cindex Spaces, pattern and hold
+@cindex Pattern space, definition
+@cindex Hold space, definition
+@command{sed} maintains two data buffers: the active @emph{pattern} space,
+and the auxiliary @emph{hold} space.
+In ``normal'' operation, @command{sed} reads in one line from the
+input stream and places it in the pattern space.
+This pattern space is where text manipulations occur.
+The hold space is initially empty, but there are commands
+for moving data between the pattern and hold spaces.
+@c XXX FIXME: explain why this is useful/interesting to know.
+
+
 @node Common Commands
 @section Often-Used Commands
 
@@ -902,6 +850,21 @@
 This command is usually only used in conjunction with the @option{-n}
 command-line option.
 
+Note: some implementations of @command{sed}, such as this one, will
+double-print lines when auto-print is not disabled and the @code{p}
+command is given.
+Other implementations will only print the line once.
+@c *** CHECK CURRENT STANDARD. I THINK NOT DOUBLE-PRINTING IS HOW IT WORKS. ADR.
+Both ways conform with the @sc{posix} standard, and so neither
+way can be considered to be in error.
+
+@cindex Non-bugs, @code{p} command and @option{-n} flag
+@cindex Portability, @code{p} command and @option{-n} flag
+Portable @command{sed} scripts should thus avoid relying on either behavior;
+either use the @option{-n} option and explicitly print what you want,
+or avoid use of the @code{p} command (and also the @code{p} flag to the
+@code{s} command).
+
 @item n
 @findex n (next-line) command
 @cindex Next input line, replace pattern space with
@@ -950,7 +913,7 @@
 characters which reference the whole matched portion
 of the pattern space.
 @cindex @value{SSEDEXT}, case modifiers in @code{s} commands
-Finally, as a @value{SSED} extension, you can include a
+Finally (this is a @value{SSED} extension) you can include a
 special sequence made of a backslash and one of the letters
 @code{L}, @code{l}, @code{U}, @code{u}, or @code{E}.
 The meaning is as follows:
@@ -1129,8 +1092,9 @@
 
 @item a\
 @itemx @var{text}
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex a (append text lines) command
 @cindex Appending text after a line
@@ -1141,9 +1105,6 @@
 to be output at the end of the current cycle,
 or when the next input line is read.
 
-Escape sequences in @var{text} are processed, so you should
-use @code{\\} in @var{text} to print a single backslash.
-
 As a @acronym{GNU} extension, if between the @code{a} and the newline there is
 other than a whitespace-@code{\} sequence, then the text of this line,
 starting at the first non-whitespace character after the @code{a},
@@ -1153,8 +1114,9 @@
 
 @item i\
 @itemx @var{text}
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex i (insert text lines) command
 @cindex Inserting text before a line
@@ -1177,8 +1139,9 @@
 since the pattern space will have been deleted.
 
 @item =
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex = (print line number) command
 @cindex Printing line number
@@ -1203,8 +1166,9 @@
 parameter is a @value{SSED} extension.
 
 @item r @var{filename}
-@cindex @value{SSEDEXT}, two addresses supported by most commands
-As a @acronym{GNU} extension, this command accepts two addresses.
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
 
 @findex r (read file) command
 @cindex Read text from a file
@@ -1363,6 +1327,10 @@
 executed contains a @sc{nul} character.
 
 @item L @var{n}
+@cindex @code{POSIXLY_CORRECT} behavior, two addresses
+In @code{POSIXLY_CORRECT} mode, this command only accepts a single
+address.
+
 @findex L (fLow paragraphs) command
 @cindex Reformat pattern space
 @cindex Reformatting paragraphs
@@ -1371,11 +1339,8 @@
 This @value{SSED} extension fills and joins lines in pattern space
 to produce output lines of (at most) @var{n} characters, like
 @code{fmt} does; if @var{n} is omitted, the default as specified
-on the command line is used.  This command is considered a failed
-experiment and unless there is enough request (which seems unlikely)
-will be removed in future versions.
+on the command line is used.
 
-@ignore
 Blank lines, spaces between words, and indentation are
 preserved in the output; successive input lines with different
 indentation are not joined; tabs are expanded to 8 columns.
@@ -1387,7 +1352,6 @@
 
 @var{n} specifies the desired line-wrap length; if omitted,
 the default as specified on the command line is used.
-@end ignore
 
 @item Q [@var{exit-code}]
 This command only accepts a single address.
@@ -1451,8 +1415,8 @@
 requires, such as @code{4.0.5}.  The default is @code{4.0}
 because that is the first version that implemented this command.
 
-This command enables all @value{SSEDEXT} even if
-@env{POSIXLY_CORRECT} is set in the environment.
+This commands also enables @value{SSEDEXT} unconditionally, even
+if @env{POSIXLY_CORRECT} is set in the environment.
 
 @item W @var{filename}
 @findex W (write first line) command
@@ -1476,9 +1440,7 @@
 @cindex @code{POSIXLY_CORRECT} behavior, escapes
 This chapter introduces another kind of escape@footnote{All
 the escapes introduced here are @acronym{GNU}
-extensions, with the exception of @code{\n}.  In basic regular
-expression mode, setting @code{POSIXLY_CORRECT} disables them inside
-bracket expressions.}---that
+extensions, with the exception of @code{\n}.}---that
 is, escapes that are applied to a character or sequence of characters
 that ordinarily are taken literally, and that @command{sed} replaces
 with a special character.  This provides a way
@@ -1567,15 +1529,6 @@
 @item \'
 Matches only at the end of pattern space.  This is different
 from @code{$} in multi-line mode.
-
-@ifset PERL
-@item \G
-Match only at the start of pattern space or, when doing a global
-substitution using the @code{s///g} command and option, at
-the end-of-match position of the prior match.  For example,
-@samp{s/\Ga/Z/g} will change an initial run of @code{a}s to
-a run of @code{Z}s
-@end ifset
 @end table
 
 @node Examples
@@ -1777,7 +1730,7 @@
 
 @group
 apply_cmd='sh'
-finder='echo "$@@" | tr " " "\n"'
+finder='echo "$@" | tr " " "\n"'
 files_only=
 @end group
 
@@ -1786,7 +1739,7 @@
 do
     case "$1" in 
         -n) apply_cmd='cat' ;;
-        -R) finder='find "$@@" -type f';;
+        -R) finder='find "$@" -type f';;
         -h) help ; exit 1 ;;
         *) break ;;
     esac
@@ -2772,6 +2725,23 @@
 Here are a few commonly reported bugs that are not bugs.
 
 @table @asis
+@item @samp{sed -n} and @samp{s/@var{regex}/@samp{replace}/p}
+@cindex Portability, @code{p} command and @option{-n} flag
+@cindex Non-bugs, @code{p} command and @option{-n} flag
+Some versions of @command{sed} ignore the @code{p} (print) option of an @code{s} command
+unless the @option{-n} command-line option has been specified.  Other versions
+always honor the @code{p} option.
+@c *** CHECK THE CURRENT STANDARD. ADR.
+Both approaches are allowed by @sc{posix}
+and @acronym{GNU} @command{sed}
+@ifset PERL
+(on which @value{SSED} is based)
+@end ifset
+is the
+better when you write complex scripts and also more intuitive, but
+portable scripts should be written to work correctly with either
+behavior.
+
 @item @code{N} command on the last line
 @cindex Portability, @code{N} command on the last line
 @cindex Non-bugs, @code{N} command on the last line
@@ -2807,7 +2777,7 @@
 scripts that rely on the traditional behavior, or to set
 the @code{POSIXLY_CORRECT} variable to a non-empty value.
 
-@item Regex syntax clashes (problems with backslashes)
+@item Regex syntax clashes
 @cindex @acronym{GNU} extensions, to basic regular expressions
 @cindex Non-bugs, regex syntax clashes
 @command{sed} uses the @sc{posix} basic regular expression syntax.  According to
@@ -2816,10 +2786,10 @@
 @code{\+}, @code{\?}, @code{\`}, @code{\'}, @code{\<},
 @code{\>}, @code{\b}, @code{\B}, @code{\w}, and @code{\W}.
 
-As in all @acronym{GNU} programs that use @sc{posix} basic regular
-expressions, @command{sed} interprets these escape sequences as special
-characters.  So, @code{x\+} matches one or more occurrences of @samp{x}.
-@code{abc\|def} matches either @samp{abc} or @samp{def}.
+As in all GNU programs that use @sc{posix} basic regular expressions, @command{sed}
+interprets these escape sequences as special characters.  So, @code{x\+}
+matches one or more occurrences of @samp{x}.  @code{abc\|def} matches
+either @samp{abc} or @samp{def}.
 
 This syntax may cause problems when running scripts written for other
 @command{sed}s.  Some @command{sed} programs have been written with the
@@ -2832,16 +2802,6 @@
 @end ifset
 @acronym{GNU} @command{sed}.
 
-On the other hand, some scripts use s|abc\|def||g to remove occurrences
-of @emph{either} @code{abc} or @code{def}.  While this worked until
-@command{sed} 4.0.x, newer versions interpret this as removing the
-string @code{abc|def}.  This is again undefined behavior according to
-@acronym{POSIX}, and this interpretation is arguably more robust: older
-@command{sed}s, for example, required that the regex matcher parsed
-@code{\/} as @code{/} in the common case of escaping a slash, which is
-again undefined behavior; the new behavior avoids this, and this is good
-because the regex matcher is only partially under our control.
-
 @cindex @acronym{GNU} extensions, special escapes
 In addition, this version of @command{sed} supports several escape characters
 (some of which are multi-character) to insert non-printable characters
@@ -2871,39 +2831,8 @@
 reason, @command{sed} does not let you use @option{-i} on a writeable file
 in a read-only directory (but unbelievably nobody reports that as a
 bug@dots{}).
-
-@item @code{0a} does not work (gives an error)
-There is no line 0.  0 is a special address that is only used to treat
-addresses like @code{0,/@var{RE}/} as active when the script starts: if
-you write @code{1,/abc/d} and the first line includes the word @samp{abc},
-then that match would be ignored because address ranges must span at least
-two lines (barring the end of the file); but what you probably wanted is
-to delete every line up to the first one including @samp{abc}, and this
-is obtained with @code{0,/abc/d}.
-
-@ifclear PERL
-@item @code{[a-z]} is case insensitive
-You are encountering problems with locales.  POSIX mandates that @code{[a-z]}
-uses the current locale's collation order -- in C parlance, that means using
-@code{strcoll(3)} instead of @code{strcmp(3)}.  Some locales have a
-case-insensitive collation order, others don't: one of those that have
-problems is Estonian.
-
-Another problem is that @code{[a-z]} tries to use collation symbols.
-This only happens if you are on the @acronym{GNU} system, using
-@acronym{GNU} libc's regular expression matcher instead of compiling the
-one supplied with @acronym{GNU} sed.  In a Danish locale, for example,
-the regular expression @code{^[a-z]$} matches the string @samp{aa},
-because this is a single collating symbol that comes after @samp{a}
-and before @samp{b}; @samp{ll} behaves similarly in Spanish
-locales, or @samp{ij} in Dutch locales.
-
-To work around these problems, which may cause bugs in shell scripts, set
-the @env{LC_COLLATE} and @env{LC_CTYPE} environment variables to @samp{C}.
-@end ifclear
 @end table
 
-
 @node Extended regexps
 @appendix Extended regular expressions
 @cindex Extended regular expressions, syntax
@@ -3086,8 +3015,9 @@
 as the backspace character (hex 08). Outside a character
 class it has a different meaning (see below).
 
-In addition, there are four additional escapes specifying
-generic character classes (like @code{\w} and @code{\W} do):
+In addition, there are two additional escapes specifying
+generic character classes (like @code{\s}, @code{\S}, @code{\w}
+and @code{\W} do):
 
 @cindex Perl-style regular expressions, character classes
 @table @samp
@@ -3100,8 +3030,9 @@
 
 In Perl mode, these character type sequences can appear both inside and
 outside character classes. Instead, in @sc{posix} mode these sequences
-(as well as @code{\w} and @code{\W}) are treated as two literal characters
-(a backslash and a letter) inside square brackets.
+(as well as @code{\s}, @code{\S}, @code{\w}, @code{\W}) are treated
+as two literal characters (a backslash and a letter) inside square
+brackets.
 
 Escaped sequences specifying assertions are also different in
 Perl mode.  An assertion specifies a condition that has to be met
@@ -3291,9 +3222,10 @@
 are non-special in character classes, but it does no harm
 if they are escaped.
 
-Perl 5.6 supports the @sc{posix} notation for character classes, which
+Perl 5.6 (not yet released at the time of writing) is going
+to support the @sc{posix} notation for character classes, which
 uses names enclosed by @code{[:} and @code{:]} within the enclosing
-square brackets, and @value{SSED} supports this notation as well.
+square brackets. @value{SSED} supports this notation.
 For example,
 
 @example
@@ -4043,6 +3975,11 @@
 sequences of non-digits cannot be broken, and failure happens
 quickly.
 
+If changed to
+
+@example
+@end example
+
 @node Conditional subpatterns
 @appendixsec Conditional subpatterns
 @cindex Perl-style regular expressions, conditional subpatterns
--- 4.1.4/lib/Makefile.am
+++ 4.0.9/lib/Makefile.am
@@ -1,16 +1,16 @@
 ## Process this file with automake to produce Makefile.in
 noinst_LIBRARIES = libsed.a
 noinst_HEADERS = getopt.h utils.h obstack.h regex_.h regex_internal.h \
-	strverscmp.h stdbool_.h
+	strverscmp.h
 
 libsed_a_SOURCES = getopt1.c getopt.c utils.c
 
 EXTRA_DIST = memmove.c strerror.c regcomp.c regexec.c regex_internal.c
 
 AM_CPPFLAGS = -I$(top_srcdir)/lib -I$(top_srcdir)/intl -I$(top_srcdir) \
-	-I$(top_builddir)/lib -I$(top_builddir)/intl
+	-I$(top_builddir)/lib
 
 libsed_a_LIBADD = @LIBOBJS@ @ALLOCA@
 libsed_a_DEPENDENCIES = $(libsed_a_LIBADD)
 
-DISTCLEANFILES = regex.h stdbool.h
+DISTCLEANFILES = regex.h
--- 4.1.4/lib/obstack.h
+++ 4.0.9/lib/obstack.h
@@ -1,22 +1,23 @@
 /* obstack.h - object stack macros
    Copyright (C) 1988,89,90,91,92,93,94,96,97,98,99 Free Software Foundation, Inc.
+
    This file is part of the GNU C Library.  Its master source is NOT part of
    the C library, however.  The master source lives in /gd/gnu/lib.
 
    The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
+   modify it under the terms of the GNU Library General Public License as
+   published by the Free Software Foundation; either version 2 of the
+   License, or (at your option) any later version.
 
    The GNU C Library is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
+   Library General Public License for more details.
 
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
+   You should have received a copy of the GNU Library General Public
+   License along with the GNU C Library; see the file COPYING.LIB.  If not,
+   write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+   Boston, MA 02111-1307, USA.  */
 
 /* Summary:
 
@@ -106,6 +107,10 @@
 #ifndef _OBSTACK_H
 #define _OBSTACK_H 1
 
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -139,8 +144,12 @@
 # endif
 #endif
 
-#if defined _LIBC || defined HAVE_STRING_H
+#if defined _LIBC || defined HAVE_STRING_H || defined HAVE_STRINGS_H
+# ifdef HAVE_STRINGS_H
+#  include <strings.h>
+# else
 # include <string.h>
+# endif
 # define _obstack_memcpy(To, From, N) memcpy ((To), (From), (N))
 #else
 # ifdef memcpy
@@ -423,7 +432,7 @@
 ({ struct obstack *__o = (OBSTACK);					\
    if (__o->next_free + sizeof (void *) > __o->chunk_limit)		\
      _obstack_newchunk (__o, sizeof (void *));				\
-   ((*((void **)__o->next_free) = (datum)), (__o->next_free += sizeof (void *)));				\
+   *((void **)__o->next_free)++ = (datum);				\
    (void) 0; })
 
 # define obstack_int_grow(OBSTACK,datum)				\
@@ -431,14 +440,14 @@
 ({ struct obstack *__o = (OBSTACK);					\
    if (__o->next_free + sizeof (int) > __o->chunk_limit)		\
      _obstack_newchunk (__o, sizeof (int));				\
-   ((*((int *)__o->next_free) = (datum)), (__o->next_free += sizeof (int )));				\
+   *((int *)__o->next_free)++ = (datum);				\
    (void) 0; })
 
 # define obstack_ptr_grow_fast(h,aptr)					\
-  (((*((void **) (h)->next_free) = (aptr)), ( (h)->next_free += sizeof (void *))))
+  (*((void **) (h)->next_free)++ = (aptr))
 
 # define obstack_int_grow_fast(h,aint)					\
-  (((*((int *) (h)->next_free) = (aint)), ( (h)->next_free += sizeof (int ))))
+  (*((int *) (h)->next_free)++ = (aint))
 
 # define obstack_blank(OBSTACK,length)					\
 __extension__								\
@@ -546,10 +555,10 @@
   (*((int *) (((h)->next_free+=sizeof(int))-sizeof(int))) = (datum)))
 
 # define obstack_ptr_grow_fast(h,aptr)					\
-  (((*((const char **) (h)->next_free) = (aptr)), ( (h)->next_free += sizeof (const char *))))
+  (*((const char **) (h)->next_free)++ = (aptr))
 
 # define obstack_int_grow_fast(h,aint)					\
-  (((*((int *) (h)->next_free) = (aint)), ( (h)->next_free += sizeof (int ))))
+  (*((int *) (h)->next_free)++ = (aint))
 
 # define obstack_blank(h,length)					\
 ( (h)->temp = (length),							\
--- 4.1.4/lib/regcomp.c
+++ 4.0.9/lib/regcomp.c
@@ -1,5 +1,5 @@
 /* Extended regular expression matching and search library.
-   Copyright (C) 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003, 2004 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Isamu Hasegawa <isamu@yamato.ibm.com>.
 
@@ -33,21 +33,11 @@
 #ifdef RE_ENABLE_I18N
 static void optimize_utf8 (re_dfa_t *dfa);
 #endif
-static reg_errcode_t analyze (regex_t *preg);
-static reg_errcode_t create_initial_state (re_dfa_t *dfa);
-static reg_errcode_t preorder (bin_tree_t *root,
-			       reg_errcode_t (fn (void *, bin_tree_t *)),
-			       void *extra);
-static reg_errcode_t postorder (bin_tree_t *root,
-				reg_errcode_t (fn (void *, bin_tree_t *)),
-				void *extra);
-static reg_errcode_t optimize_subexps (void *extra, bin_tree_t *node);
-static reg_errcode_t lower_subexps (void *extra, bin_tree_t *node);
-static bin_tree_t *lower_subexp (reg_errcode_t *err, regex_t *preg,
-				 bin_tree_t *node);
-static reg_errcode_t calc_first (void *extra, bin_tree_t *node);
-static reg_errcode_t calc_next (void *extra, bin_tree_t *node);
-static reg_errcode_t link_nfa_nodes (void *extra, bin_tree_t *node);
+static reg_errcode_t analyze (re_dfa_t *dfa);
+static reg_errcode_t analyze_tree (re_dfa_t *dfa, bin_tree_t *node);
+static void calc_first (re_dfa_t *dfa, bin_tree_t *node);
+static void calc_next (re_dfa_t *dfa, bin_tree_t *node);
+static void calc_epsdest (re_dfa_t *dfa, bin_tree_t *node);
 static reg_errcode_t duplicate_node_closure (re_dfa_t *dfa, int top_org_node,
 					     int top_clone_node, int root_node,
 					     unsigned int constraint);
@@ -58,7 +48,7 @@
 static reg_errcode_t calc_eclosure (re_dfa_t *dfa);
 static reg_errcode_t calc_eclosure_iter (re_node_set *new_set, re_dfa_t *dfa,
 					 int node, int root);
-static reg_errcode_t calc_inveclosure (re_dfa_t *dfa);
+static void calc_inveclosure (re_dfa_t *dfa);
 static int fetch_number (re_string_t *input, re_token_t *token,
 			 reg_syntax_t syntax);
 static void fetch_token (re_token_t *result, re_string_t *input,
@@ -119,7 +109,7 @@
 					re_charset_t *mbcset,
 					int *equiv_class_alloc,
 					const unsigned char *name);
-static reg_errcode_t build_charclass (unsigned RE_TRANSLATE_TYPE trans,
+static reg_errcode_t build_charclass (RE_TRANSLATE_TYPE trans,
 				      re_bitset_ptr_t sbcset,
 				      re_charset_t *mbcset,
 				      int *char_class_alloc,
@@ -128,26 +118,25 @@
 #else  /* not RE_ENABLE_I18N */
 static reg_errcode_t build_equiv_class (re_bitset_ptr_t sbcset,
 					const unsigned char *name);
-static reg_errcode_t build_charclass (unsigned RE_TRANSLATE_TYPE trans,
+static reg_errcode_t build_charclass (RE_TRANSLATE_TYPE trans,
 				      re_bitset_ptr_t sbcset,
 				      const unsigned char *class_name,
 				      reg_syntax_t syntax);
 #endif /* not RE_ENABLE_I18N */
-static bin_tree_t *build_charclass_op (re_dfa_t *dfa,
-				       unsigned RE_TRANSLATE_TYPE trans,
+static bin_tree_t *build_charclass_op (re_dfa_t *dfa, RE_TRANSLATE_TYPE trans,
 				       const unsigned char *class_name,
-				       const unsigned char *extra,
-				       int non_match, reg_errcode_t *err);
+				       const unsigned char *extra, int not,
+				       reg_errcode_t *err);
 static bin_tree_t *create_tree (re_dfa_t *dfa,
 				bin_tree_t *left, bin_tree_t *right,
-				re_token_type_t type);
-static bin_tree_t *create_token_tree (re_dfa_t *dfa,
-				      bin_tree_t *left, bin_tree_t *right,
-				      const re_token_t *token);
+				re_token_type_t type, int index);
+static bin_tree_t *re_dfa_add_tree_node (re_dfa_t *dfa,
+					 bin_tree_t *left, bin_tree_t *right,
+					 const re_token_t *token)
+  __attribute ((noinline));
 static bin_tree_t *duplicate_tree (const bin_tree_t *src, re_dfa_t *dfa);
-static void free_token (re_token_t *node);
-static reg_errcode_t free_tree (void *extra, bin_tree_t *node);
-static reg_errcode_t mark_opt_subexp (void *extra, bin_tree_t *node);
+static void mark_opt_subexp (const bin_tree_t *src, re_dfa_t *dfa);
+static void mark_opt_subexp_iter (const bin_tree_t *src, re_dfa_t *dfa, int idx);
 
 /* This table gives an error message for each of the error codes listed
    in regex.h.  Obviously the order here has to be same as there.
@@ -248,8 +237,8 @@
 
   /* And GNU code determines whether or not to get register information
      by passing null for the REGS argument to re_match, etc., not by
-     setting no_sub, unless RE_NO_SUB is set.  */
-  bufp->no_sub = !!(re_syntax_options & RE_NO_SUB);
+     setting no_sub.  */
+  bufp->no_sub = 0;
 
   /* Match anchors at newline.  */
   bufp->newline_anchor = 1;
@@ -513,7 +502,7 @@
   /* We have already checked preg->fastmap != NULL.  */
   if (BE (ret == REG_NOERROR, 1))
     /* Compute the fastmap now, since regexec cannot modify the pattern
-       buffer.  This function never fails in this implementation.  */
+       buffer.  This function nevers fails in this implementation.  */
     (void) re_compile_fastmap (preg);
   else
     {
@@ -576,31 +565,25 @@
 #endif
 
 
-#ifdef RE_ENABLE_I18N
-/* This static array is used for the map to single-byte characters when
-   UTF-8 is used.  Otherwise we would allocate memory just to initialize
-   it the same all the time.  UTF-8 is the preferred encoding so this is
-   a worthwhile optimization.  */
-static const bitset utf8_sb_map =
-{
-  /* Set the first 128 bits.  */
-# if UINT_MAX == 0xffffffff
-  0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff
-# else
-#  error "Add case for new unsigned int size"
-# endif
-};
-#endif
-
-
 static void
 free_dfa_content (re_dfa_t *dfa)
 {
   int i, j;
 
+  re_free (dfa->subexps);
+
   if (dfa->nodes)
     for (i = 0; i < dfa->nodes_len; ++i)
-      free_token (dfa->nodes + i);
+      {
+	re_token_t *node = dfa->nodes + i;
+#ifdef RE_ENABLE_I18N
+	if (node->type == COMPLEX_BRACKET && node->duplicated == 0)
+	  free_charset (node->opr.mbcset);
+	else
+#endif /* RE_ENABLE_I18N */
+	  if (node->type == SIMPLE_BRACKET && node->duplicated == 0)
+	    re_free (node->opr.sbcset);
+      }
   re_free (dfa->nexts);
   for (i = 0; i < dfa->nodes_len; ++i)
     {
@@ -629,10 +612,8 @@
       }
   re_free (dfa->state_table);
 #ifdef RE_ENABLE_I18N
-  if (dfa->sb_char != utf8_sb_map)
-    re_free (dfa->sb_char);
+  re_free (dfa->sb_char);
 #endif
-  re_free (dfa->subexp_map);
 #ifdef DEBUG
   re_free (dfa->re_str);
 #endif
@@ -650,14 +631,8 @@
   re_dfa_t *dfa = (re_dfa_t *) preg->buffer;
   if (BE (dfa != NULL, 1))
     free_dfa_content (dfa);
-  preg->buffer = NULL;
-  preg->allocated = 0;
 
   re_free (preg->fastmap);
-  preg->fastmap = NULL;
-
-  re_free (preg->translate);
-  preg->translate = NULL;
 }
 #ifdef _LIBC
 weak_alias (__regfree, regfree)
@@ -804,17 +779,18 @@
   if (BE (dfa->str_tree == NULL, 0))
     goto re_compile_internal_free_return;
 
-  /* Analyze the tree and create the nfa.  */
-  err = analyze (preg);
-  if (BE (err != REG_NOERROR, 0))
-    goto re_compile_internal_free_return;
-
 #ifdef RE_ENABLE_I18N
   /* If possible, do searching in single byte encoding to speed things up.  */
   if (dfa->is_utf8 && !(syntax & RE_ICASE) && preg->translate == NULL)
     optimize_utf8 (dfa);
 #endif
 
+  /* Analyze the tree and collect information which is necessary to
+     create the dfa.  */
+  err = analyze (dfa);
+  if (BE (err != REG_NOERROR, 0))
+    goto re_compile_internal_free_return;
+
   /* Then create the initial state of the dfa.  */
   err = create_initial_state (dfa);
 
@@ -841,9 +817,6 @@
      int pat_len;
 {
   int table_size;
-#ifndef _LIBC
-  char *codeset_name;
-#endif
 
   memset (dfa, '\0', sizeof (re_dfa_t));
 
@@ -863,6 +836,9 @@
   dfa->state_table = calloc (sizeof (struct re_state_table_entry), table_size);
   dfa->state_hash_mask = table_size - 1;
 
+  dfa->subexps_alloc = 1;
+  dfa->subexps = re_malloc (re_subexp_t, dfa->subexps_alloc);
+
   dfa->mb_cur_max = MB_CUR_MAX;
 #ifdef _LIBC
   if (dfa->mb_cur_max == 6
@@ -870,63 +846,29 @@
     dfa->is_utf8 = 1;
   dfa->map_notascii = (_NL_CURRENT_WORD (LC_CTYPE, _NL_CTYPE_MAP_TO_NONASCII)
 		       != 0);
-#else
-# ifdef HAVE_LANGINFO_CODESET
-  codeset_name = nl_langinfo (CODESET);
-# else
-  codeset_name = getenv ("LC_ALL");
-  if (codeset_name == NULL || codeset_name[0] == '\0')
-    codeset_name = getenv ("LC_CTYPE");
-  if (codeset_name == NULL || codeset_name[0] == '\0')
-    codeset_name = getenv ("LANG");
-  if (codeset_name == NULL)
-    codeset_name = "";
-  else if (strchr (codeset_name, '.') !=  NULL)
-    codeset_name = strchr (codeset_name, '.') + 1;
-# endif
-
-  if (strcasecmp (codeset_name, "UTF-8") == 0
-      || strcasecmp (codeset_name, "UTF8") == 0)
-    dfa->is_utf8 = 1;
-
-  /* We check exhaustively in the loop below if this charset is a
-     superset of ASCII.  */
-  dfa->map_notascii = 0;
 #endif
-
 #ifdef RE_ENABLE_I18N
   if (dfa->mb_cur_max > 1)
     {
+      int i, j, ch;
+
+      dfa->sb_char = (re_bitset_ptr_t) calloc (sizeof (bitset), 1);
+      if (BE (dfa->sb_char == NULL, 0))
+	return REG_ESPACE;
+#ifdef _LIBC
       if (dfa->is_utf8)
-	dfa->sb_char = (re_bitset_ptr_t) utf8_sb_map;
+	memset (dfa->sb_char, 255, sizeof (unsigned int) * BITSET_UINTS / 2);
       else
-	{
-	  int i, j, ch;
-
-	  dfa->sb_char = (re_bitset_ptr_t) calloc (sizeof (bitset), 1);
-	  if (BE (dfa->sb_char == NULL, 0))
-	    return REG_ESPACE;
-
-	  /* Clear all bits by, then set those corresponding to single
-	     byte chars.  */
-	  bitset_empty (dfa->sb_char);
-
-	  for (i = 0, ch = 0; i < BITSET_UINTS; ++i)
-	    for (j = 0; j < UINT_BITS; ++j, ++ch)
-	      {
-		wchar_t wch = __btowc (ch);
-		if (wch != WEOF)
-		  dfa->sb_char[i] |= 1 << j;
-# ifndef _LIBC
-		if (isascii (ch) && wch != (wchar_t) ch)
-		  dfa->map_notascii = 1;
-# endif
-	      }
-	}
+#endif
+	for (i = 0, ch = 0; i < BITSET_UINTS; ++i)
+	  for (j = 0; j < UINT_BITS; ++j, ++ch)
+	    if (btowc (ch) != WEOF)
+	      dfa->sb_char[i] |= 1 << j;
     }
 #endif
 
-  if (BE (dfa->nodes == NULL || dfa->state_table == NULL, 0))
+  if (BE (dfa->nodes == NULL || dfa->state_table == NULL
+	  || dfa->subexps == NULL, 0))
     return REG_ESPACE;
   return REG_NOERROR;
 }
@@ -979,7 +921,7 @@
 
   /* Initial states have the epsilon closure of the node which is
      the first node of the regular expression.  */
-  first = dfa->str_tree->first->node_idx;
+  first = dfa->str_tree->first;
   dfa->init_node = first;
   err = re_node_set_init_copy (&init_nodes, dfa->eclosures + first);
   if (BE (err != REG_NOERROR, 0))
@@ -1003,7 +945,7 @@
 	    re_token_t *clexp_node;
 	    clexp_node = dfa->nodes + init_nodes.elems[clexp_idx];
 	    if (clexp_node->type == OP_CLOSE_SUBEXP
-		&& clexp_node->opr.idx == dfa->nodes[node_idx].opr.idx)
+		&& clexp_node->opr.idx + 1 == dfa->nodes[node_idx].opr.idx)
 	      break;
 	  }
 	if (clexp_idx == init_nodes.nelem)
@@ -1085,11 +1027,10 @@
       case OP_ALT:
       case END_OF_RE:
       case OP_DUP_ASTERISK:
+      case OP_DUP_QUESTION:
       case OP_OPEN_SUBEXP:
       case OP_CLOSE_SUBEXP:
 	break;
-      case COMPLEX_BRACKET:
-	return;
       case SIMPLE_BRACKET:
 	/* Just double check.  */
         for (i = 0x80 / UINT_BITS; i < BITSET_UINTS; ++i)
@@ -1097,7 +1038,7 @@
 	    return;
 	break;
       default:
-	abort ();
+	return;
       }
 
   if (mb_chars || has_period)
@@ -1121,10 +1062,10 @@
    "eclosure", and "inveclosure".  */
 
 static reg_errcode_t
-analyze (preg)
-     regex_t *preg;
+analyze (dfa)
+     re_dfa_t *dfa;
 {
-  re_dfa_t *dfa = (re_dfa_t *) preg->buffer;
+  int i;
   reg_errcode_t ret;
 
   /* Allocate arrays.  */
@@ -1132,321 +1073,225 @@
   dfa->org_indices = re_malloc (int, dfa->nodes_alloc);
   dfa->edests = re_malloc (re_node_set, dfa->nodes_alloc);
   dfa->eclosures = re_malloc (re_node_set, dfa->nodes_alloc);
+  dfa->inveclosures = re_malloc (re_node_set, dfa->nodes_alloc);
   if (BE (dfa->nexts == NULL || dfa->org_indices == NULL || dfa->edests == NULL
-	  || dfa->eclosures == NULL, 0))
+	  || dfa->eclosures == NULL || dfa->inveclosures == NULL, 0))
     return REG_ESPACE;
-
-  dfa->subexp_map = re_malloc (int, preg->re_nsub);
-  if (dfa->subexp_map != NULL)
+  /* Initialize them.  */
+  for (i = 0; i < dfa->nodes_len; ++i)
     {
-      int i;
-      for (i = 0; i < preg->re_nsub; i++)
-	dfa->subexp_map[i] = i;
-      preorder (dfa->str_tree, optimize_subexps, dfa);
-      for (i = 0; i < preg->re_nsub; i++)
-	if (dfa->subexp_map[i] != i)
-	  break;
-      if (i == preg->re_nsub)
-	{
-	  free (dfa->subexp_map);
-	  dfa->subexp_map = NULL;
-	}
+      dfa->nexts[i] = -1;
+      re_node_set_init_empty (dfa->edests + i);
+      re_node_set_init_empty (dfa->eclosures + i);
+      re_node_set_init_empty (dfa->inveclosures + i);
     }
 
-  ret = postorder (dfa->str_tree, lower_subexps, preg);
-  if (BE (ret != REG_NOERROR, 0))
-    return ret;
-  ret = postorder (dfa->str_tree, calc_first, dfa);
-  if (BE (ret != REG_NOERROR, 0))
-    return ret;
-  preorder (dfa->str_tree, calc_next, dfa);
-  ret = preorder (dfa->str_tree, link_nfa_nodes, dfa);
-  if (BE (ret != REG_NOERROR, 0))
-    return ret;
-  ret = calc_eclosure (dfa);
-  if (BE (ret != REG_NOERROR, 0))
-    return ret;
-
-  /* We only need this during the prune_impossible_nodes pass in regexec.c;
-     skip it if p_i_n will not run, as calc_inveclosure can be quadratic.  */
-  if ((!preg->no_sub && preg->re_nsub > 0 && dfa->has_plural_match)
-      || dfa->nbackref)
-    {
-      dfa->inveclosures = re_malloc (re_node_set, dfa->nodes_len);
-      if (BE (dfa->inveclosures == NULL, 0))
-        return REG_ESPACE;
-      ret = calc_inveclosure (dfa);
+  ret = analyze_tree (dfa, dfa->str_tree);
+  if (BE (ret == REG_NOERROR, 1))
+    {
+      ret = calc_eclosure (dfa);
+      if (ret == REG_NOERROR)
+	calc_inveclosure (dfa);
     }
-
   return ret;
 }
 
-/* Our parse trees are very unbalanced, so we cannot use a stack to
-   implement parse tree visits.  Instead, we use parent pointers and
-   some hairy code in these two functions.  */
-static reg_errcode_t
-postorder (root, fn, extra)
-     bin_tree_t *root;
-     reg_errcode_t (fn (void *, bin_tree_t *));
-     void *extra;
-{
-  bin_tree_t *node, *prev;
-
-  for (node = root; ; )
-    {
-      /* Descend down the tree, preferably to the left (or to the right
-	 if that's the only child).  */
-      while (node->left || node->right)
-	if (node->left)
-          node = node->left;
-        else
-          node = node->right;
+/* Helper functions for analyze.
+   This function calculate "first", "next", and "edest" for the subtree
+   whose root is NODE.  */
 
-      do
-	{
-	  reg_errcode_t err = fn (extra, node);
-	  if (BE (err != REG_NOERROR, 0))
-	    return err;
-          if (node->parent == NULL)
-	    return REG_NOERROR;
-	  prev = node;
-	  node = node->parent;
-	}
-      /* Go up while we have a node that is reached from the right.  */
-      while (node->right == prev || node->right == NULL);
-      node = node->right;
-    }
-}
-
-static reg_errcode_t
-preorder (root, fn, extra)
-     bin_tree_t *root;
-     reg_errcode_t (fn (void *, bin_tree_t *));
-     void *extra;
-{
-  bin_tree_t *node;
-
-  for (node = root; ; )
-    {
-      reg_errcode_t err = fn (extra, node);
-      if (BE (err != REG_NOERROR, 0))
-	return err;
-
-      /* Go to the left node, or up and to the right.  */
-      if (node->left)
-	node = node->left;
-      else
-	{
-	  bin_tree_t *prev = NULL;
-	  while (node->right == prev || node->right == NULL)
-	    {
-	      prev = node;
-	      node = node->parent;
-	      if (!node)
-	        return REG_NOERROR;
-	    }
-	  node = node->right;
-	}
-    }
-}
-
-/* Optimization pass: if a SUBEXP is entirely contained, strip it and tell
-   re_search_internal to map the inner one's opr.idx to this one's.  Adjust
-   backreferences as well.  Requires a preorder visit.  */
 static reg_errcode_t
-optimize_subexps (extra, node)
-     void *extra;
+analyze_tree (dfa, node)
+     re_dfa_t *dfa;
      bin_tree_t *node;
 {
-  re_dfa_t *dfa = (re_dfa_t *) extra;
-
-  if (node->token.type == OP_BACK_REF && dfa->subexp_map)
+  reg_errcode_t ret;
+  if (node->first == -1)
+    calc_first (dfa, node);
+  if (node->next == -1)
+    calc_next (dfa, node);
+  if (node->eclosure.nelem == 0)
+    calc_epsdest (dfa, node);
+  /* Calculate "first" etc. for the left child.  */
+  if (node->left != NULL)
     {
-      int idx = node->token.opr.idx;
-      node->token.opr.idx = dfa->subexp_map[idx];
-      dfa->used_bkref_map |= 1 << node->token.opr.idx;
+      ret = analyze_tree (dfa, node->left);
+      if (BE (ret != REG_NOERROR, 0))
+	return ret;
     }
-
-  else if (node->token.type == SUBEXP
-           && node->left && node->left->token.type == SUBEXP)
+  /* Calculate "first" etc. for the right child.  */
+  if (node->right != NULL)
     {
-      int other_idx = node->left->token.opr.idx;
-
-      node->left = node->left->left;
-      if (node->left)
-        node->left->parent = node;
-
-      dfa->subexp_map[other_idx] = dfa->subexp_map[node->token.opr.idx];
-      if (other_idx < 8 * sizeof (dfa->used_bkref_map))
-	dfa->used_bkref_map &= ~(1 << other_idx);
+      ret = analyze_tree (dfa, node->right);
+      if (BE (ret != REG_NOERROR, 0))
+	return ret;
     }
-
   return REG_NOERROR;
 }
 
-/* Lowering pass: Turn each SUBEXP node into the appropriate concatenation
-   of OP_OPEN_SUBEXP, the body of the SUBEXP (if any) and OP_CLOSE_SUBEXP.  */
-static reg_errcode_t
-lower_subexps (extra, node)
-     void *extra;
+/* Calculate "first" for the node NODE.  */
+static void
+calc_first (dfa, node)
+     re_dfa_t *dfa;
      bin_tree_t *node;
 {
-  regex_t *preg = (regex_t *) extra;
-  reg_errcode_t err = REG_NOERROR;
+  int idx, type;
+  idx = node->node_idx;
+  type = (node->type == 0) ? dfa->nodes[idx].type : node->type;
 
-  if (node->left && node->left->token.type == SUBEXP)
-    {
-      node->left = lower_subexp (&err, preg, node->left);
-      if (node->left)
-	node->left->parent = node;
-    }
-  if (node->right && node->right->token.type == SUBEXP)
+  switch (type)
     {
-      node->right = lower_subexp (&err, preg, node->right);
-      if (node->right)
-	node->right->parent = node;
+#ifdef DEBUG
+    case OP_OPEN_BRACKET:
+    case OP_CLOSE_BRACKET:
+    case OP_OPEN_DUP_NUM:
+    case OP_CLOSE_DUP_NUM:
+    case OP_DUP_PLUS:
+    case OP_NON_MATCH_LIST:
+    case OP_OPEN_COLL_ELEM:
+    case OP_CLOSE_COLL_ELEM:
+    case OP_OPEN_EQUIV_CLASS:
+    case OP_CLOSE_EQUIV_CLASS:
+    case OP_OPEN_CHAR_CLASS:
+    case OP_CLOSE_CHAR_CLASS:
+      /* These must not appear here.  */
+      assert (0);
+#endif
+    case END_OF_RE:
+    case CHARACTER:
+    case OP_PERIOD:
+    case OP_DUP_ASTERISK:
+    case OP_DUP_QUESTION:
+#ifdef RE_ENABLE_I18N
+    case OP_UTF8_PERIOD:
+    case COMPLEX_BRACKET:
+#endif /* RE_ENABLE_I18N */
+    case SIMPLE_BRACKET:
+    case OP_BACK_REF:
+    case ANCHOR:
+    case OP_OPEN_SUBEXP:
+    case OP_CLOSE_SUBEXP:
+      node->first = idx;
+      break;
+    case OP_ALT:
+      node->first = idx;
+      break;
+      /* else fall through */
+    default:
+#ifdef DEBUG
+      assert (node->left != NULL);
+#endif
+      if (node->left->first == -1)
+	calc_first (dfa, node->left);
+      node->first = node->left->first;
+      break;
     }
-
-  return err;
 }
 
-static bin_tree_t *
-lower_subexp (err, preg, node)
-     reg_errcode_t *err;
-     regex_t *preg;
-     bin_tree_t *node;
-{
-  re_dfa_t *dfa = (re_dfa_t *) preg->buffer;
-  bin_tree_t *body = node->left;
-  bin_tree_t *op, *cls, *tree1, *tree;
-
-  if (preg->no_sub
-      && (node->token.opr.idx >= 8 * sizeof (dfa->used_bkref_map)
-	  || !(dfa->used_bkref_map & (1 << node->token.opr.idx))))
-    return node->left;
-
-  /* Convert the SUBEXP node to the concatenation of an
-     OP_OPEN_SUBEXP, the contents, and an OP_CLOSE_SUBEXP.  */
-  op = create_tree (dfa, NULL, NULL, OP_OPEN_SUBEXP);
-  cls = create_tree (dfa, NULL, NULL, OP_CLOSE_SUBEXP);
-  tree1 = body ? create_tree (dfa, body, cls, CONCAT) : cls;
-  tree = create_tree (dfa, op, tree1, CONCAT);
-  if (BE (tree == NULL || tree1 == NULL || op == NULL || cls == NULL, 0))
-    {
-      *err = REG_ESPACE;
-      return NULL;
-    }
+/* Calculate "next" for the node NODE.  */
 
-  op->token.opr.idx = cls->token.opr.idx = node->token.opr.idx;
-  op->token.opt_subexp = cls->token.opt_subexp = node->token.opt_subexp;
-  return tree;
-}
-
-/* Pass 1 in building the NFA: compute FIRST and create unlinked automaton
-   nodes.  Requires a postorder visit.  */
-static reg_errcode_t
-calc_first (extra, node)
-     void *extra;
+static void
+calc_next (dfa, node)
+     re_dfa_t *dfa;
      bin_tree_t *node;
 {
-  re_dfa_t *dfa = (re_dfa_t *) extra;
-  if (node->token.type == CONCAT)
+  int idx, type;
+  bin_tree_t *parent = node->parent;
+  if (parent == NULL)
     {
-      node->first = node->left->first;
-      node->node_idx = node->left->node_idx;
-    }
-  else
-    {
-      node->first = node;
-      node->node_idx = re_dfa_add_node (dfa, node->token);
-      if (BE (node->node_idx == -1, 0))
-        return REG_ESPACE;
+      node->next = -1;
+      idx = node->node_idx;
+      if (node->type == 0)
+	dfa->nexts[idx] = node->next;
+      return;
     }
-  return REG_NOERROR;
-}
 
-/* Pass 2: compute NEXT on the tree.  Preorder visit.  */
-static reg_errcode_t
-calc_next (extra, node)
-     void *extra;
-     bin_tree_t *node;
-{
-  switch (node->token.type)
+  idx = parent->node_idx;
+  type = (parent->type == 0) ? dfa->nodes[idx].type : parent->type;
+
+  switch (type)
     {
     case OP_DUP_ASTERISK:
-      node->left->next = node;
+      node->next = idx;
       break;
     case CONCAT:
-      node->left->next = node->right->first;
-      node->right->next = node->next;
-      break;
+      if (parent->left == node)
+	{
+	  if (parent->right->first == -1)
+	    calc_first (dfa, parent->right);
+	  node->next = parent->right->first;
+	  break;
+	}
+      /* else fall through */
     default:
-      if (node->left)
-	node->left->next = node->next;
-      if (node->right)
-        node->right->next = node->next;
+      if (parent->next == -1)
+	calc_next (dfa, parent);
+      node->next = parent->next;
       break;
     }
-  return REG_NOERROR;
+  idx = node->node_idx;
+  if (node->type == 0)
+    dfa->nexts[idx] = node->next;
 }
 
-/* Pass 3: link all DFA nodes to their NEXT node (any order will do).  */
-static reg_errcode_t
-link_nfa_nodes (extra, node)
-     void *extra;
+/* Calculate "edest" for the node NODE.  */
+
+static void
+calc_epsdest (dfa, node)
+     re_dfa_t *dfa;
      bin_tree_t *node;
 {
-  re_dfa_t *dfa = (re_dfa_t *) extra;
-  int idx = node->node_idx;
-  reg_errcode_t err = REG_NOERROR;
-
-  switch (node->token.type)
+  int idx;
+  idx = node->node_idx;
+  if (node->type == 0)
     {
-    case CONCAT:
-      break;
-
-    case END_OF_RE:
-      assert (node->next == NULL);
-      break;
-
-    case OP_DUP_ASTERISK:
-    case OP_ALT:
-      {
-	int left, right;
-	dfa->has_plural_match = 1;
-	if (node->left != NULL)
-	  left = node->left->first->node_idx;
-	else
-	  left = node->next->node_idx;
-	if (node->right != NULL)
-	  right = node->right->first->node_idx;
-	else
-	  right = node->next->node_idx;
-	assert (left > -1);
-	assert (right > -1);
-	err = re_node_set_init_2 (dfa->edests + idx, left, right);
-      }
-      break;
-
-    case ANCHOR:
-    case OP_OPEN_SUBEXP:
-    case OP_CLOSE_SUBEXP:
-      err = re_node_set_init_1 (dfa->edests + idx, node->next->node_idx);
-      break;
-
-    case OP_BACK_REF:
-      dfa->nexts[idx] = node->next->node_idx;
-      if (node->token.type == OP_BACK_REF)
-	re_node_set_init_1 (dfa->edests + idx, dfa->nexts[idx]);
-      break;
-
-    default:
-      assert (!IS_EPSILON_NODE (node->token.type));
-      dfa->nexts[idx] = node->next->node_idx;
-      break;
+      if (dfa->nodes[idx].type == OP_DUP_ASTERISK
+	  || dfa->nodes[idx].type == OP_DUP_QUESTION)
+	{
+	  if (node->left->first == -1)
+	    calc_first (dfa, node->left);
+	  if (node->next == -1)
+	    calc_next (dfa, node);
+	  re_node_set_init_2 (dfa->edests + idx, node->left->first,
+			      node->next);
+	}
+      else if (dfa->nodes[idx].type == OP_ALT)
+	{
+	  int left, right;
+	  if (node->left != NULL)
+	    {
+	      if (node->left->first == -1)
+		calc_first (dfa, node->left);
+	      left = node->left->first;
+	    }
+	  else
+	    {
+	      if (node->next == -1)
+		calc_next (dfa, node);
+	      left = node->next;
+	    }
+	  if (node->right != NULL)
+	    {
+	      if (node->right->first == -1)
+		calc_first (dfa, node->right);
+	      right = node->right->first;
+	    }
+	  else
+	    {
+	      if (node->next == -1)
+		calc_next (dfa, node);
+	      right = node->next;
+	    }
+	  re_node_set_init_2 (dfa->edests + idx, left, right);
+	}
+      else if (dfa->nodes[idx].type == ANCHOR
+	       || dfa->nodes[idx].type == OP_OPEN_SUBEXP
+	       || dfa->nodes[idx].type == OP_CLOSE_SUBEXP
+	       || dfa->nodes[idx].type == OP_BACK_REF)
+	re_node_set_init_1 (dfa->edests + idx, node->next);
+      else
+        assert (!IS_EPSILON_NODE (dfa->nodes[idx].type));
     }
-
-  return err;
 }
 
 /* Duplicate the epsilon closure of the node ROOT_NODE.
@@ -1522,7 +1367,7 @@
       else /* dfa->edests[org_node].nelem == 2 */
 	{
 	  /* In case of the node can epsilon-transit, and it has two
-	     destinations. In the bin_tree_t and DFA, that's '|' and '*'.   */
+	     destinations. E.g. '|', '*', '+', '?'.   */
 	  org_dest = dfa->edests[org_node].elems[0];
 	  re_node_set_empty (dfa->edests + clone_node);
 	  /* Search for a duplicated node which satisfies the constraint.  */
@@ -1593,13 +1438,16 @@
      int *new_idx, org_idx;
      unsigned int constraint;
 {
-  int dup_idx = re_dfa_add_node (dfa, dfa->nodes[org_idx]);
+  int dup_idx = re_dfa_add_node (dfa, dfa->nodes[org_idx], 1);
   if (BE (dup_idx == -1, 0))
     return REG_ESPACE;
   dfa->nodes[dup_idx].constraint = constraint;
   if (dfa->nodes[org_idx].type == ANCHOR)
     dfa->nodes[dup_idx].constraint |= dfa->nodes[org_idx].opr.ctx_type;
   dfa->nodes[dup_idx].duplicated = 1;
+  re_node_set_init_empty (dfa->edests + dup_idx);
+  re_node_set_init_empty (dfa->eclosures + dup_idx);
+  re_node_set_init_empty (dfa->inveclosures + dup_idx);
 
   /* Store the index of the original node.  */
   dfa->org_indices[dup_idx] = org_idx;
@@ -1607,26 +1455,19 @@
   return REG_NOERROR;
 }
 
-static reg_errcode_t
+static void
 calc_inveclosure (dfa)
      re_dfa_t *dfa;
 {
-  int src, idx, ret;
-  for (idx = 0; idx < dfa->nodes_len; ++idx)
-    re_node_set_init_empty (dfa->inveclosures + idx);
-
+  int src, idx, dest;
   for (src = 0; src < dfa->nodes_len; ++src)
     {
-      int *elems = dfa->eclosures[src].elems;
       for (idx = 0; idx < dfa->eclosures[src].nelem; ++idx)
 	{
-	  ret = re_node_set_insert_last (dfa->inveclosures + elems[idx], src);
-	  if (BE (ret == -1, 0))
-	    return REG_ESPACE;
+	  dest = dfa->eclosures[src].elems[idx];
+	  re_node_set_insert (dfa->inveclosures + dest, src);
 	}
     }
-
-  return REG_NOERROR;
 }
 
 /* Calculate "eclosure" for all the node in DFA.  */
@@ -1656,7 +1497,6 @@
 #ifdef DEBUG
       assert (dfa->eclosures[node_idx].nelem != -1);
 #endif
-
       /* If we have already calculated, skip it.  */
       if (dfa->eclosures[node_idx].nelem != 0)
 	continue;
@@ -1699,9 +1539,7 @@
 		? dfa->nodes[node].opr.ctx_type : 0);
   /* If the current node has constraints, duplicate all nodes.
      Since they must inherit the constraints.  */
-  if (constraint
-      && dfa->edests[node].nelem
-      && !dfa->nodes[dfa->edests[node].elems[0]].duplicated)
+  if (constraint && !dfa->nodes[dfa->edests[node].elems[0]].duplicated)
     {
       int org_node, cur_node;
       org_node = cur_node = node;
@@ -1833,7 +1671,7 @@
 	  if (!(syntax & RE_NO_BK_REFS))
 	    {
 	      token->type = OP_BACK_REF;
-	      token->opr.idx = c2 - '1';
+	      token->opr.idx = c2 - '0';
 	    }
 	  break;
 	case '<':
@@ -1861,7 +1699,7 @@
 	  if (!(syntax & RE_NO_GNU_OPS))
 	    {
 	      token->type = ANCHOR;
-	      token->opr.ctx_type = NOT_WORD_DELIM;
+	      token->opr.ctx_type = INSIDE_WORD;
 	    }
 	  break;
 	case 'w':
@@ -2036,8 +1874,7 @@
     }
 #endif /* RE_ENABLE_I18N */
 
-  if (c == '\\' && (syntax & RE_BACKSLASH_ESCAPE_IN_LISTS)
-      && re_string_cur_idx (input) + 1 < re_string_length (input))
+  if (c == '\\' && (syntax & RE_BACKSLASH_ESCAPE_IN_LISTS))
     {
       /* In this case, '\' escape a character.  */
       unsigned char c2;
@@ -2051,10 +1888,7 @@
     {
       unsigned char c2;
       int token_len;
-      if (re_string_cur_idx (input) + 1 < re_string_length (input))
-	c2 = re_string_peek_byte (input, 1);
-      else
-	c2 = 0;
+      c2 = re_string_peek_byte (input, 1);
       token->opr.c = c2;
       token_len = 2;
       switch (c2)
@@ -2126,9 +1960,9 @@
   tree = parse_reg_exp (regexp, preg, &current_token, syntax, 0, err);
   if (BE (*err != REG_NOERROR && tree == NULL, 0))
     return NULL;
-  eor = create_tree (dfa, NULL, NULL, END_OF_RE);
+  eor = re_dfa_add_tree_node (dfa, NULL, NULL, &current_token);
   if (tree != NULL)
-    root = create_tree (dfa, tree, eor, CONCAT);
+    root = create_tree (dfa, tree, eor, CONCAT, 0);
   else
     root = eor;
   if (BE (eor == NULL || root == NULL, 0))
@@ -2165,6 +1999,7 @@
 
   while (token->type == OP_ALT)
     {
+      re_token_t alt_token = *token;
       fetch_token (token, regexp, syntax | RE_CARET_ANCHORS_HERE);
       if (token->type != OP_ALT && token->type != END_OF_RE
 	  && (nest == 0 || token->type != OP_CLOSE_SUBEXP))
@@ -2175,12 +2010,13 @@
 	}
       else
 	branch = NULL;
-      tree = create_tree (dfa, tree, branch, OP_ALT);
+      tree = re_dfa_add_tree_node (dfa, tree, branch, &alt_token);
       if (BE (tree == NULL, 0))
 	{
 	  *err = REG_ESPACE;
 	  return NULL;
 	}
+      dfa->has_plural_match = 1;
     }
   return tree;
 }
@@ -2219,7 +2055,7 @@
 	}
       if (tree != NULL && exp != NULL)
 	{
-	  tree = create_tree (dfa, tree, exp, CONCAT);
+	  tree = create_tree (dfa, tree, exp, CONCAT, 0);
 	  if (tree == NULL)
 	    {
 	      *err = REG_ESPACE;
@@ -2253,7 +2089,7 @@
   switch (token->type)
     {
     case CHARACTER:
-      tree = create_token_tree (dfa, NULL, NULL, token);
+      tree = re_dfa_add_tree_node (dfa, NULL, NULL, token);
       if (BE (tree == NULL, 0))
 	{
 	  *err = REG_ESPACE;
@@ -2267,8 +2103,8 @@
 	    {
 	      bin_tree_t *mbc_remain;
 	      fetch_token (token, regexp, syntax);
-	      mbc_remain = create_token_tree (dfa, NULL, NULL, token);
-	      tree = create_tree (dfa, tree, mbc_remain, CONCAT);
+	      mbc_remain = re_dfa_add_tree_node (dfa, NULL, NULL, token);
+	      tree = create_tree (dfa, tree, mbc_remain, CONCAT, 0);
 	      if (BE (mbc_remain == NULL || tree == NULL, 0))
 		{
 		  *err = REG_ESPACE;
@@ -2289,13 +2125,14 @@
 	return NULL;
       break;
     case OP_BACK_REF:
-      if (!BE (dfa->completed_bkref_map & (1 << token->opr.idx), 1))
+      if (BE (preg->re_nsub < token->opr.idx
+	      || dfa->subexps[token->opr.idx - 1].end == -1, 0))
 	{
 	  *err = REG_ESUBREG;
 	  return NULL;
 	}
-      dfa->used_bkref_map |= 1 << token->opr.idx;
-      tree = create_token_tree (dfa, NULL, NULL, token);
+      dfa->used_bkref_map |= 1 << (token->opr.idx - 1);
+      tree = re_dfa_add_tree_node (dfa, NULL, NULL, token);
       if (BE (tree == NULL, 0))
 	{
 	  *err = REG_ESPACE;
@@ -2340,7 +2177,7 @@
       token->type = CHARACTER;
       /* mb_partial and word_char bits should be initialized already
 	 by peek_token.  */
-      tree = create_token_tree (dfa, NULL, NULL, token);
+      tree = re_dfa_add_tree_node (dfa, NULL, NULL, token);
       if (BE (tree == NULL, 0))
 	{
 	  *err = REG_ESPACE;
@@ -2349,27 +2186,18 @@
       break;
     case ANCHOR:
       if ((token->opr.ctx_type
-	   & (WORD_DELIM | NOT_WORD_DELIM | WORD_FIRST | WORD_LAST))
+	   & (WORD_DELIM | INSIDE_WORD | WORD_FIRST | WORD_LAST))
 	  && dfa->word_ops_used == 0)
 	init_word_char (dfa);
-      if (token->opr.ctx_type == WORD_DELIM
-          || token->opr.ctx_type == NOT_WORD_DELIM)
+      if (token->opr.ctx_type == WORD_DELIM)
 	{
 	  bin_tree_t *tree_first, *tree_last;
-	  if (token->opr.ctx_type == WORD_DELIM)
-	    {
-	      token->opr.ctx_type = WORD_FIRST;
-	      tree_first = create_token_tree (dfa, NULL, NULL, token);
-	      token->opr.ctx_type = WORD_LAST;
-            }
-          else
-            {
-	      token->opr.ctx_type = INSIDE_WORD;
-	      tree_first = create_token_tree (dfa, NULL, NULL, token);
-	      token->opr.ctx_type = INSIDE_NOTWORD;
-            }
-	  tree_last = create_token_tree (dfa, NULL, NULL, token);
-	  tree = create_tree (dfa, tree_first, tree_last, OP_ALT);
+	  token->opr.ctx_type = WORD_FIRST;
+	  tree_first = re_dfa_add_tree_node (dfa, NULL, NULL, token);
+	  token->opr.ctx_type = WORD_LAST;
+	  tree_last = re_dfa_add_tree_node (dfa, NULL, NULL, token);
+	  token->type = OP_ALT;
+	  tree = re_dfa_add_tree_node (dfa, tree_first, tree_last, token);
 	  if (BE (tree_first == NULL || tree_last == NULL || tree == NULL, 0))
 	    {
 	      *err = REG_ESPACE;
@@ -2378,7 +2206,7 @@
 	}
       else
 	{
-	  tree = create_token_tree (dfa, NULL, NULL, token);
+	  tree = re_dfa_add_tree_node (dfa, NULL, NULL, token);
 	  if (BE (tree == NULL, 0))
 	    {
 	      *err = REG_ESPACE;
@@ -2392,7 +2220,7 @@
       fetch_token (token, regexp, syntax);
       return tree;
     case OP_PERIOD:
-      tree = create_token_tree (dfa, NULL, NULL, token);
+      tree = re_dfa_add_tree_node (dfa, NULL, NULL, token);
       if (BE (tree == NULL, 0))
 	{
 	  *err = REG_ESPACE;
@@ -2402,20 +2230,22 @@
 	dfa->has_mb_node = 1;
       break;
     case OP_WORD:
+      tree = build_charclass_op (dfa, regexp->trans, "alnum", "_", 0, err);
+      if (BE (*err != REG_NOERROR && tree == NULL, 0))
+	return NULL;
+      break;
     case OP_NOTWORD:
-      tree = build_charclass_op (dfa, regexp->trans,
-				 (const unsigned char *) "alnum",
-				 (const unsigned char *) "_",
-				 token->type == OP_NOTWORD, err);
+      tree = build_charclass_op (dfa, regexp->trans, "alnum", "_", 1, err);
       if (BE (*err != REG_NOERROR && tree == NULL, 0))
 	return NULL;
       break;
     case OP_SPACE:
+      tree = build_charclass_op (dfa, regexp->trans, "space", "", 0, err);
+      if (BE (*err != REG_NOERROR && tree == NULL, 0))
+	return NULL;
+      break;
     case OP_NOTSPACE:
-      tree = build_charclass_op (dfa, regexp->trans,
-				 (const unsigned char *) "space",
-				 (const unsigned char *) "",
-				 token->type == OP_NOTSPACE, err);
+      tree = build_charclass_op (dfa, regexp->trans, "space", "", 1, err);
       if (BE (*err != REG_NOERROR && tree == NULL, 0))
 	return NULL;
       break;
@@ -2448,6 +2278,7 @@
 	  *err = REG_BADRPT;
 	  return NULL;
 	}
+      dfa->has_plural_match = 1;
     }
 
   return tree;
@@ -2470,10 +2301,32 @@
      reg_errcode_t *err;
 {
   re_dfa_t *dfa = (re_dfa_t *) preg->buffer;
-  bin_tree_t *tree;
+  bin_tree_t *tree, *left_par, *right_par;
   size_t cur_nsub;
   cur_nsub = preg->re_nsub++;
+  if (BE (dfa->subexps_alloc < preg->re_nsub, 0))
+    {
+      re_subexp_t *new_array;
+      dfa->subexps_alloc *= 2;
+      new_array = re_realloc (dfa->subexps, re_subexp_t, dfa->subexps_alloc);
+      if (BE (new_array == NULL, 0))
+	{
+	  dfa->subexps_alloc /= 2;
+	  *err = REG_ESPACE;
+	  return NULL;
+	}
+      dfa->subexps = new_array;
+    }
+  dfa->subexps[cur_nsub].start = dfa->nodes_len;
+  dfa->subexps[cur_nsub].end = -1;
 
+  left_par = re_dfa_add_tree_node (dfa, NULL, NULL, token);
+  if (BE (left_par == NULL, 0))
+    {
+      *err = REG_ESPACE;
+      return NULL;
+    }
+  dfa->nodes[left_par->node_idx].opr.idx = cur_nsub;
   fetch_token (token, regexp, syntax | RE_CARET_ANCHORS_HERE);
 
   /* The subexpression may be a null string.  */
@@ -2482,20 +2335,26 @@
   else
     {
       tree = parse_reg_exp (regexp, preg, token, syntax, nest, err);
-      if (BE (*err == REG_NOERROR && token->type != OP_CLOSE_SUBEXP, 0))
-        *err = REG_EPAREN;
-      if (BE (*err != REG_NOERROR, 0))
+      if (BE (*err != REG_NOERROR && tree == NULL, 0))
 	return NULL;
     }
-  dfa->completed_bkref_map |= 1 << cur_nsub;
-
-  tree = create_tree (dfa, tree, NULL, SUBEXP);
-  if (BE (tree == NULL, 0))
+  if (BE (token->type != OP_CLOSE_SUBEXP, 0))
+    {
+      *err = REG_EPAREN;
+      return NULL;
+    }
+  right_par = re_dfa_add_tree_node (dfa, NULL, NULL, token);
+  dfa->subexps[cur_nsub].end = dfa->nodes_len;
+  tree = ((tree == NULL) ? right_par
+	  : create_tree (dfa, tree, right_par, CONCAT, 0));
+  tree = create_tree (dfa, left_par, tree, CONCAT, 0);
+  if (BE (right_par == NULL || tree == NULL, 0))
     {
       *err = REG_ESPACE;
       return NULL;
     }
-  tree->token.opr.idx = cur_nsub;
+  dfa->nodes[right_par->node_idx].opr.idx = cur_nsub;
+
   return tree;
 }
 
@@ -2510,7 +2369,8 @@
      reg_syntax_t syntax;
      reg_errcode_t *err;
 {
-  bin_tree_t *tree = NULL, *old_tree = NULL;
+  re_token_t dup_token;
+  bin_tree_t *tree = NULL;
   int i, start, end, start_idx = re_string_cur_idx (regexp);
   re_token_t start_token = *token;
 
@@ -2570,63 +2430,67 @@
       end = (token->type == OP_DUP_QUESTION) ? 1 : -1;
     }
 
-  fetch_token (token, regexp, syntax);
-
+  /* Treat "<re>{0}*" etc. as "<re>{0}".  */
   if (BE (elem == NULL, 0))
-    return NULL;
-  if (BE (start == 0 && end == 0, 0))
-    {
-      postorder (elem, free_tree, NULL);
-      return NULL;
-    }
+    start = end = 0;
 
   /* Extract "<re>{n,m}" to "<re><re>...<re><re>{0,<m-n>}".  */
-  if (BE (start > 0, 0))
+  else if (BE (start > 0, 0))
     {
       tree = elem;
       for (i = 2; i <= start; ++i)
 	{
 	  elem = duplicate_tree (elem, dfa);
-	  tree = create_tree (dfa, tree, elem, CONCAT);
+	  tree = create_tree (dfa, tree, elem, CONCAT, 0);
 	  if (BE (elem == NULL || tree == NULL, 0))
 	    goto parse_dup_op_espace;
 	}
-
-      if (start == end)
-	return tree;
-
-      /* Duplicate ELEM before it is marked optional.  */
-      elem = duplicate_tree (elem, dfa);
-      old_tree = tree;
     }
-  else
-    old_tree = NULL;
 
-  if (elem->token.type == SUBEXP)
-    postorder (elem, mark_opt_subexp, (void *) (long) elem->token.opr.idx);
+  if (BE (end != start, 1))
+    {
+      dup_token.type = (end == -1 ? OP_DUP_ASTERISK : OP_DUP_QUESTION);
+      if (BE (start > 0, 0))
+	{
+          elem = duplicate_tree (elem, dfa);
+          if (BE (elem == NULL, 0))
+	    goto parse_dup_op_espace;
 
-  tree = create_tree (dfa, elem, NULL, (end == -1 ? OP_DUP_ASTERISK : OP_ALT));
-  if (BE (tree == NULL, 0))
-    goto parse_dup_op_espace;
+          /* This subexpression will be marked as optional, so that
+             empty matches do not touch the registers.  */
+          mark_opt_subexp (elem, dfa);
+
+          /* Prepare the tree with the modifier.  */
+          elem = re_dfa_add_tree_node (dfa, elem, NULL, &dup_token);
+          tree = create_tree (dfa, tree, elem, CONCAT, 0);
+	}
+      else
+	{
+	  /* We do not need to duplicate the tree because we have not
+	     created it yet.  */
+          mark_opt_subexp (elem, dfa);
+          tree = elem = re_dfa_add_tree_node (dfa, elem, NULL, &dup_token);
+	}
 
-  /* This loop is actually executed only when end != -1,
-     to rewrite <re>{0,n} as (<re>(<re>...<re>?)?)?...  We have
-     already created the start+1-th copy.  */
-  for (i = start + 2; i <= end; ++i)
-    {
-      elem = duplicate_tree (elem, dfa);
-      tree = create_tree (dfa, tree, elem, CONCAT);
       if (BE (elem == NULL || tree == NULL, 0))
         goto parse_dup_op_espace;
 
-      tree = create_tree (dfa, tree, NULL, OP_ALT);
-      if (BE (tree == NULL, 0))
-        goto parse_dup_op_espace;
+      /* This loop is actually executed only when end != -1,
+         to rewrite <re>{0,n} as <re>?<re>?<re>?...  We have
+         already created the start+1-th copy.  */
+      for (i = start + 2; i <= end; ++i)
+        {
+          elem = duplicate_tree (elem, dfa);
+          tree = create_tree (dfa, tree, elem, CONCAT, 0);
+          if (BE (elem == NULL || tree == NULL, 0))
+	    {
+	      *err = REG_ESPACE;
+	      return NULL;
+	    }
+        }
     }
 
-  if (old_tree)
-    tree = create_tree (dfa, old_tree, tree, CONCAT);
-
+  fetch_token (token, regexp, syntax);
   return tree;
 
  parse_dup_op_espace:
@@ -2687,50 +2551,40 @@
 		? __btowc (start_ch) : start_elem->opr.wch);
     end_wc = ((end_elem->type == SB_CHAR || end_elem->type == COLL_SYM)
 	      ? __btowc (end_ch) : end_elem->opr.wch);
-    if (start_wc == WEOF || end_wc == WEOF)
-      return REG_ECOLLATE;
     cmp_buf[0] = start_wc;
     cmp_buf[4] = end_wc;
     if (wcscoll (cmp_buf, cmp_buf + 4) > 0)
       return REG_ERANGE;
 
-    /* Got valid collation sequence values, add them as a new entry.
-       However, for !_LIBC we have no collation elements: if the
-       character set is single byte, the single byte character set
-       that we build below suffices.  parse_bracket_exp passes
-       no MBCSET if dfa->mb_cur_max == 1.  */
-    if (mbcset)
+    /* Check the space of the arrays.  */
+    if (BE (*range_alloc == mbcset->nranges, 0))
       {
-        /* Check the space of the arrays.  */
-        if (BE (*range_alloc == mbcset->nranges, 0))
-          {
-	    /* There is not enough space, need realloc.  */
-	    wchar_t *new_array_start, *new_array_end;
-	    int new_nranges;
-
-	    /* +1 in case of mbcset->nranges is 0.  */
-	    new_nranges = 2 * mbcset->nranges + 1;
-	    /* Use realloc since mbcset->range_starts and mbcset->range_ends
-	       are NULL if *range_alloc == 0.  */
-	    new_array_start = re_realloc (mbcset->range_starts, wchar_t,
-				          new_nranges);
-	    new_array_end = re_realloc (mbcset->range_ends, wchar_t,
-				        new_nranges);
-
-	    if (BE (new_array_start == NULL || new_array_end == NULL, 0))
-	      return REG_ESPACE;
-
-	    mbcset->range_starts = new_array_start;
-	    mbcset->range_ends = new_array_end;
-	    *range_alloc = new_nranges;
-          }
-
-        mbcset->range_starts[mbcset->nranges] = start_wc;
-        mbcset->range_ends[mbcset->nranges++] = end_wc;
+	/* There are not enough space, need realloc.  */
+	wchar_t *new_array_start, *new_array_end;
+	int new_nranges;
+
+	/* +1 in case of mbcset->nranges is 0.  */
+	new_nranges = 2 * mbcset->nranges + 1;
+	/* Use realloc since mbcset->range_starts and mbcset->range_ends
+	   are NULL if *range_alloc == 0.  */
+	new_array_start = re_realloc (mbcset->range_starts, wchar_t,
+				      new_nranges);
+	new_array_end = re_realloc (mbcset->range_ends, wchar_t,
+				    new_nranges);
+
+	if (BE (new_array_start == NULL || new_array_end == NULL, 0))
+	  return REG_ESPACE;
+
+	mbcset->range_starts = new_array_start;
+	mbcset->range_ends = new_array_end;
+	*range_alloc = new_nranges;
       }
 
+    mbcset->range_starts[mbcset->nranges] = start_wc;
+    mbcset->range_ends[mbcset->nranges++] = end_wc;
+
     /* Build the table for single byte characters.  */
-    for (wc = 0; wc < SBC_MAX; ++wc)
+    for (wc = 0; wc <= SBC_MAX; ++wc)
       {
 	cmp_buf[2] = wc;
 	if (wcscoll (cmp_buf, cmp_buf + 2) <= 0
@@ -2750,7 +2604,7 @@
     if (start_ch > end_ch)
       return REG_ERANGE;
     /* Build the table for single byte characters.  */
-    for (ch = 0; ch < SBC_MAX; ++ch)
+    for (ch = 0; ch <= SBC_MAX; ++ch)
       if (start_ch <= ch  && ch <= end_ch)
 	bitset_set (sbcset, ch);
   }
@@ -2811,7 +2665,7 @@
      Seek the collating symbol entry correspondings to NAME.
      Return the index of the symbol in the SYMB_TABLE.  */
 
-  auto inline int32_t
+  static inline int32_t
   __attribute ((always_inline))
   seek_collating_symbol_entry (name, name_len)
 	 const unsigned char *name;
@@ -2844,7 +2698,7 @@
      Look up the collation sequence value of BR_ELEM.
      Return the value if succeeded, UINT_MAX otherwise.  */
 
-  auto inline unsigned int
+  static inline unsigned int
   __attribute ((always_inline))
   lookup_collation_sequence_value (br_elem)
 	 bracket_elem_t *br_elem;
@@ -2912,11 +2766,15 @@
      mbcset->range_ends, is a pointer argument sinse we may
      update it.  */
 
-  auto inline reg_errcode_t
+  static inline reg_errcode_t
   __attribute ((always_inline))
+# ifdef RE_ENABLE_I18N
   build_range_exp (sbcset, mbcset, range_alloc, start_elem, end_elem)
 	 re_charset_t *mbcset;
 	 int *range_alloc;
+# else /* not RE_ENABLE_I18N */
+  build_range_exp (sbcset, start_elem, end_elem)
+# endif /* not RE_ENABLE_I18N */
 	 re_bitset_ptr_t sbcset;
 	 bracket_elem_t *start_elem, *end_elem;
     {
@@ -2924,6 +2782,33 @@
       uint32_t start_collseq;
       uint32_t end_collseq;
 
+# ifdef RE_ENABLE_I18N
+      /* Check the space of the arrays.  */
+      if (BE (*range_alloc == mbcset->nranges, 0))
+	{
+	  /* There are not enough space, need realloc.  */
+	  uint32_t *new_array_start;
+	  uint32_t *new_array_end;
+	  int new_nranges;
+
+	  /* +1 in case of mbcset->nranges is 0.  */
+	  new_nranges = 2 * mbcset->nranges + 1;
+	  /* Use realloc since mbcset->range_starts and mbcset->range_ends
+	     are NULL if *range_alloc == 0.  */
+	  new_array_start = re_realloc (mbcset->range_starts, uint32_t,
+					new_nranges);
+	  new_array_end = re_realloc (mbcset->range_ends, uint32_t,
+				      new_nranges);
+
+	  if (BE (new_array_start == NULL || new_array_end == NULL, 0))
+	    return REG_ESPACE;
+
+	  mbcset->range_starts = new_array_start;
+	  mbcset->range_ends = new_array_end;
+	  *range_alloc = new_nranges;
+	}
+# endif /* RE_ENABLE_I18N */
+
       /* Equivalence Classes and Character Classes can't be a range
 	 start/end.  */
       if (BE (start_elem->type == EQUIV_CLASS || start_elem->type == CHAR_CLASS
@@ -2939,41 +2824,14 @@
       if (BE ((syntax & RE_NO_EMPTY_RANGES) && start_collseq > end_collseq, 0))
 	return REG_ERANGE;
 
-      /* Got valid collation sequence values, add them as a new entry.
-	 However, if we have no collation elements, and the character set
-	 is single byte, the single byte character set that we
-	 build below suffices. */
-      if (nrules > 0 || dfa->mb_cur_max > 1)
-	{
-          /* Check the space of the arrays.  */
-          if (BE (*range_alloc == mbcset->nranges, 0))
-	    {
-	      /* There is not enough space, need realloc.  */
-	      uint32_t *new_array_start;
-	      uint32_t *new_array_end;
-	      int new_nranges;
-
-	      /* +1 in case of mbcset->nranges is 0.  */
-	      new_nranges = 2 * mbcset->nranges + 1;
-	      new_array_start = re_realloc (mbcset->range_starts, uint32_t,
-					    new_nranges);
-	      new_array_end = re_realloc (mbcset->range_ends, uint32_t,
-				          new_nranges);
-
-	      if (BE (new_array_start == NULL || new_array_end == NULL, 0))
-	        return REG_ESPACE;
-
-	      mbcset->range_starts = new_array_start;
-	      mbcset->range_ends = new_array_end;
-	      *range_alloc = new_nranges;
-	    }
-
-          mbcset->range_starts[mbcset->nranges] = start_collseq;
-          mbcset->range_ends[mbcset->nranges++] = end_collseq;
-	}
+# ifdef RE_ENABLE_I18N
+      /* Got valid collation sequence values, add them as a new entry.  */
+      mbcset->range_starts[mbcset->nranges] = start_collseq;
+      mbcset->range_ends[mbcset->nranges++] = end_collseq;
+# endif /* RE_ENABLE_I18N */
 
       /* Build the table for single byte characters.  */
-      for (ch = 0; ch < SBC_MAX; ch++)
+      for (ch = 0; ch <= SBC_MAX; ch++)
 	{
 	  uint32_t ch_collseq;
 	  /*
@@ -2995,11 +2853,15 @@
      COLL_SYM_ALLOC is the allocated size of mbcset->coll_sym, is a
      pointer argument sinse we may update it.  */
 
-  auto inline reg_errcode_t
+  static inline reg_errcode_t
   __attribute ((always_inline))
+# ifdef RE_ENABLE_I18N
   build_collating_symbol (sbcset, mbcset, coll_sym_alloc, name)
 	 re_charset_t *mbcset;
 	 int *coll_sym_alloc;
+# else /* not RE_ENABLE_I18N */
+  build_collating_symbol (sbcset, name)
+# endif /* not RE_ENABLE_I18N */
 	 re_bitset_ptr_t sbcset;
 	 const unsigned char *name;
     {
@@ -3025,6 +2887,7 @@
 	  else
 	    return REG_ECOLLATE;
 
+# ifdef RE_ENABLE_I18N
 	  /* Got valid collation sequence, add it as a new entry.  */
 	  /* Check the space of the arrays.  */
 	  if (BE (*coll_sym_alloc == mbcset->ncoll_syms, 0))
@@ -3042,6 +2905,7 @@
 	      *coll_sym_alloc = new_coll_sym_alloc;
 	    }
 	  mbcset->coll_syms[mbcset->ncoll_syms++] = idx;
+# endif /* RE_ENABLE_I18N */
 	  return REG_NOERROR;
 	}
       else
@@ -3063,8 +2927,9 @@
   re_charset_t *mbcset;
   int coll_sym_alloc = 0, range_alloc = 0, mbchar_alloc = 0;
   int equiv_class_alloc = 0, char_class_alloc = 0;
-#endif /* not RE_ENABLE_I18N */
+#else /* not RE_ENABLE_I18N */
   int non_match = 0;
+#endif /* not RE_ENABLE_I18N */
   bin_tree_t *work_tree;
   int token_len;
   int first_round = 1;
@@ -3109,8 +2974,9 @@
     {
 #ifdef RE_ENABLE_I18N
       mbcset->non_match = 1;
-#endif /* not RE_ENABLE_I18N */
+#else /* not RE_ENABLE_I18N */
       non_match = 1;
+#endif /* not RE_ENABLE_I18N */
       if (syntax & RE_HAT_LISTS_NOT_NEWLINE)
 	bitset_set (sbcset, '\0');
       re_string_skip_bytes (regexp, token_len); /* Skip a token.  */
@@ -3189,18 +3055,11 @@
 
 	  token_len = peek_token_bracket (token, regexp, syntax);
 
-#ifdef _LIBC
-	  *err = build_range_exp (sbcset, mbcset, &range_alloc,
-				  &start_elem, &end_elem);
-#else
-# ifdef RE_ENABLE_I18N
 	  *err = build_range_exp (sbcset,
-				  dfa->mb_cur_max > 1 ? mbcset : NULL,
-				  &range_alloc, &start_elem, &end_elem);
-# else
-	  *err = build_range_exp (sbcset, &start_elem, &end_elem);
-# endif
+#ifdef RE_ENABLE_I18N
+				  mbcset, &range_alloc,
 #endif /* RE_ENABLE_I18N */
+				  &start_elem, &end_elem);
 	  if (BE (*err != REG_NOERROR, 0))
 	    goto parse_bracket_exp_free_return;
 	}
@@ -3274,66 +3133,67 @@
   re_string_skip_bytes (regexp, token_len); /* Skip a token.  */
 
   /* If it is non-matching list.  */
+#ifdef RE_ENABLE_I18N
+  if (mbcset->non_match)
+#else /* not RE_ENABLE_I18N */
   if (non_match)
+#endif /* not RE_ENABLE_I18N */
     bitset_not (sbcset);
-
 #ifdef RE_ENABLE_I18N
   /* Ensure only single byte characters are set.  */
   if (dfa->mb_cur_max > 1)
     bitset_mask (sbcset, dfa->sb_char);
+#endif /* RE_ENABLE_I18N */
 
+  /* Build a tree for simple bracket.  */
+  br_token.type = SIMPLE_BRACKET;
+  br_token.opr.sbcset = sbcset;
+  work_tree = re_dfa_add_tree_node (dfa, NULL, NULL, &br_token);
+  if (BE (work_tree == NULL, 0))
+    goto parse_bracket_exp_espace;
+
+#ifdef RE_ENABLE_I18N
   if (mbcset->nmbchars || mbcset->ncoll_syms || mbcset->nequiv_classes
       || mbcset->nranges || (dfa->mb_cur_max > 1 && (mbcset->nchar_classes
 						     || mbcset->non_match)))
     {
+      re_token_t alt_token;
       bin_tree_t *mbc_tree;
       int sbc_idx;
       /* Build a tree for complex bracket.  */
       dfa->has_mb_node = 1;
-      br_token.type = COMPLEX_BRACKET;
-      br_token.opr.mbcset = mbcset;
-      mbc_tree = create_token_tree (dfa, NULL, NULL, &br_token);
-      if (BE (mbc_tree == NULL, 0))
-	goto parse_bracket_exp_espace;
       for (sbc_idx = 0; sbc_idx < BITSET_UINTS; ++sbc_idx)
 	if (sbcset[sbc_idx])
 	  break;
       /* If there are no bits set in sbcset, there is no point
 	 of having both SIMPLE_BRACKET and COMPLEX_BRACKET.  */
-      if (sbc_idx < BITSET_UINTS)
-	{
-          /* Build a tree for simple bracket.  */
-          br_token.type = SIMPLE_BRACKET;
-          br_token.opr.sbcset = sbcset;
-          work_tree = create_token_tree (dfa, NULL, NULL, &br_token);
-          if (BE (work_tree == NULL, 0))
-            goto parse_bracket_exp_espace;
-
-          /* Then join them by ALT node.  */
-          work_tree = create_tree (dfa, work_tree, mbc_tree, OP_ALT);
-          if (BE (work_tree == NULL, 0))
-            goto parse_bracket_exp_espace;
-	}
-      else
+      if (sbc_idx == BITSET_UINTS)
 	{
 	  re_free (sbcset);
-	  work_tree = mbc_tree;
+	  dfa->nodes[work_tree->node_idx].type = COMPLEX_BRACKET;
+	  dfa->nodes[work_tree->node_idx].opr.mbcset = mbcset;
+	  return work_tree;
 	}
+      br_token.type = COMPLEX_BRACKET;
+      br_token.opr.mbcset = mbcset;
+      mbc_tree = re_dfa_add_tree_node (dfa, NULL, NULL, &br_token);
+      if (BE (mbc_tree == NULL, 0))
+	goto parse_bracket_exp_espace;
+      /* Then join them by ALT node.  */
+      alt_token.type = OP_ALT;
+      dfa->has_plural_match = 1;
+      work_tree = re_dfa_add_tree_node (dfa, work_tree, mbc_tree, &alt_token);
+      if (BE (mbc_tree != NULL, 1))
+	return work_tree;
     }
   else
-#endif /* not RE_ENABLE_I18N */
     {
-#ifdef RE_ENABLE_I18N
       free_charset (mbcset);
-#endif
-      /* Build a tree for simple bracket.  */
-      br_token.type = SIMPLE_BRACKET;
-      br_token.opr.sbcset = sbcset;
-      work_tree = create_token_tree (dfa, NULL, NULL, &br_token);
-      if (BE (work_tree == NULL, 0))
-        goto parse_bracket_exp_espace;
+      return work_tree;
     }
+#else /* not RE_ENABLE_I18N */
   return work_tree;
+#endif /* not RE_ENABLE_I18N */
 
  parse_bracket_exp_espace:
   *err = REG_ESPACE;
@@ -3401,18 +3261,14 @@
 {
   unsigned char ch, delim = token->opr.c;
   int i = 0;
-  if (re_string_eoi(regexp))
-    return REG_EBRACK;
   for (;; ++i)
     {
-      if (i >= BRACKET_NAME_BUF_SIZE)
+      if (re_string_eoi(regexp) || i >= BRACKET_NAME_BUF_SIZE)
 	return REG_EBRACK;
       if (token->type == OP_OPEN_CHAR_CLASS)
 	ch = re_string_fetch_byte_case (regexp);
       else
 	ch = re_string_fetch_byte (regexp);
-      if (re_string_eoi(regexp))
-	return REG_EBRACK;
       if (ch == delim && re_string_peek_byte (regexp, 0) == ']')
 	break;
       elem->opr.name[i] = ch;
@@ -3453,7 +3309,7 @@
      re_bitset_ptr_t sbcset;
      const unsigned char *name;
 {
-#if defined _LIBC
+#if defined _LIBC && defined RE_ENABLE_I18N
   uint32_t nrules = _NL_CURRENT_WORD (LC_COLLATE, _NL_COLLATE_NRULES);
   if (nrules != 0)
     {
@@ -3522,7 +3378,7 @@
       mbcset->equiv_classes[mbcset->nequiv_classes++] = idx1;
     }
   else
-#endif /* _LIBC */
+#endif /* _LIBC && RE_ENABLE_I18N */
     {
       if (BE (strlen ((const char *) name) != 1, 0))
 	return REG_ECOLLATE;
@@ -3545,7 +3401,7 @@
 #else /* not RE_ENABLE_I18N */
 build_charclass (trans, sbcset, class_name, syntax)
 #endif /* not RE_ENABLE_I18N */
-     unsigned RE_TRANSLATE_TYPE trans;
+     RE_TRANSLATE_TYPE trans;
      re_bitset_ptr_t sbcset;
      const unsigned char *class_name;
      reg_syntax_t syntax;
@@ -3618,18 +3474,20 @@
 }
 
 static bin_tree_t *
-build_charclass_op (dfa, trans, class_name, extra, non_match, err)
+build_charclass_op (dfa, trans, class_name, extra, not, err)
      re_dfa_t *dfa;
-     unsigned RE_TRANSLATE_TYPE trans;
+     RE_TRANSLATE_TYPE trans;
      const unsigned char *class_name;
      const unsigned char *extra;
-     int non_match;
+     int not;
      reg_errcode_t *err;
 {
   re_bitset_ptr_t sbcset;
 #ifdef RE_ENABLE_I18N
   re_charset_t *mbcset;
   int alloc = 0;
+#else /* not RE_ENABLE_I18N */
+  int non_match = 0;
 #endif /* not RE_ENABLE_I18N */
   reg_errcode_t ret;
   re_token_t br_token;
@@ -3650,7 +3508,7 @@
       return NULL;
     }
 
-  if (non_match)
+  if (not)
     {
 #ifdef RE_ENABLE_I18N
       /*
@@ -3658,6 +3516,8 @@
 	bitset_set(cset->sbcset, '\0');
       */
       mbcset->non_match = 1;
+#else /* not RE_ENABLE_I18N */
+      non_match = 1;
 #endif /* not RE_ENABLE_I18N */
     }
 
@@ -3682,7 +3542,11 @@
     bitset_set (sbcset, *extra);
 
   /* If it is non-matching list.  */
+#ifdef RE_ENABLE_I18N
+  if (mbcset->non_match)
+#else /* not RE_ENABLE_I18N */
   if (non_match)
+#endif /* not RE_ENABLE_I18N */
     bitset_not (sbcset);
 
 #ifdef RE_ENABLE_I18N
@@ -3694,23 +3558,26 @@
   /* Build a tree for simple bracket.  */
   br_token.type = SIMPLE_BRACKET;
   br_token.opr.sbcset = sbcset;
-  tree = create_token_tree (dfa, NULL, NULL, &br_token);
+  tree = re_dfa_add_tree_node (dfa, NULL, NULL, &br_token);
   if (BE (tree == NULL, 0))
     goto build_word_op_espace;
 
 #ifdef RE_ENABLE_I18N
   if (dfa->mb_cur_max > 1)
     {
+      re_token_t alt_token;
       bin_tree_t *mbc_tree;
       /* Build a tree for complex bracket.  */
       br_token.type = COMPLEX_BRACKET;
       br_token.opr.mbcset = mbcset;
       dfa->has_mb_node = 1;
-      mbc_tree = create_token_tree (dfa, NULL, NULL, &br_token);
+      mbc_tree = re_dfa_add_tree_node (dfa, NULL, NULL, &br_token);
       if (BE (mbc_tree == NULL, 0))
 	goto build_word_op_espace;
       /* Then join them by ALT node.  */
-      tree = create_tree (dfa, tree, mbc_tree, OP_ALT);
+      alt_token.type = OP_ALT;
+      dfa->has_plural_match = 1;
+      tree = re_dfa_add_tree_node (dfa, tree, mbc_tree, &alt_token);
       if (BE (mbc_tree != NULL, 1))
 	return tree;
     }
@@ -3781,23 +3648,12 @@
 /* Create a tree node.  */
 
 static bin_tree_t *
-create_tree (dfa, left, right, type)
+create_tree (dfa, left, right, type, index)
      re_dfa_t *dfa;
      bin_tree_t *left;
      bin_tree_t *right;
      re_token_type_t type;
-{
-  re_token_t t;
-  t.type = type;
-  return create_token_tree (dfa, left, right, &t);
-}
-
-static bin_tree_t *
-create_token_tree (dfa, left, right, token)
-     re_dfa_t *dfa;
-     bin_tree_t *left;
-     bin_tree_t *right;
-     const re_token_t *token;
+     int index;
 {
   bin_tree_t *tree;
   if (BE (dfa->str_tree_storage_idx == BIN_TREE_STORAGE_SIZE, 0))
@@ -3815,12 +3671,11 @@
   tree->parent = NULL;
   tree->left = left;
   tree->right = right;
-  tree->token = *token;
-  tree->token.duplicated = 0;
-  tree->token.opt_subexp = 0;
-  tree->first = NULL;
-  tree->next = NULL;
-  tree->node_idx = -1;
+  tree->type = type;
+  tree->node_idx = index;
+  tree->first = -1;
+  tree->next = -1;
+  re_node_set_init_empty (&tree->eclosure);
 
   if (left != NULL)
     left->parent = tree;
@@ -3829,89 +3684,103 @@
   return tree;
 }
 
-/* Mark the tree SRC as an optional subexpression.
-   To be called from preorder or postorder.  */
+/* Create both a DFA node and a tree for it.  */
 
-static reg_errcode_t
-mark_opt_subexp (extra, node)
-     void *extra;
-     bin_tree_t *node;
+static bin_tree_t *
+re_dfa_add_tree_node (dfa, left, right, token)
+     re_dfa_t *dfa;
+     bin_tree_t *left;
+     bin_tree_t *right;
+     const re_token_t *token;
 {
-  int idx = (int) (long) extra;
-  if (node->token.type == SUBEXP && node->token.opr.idx == idx)
-    node->token.opt_subexp = 1;
+  int new_idx = re_dfa_add_node (dfa, *token, 0);
 
-  return REG_NOERROR;
+  if (new_idx == -1)
+    return NULL;
+
+  return create_tree (dfa, left, right, 0, new_idx);
 }
 
-/* Free the allocated memory inside NODE. */
+/* Mark the tree SRC as an optional subexpression.  */
 
 static void
-free_token (re_token_t *node)
+mark_opt_subexp (src, dfa)
+     const bin_tree_t *src;
+     re_dfa_t *dfa;
 {
-#ifdef RE_ENABLE_I18N
-  if (node->type == COMPLEX_BRACKET && node->duplicated == 0)
-    free_charset (node->opr.mbcset);
-  else
-#endif /* RE_ENABLE_I18N */
-    if (node->type == SIMPLE_BRACKET && node->duplicated == 0)
-      re_free (node->opr.sbcset);
+  /* Pass an OPT_SUBEXP_IDX which is != 1 if the duplicated tree is
+     a subexpression.  */
+  if (src->type == CONCAT
+      && src->left->type == NON_TYPE
+      && dfa->nodes[src->left->node_idx].type == OP_OPEN_SUBEXP)
+    mark_opt_subexp_iter (src, dfa, dfa->nodes[src->left->node_idx].opr.idx);
 }
 
-/* Worker function for tree walking.  Free the allocated memory inside NODE
-   and its children. */
 
-static reg_errcode_t
-free_tree (void *extra, bin_tree_t *node)
+/* Recursive tree walker for mark_opt_subexp.  */
+
+static void
+mark_opt_subexp_iter (src, dfa, idx)
+     const bin_tree_t *src;
+     re_dfa_t *dfa;
+     int idx;
 {
-  free_token (&node->token);
-  return REG_NOERROR;
+  int node_idx;
+
+  if (src->type == NON_TYPE)
+    {
+      node_idx = src->node_idx;
+      if ((dfa->nodes[node_idx].type == OP_OPEN_SUBEXP
+	   || dfa->nodes[node_idx].type == OP_CLOSE_SUBEXP)
+	  && dfa->nodes[node_idx].opr.idx == idx)
+	dfa->nodes[node_idx].opt_subexp = 1;
+     }
+
+  if (src->left != NULL)
+    mark_opt_subexp_iter (src->left, dfa, idx);
+
+  if (src->right != NULL)
+    mark_opt_subexp_iter (src->right, dfa, idx);
 }
 
 
-/* Duplicate the node SRC, and return new node.  This is a preorder
-   visit similar to the one implemented by the generic visitor, but
-   we need more infrastructure to maintain two parallel trees --- so,
-   it's easier to duplicate.  */
+/* Duplicate the node SRC, and return new node.  */
 
 static bin_tree_t *
-duplicate_tree (root, dfa)
-     const bin_tree_t *root;
+duplicate_tree (src, dfa)
+     const bin_tree_t *src;
      re_dfa_t *dfa;
 {
-  const bin_tree_t *node;
-  bin_tree_t *dup_root;
-  bin_tree_t **p_new = &dup_root, *dup_node = root->parent;
+  bin_tree_t *left = NULL, *right = NULL, *new_tree;
+  int new_node_idx;
+  /* Since node indies must be according to Post-order of the tree,
+     we must duplicate the left at first.  */
+  if (src->left != NULL)
+    {
+      left = duplicate_tree (src->left, dfa);
+      if (left == NULL)
+	return NULL;
+    }
 
-  for (node = root; ; )
+  /* Secondaly, duplicate the right.  */
+  if (src->right != NULL)
     {
-      /* Create a new tree and link it back to the current parent.  */
-      *p_new = create_token_tree (dfa, NULL, NULL, &node->token);
-      if (*p_new == NULL)
+      right = duplicate_tree (src->right, dfa);
+      if (right == NULL)
 	return NULL;
-      (*p_new)->parent = dup_node;
-      (*p_new)->token.duplicated = 1;
-      dup_node = *p_new;
+    }
 
-      /* Go to the left node, or up and to the right.  */
-      if (node->left)
-	{
-	  node = node->left;
-	  p_new = &dup_node->left;
-	}
-      else
-	{
-	  const bin_tree_t *prev = NULL;
-	  while (node->right == prev || node->right == NULL)
-	    {
-	      prev = node;
-	      node = node->parent;
-	      dup_node = dup_node->parent;
-	      if (!node)
-	        return dup_root;
-	    }
-	  node = node->right;
-	  p_new = &dup_node->right;
-	}
+  /* At last, duplicate itself.  */
+  if (src->type == NON_TYPE)
+    {
+      new_node_idx = re_dfa_add_node (dfa, dfa->nodes[src->node_idx], 0);
+      dfa->nodes[new_node_idx].duplicated = 1;
+      if (BE (new_node_idx == -1, 0))
+	return NULL;
     }
+  else
+    new_node_idx = src->type;
+
+  new_tree = create_tree (dfa, left, right, src->type, new_node_idx);
+  return new_tree;
 }
--- 4.1.4/lib/regex.c
+++ 4.0.9/lib/regex.c
@@ -22,21 +22,21 @@
 #include "config.h"
 #endif
 
-#ifdef _AIX
+#if defined(_AIX)
 #pragma alloca
 #else
-# ifndef allocax           /* predefined by HP cc +Olibcalls */
+# if !defined(alloca)           /* predefined by HP cc +Olibcalls */
 #  ifdef __GNUC__
-#   define alloca(size) __builtin_alloca (size)
+#   define alloca(size) __builtin_alloca(size)
 #  else
 #   if HAVE_ALLOCA_H
 #    include <alloca.h>
 #   else
-#    ifdef __hpux
-        void *alloca ();
+#    if defined(__hpux)
+	void *alloca ();
 #    else
-#     if !defined __OS2__ && !defined WIN32
-        char *alloca ();
+#     if !defined(__OS2__) && !defined(WIN32)
+	char *alloca ();
 #     else
 #      include <malloc.h>       /* OS/2 defines alloca in here */
 #     endif
@@ -74,12 +74,6 @@
 /* POSIX says that <sys/types.h> must be included (by the caller) before
    <regex.h>.  */
 #include <sys/types.h>
-
-/* On some systems, limits.h sets RE_DUP_MAX to a lower value than
-   GNU regex allows.  Include it before <regex.h>, which correctly
-   #undefs RE_DUP_MAX and sets it to the right value.  */
-#include <limits.h>
-
 #include <regex.h>
 #include "regex_internal.h"
 
--- 4.1.4/lib/regexec.c
+++ 4.0.9/lib/regexec.c
@@ -22,11 +22,14 @@
 				     int n) internal_function;
 static void match_ctx_clean (re_match_context_t *mctx) internal_function;
 static void match_ctx_free (re_match_context_t *cache) internal_function;
+static void match_ctx_free_subtops (re_match_context_t *mctx)
+     internal_function;
 static reg_errcode_t match_ctx_add_entry (re_match_context_t *cache, int node,
 					  int str_idx, int from, int to)
      internal_function;
 static int search_cur_bkref_entry (re_match_context_t *mctx, int str_idx)
      internal_function;
+static void match_ctx_clear_flag (re_match_context_t *mctx) internal_function;
 static reg_errcode_t match_ctx_add_subtop (re_match_context_t *mctx, int node,
 					   int str_idx) internal_function;
 static re_sub_match_last_t * match_ctx_add_sublast (re_sub_match_top_t *subtop,
@@ -34,7 +37,7 @@
      internal_function;
 static void sift_ctx_init (re_sift_context_t *sctx, re_dfastate_t **sifted_sts,
 			   re_dfastate_t **limited_sts, int last_node,
-			   int last_str_idx)
+			   int last_str_idx, int check_subexp)
      internal_function;
 static reg_errcode_t re_search_internal (const regex_t *preg,
 					 const char *string, int length,
@@ -57,8 +60,7 @@
      __attribute ((always_inline)) internal_function;
 static reg_errcode_t prune_impossible_nodes (re_match_context_t *mctx)
      internal_function;
-static int check_matching (re_match_context_t *mctx, int fl_longest_match,
-			   int *p_match_first)
+static int check_matching (re_match_context_t *mctx, int fl_longest_match)
      internal_function;
 static int check_halt_node_context (const re_dfa_t *dfa, int node,
 				    unsigned int context) internal_function;
@@ -73,7 +75,7 @@
 			      int *pidx, int node, re_node_set *eps_via_nodes,
 			      struct re_fail_stack_t *fs) internal_function;
 static reg_errcode_t push_fail_stack (struct re_fail_stack_t *fs,
-				      int str_idx, int dest_node, int nregs,
+				      int str_idx, int *dests, int nregs,
 				      regmatch_t *regs,
 				      re_node_set *eps_via_nodes) internal_function;
 static int pop_fail_stack (struct re_fail_stack_t *fs, int *pidx, int nregs,
@@ -91,9 +93,6 @@
 #endif /* RE_ENABLE_I18N */
 static reg_errcode_t sift_states_backward (re_match_context_t *mctx,
 					   re_sift_context_t *sctx) internal_function;
-static reg_errcode_t build_sifted_states (re_match_context_t *mctx,
-					  re_sift_context_t *sctx, int str_idx,
-					  re_node_set *cur_dest) internal_function;
 static reg_errcode_t update_cur_sifted_state (re_match_context_t *mctx,
 					      re_sift_context_t *sctx,
 					      int str_idx,
@@ -107,13 +106,9 @@
 static int check_dst_limits (re_match_context_t *mctx, re_node_set *limits,
 			     int dst_node, int dst_idx, int src_node,
 			     int src_idx) internal_function;
-static int check_dst_limits_calc_pos_1 (re_match_context_t *mctx,
-					int boundaries, int subexp_idx,
-					int from_node, int bkref_idx) internal_function;
 static int check_dst_limits_calc_pos (re_match_context_t *mctx,
-				      int limit, int subexp_idx,
-				      int node, int str_idx,
-				      int bkref_idx) internal_function;
+				      int limit, re_node_set *eclosures,
+				      int subexp_idx, int node, int str_idx) internal_function;
 static reg_errcode_t check_subexp_limits (re_dfa_t *dfa,
 					  re_node_set *dest_nodes,
 					  const re_node_set *candidates,
@@ -122,19 +117,14 @@
 					  int str_idx) internal_function;
 static reg_errcode_t sift_states_bkref (re_match_context_t *mctx,
 					re_sift_context_t *sctx,
-					int str_idx, const re_node_set *candidates) internal_function;
+					int str_idx, re_node_set *dest_nodes) internal_function;
 static reg_errcode_t clean_state_log_if_needed (re_match_context_t *mctx,
 					        int next_state_log_idx) internal_function;
 static reg_errcode_t merge_state_array (re_dfa_t *dfa, re_dfastate_t **dst,
 					re_dfastate_t **src, int num) internal_function;
-static re_dfastate_t *find_recover_state (reg_errcode_t *err,
-					 re_match_context_t *mctx) internal_function;
 static re_dfastate_t *transit_state (reg_errcode_t *err,
 				     re_match_context_t *mctx,
 				     re_dfastate_t *state) internal_function;
-static re_dfastate_t *merge_state_with_log (reg_errcode_t *err,
-					    re_match_context_t *mctx,
-					    re_dfastate_t *next_state) internal_function;
 static reg_errcode_t check_subexp_matching_top (re_match_context_t *mctx,
 						re_node_set *cur_nodes,
 						int str_idx) internal_function;
@@ -174,9 +164,10 @@
 						   int type) internal_function;
 static reg_errcode_t expand_bkref_cache (re_match_context_t *mctx,
 					 re_node_set *cur_nodes, int cur_str,
-					 int subexp_num, int type) internal_function;
-static int build_trtable (re_dfa_t *dfa,
-			  re_dfastate_t *state) internal_function;
+					 int last_str, int subexp_num,
+					 int type) internal_function;
+static re_dfastate_t **build_trtable (re_dfa_t *dfa,
+				      re_dfastate_t *state) internal_function;
 #ifdef RE_ENABLE_I18N
 static int check_node_accept_bytes (re_dfa_t *dfa, int node_idx,
 				    const re_string_t *input, int idx) internal_function;
@@ -218,48 +209,17 @@
     int eflags;
 {
   reg_errcode_t err;
-  int start, length;
-
-  if (eflags & ~(REG_NOTBOL | REG_NOTEOL | REG_STARTEND))
-    return REG_BADPAT;
-
-  if (eflags & REG_STARTEND)
-    {
-      start = pmatch[0].rm_so;
-      length = pmatch[0].rm_eo;
-    }
-  else
-    {
-      start = 0;
-      length = strlen (string);
-    }
+  int length = strlen (string);
   if (preg->no_sub)
-    err = re_search_internal (preg, string, length, start, length - start,
-			      length, 0, NULL, eflags);
+    err = re_search_internal (preg, string, length, 0, length, length, 0,
+			      NULL, eflags);
   else
-    err = re_search_internal (preg, string, length, start, length - start,
-			      length, nmatch, pmatch, eflags);
+    err = re_search_internal (preg, string, length, 0, length, length, nmatch,
+			      pmatch, eflags);
   return err != REG_NOERROR;
 }
-
 #ifdef _LIBC
-# include <shlib-compat.h>
-versioned_symbol (libc, __regexec, regexec, GLIBC_2_3_4);
-
-# if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_3_4)
-__typeof__ (__regexec) __compat_regexec;
-
-int
-attribute_compat_text_section
-__compat_regexec (const regex_t *__restrict preg,
-		  const char *__restrict string, size_t nmatch,
-		  regmatch_t pmatch[], int eflags)
-{
-  return regexec (preg, string, nmatch, pmatch,
-		  eflags & (REG_NOTBOL | REG_NOTEOL));
-}
-compat_symbol (libc, __compat_regexec, regexec, GLIBC_2_0);
-# endif
+weak_alias (__regexec, regexec)
 #endif
 
 /* Entry points for GNU code.  */
@@ -581,6 +541,8 @@
 }
 #endif /* _REGEX_RE_COMP */
 
+static re_node_set empty_set;
+
 /* Internal entry point.  */
 
 /* Searches for a compiled pattern PREG in the string STRING, whose
@@ -604,26 +566,21 @@
   reg_errcode_t err;
   re_dfa_t *dfa = (re_dfa_t *)preg->buffer;
   int left_lim, right_lim, incr;
-  int fl_longest_match, match_first, match_kind, match_last = -1;
-  int extra_nmatch;
-  int sb, ch;
+  int fl_longest_match, match_first, match_last = -1;
+  int fast_translate, sb;
 #if defined _LIBC || (defined __STDC_VERSION__ && __STDC_VERSION__ >= 199901L)
   re_match_context_t mctx = { .dfa = dfa };
 #else
   re_match_context_t mctx;
 #endif
-  char *fastmap = (preg->fastmap != NULL && preg->fastmap_accurate
-		   && range && !preg->can_be_null) ? preg->fastmap : NULL;
-  unsigned RE_TRANSLATE_TYPE t = (unsigned RE_TRANSLATE_TYPE) preg->translate;
+  char *fastmap = ((preg->fastmap != NULL && preg->fastmap_accurate
+		    && range && !preg->can_be_null) ? preg->fastmap : NULL);
 
 #if !(defined _LIBC || (defined __STDC_VERSION__ && __STDC_VERSION__ >= 199901L))
   memset (&mctx, '\0', sizeof (re_match_context_t));
   mctx.dfa = dfa;
 #endif
 
-  extra_nmatch = (nmatch > preg->re_nsub) ? nmatch - (preg->re_nsub + 1) : 0;
-  nmatch -= extra_nmatch;
-
   /* Check if the DFA haven't been compiled.  */
   if (BE (preg->used == 0 || dfa->init_state == NULL
 	  || dfa->init_state_word == NULL || dfa->init_state_nl == NULL
@@ -648,6 +605,8 @@
       start = range = 0;
     }
 
+  re_node_set_init_empty (&empty_set);
+
   /* We must check the longest matching, if nmatch > 0.  */
   fl_longest_match = (nmatch != 0 || dfa->nbackref);
 
@@ -688,100 +647,88 @@
   left_lim = (range < 0) ? start + range : start;
   right_lim = (range < 0) ? start : start + range;
   sb = dfa->mb_cur_max == 1;
-  match_kind =
-    (fastmap
-     ? ((sb || !(preg->syntax & RE_ICASE || t) ? 4 : 0)
-	| (range >= 0 ? 2 : 0)
-	| (t != NULL ? 1 : 0))
-     : 8);
+  fast_translate = sb || !(preg->syntax & RE_ICASE || preg->translate);
 
-  for (;; match_first += incr)
+  for (;;)
     {
-      err = REG_NOMATCH;
-      if (match_first < left_lim || right_lim < match_first)
-	goto free_return;
-
-      /* Advance as rapidly as possible through the string, until we
-	 find a plausible place to start matching.  This may be done
-	 with varying efficiency, so there are various possibilities:
-	 only the most common of them are specialized, in order to
-	 save on code size.  We use a switch statement for speed.  */
-      switch (match_kind)
+      /* At first get the current byte from input string.  */
+      if (fastmap)
 	{
-	case 8:
-	  /* No fastmap.  */
-	  break;
-
-	case 7:
-	  /* Fastmap with single-byte translation, match forward.  */
-	  while (BE (match_first < right_lim, 1)
-		 && !fastmap[t[(unsigned char) string[match_first]]])
-	    ++match_first;
-	  goto forward_match_found_start_or_reached_end;
-
-	case 6:
-	  /* Fastmap without translation, match forward.  */
-	  while (BE (match_first < right_lim, 1)
-		 && !fastmap[(unsigned char) string[match_first]])
-	    ++match_first;
-
-	forward_match_found_start_or_reached_end:
-	  if (BE (match_first == right_lim, 0))
-	    {
-	      ch = match_first >= length
-		       ? 0 : (unsigned char) string[match_first];
-	      if (!fastmap[t ? t[ch] : ch])
-		goto free_return;
-	    }
-	  break;
-
-	case 4:
-	case 5:
-	  /* Fastmap without multi-byte translation, match backwards.  */
-	  while (match_first >= left_lim)
-	    {
-	      ch = match_first >= length
-		       ? 0 : (unsigned char) string[match_first];
-	      if (fastmap[t ? t[ch] : ch])
-		break;
-	      --match_first;
+	  if (BE (fast_translate, 1))
+	    {
+	      unsigned RE_TRANSLATE_TYPE t
+		= (unsigned RE_TRANSLATE_TYPE) preg->translate;
+	      if (BE (range >= 0, 1))
+		{
+		  if (BE (t != NULL, 0))
+		    {
+		      while (BE (match_first < right_lim, 1)
+			     && !fastmap[t[(unsigned char) string[match_first]]])
+			++match_first;
+		    }
+		  else
+		    {
+		      while (BE (match_first < right_lim, 1)
+			     && !fastmap[(unsigned char) string[match_first]])
+			++match_first;
+		    }
+		  if (BE (match_first == right_lim, 0))
+		    {
+		      int ch = match_first >= length
+			       ? 0 : (unsigned char) string[match_first];
+		      if (!fastmap[t ? t[ch] : ch])
+			break;
+		    }
+		}
+	      else
+		{
+		  while (match_first >= left_lim)
+		    {
+		      int ch = match_first >= length
+			       ? 0 : (unsigned char) string[match_first];
+		      if (fastmap[t ? t[ch] : ch])
+			break;
+		      --match_first;
+		    }
+		  if (match_first < left_lim)
+		    break;
+		}
 	    }
-	  if (match_first < left_lim)
-	    goto free_return;
-	  break;
+	  else
+	    {
+	      int ch;
 
-	default:
-	  /* In this case, we can't determine easily the current byte,
-	     since it might be a component byte of a multibyte
-	     character.  Then we use the constructed buffer instead.  */
-	  for (;;)
-	    {
-	      /* If MATCH_FIRST is out of the valid range, reconstruct the
-		 buffers.  */
-	      unsigned int offset = match_first - mctx.input.raw_mbs_idx;
-	      if (BE (offset >= (unsigned int) mctx.input.valid_raw_len, 0))
+	      do
 		{
-		  err = re_string_reconstruct (&mctx.input, match_first,
-					       eflags);
-		  if (BE (err != REG_NOERROR, 0))
-		    goto free_return;
-
-		  offset = match_first - mctx.input.raw_mbs_idx;
+		  /* In this case, we can't determine easily the current byte,
+		     since it might be a component byte of a multibyte
+		     character.  Then we use the constructed buffer
+		     instead.  */
+		  /* If MATCH_FIRST is out of the valid range, reconstruct the
+		     buffers.  */
+		  if (mctx.input.raw_mbs_idx + mctx.input.valid_raw_len
+		      <= match_first
+		      || match_first < mctx.input.raw_mbs_idx)
+		    {
+		      err = re_string_reconstruct (&mctx.input, match_first,
+						   eflags);
+		      if (BE (err != REG_NOERROR, 0))
+			goto free_return;
+		    }
+		  /* If MATCH_FIRST is out of the buffer, leave it as '\0'.
+		     Note that MATCH_FIRST must not be smaller than 0.  */
+		  ch = ((match_first >= length) ? 0
+		       : re_string_byte_at (&mctx.input,
+					    match_first
+					    - mctx.input.raw_mbs_idx));
+		  if (fastmap[ch])
+		    break;
+		  match_first += incr;
 		}
-	      /* If MATCH_FIRST is out of the buffer, leave it as '\0'.
-		 Note that MATCH_FIRST must not be smaller than 0.  */
-	      ch = (match_first >= length
-		    ? 0 : re_string_byte_at (&mctx.input, offset));
-	      if (fastmap[ch])
+	      while (match_first >= left_lim && match_first <= right_lim);
+	      if (! fastmap[ch])
 		break;
-	      match_first += incr;
-	      if (match_first < left_lim || match_first > right_lim)
-	        {
-	          err = REG_NOMATCH;
-	          goto free_return;
-	        }
 	    }
-	  break;
 	}
 
       /* Reconstruct the buffers so that the matcher can assume that
@@ -789,60 +736,56 @@
       err = re_string_reconstruct (&mctx.input, match_first, eflags);
       if (BE (err != REG_NOERROR, 0))
 	goto free_return;
-
 #ifdef RE_ENABLE_I18N
-     /* Don't consider this char as a possible match start if it part,
-	yet isn't the head, of a multibyte character.  */
-      if (!sb && !re_string_first_byte (&mctx.input, 0))
-	continue;
+     /* Eliminate it when it is a component of a multibyte character
+	 and isn't the head of a multibyte character.  */
+      if (sb || re_string_first_byte (&mctx.input, 0))
 #endif
-
-      /* It seems to be appropriate one, then use the matcher.  */
-      /* We assume that the matching starts from 0.  */
-      mctx.state_log_top = mctx.nbkref_ents = mctx.max_mb_elem_len = 0;
-      match_last = check_matching (&mctx, fl_longest_match,
-				   range >= 0 ? &match_first : NULL);
-      if (match_last != -1)
 	{
-	  if (BE (match_last == -2, 0))
+	  /* It seems to be appropriate one, then use the matcher.  */
+	  /* We assume that the matching starts from 0.  */
+	  mctx.state_log_top = mctx.nbkref_ents = mctx.max_mb_elem_len = 0;
+	  match_last = check_matching (&mctx, fl_longest_match);
+	  if (match_last != -1)
 	    {
-	      err = REG_ESPACE;
-	      goto free_return;
-	    }
-	  else
-	    {
-	      mctx.match_last = match_last;
-	      if ((!preg->no_sub && nmatch > 1) || dfa->nbackref)
+	      if (BE (match_last == -2, 0))
 		{
-		  re_dfastate_t *pstate = mctx.state_log[match_last];
-		  mctx.last_node = check_halt_state_context (&mctx, pstate,
-							     match_last);
+		  err = REG_ESPACE;
+		  goto free_return;
 		}
-	      if ((!preg->no_sub && nmatch > 1 && dfa->has_plural_match)
-		  || dfa->nbackref)
+	      else
 		{
-		  err = prune_impossible_nodes (&mctx);
-		  if (err == REG_NOERROR)
-		    break;
-		  if (BE (err != REG_NOMATCH, 0))
-		    goto free_return;
-		  match_last = -1;
+		  mctx.match_last = match_last;
+		  if ((!preg->no_sub && nmatch > 1) || dfa->nbackref)
+		    {
+		      re_dfastate_t *pstate = mctx.state_log[match_last];
+		      mctx.last_node = check_halt_state_context (&mctx, pstate,
+								 match_last);
+		    }
+		  if ((!preg->no_sub && nmatch > 1 && dfa->has_plural_match)
+		      || dfa->nbackref)
+		    {
+		      err = prune_impossible_nodes (&mctx);
+		      if (err == REG_NOERROR)
+			break;
+		      if (BE (err != REG_NOMATCH, 0))
+			goto free_return;
+		      match_last = -1;
+		    }
+		  else
+		    break; /* We found a match.  */
 		}
-	      else
-		break; /* We found a match.  */
 	    }
+	  match_ctx_clean (&mctx);
 	}
-
-      match_ctx_clean (&mctx);
+      /* Update counter.  */
+      match_first += incr;
+      if (match_first < left_lim || right_lim < match_first)
+	break;
     }
 
-#ifdef DEBUG
-  assert (match_last != -1);
-  assert (err == REG_NOERROR);
-#endif
-
   /* Set pmatch[] if we need.  */
-  if (nmatch > 0)
+  if (match_last != -1 && nmatch > 0)
     {
       int reg_idx;
 
@@ -886,23 +829,8 @@
 	    pmatch[reg_idx].rm_so += match_first;
 	    pmatch[reg_idx].rm_eo += match_first;
 	  }
-      for (reg_idx = 0; reg_idx < extra_nmatch; ++reg_idx)
-	{
-	  pmatch[nmatch + reg_idx].rm_so = -1;
-	  pmatch[nmatch + reg_idx].rm_eo = -1;
-	}
-
-      if (dfa->subexp_map)
-        for (reg_idx = 0; reg_idx + 1 < nmatch; reg_idx++)
-          if (dfa->subexp_map[reg_idx] != reg_idx)
-            {
-              pmatch[reg_idx + 1].rm_so
-                = pmatch[dfa->subexp_map[reg_idx] + 1].rm_so;
-              pmatch[reg_idx + 1].rm_eo
-                = pmatch[dfa->subexp_map[reg_idx] + 1].rm_eo;
-            }
     }
-
+  err = (match_last == -1) ? REG_NOMATCH : REG_NOERROR;
  free_return:
   re_free (mctx.state_log);
   if (dfa->nbackref)
@@ -944,8 +872,9 @@
 	{
 	  memset (lim_states, '\0',
 		  sizeof (re_dfastate_t *) * (match_last + 1));
+	  match_ctx_clear_flag (mctx);
 	  sift_ctx_init (&sctx, sifted_states, lim_states, halt_node,
-			 match_last);
+			 match_last, 0);
 	  ret = sift_states_backward (mctx, &sctx);
 	  re_node_set_free (&sctx.limits);
 	  if (BE (ret != REG_NOERROR, 0))
@@ -975,7 +904,8 @@
     }
   else
     {
-      sift_ctx_init (&sctx, sifted_states, lim_states, halt_node, match_last);
+      sift_ctx_init (&sctx, sifted_states, lim_states, halt_node,
+		     match_last, 0);
       ret = sift_states_backward (mctx, &sctx);
       re_node_set_free (&sctx.limits);
       if (BE (ret != REG_NOERROR, 0))
@@ -1004,6 +934,7 @@
      int idx;
 {
   re_dfa_t *const dfa = mctx->dfa;
+  *err = REG_NOERROR;
   if (dfa->init_state->has_constraint)
     {
       unsigned int context;
@@ -1019,9 +950,9 @@
       else if (IS_BEGBUF_CONTEXT (context))
 	{
 	  /* It is relatively rare case, then calculate on demand.  */
-	  return re_acquire_state_context (err, dfa,
-					   dfa->init_state->entrance_nodes,
-					   context);
+	  return  re_acquire_state_context (err, dfa,
+					    dfa->init_state->entrance_nodes,
+					    context);
 	}
       else
 	/* Must not happen?  */
@@ -1035,16 +966,13 @@
    and return the index where the matching end, return -1 if not match,
    or return -2 in case of an error.
    FL_LONGEST_MATCH means we want the POSIX longest matching.
-   If P_MATCH_FIRST is not NULL, and the match fails, it is set to the
-   next place where we may want to try matching.
    Note that the matcher assume that the maching starts from the current
    index of the buffer.  */
 
 static int
-check_matching (mctx, fl_longest_match, p_match_first)
+check_matching (mctx, fl_longest_match)
     re_match_context_t *mctx;
     int fl_longest_match;
-    int *p_match_first;
 {
   re_dfa_t *const dfa = mctx->dfa;
   reg_errcode_t err;
@@ -1052,37 +980,27 @@
   int match_last = -1;
   int cur_str_idx = re_string_cur_idx (&mctx->input);
   re_dfastate_t *cur_state;
-  int at_init_state = p_match_first != NULL;
-  int next_start_idx = cur_str_idx;
 
-  err = REG_NOERROR;
   cur_state = acquire_init_state_context (&err, mctx, cur_str_idx);
-  /* An initial state must not be NULL (invalid).  */
+  /* An initial state must not be NULL(invalid state).  */
   if (BE (cur_state == NULL, 0))
-    {
-      assert (err == REG_ESPACE);
-      return -2;
-    }
-
+    return -2;
   if (mctx->state_log != NULL)
+    mctx->state_log[cur_str_idx] = cur_state;
+
+  /* Check OP_OPEN_SUBEXP in the initial state in case that we use them
+     later.  E.g. Processing back references.  */
+  if (BE (dfa->nbackref, 0))
     {
-      mctx->state_log[cur_str_idx] = cur_state;
+      err = check_subexp_matching_top (mctx, &cur_state->nodes, 0);
+      if (BE (err != REG_NOERROR, 0))
+	return err;
 
-      /* Check OP_OPEN_SUBEXP in the initial state in case that we use them
-	 later.  E.g. Processing back references.  */
-      if (BE (dfa->nbackref, 0))
+      if (cur_state->has_backref)
 	{
-	  at_init_state = 0;
-	  err = check_subexp_matching_top (mctx, &cur_state->nodes, 0);
+	  err = transit_state_bkref (mctx, &cur_state->nodes);
 	  if (BE (err != REG_NOERROR, 0))
 	    return err;
-
-	  if (cur_state->has_backref)
-	    {
-	      err = transit_state_bkref (mctx, &cur_state->nodes);
-	      if (BE (err != REG_NOERROR, 0))
-	        return err;
-	    }
 	}
     }
 
@@ -1104,50 +1022,33 @@
 
   while (!re_string_eoi (&mctx->input))
     {
-      re_dfastate_t *old_state = cur_state;
-      int next_char_idx = re_string_cur_idx (&mctx->input) + 1;
-
-      if (BE (next_char_idx >= mctx->input.bufs_len, 0)
-          || (BE (next_char_idx >= mctx->input.valid_len, 0)
-              && mctx->input.valid_len < mctx->input.len))
-        {
-          err = extend_buffers (mctx);
-          if (BE (err != REG_NOERROR, 0))
-	    {
-	      assert (err == REG_ESPACE);
-	      return -2;
-	    }
-        }
-
       cur_state = transit_state (&err, mctx, cur_state);
-      if (mctx->state_log != NULL)
-	cur_state = merge_state_with_log (&err, mctx, cur_state);
-
-      if (cur_state == NULL)
+      if (cur_state == NULL) /* Reached at the invalid state or an error.  */
 	{
-	  /* Reached the invalid state or an error.  Try to recover a valid
-	     state using the state log, if available and if we have not
-	     already found a valid (even if not the longest) match.  */
+	  cur_str_idx = re_string_cur_idx (&mctx->input);
 	  if (BE (err != REG_NOERROR, 0))
 	    return -2;
-
-	  if (mctx->state_log == NULL
-	      || (match && !fl_longest_match)
-	      || (cur_state = find_recover_state (&err, mctx)) == NULL)
+	  if (!fl_longest_match && match)
 	    break;
-	}
-
-      if (BE (at_init_state, 0))
-	{
-	  if (old_state == cur_state)
-	    next_start_idx = next_char_idx;
 	  else
-	    at_init_state = 0;
+	    {
+	      if (mctx->state_log == NULL)
+		break;
+	      else
+		{
+		  int max = mctx->state_log_top;
+		  for (; cur_str_idx <= max; ++cur_str_idx)
+		    if (mctx->state_log[cur_str_idx] != NULL)
+		      break;
+		  if (cur_str_idx > max)
+		    break;
+		}
+	    }
 	}
 
-      if (cur_state->halt)
+      if (cur_state != NULL && cur_state->halt)
 	{
-	  /* Reached a halt state.
+	  /* Reached at a halt state.
 	     Check the halt state can satisfy the current context.  */
 	  if (!cur_state->has_constraint
 	      || check_halt_state_context (mctx, cur_state,
@@ -1156,18 +1057,11 @@
 	      /* We found an appropriate halt state.  */
 	      match_last = re_string_cur_idx (&mctx->input);
 	      match = 1;
-
-	      /* We found a match, do not modify match_first below.  */
-	      p_match_first = NULL;
 	      if (!fl_longest_match)
 		break;
 	    }
 	}
-    }
-
-  if (p_match_first)
-    *p_match_first += next_start_idx;
-
+   }
   return match_last;
 }
 
@@ -1230,38 +1124,30 @@
   if (IS_EPSILON_NODE (dfa->nodes[node].type))
     {
       re_node_set *cur_nodes = &mctx->state_log[*pidx]->nodes;
-      re_node_set *edests = &dfa->edests[node];
-      int dest_node;
+      int ndest, dest_nodes[2];
       err = re_node_set_insert (eps_via_nodes, node);
       if (BE (err < 0, 0))
 	return -2;
-      /* Pick up a valid destination, or return -1 if none is found.  */
-      for (dest_node = -1, i = 0; i < edests->nelem; ++i)
+      /* Pick up valid destinations.  */
+      for (ndest = 0, i = 0; i < dfa->edests[node].nelem; ++i)
 	{
-	  int candidate = edests->elems[i];
+	  int candidate = dfa->edests[node].elems[i];
 	  if (!re_node_set_contains (cur_nodes, candidate))
 	    continue;
-          if (dest_node == -1)
-	    dest_node = candidate;
-
-          else
-	    {
-	      /* In order to avoid infinite loop like "(a*)*", return the second
-	         epsilon-transition if the first was already considered.  */
-	      if (re_node_set_contains (eps_via_nodes, dest_node))
-	        return candidate;
-
-	      /* Otherwise, push the second epsilon-transition on the fail stack.  */
-	      else if (fs != NULL
-		       && push_fail_stack (fs, *pidx, candidate, nregs, regs,
-				           eps_via_nodes))
-		return -2;
-
-	      /* We know we are going to exit.  */
-	      break;
-	    }
-	}
-      return dest_node;
+	  dest_nodes[0] = (ndest == 0) ? candidate : dest_nodes[0];
+	  dest_nodes[1] = (ndest == 1) ? candidate : dest_nodes[1];
+	  ++ndest;
+	}
+      if (ndest <= 1)
+	return ndest == 0 ? -1 : (ndest == 1 ? dest_nodes[0] : 0);
+      /* In order to avoid infinite loop like "(a*)*".  */
+      if (re_node_set_contains (eps_via_nodes, dest_nodes[0]))
+	return dest_nodes[1];
+      if (fs != NULL
+	  && push_fail_stack (fs, *pidx, dest_nodes, nregs, regs,
+			      eps_via_nodes))
+	return -2;
+      return dest_nodes[0];
     }
   else
     {
@@ -1269,13 +1155,13 @@
       re_token_type_t type = dfa->nodes[node].type;
 
 #ifdef RE_ENABLE_I18N
-      if (dfa->nodes[node].accept_mb)
+      if (ACCEPT_MB_NODE (type))
 	naccepted = check_node_accept_bytes (dfa, node, &mctx->input, *pidx);
       else
 #endif /* RE_ENABLE_I18N */
       if (type == OP_BACK_REF)
 	{
-	  int subexp_idx = dfa->nodes[node].opr.idx + 1;
+	  int subexp_idx = dfa->nodes[node].opr.idx;
 	  naccepted = regs[subexp_idx].rm_eo - regs[subexp_idx].rm_so;
 	  if (fs != NULL)
 	    {
@@ -1319,9 +1205,9 @@
 }
 
 static reg_errcode_t
-push_fail_stack (fs, str_idx, dest_node, nregs, regs, eps_via_nodes)
+push_fail_stack (fs, str_idx, dests, nregs, regs, eps_via_nodes)
      struct re_fail_stack_t *fs;
-     int str_idx, dest_node, nregs;
+     int str_idx, *dests, nregs;
      regmatch_t *regs;
      re_node_set *eps_via_nodes;
 {
@@ -1338,7 +1224,7 @@
       fs->stack = new_array;
     }
   fs->stack[num].idx = str_idx;
-  fs->stack[num].node = dest_node;
+  fs->stack[num].node = dests[1];
   fs->stack[num].regs = re_malloc (regmatch_t, nregs);
   if (fs->stack[num].regs == NULL)
     return REG_ESPACE;
@@ -1378,7 +1264,7 @@
      int fl_backtrack;
 {
   re_dfa_t *dfa = (re_dfa_t *) preg->buffer;
-  int idx, cur_node;
+  int idx, cur_node, real_nmatch;
   re_node_set eps_via_nodes;
   struct re_fail_stack_t *fs;
   struct re_fail_stack_t fs_body = { 0, 2, NULL };
@@ -1399,14 +1285,15 @@
     fs = NULL;
 
   cur_node = dfa->init_node;
+  real_nmatch = (nmatch <= preg->re_nsub) ? nmatch : preg->re_nsub + 1;
   re_node_set_init_empty (&eps_via_nodes);
 
-  prev_idx_match = (regmatch_t *) alloca (sizeof (regmatch_t) * nmatch);
-  memcpy (prev_idx_match, pmatch, sizeof (regmatch_t) * nmatch);
+  prev_idx_match = (regmatch_t *) alloca (sizeof (regmatch_t) * real_nmatch);
+  memcpy (prev_idx_match, pmatch, sizeof (regmatch_t) * real_nmatch);
 
   for (idx = pmatch[0].rm_so; idx <= pmatch[0].rm_eo ;)
     {
-      update_regs (dfa, pmatch, prev_idx_match, cur_node, idx, nmatch);
+      update_regs (dfa, pmatch, prev_idx_match, cur_node, idx, real_nmatch);
 
       if (idx == pmatch[0].rm_eo && cur_node == mctx->last_node)
 	{
@@ -1552,14 +1439,17 @@
      re_match_context_t *mctx;
      re_sift_context_t *sctx;
 {
+  re_dfa_t *const dfa = mctx->dfa;
   reg_errcode_t err;
   int null_cnt = 0;
   int str_idx = sctx->last_str_idx;
   re_node_set cur_dest;
+  re_node_set *cur_src; /* Points the state_log[str_idx]->nodes  */
 
 #ifdef DEBUG
   assert (mctx->state_log != NULL && mctx->state_log[str_idx] != NULL);
 #endif
+  cur_src = &mctx->state_log[str_idx]->nodes;
 
   /* Build sifted state_log[str_idx].  It has the nodes which can epsilon
      transit to the last_node and the last_node itself.  */
@@ -1573,6 +1463,7 @@
   /* Then check each states in the state_log.  */
   while (str_idx > 0)
     {
+      int i, ret;
       /* Update counters.  */
       null_cnt = (sctx->sifted_states[str_idx] == NULL) ? null_cnt + 1 : 0;
       if (null_cnt > mctx->max_mb_elem_len)
@@ -1584,12 +1475,56 @@
 	}
       re_node_set_empty (&cur_dest);
       --str_idx;
+      cur_src = ((mctx->state_log[str_idx] == NULL) ? &empty_set
+		 : &mctx->state_log[str_idx]->nodes);
 
-      if (mctx->state_log[str_idx])
-	{
-	  err = build_sifted_states (mctx, sctx, str_idx, &cur_dest);
-          if (BE (err != REG_NOERROR, 0))
-	    goto free_return;
+      /* Then build the next sifted state.
+	 We build the next sifted state on `cur_dest', and update
+	 `sifted_states[str_idx]' with `cur_dest'.
+	 Note:
+	 `cur_dest' is the sifted state from `state_log[str_idx + 1]'.
+	 `cur_src' points the node_set of the old `state_log[str_idx]'.  */
+      for (i = 0; i < cur_src->nelem; i++)
+	{
+	  int prev_node = cur_src->elems[i];
+	  int naccepted = 0;
+	  re_token_type_t type = dfa->nodes[prev_node].type;
+
+	  if (IS_EPSILON_NODE (type))
+	    continue;
+#ifdef RE_ENABLE_I18N
+	  /* If the node may accept `multi byte'.  */
+	  if (ACCEPT_MB_NODE (type))
+	    naccepted = sift_states_iter_mb (mctx, sctx, prev_node,
+					     str_idx, sctx->last_str_idx);
+
+#endif /* RE_ENABLE_I18N */
+	  /* We don't check backreferences here.
+	     See update_cur_sifted_state().  */
+
+	  if (!naccepted
+	      && check_node_accept (mctx, dfa->nodes + prev_node, str_idx)
+	      && STATE_NODE_CONTAINS (sctx->sifted_states[str_idx + 1],
+				      dfa->nexts[prev_node]))
+	    naccepted = 1;
+
+	  if (naccepted == 0)
+	    continue;
+
+	  if (sctx->limits.nelem)
+	    {
+	      int to_idx = str_idx + naccepted;
+	      if (check_dst_limits (mctx, &sctx->limits,
+				    dfa->nexts[prev_node], to_idx,
+				    prev_node, str_idx))
+		continue;
+	    }
+	  ret = re_node_set_insert (&cur_dest, prev_node);
+	  if (BE (ret == -1, 0))
+	    {
+	      err = REG_ESPACE;
+	      goto free_return;
+	    }
 	}
 
       /* Add all the nodes which satisfy the following conditions:
@@ -1606,68 +1541,6 @@
   return err;
 }
 
-static reg_errcode_t
-build_sifted_states (mctx, sctx, str_idx, cur_dest)
-     re_match_context_t *mctx;
-     re_sift_context_t *sctx;
-     int str_idx;
-     re_node_set *cur_dest;
-{
-  re_dfa_t *const dfa = mctx->dfa;
-  re_node_set *cur_src = &mctx->state_log[str_idx]->non_eps_nodes;
-  int i;
-
-  /* Then build the next sifted state.
-     We build the next sifted state on `cur_dest', and update
-     `sifted_states[str_idx]' with `cur_dest'.
-     Note:
-     `cur_dest' is the sifted state from `state_log[str_idx + 1]'.
-     `cur_src' points the node_set of the old `state_log[str_idx]'
-     (with the epsilon nodes pre-filtered out).  */
-  for (i = 0; i < cur_src->nelem; i++)
-    {
-      int prev_node = cur_src->elems[i];
-      int naccepted = 0;
-      int ret;
-
-#ifdef DEBUG
-      re_token_type_t type = dfa->nodes[prev_node].type;
-      assert (!IS_EPSILON_NODE (type));
-#endif
-#ifdef RE_ENABLE_I18N
-      /* If the node may accept `multi byte'.  */
-      if (dfa->nodes[prev_node].accept_mb)
-	naccepted = sift_states_iter_mb (mctx, sctx, prev_node,
-					 str_idx, sctx->last_str_idx);
-#endif /* RE_ENABLE_I18N */
-
-      /* We don't check backreferences here.
-	 See update_cur_sifted_state().  */
-      if (!naccepted
-	  && check_node_accept (mctx, dfa->nodes + prev_node, str_idx)
-	  && STATE_NODE_CONTAINS (sctx->sifted_states[str_idx + 1],
-				  dfa->nexts[prev_node]))
-	naccepted = 1;
-
-      if (naccepted == 0)
-	continue;
-
-      if (sctx->limits.nelem)
-	{
-	  int to_idx = str_idx + naccepted;
-	  if (check_dst_limits (mctx, &sctx->limits,
-				dfa->nexts[prev_node], to_idx,
-				prev_node, str_idx))
-	    continue;
-	}
-      ret = re_node_set_insert (cur_dest, prev_node);
-      if (BE (ret == -1, 0))
-	return REG_ESPACE;
-    }
-
-  return REG_NOERROR;
-}
-
 /* Helper functions.  */
 
 static reg_errcode_t
@@ -1735,39 +1608,36 @@
   re_dfa_t *const dfa = mctx->dfa;
   reg_errcode_t err;
   const re_node_set *candidates;
-  candidates = ((mctx->state_log[str_idx] == NULL) ? NULL
+  candidates = ((mctx->state_log[str_idx] == NULL) ? &empty_set
 		: &mctx->state_log[str_idx]->nodes);
 
-  if (dest_nodes->nelem == 0)
-    sctx->sifted_states[str_idx] = NULL;
-  else
+  /* At first, add the nodes which can epsilon transit to a node in
+     DEST_NODE.  */
+  if (dest_nodes->nelem)
     {
-      if (candidates)
-	{
-	  /* At first, add the nodes which can epsilon transit to a node in
-	     DEST_NODE.  */
-	  err = add_epsilon_src_nodes (dfa, dest_nodes, candidates);
-	  if (BE (err != REG_NOERROR, 0))
-	    return err;
-
-	  /* Then, check the limitations in the current sift_context.  */
-	  if (sctx->limits.nelem)
-	    {
-	      err = check_subexp_limits (dfa, dest_nodes, candidates, &sctx->limits,
-					 mctx->bkref_ents, str_idx);
-	      if (BE (err != REG_NOERROR, 0))
-		return err;
-	    }
-	}
+      err = add_epsilon_src_nodes (dfa, dest_nodes, candidates);
+      if (BE (err != REG_NOERROR, 0))
+	return err;
+    }
 
-      sctx->sifted_states[str_idx] = re_acquire_state (&err, dfa, dest_nodes);
+  /* Then, check the limitations in the current sift_context.  */
+  if (dest_nodes->nelem && sctx->limits.nelem)
+    {
+      err = check_subexp_limits (dfa, dest_nodes, candidates, &sctx->limits,
+				 mctx->bkref_ents, str_idx);
       if (BE (err != REG_NOERROR, 0))
 	return err;
     }
 
-  if (candidates && mctx->state_log[str_idx]->has_backref)
+  /* Update state_log.  */
+  sctx->sifted_states[str_idx] = re_acquire_state (&err, dfa, dest_nodes);
+  if (BE (sctx->sifted_states[str_idx] == NULL && err != REG_NOERROR, 0))
+    return err;
+
+  if ((mctx->state_log[str_idx] != NULL
+       && mctx->state_log[str_idx]->has_backref))
     {
-      err = sift_states_bkref (mctx, sctx, str_idx, candidates);
+      err = sift_states_bkref (mctx, sctx, str_idx, dest_nodes);
       if (BE (err != REG_NOERROR, 0))
 	return err;
     }
@@ -1780,24 +1650,26 @@
      re_node_set *dest_nodes;
      const re_node_set *candidates;
 {
-  reg_errcode_t err = REG_NOERROR;
-  int i;
+  reg_errcode_t err;
+  int src_idx;
+  re_node_set src_copy;
 
-  re_dfastate_t *state = re_acquire_state (&err, dfa, dest_nodes);
+  err = re_node_set_init_copy (&src_copy, dest_nodes);
   if (BE (err != REG_NOERROR, 0))
     return err;
-
-  if (!state->inveclosure.alloc)
+  for (src_idx = 0; src_idx < src_copy.nelem; ++src_idx)
     {
-      err = re_node_set_alloc (&state->inveclosure, dest_nodes->nelem);
+      err = re_node_set_add_intersect (dest_nodes, candidates,
+				       dfa->inveclosures
+				       + src_copy.elems[src_idx]);
       if (BE (err != REG_NOERROR, 0))
-        return REG_ESPACE;
-      for (i = 0; i < dest_nodes->nelem; i++)
-        re_node_set_merge (&state->inveclosure,
-			   dfa->inveclosures + dest_nodes->elems[i]);
+	{
+	  re_node_set_free (&src_copy);
+	  return err;
+	}
     }
-  return re_node_set_add_intersect (dest_nodes, candidates,
-				    &state->inveclosure);
+  re_node_set_free (&src_copy);
+  return REG_NOERROR;
 }
 
 static reg_errcode_t
@@ -1860,21 +1732,19 @@
   re_dfa_t *const dfa = mctx->dfa;
   int lim_idx, src_pos, dst_pos;
 
-  int dst_bkref_idx = search_cur_bkref_entry (mctx, dst_idx);
-  int src_bkref_idx = search_cur_bkref_entry (mctx, src_idx);
   for (lim_idx = 0; lim_idx < limits->nelem; ++lim_idx)
     {
       int subexp_idx;
       struct re_backref_cache_entry *ent;
       ent = mctx->bkref_ents + limits->elems[lim_idx];
-      subexp_idx = dfa->nodes[ent->node].opr.idx;
+      subexp_idx = dfa->nodes[ent->node].opr.idx - 1;
 
       dst_pos = check_dst_limits_calc_pos (mctx, limits->elems[lim_idx],
-					   subexp_idx, dst_node, dst_idx,
-					   dst_bkref_idx);
+					   dfa->eclosures + dst_node,
+					   subexp_idx, dst_node, dst_idx);
       src_pos = check_dst_limits_calc_pos (mctx, limits->elems[lim_idx],
-					   subexp_idx, src_node, src_idx,
-					   src_bkref_idx);
+					   dfa->eclosures + src_node,
+					   subexp_idx, src_node, src_idx);
 
       /* In case of:
 	 <src> <dst> ( <subexp> )
@@ -1889,14 +1759,27 @@
 }
 
 static int
-check_dst_limits_calc_pos_1 (mctx, boundaries, subexp_idx, from_node, bkref_idx)
+check_dst_limits_calc_pos (mctx, limit, eclosures, subexp_idx, from_node,
+			   str_idx)
      re_match_context_t *mctx;
-     int boundaries, subexp_idx, from_node, bkref_idx;
+     re_node_set *eclosures;
+     int limit, subexp_idx, from_node, str_idx;
 {
   re_dfa_t *const dfa = mctx->dfa;
-  re_node_set *eclosures = dfa->eclosures + from_node;
+  struct re_backref_cache_entry *lim = mctx->bkref_ents + limit;
   int node_idx;
 
+  /* If we are outside the range of the subexpression, return -1 or 1.  */
+  if (str_idx < lim->subexp_from)
+    return -1;
+
+  if (lim->subexp_to < str_idx)
+    return 1;
+
+  /* If we are within the subexpression, return 0.  */
+  if (str_idx != lim->subexp_from && str_idx != lim->subexp_to)
+    return 0;
+
   /* Else, we are on the boundary: examine the nodes on the epsilon
      closure.  */
   for (node_idx = 0; node_idx < eclosures->nelem; ++node_idx)
@@ -1905,56 +1788,57 @@
       switch (dfa->nodes[node].type)
 	{
 	case OP_BACK_REF:
-	  if (bkref_idx != -1)
-	    {
-	      struct re_backref_cache_entry *ent = mctx->bkref_ents + bkref_idx;
-	      do
-	        {
-		  int dst, cpos;
+	  {
+	    int bi = search_cur_bkref_entry (mctx, str_idx);
+	    for (; bi < mctx->nbkref_ents; ++bi)
+	      {
+		struct re_backref_cache_entry *ent = mctx->bkref_ents + bi;
+		int dst, cpos;
 
-		  if (ent->node != node)
-		    continue;
+		/* If this backreference goes beyond the point we're
+		   examining, don't go any further.  */
+		if (ent->str_idx > str_idx)
+		  break;
 
-		  if (subexp_idx <= 8 * sizeof (ent->eps_reachable_subexps_map)
-		      && !(ent->eps_reachable_subexps_map & (1 << subexp_idx)))
-		    continue;
+		if (ent->node != node || ent->subexp_from != ent->subexp_to)
+		  continue;
 
-		  /* Recurse trying to reach the OP_OPEN_SUBEXP and
-		     OP_CLOSE_SUBEXP cases below.  But, if the
-		     destination node is the same node as the source
-		     node, don't recurse because it would cause an
-		     infinite loop: a regex that exhibits this behavior
-		     is ()\1*\1*  */
-		  dst = dfa->edests[node].elems[0];
-		  if (dst == from_node)
-		    {
-		      if (boundaries & 1)
-		        return -1;
-		      else /* if (boundaries & 2) */
-		        return 0;
-		    }
+		/* Recurse trying to reach the OP_OPEN_SUBEXP and
+		   OP_CLOSE_SUBEXP cases below.  But, if the
+		   destination node is the same node as the source
+		   node, don't recurse because it would cause an
+		   infinite loop: a regex that exhibits this behavior
+		   is ()\1*\1*  */
+		dst = dfa->edests[node].elems[0];
+		if (dst == from_node)
+		  {
+		    if (str_idx == lim->subexp_from)
+		      return -1;
+		    else /* if (str_idx == lim->subexp_to) */
+		      return 0;
+		  }
 
-		  cpos =
-		    check_dst_limits_calc_pos_1 (mctx, boundaries, subexp_idx,
-						 dst, bkref_idx);
-		  if (cpos == -1 /* && (boundaries & 1) */)
-		    return -1;
-		  if (cpos == 0 && (boundaries & 2))
-		    return 0;
+		cpos = check_dst_limits_calc_pos (mctx, limit,
+						  dfa->eclosures + dst,
+						  subexp_idx, dst,
+						  str_idx);
+
+		if (cpos == -1 && str_idx == lim->subexp_from)
+		  return -1;
 
-		  ent->eps_reachable_subexps_map &= ~(1 << subexp_idx);
-	        }
-	      while (ent++->more);
+		if (cpos == 0 /* && str_idx == lim->lim->subexp_to */)
+		  return 0;
+	      }
+	      break;
 	    }
-	  break;
 
 	case OP_OPEN_SUBEXP:
-	  if ((boundaries & 1) && subexp_idx == dfa->nodes[node].opr.idx)
+	  if (str_idx == lim->subexp_from && subexp_idx == dfa->nodes[node].opr.idx)
 	    return -1;
 	  break;
 
 	case OP_CLOSE_SUBEXP:
-	  if ((boundaries & 2) && subexp_idx == dfa->nodes[node].opr.idx)
+	  if (str_idx == lim->subexp_to && subexp_idx == dfa->nodes[node].opr.idx)
 	    return 0;
 	  break;
 
@@ -1963,33 +1847,10 @@
 	}
     }
 
-  return (boundaries & 2) ? 1 : 0;
-}
-
-static int
-check_dst_limits_calc_pos (mctx, limit, subexp_idx, from_node, str_idx, bkref_idx)
-     re_match_context_t *mctx;
-     int limit, subexp_idx, from_node, str_idx, bkref_idx;
-{
-  struct re_backref_cache_entry *lim = mctx->bkref_ents + limit;
-  int boundaries;
-
-  /* If we are outside the range of the subexpression, return -1 or 1.  */
-  if (str_idx < lim->subexp_from)
-    return -1;
-
-  if (lim->subexp_to < str_idx)
+  if (str_idx == lim->subexp_to)
     return 1;
-
-  /* If we are within the subexpression, return 0.  */
-  boundaries = (str_idx == lim->subexp_from);
-  boundaries |= (str_idx == lim->subexp_to) << 1;
-  if (boundaries == 0)
+  else
     return 0;
-
-  /* Else, examine epsilon closure.  */
-  return check_dst_limits_calc_pos_1 (mctx, boundaries, subexp_idx,
-				      from_node, bkref_idx);
 }
 
 /* Check the limitations of sub expressions LIMITS, and remove the nodes
@@ -2016,7 +1877,7 @@
       if (str_idx <= ent->subexp_from || ent->str_idx < str_idx)
 	continue; /* This is unrelated limitation.  */
 
-      subexp_idx = dfa->nodes[ent->node].opr.idx;
+      subexp_idx = dfa->nodes[ent->node].opr.idx - 1;
       if (ent->subexp_to == str_idx)
 	{
 	  int ops_node = -1;
@@ -2073,12 +1934,16 @@
 		{
 		  if (subexp_idx != dfa->nodes[node].opr.idx)
 		    continue;
-		  /* It is against this limitation.
-		     Remove it form the current sifted state.  */
-		  err = sub_epsilon_src_nodes (dfa, node, dest_nodes,
-					       candidates);
-		  if (BE (err != REG_NOERROR, 0))
-		    return err;
+		  if ((type == OP_CLOSE_SUBEXP && ent->subexp_to != str_idx)
+		      || (type == OP_OPEN_SUBEXP))
+		    {
+		      /* It is against this limitation.
+			 Remove it form the current sifted state.  */
+		      err = sub_epsilon_src_nodes (dfa, node, dest_nodes,
+						   candidates);
+		      if (BE (err != REG_NOERROR, 0))
+			return err;
+		    }
 		}
 	    }
 	}
@@ -2087,91 +1952,115 @@
 }
 
 static reg_errcode_t
-sift_states_bkref (mctx, sctx, str_idx, candidates)
+sift_states_bkref (mctx, sctx, str_idx, dest_nodes)
      re_match_context_t *mctx;
      re_sift_context_t *sctx;
      int str_idx;
-     const re_node_set *candidates;
+     re_node_set *dest_nodes;
 {
   re_dfa_t *const dfa = mctx->dfa;
   reg_errcode_t err;
   int node_idx, node;
   re_sift_context_t local_sctx;
-  int first_idx = search_cur_bkref_entry (mctx, str_idx);
-
-  if (first_idx == -1)
-    return REG_NOERROR;
-
+  const re_node_set *candidates;
+  candidates = ((mctx->state_log[str_idx] == NULL) ? &empty_set
+		: &mctx->state_log[str_idx]->nodes);
   local_sctx.sifted_states = NULL; /* Mark that it hasn't been initialized.  */
 
   for (node_idx = 0; node_idx < candidates->nelem; ++node_idx)
     {
-      int enabled_idx;
+      int cur_bkref_idx = re_string_cur_idx (&mctx->input);
       re_token_type_t type;
-      struct re_backref_cache_entry *entry;
       node = candidates->elems[node_idx];
       type = dfa->nodes[node].type;
+      if (node == sctx->cur_bkref && str_idx == cur_bkref_idx)
+	continue;
       /* Avoid infinite loop for the REs like "()\1+".  */
       if (node == sctx->last_node && str_idx == sctx->last_str_idx)
 	continue;
-      if (type != OP_BACK_REF)
-	continue;
-
-      entry = mctx->bkref_ents + first_idx;
-      enabled_idx = first_idx;
-      do
+      if (type == OP_BACK_REF)
 	{
-	  int subexp_len, to_idx, dst_node;
-	  re_dfastate_t *cur_state;
-
-	  if (entry->node != node)
-	    continue;
-	  subexp_len = entry->subexp_to - entry->subexp_from;
-	  to_idx = str_idx + subexp_len;
-	  dst_node = (subexp_len ? dfa->nexts[node]
-		      : dfa->edests[node].elems[0]);
-
-	  if (to_idx > sctx->last_str_idx
-	      || sctx->sifted_states[to_idx] == NULL
-	      || !STATE_NODE_CONTAINS (sctx->sifted_states[to_idx], dst_node)
-	      || check_dst_limits (mctx, &sctx->limits, node,
-				   str_idx, dst_node, to_idx))
-	    continue;
-
-	  if (local_sctx.sifted_states == NULL)
+	  int enabled_idx = search_cur_bkref_entry (mctx, str_idx);
+	  for (; enabled_idx < mctx->nbkref_ents; ++enabled_idx)
 	    {
-	      local_sctx = *sctx;
-	      err = re_node_set_init_copy (&local_sctx.limits, &sctx->limits);
-	      if (BE (err != REG_NOERROR, 0))
-		goto free_return;
-	    }
-	  local_sctx.last_node = node;
-	  local_sctx.last_str_idx = str_idx;
-	  err = re_node_set_insert (&local_sctx.limits, enabled_idx);
-	  if (BE (err < 0, 0))
-	    {
-	      err = REG_ESPACE;
-	      goto free_return;
+	      int disabled_idx, subexp_len, to_idx, dst_node;
+	      struct re_backref_cache_entry *entry;
+	      entry = mctx->bkref_ents + enabled_idx;
+	      if (entry->str_idx > str_idx)
+		break;
+	      if (entry->node != node)
+		  continue;
+	      subexp_len = entry->subexp_to - entry->subexp_from;
+	      to_idx = str_idx + subexp_len;
+	      dst_node = (subexp_len ? dfa->nexts[node]
+			  : dfa->edests[node].elems[0]);
+
+	      if (to_idx > sctx->last_str_idx
+		  || sctx->sifted_states[to_idx] == NULL
+		  || !STATE_NODE_CONTAINS (sctx->sifted_states[to_idx],
+					   dst_node)
+		  || check_dst_limits (mctx, &sctx->limits, node,
+				       str_idx, dst_node, to_idx))
+		continue;
+		{
+		  re_dfastate_t *cur_state;
+		  entry->flag = 0;
+		  for (disabled_idx = enabled_idx + 1;
+		       disabled_idx < mctx->nbkref_ents; ++disabled_idx)
+		    {
+		      struct re_backref_cache_entry *entry2;
+		      entry2 = mctx->bkref_ents + disabled_idx;
+		      if (entry2->str_idx > str_idx)
+			break;
+		      entry2->flag = (entry2->node == node) ? 1 : entry2->flag;
+		    }
+
+		  if (local_sctx.sifted_states == NULL)
+		    {
+		      local_sctx = *sctx;
+		      err = re_node_set_init_copy (&local_sctx.limits,
+						   &sctx->limits);
+		      if (BE (err != REG_NOERROR, 0))
+			goto free_return;
+		    }
+		  local_sctx.last_node = node;
+		  local_sctx.last_str_idx = str_idx;
+		  err = re_node_set_insert (&local_sctx.limits, enabled_idx);
+		  if (BE (err < 0, 0))
+		    {
+		      err = REG_ESPACE;
+		      goto free_return;
+		    }
+		  cur_state = local_sctx.sifted_states[str_idx];
+		  err = sift_states_backward (mctx, &local_sctx);
+		  if (BE (err != REG_NOERROR, 0))
+		    goto free_return;
+		  if (sctx->limited_states != NULL)
+		    {
+		      err = merge_state_array (dfa, sctx->limited_states,
+					       local_sctx.sifted_states,
+					       str_idx + 1);
+		      if (BE (err != REG_NOERROR, 0))
+			goto free_return;
+		    }
+		  local_sctx.sifted_states[str_idx] = cur_state;
+		  re_node_set_remove (&local_sctx.limits, enabled_idx);
+		  /* We must not use the variable entry here, since
+		     mctx->bkref_ents might be realloced.  */
+		  mctx->bkref_ents[enabled_idx].flag = 1;
+		}
 	    }
-	  cur_state = local_sctx.sifted_states[str_idx];
-	  err = sift_states_backward (mctx, &local_sctx);
-	  if (BE (err != REG_NOERROR, 0))
-	    goto free_return;
-	  if (sctx->limited_states != NULL)
+	  enabled_idx = search_cur_bkref_entry (mctx, str_idx);
+	  for (; enabled_idx < mctx->nbkref_ents; ++enabled_idx)
 	    {
-	      err = merge_state_array (dfa, sctx->limited_states,
-				       local_sctx.sifted_states,
-				       str_idx + 1);
-	      if (BE (err != REG_NOERROR, 0))
-		goto free_return;
+	      struct re_backref_cache_entry *entry;
+	      entry = mctx->bkref_ents + enabled_idx;
+	      if (entry->str_idx > str_idx)
+		break;
+	      if (entry->node == node)
+		entry->flag = 0;
 	    }
-	  local_sctx.sifted_states[str_idx] = cur_state;
-	  re_node_set_remove (&local_sctx.limits, enabled_idx);
-
-	  /* mctx->bkref_ents may have changed, reload the pointer.  */
-          entry = mctx->bkref_ents + enabled_idx;
 	}
-      while (enabled_idx++, entry++->more);
     }
   err = REG_NOERROR;
  free_return:
@@ -2222,111 +2111,127 @@
      re_match_context_t *mctx;
      re_dfastate_t *state;
 {
-  re_dfastate_t **trtable;
+  re_dfa_t *const dfa = mctx->dfa;
+  re_dfastate_t **trtable, *next_state;
   unsigned char ch;
+  int cur_idx;
 
-#ifdef RE_ENABLE_I18N
-  /* If the current state can accept multibyte.  */
-  if (BE (state->accept_mb, 0))
+  if (re_string_cur_idx (&mctx->input) + 1 >= mctx->input.bufs_len
+      || (re_string_cur_idx (&mctx->input) + 1 >= mctx->input.valid_len
+	  && mctx->input.valid_len < mctx->input.len))
     {
-      *err = transit_state_mb (mctx, state);
+      *err = extend_buffers (mctx);
       if (BE (*err != REG_NOERROR, 0))
 	return NULL;
     }
-#endif /* RE_ENABLE_I18N */
-
-  /* Then decide the next state with the single byte.  */
-#if 0
-  if (0)
-    /* don't use transition table  */
-    return transit_state_sb (err, mctx, state);
-#endif
 
-  /* Use transition table  */
-  ch = re_string_fetch_byte (&mctx->input);
-  for (;;)
+  *err = REG_NOERROR;
+  if (state == NULL)
+    {
+      next_state = state;
+      re_string_skip_bytes (&mctx->input, 1);
+    }
+  else
     {
-      trtable = state->trtable;
-      if (BE (trtable != NULL, 1))
-	return trtable[ch];
+#ifdef RE_ENABLE_I18N
+      /* If the current state can accept multibyte.  */
+      if (state->accept_mb)
+	{
+	  *err = transit_state_mb (mctx, state);
+	  if (BE (*err != REG_NOERROR, 0))
+	    return NULL;
+	}
+#endif /* RE_ENABLE_I18N */
 
-      trtable = state->word_trtable;
-      if (BE (trtable != NULL, 1))
-        {
-	  unsigned int context;
-	  context
-	    = re_string_context_at (&mctx->input,
-				    re_string_cur_idx (&mctx->input) - 1,
-				    mctx->eflags);
-	  if (IS_WORD_CONTEXT (context))
-	    return trtable[ch + SBC_MAX];
+      /* Then decide the next state with the single byte.  */
+      if (1)
+	{
+	  /* Use transition table  */
+	  ch = re_string_fetch_byte (&mctx->input);
+	  trtable = state->trtable;
+	  if (trtable == NULL)
+	    {
+	      trtable = build_trtable (dfa, state);
+	      if (trtable == NULL)
+		{
+		  *err = REG_ESPACE;
+		  return NULL;
+		}
+	    }
+	  if (BE (state->word_trtable, 0))
+	    {
+	      unsigned int context;
+	      context
+		= re_string_context_at (&mctx->input,
+					re_string_cur_idx (&mctx->input) - 1,
+					mctx->eflags);
+	      if (IS_WORD_CONTEXT (context))
+		next_state = trtable[ch + SBC_MAX];
+	      else
+		next_state = trtable[ch];
+	    }
 	  else
-	    return trtable[ch];
+	    next_state = trtable[ch];
 	}
-
-      if (!build_trtable (mctx->dfa, state))
+#if 0
+      else
 	{
-	  *err = REG_ESPACE;
-	  return NULL;
+	  /* don't use transition table  */
+	  next_state = transit_state_sb (err, mctx, state);
+	  if (BE (next_state == NULL && err != REG_NOERROR, 0))
+	    return NULL;
 	}
-
-      /* Retry, we now have a transition table.  */
+#endif
     }
-}
-
-/* Update the state_log if we need */
-re_dfastate_t *
-merge_state_with_log (err, mctx, next_state)
-     reg_errcode_t *err;
-     re_match_context_t *mctx;
-     re_dfastate_t *next_state;
-{
-  re_dfa_t *const dfa = mctx->dfa;
-  int cur_idx = re_string_cur_idx (&mctx->input);
 
-  if (cur_idx > mctx->state_log_top)
-    {
-      mctx->state_log[cur_idx] = next_state;
-      mctx->state_log_top = cur_idx;
-    }
-  else if (mctx->state_log[cur_idx] == 0)
-    {
-      mctx->state_log[cur_idx] = next_state;
-    }
-  else
+  cur_idx = re_string_cur_idx (&mctx->input);
+  /* Update the state_log if we need.  */
+  if (mctx->state_log != NULL)
     {
-      re_dfastate_t *pstate;
-      unsigned int context;
-      re_node_set next_nodes, *log_nodes, *table_nodes = NULL;
-      /* If (state_log[cur_idx] != 0), it implies that cur_idx is
-         the destination of a multibyte char/collating element/
-         back reference.  Then the next state is the union set of
-         these destinations and the results of the transition table.  */
-      pstate = mctx->state_log[cur_idx];
-      log_nodes = pstate->entrance_nodes;
-      if (next_state != NULL)
-        {
-          table_nodes = next_state->entrance_nodes;
-          *err = re_node_set_init_union (&next_nodes, table_nodes,
-					     log_nodes);
-          if (BE (*err != REG_NOERROR, 0))
-	    return NULL;
-        }
+      if (cur_idx > mctx->state_log_top)
+	{
+	  mctx->state_log[cur_idx] = next_state;
+	  mctx->state_log_top = cur_idx;
+	}
+      else if (mctx->state_log[cur_idx] == 0)
+	{
+	  mctx->state_log[cur_idx] = next_state;
+	}
       else
-        next_nodes = *log_nodes;
-      /* Note: We already add the nodes of the initial state,
-	 then we don't need to add them here.  */
-
-      context = re_string_context_at (&mctx->input,
-				      re_string_cur_idx (&mctx->input) - 1,
-				      mctx->eflags);
-      next_state = mctx->state_log[cur_idx]
-        = re_acquire_state_context (err, dfa, &next_nodes, context);
-      /* We don't need to check errors here, since the return value of
-         this function is next_state and ERR is already set.  */
+	{
+	  re_dfastate_t *pstate;
+	  unsigned int context;
+	  re_node_set next_nodes, *log_nodes, *table_nodes = NULL;
+	  /* If (state_log[cur_idx] != 0), it implies that cur_idx is
+	     the destination of a multibyte char/collating element/
+	     back reference.  Then the next state is the union set of
+	     these destinations and the results of the transition table.  */
+	  pstate = mctx->state_log[cur_idx];
+	  log_nodes = pstate->entrance_nodes;
+	  if (next_state != NULL)
+	    {
+	      table_nodes = next_state->entrance_nodes;
+	      *err = re_node_set_init_union (&next_nodes, table_nodes,
+					     log_nodes);
+	      if (BE (*err != REG_NOERROR, 0))
+		return NULL;
+	    }
+	  else
+	    next_nodes = *log_nodes;
+	  /* Note: We already add the nodes of the initial state,
+		   then we don't need to add them here.  */
+
+	  context = re_string_context_at (&mctx->input,
+					  re_string_cur_idx (&mctx->input) - 1,
+					  mctx->eflags);
+	  next_state = mctx->state_log[cur_idx]
+	    = re_acquire_state_context (err, dfa, &next_nodes, context);
+	  /* We don't need to check errors here, since the return value of
+	     this function is next_state and ERR is already set.  */
 
-      if (table_nodes != NULL)
-        re_node_set_free (&next_nodes);
+	  if (table_nodes != NULL)
+	    re_node_set_free (&next_nodes);
+	}
     }
 
   if (BE (dfa->nbackref, 0) && next_state != NULL)
@@ -2348,38 +2253,9 @@
 	  next_state = mctx->state_log[cur_idx];
 	}
     }
-
   return next_state;
 }
 
-/* Skip bytes in the input that correspond to part of a
-   multi-byte match, then look in the log for a state
-   from which to restart matching.  */
-re_dfastate_t *
-find_recover_state (err, mctx)
-     reg_errcode_t *err;
-     re_match_context_t *mctx;
-{
-  re_dfastate_t *cur_state = NULL;
-  do
-    {
-      int max = mctx->state_log_top;
-      int cur_str_idx = re_string_cur_idx (&mctx->input);
-
-      do
-	{
-          if (++cur_str_idx > max)
-            return NULL;
-          re_string_skip_bytes (&mctx->input, 1);
-	}
-      while (mctx->state_log[cur_str_idx] == NULL);
-
-      cur_state = merge_state_with_log (err, mctx, NULL);
-    }
-  while (err == REG_NOERROR && cur_state == NULL);
-  return cur_state;
-}
-
 /* Helper functions for transit_state.  */
 
 /* From the node set CUR_NODES, pick up the nodes whose types are
@@ -2475,13 +2351,10 @@
     {
       re_node_set dest_nodes, *new_nodes;
       int cur_node_idx = pstate->nodes.elems[i];
-      int naccepted, dest_idx;
+      int naccepted = 0, dest_idx;
       unsigned int context;
       re_dfastate_t *dest_state;
 
-      if (!dfa->nodes[cur_node_idx].accept_mb)
-        continue;
-
       if (dfa->nodes[cur_node_idx].constraint)
 	{
 	  context = re_string_context_at (&mctx->input,
@@ -2493,8 +2366,9 @@
 	}
 
       /* How many bytes the node can accept?  */
-      naccepted = check_node_accept_bytes (dfa, cur_node_idx, &mctx->input,
-					   re_string_cur_idx (&mctx->input));
+      if (ACCEPT_MB_NODE (dfa->nodes[cur_node_idx].type))
+	naccepted = check_node_accept_bytes (dfa, cur_node_idx, &mctx->input,
+					     re_string_cur_idx (&mctx->input));
       if (naccepted == 0)
 	continue;
 
@@ -2508,7 +2382,9 @@
 #ifdef DEBUG
       assert (dfa->nexts[cur_node_idx] != -1);
 #endif
-      new_nodes = dfa->eclosures + dfa->nexts[cur_node_idx];
+      /* `cur_node_idx' may point the entity of the OP_CONTEXT_NODE,
+	 then we use pstate->nodes.elems[i] instead.  */
+      new_nodes = dfa->eclosures + dfa->nexts[pstate->nodes.elems[i]];
 
       dest_state = mctx->state_log[dest_idx];
       if (dest_state == NULL)
@@ -2657,16 +2533,16 @@
   const char *buf = (const char *) re_string_get_buffer (&mctx->input);
   /* Return if we have already checked BKREF_NODE at BKREF_STR_IDX.  */
   int cache_idx = search_cur_bkref_entry (mctx, bkref_str_idx);
-  if (cache_idx != -1)
+  for (; cache_idx < mctx->nbkref_ents; ++cache_idx)
     {
-      const struct re_backref_cache_entry *entry = mctx->bkref_ents + cache_idx;
-      do
-        if (entry->node == bkref_node)
-	  return REG_NOERROR; /* We already checked it.  */
-      while (entry++->more);
+      const struct re_backref_cache_entry *entry
+	= &mctx->bkref_ents[cache_idx];
+      if (entry->str_idx > bkref_str_idx)
+	break;
+      if (entry->node == bkref_node)
+	return REG_NOERROR; /* We already checked it.  */
     }
-
-  subexp_num = dfa->nodes[bkref_node].opr.idx;
+  subexp_num = dfa->nodes[bkref_node].opr.idx - 1;
 
   /* For each sub expression  */
   for (sub_top_idx = 0; sub_top_idx < mctx->nsub_tops; ++sub_top_idx)
@@ -2675,6 +2551,7 @@
       re_sub_match_top_t *sub_top = mctx->sub_tops[sub_top_idx];
       re_sub_match_last_t *sub_last;
       int sub_last_idx, sl_str, bkref_str_off;
+      const char *bkref_str;
 
       if (dfa->nodes[sub_top->node].opr.idx != subexp_num)
 	continue; /* It isn't related.  */
@@ -2690,24 +2567,9 @@
 	  sl_str_diff = sub_last->str_idx - sl_str;
 	  /* The matched string by the sub expression match with the substring
 	     at the back reference?  */
-	  if (sl_str_diff > 0)
-	    {
-	      if (BE (bkref_str_off + sl_str_diff > mctx->input.valid_len, 0))
-		{
-		  /* Not enough chars for a successful match.  */
-		  if (bkref_str_off + sl_str_diff > mctx->input.len)
-		    break;
-
-		  err = clean_state_log_if_needed (mctx,
-						   bkref_str_off
-						   + sl_str_diff);
-		  if (BE (err != REG_NOERROR, 0))
-		    return err;
-		  buf = (const char *) re_string_get_buffer (&mctx->input);
-		}
-	      if (memcmp (buf + bkref_str_off, buf + sl_str, sl_str_diff) != 0)
-		break; /* We don't need to search this sub expression any more.  */
-	    }
+	  if (sl_str_diff > 0
+	      && memcmp (buf + bkref_str_off, buf + sl_str, sl_str_diff) != 0)
+	    break; /* We don't need to search this sub expression any more.  */
 	  bkref_str_off += sl_str_diff;
 	  sl_str += sl_str_diff;
 	  err = get_subexp_sub (mctx, sub_top, sub_last, bkref_node,
@@ -2722,6 +2584,7 @@
 	  if (BE (err != REG_NOERROR, 0))
 	    return err;
 	}
+      bkref_str = buf + bkref_str_off;
 
       if (sub_last_idx < sub_top->nlasts)
 	continue;
@@ -2735,24 +2598,8 @@
 	  sl_str_off = sl_str - sub_top->str_idx;
 	  /* The matched string by the sub expression match with the substring
 	     at the back reference?  */
-	  if (sl_str_off > 0)
-	    {
-	      if (BE (bkref_str_off >= mctx->input.valid_len, 0))
-		{
-		  /* If we are at the end of the input, we cannot match.  */
-		  if (bkref_str_off >= mctx->input.len)
-		    break;
-
-		  err = extend_buffers (mctx);
-		  if (BE (err != REG_NOERROR, 0))
-		    return err;
-
-		  buf = (const char *) re_string_get_buffer (&mctx->input);
-		}
-	      if (buf [bkref_str_off++] != buf[sl_str - 1])
-		break; /* We don't need to search this sub expression
-			  any more.  */
-	    }
+	  if (sl_str_off > 0 && *bkref_str++ != buf[sl_str - 1])
+	    break; /* We don't need to search this sub expression any more.  */
 	  if (mctx->state_log[sl_str] == NULL)
 	    continue;
 	  /* Does this state have a ')' of the sub expression?  */
@@ -2812,7 +2659,8 @@
   if (BE (err != REG_NOERROR, 0))
     return err;
   to_idx = bkref_str + sub_last->str_idx - sub_top->str_idx;
-  return clean_state_log_if_needed (mctx, to_idx);
+  clean_state_log_if_needed (mctx, to_idx);
+  return REG_NOERROR;
 }
 
 /* Find the first node which is '(' or ')' and whose index is SUBEXP_IDX.
@@ -2917,7 +2765,7 @@
     {
       if (next_nodes.nelem)
 	{
-	  err = expand_bkref_cache (mctx, &next_nodes, str_idx,
+	  err = expand_bkref_cache (mctx, &next_nodes, str_idx, last_str,
 				    subexp_num, type);
 	  if (BE ( err != REG_NOERROR, 0))
 	    {
@@ -2950,7 +2798,7 @@
       if (cur_state)
 	{
 	  err = check_arrival_add_next_nodes (mctx, str_idx,
-					      &cur_state->non_eps_nodes, &next_nodes);
+					      &cur_state->nodes, &next_nodes);
 	  if (BE (err != REG_NOERROR, 0))
 	    {
 	      re_node_set_free (&next_nodes);
@@ -2966,7 +2814,7 @@
 	      re_node_set_free (&next_nodes);
 	      return err;
 	    }
-	  err = expand_bkref_cache (mctx, &next_nodes, str_idx,
+	  err = expand_bkref_cache (mctx, &next_nodes, str_idx, last_str,
 				    subexp_num, type);
 	  if (BE ( err != REG_NOERROR, 0))
 	    {
@@ -3015,7 +2863,6 @@
      re_node_set *cur_nodes, *next_nodes;
 {
   re_dfa_t *const dfa = mctx->dfa;
-  int result;
   int cur_idx;
   reg_errcode_t err;
   re_node_set union_set;
@@ -3024,13 +2871,12 @@
     {
       int naccepted = 0;
       int cur_node = cur_nodes->elems[cur_idx];
-#ifdef DEBUG
       re_token_type_t type = dfa->nodes[cur_node].type;
-      assert (!IS_EPSILON_NODE (type));
-#endif
+      if (IS_EPSILON_NODE (type))
+	continue;
 #ifdef RE_ENABLE_I18N
       /* If the node may accept `multi byte'.  */
-      if (dfa->nodes[cur_node].accept_mb)
+      if (ACCEPT_MB_NODE (type))
 	{
 	  naccepted = check_node_accept_bytes (dfa, cur_node, &mctx->input,
 					       str_idx);
@@ -3050,8 +2896,8 @@
 		      return err;
 		    }
 		}
-	      result = re_node_set_insert (&union_set, next_node);
-	      if (BE (result < 0, 0))
+	      err = re_node_set_insert (&union_set, next_node);
+	      if (BE (err < 0, 0))
 		{
 		  re_node_set_free (&union_set);
 		  return REG_ESPACE;
@@ -3070,8 +2916,8 @@
       if (naccepted
 	  || check_node_accept (mctx, dfa->nodes + cur_node, str_idx))
 	{
-	  result = re_node_set_insert (next_nodes, dfa->nexts[cur_node]);
-	  if (BE (result < 0, 0))
+	  err = re_node_set_insert (next_nodes, dfa->nexts[cur_node]);
+	  if (BE (err < 0, 0))
 	    {
 	      re_node_set_free (&union_set);
 	      return REG_ESPACE;
@@ -3188,26 +3034,24 @@
    in MCTX->BKREF_ENTS.  */
 
 static reg_errcode_t
-expand_bkref_cache (mctx, cur_nodes, cur_str, subexp_num,
+expand_bkref_cache (mctx, cur_nodes, cur_str, last_str, subexp_num,
 		    type)
      re_match_context_t *mctx;
-     int cur_str, subexp_num, type;
+     int cur_str, last_str, subexp_num, type;
      re_node_set *cur_nodes;
 {
   re_dfa_t *const dfa = mctx->dfa;
   reg_errcode_t err;
-  int cache_idx_start = search_cur_bkref_entry (mctx, cur_str);
-  struct re_backref_cache_entry *ent;
+  int cache_idx, cache_idx_start;
+  /* The current state.  */
 
-  if (cache_idx_start == -1)
-    return REG_NOERROR;
-
- restart:
-  ent = mctx->bkref_ents + cache_idx_start;
-  do
+  cache_idx_start = search_cur_bkref_entry (mctx, cur_str);
+  for (cache_idx = cache_idx_start; cache_idx < mctx->nbkref_ents; ++cache_idx)
     {
       int to_idx, next_node;
-
+      struct re_backref_cache_entry *ent = mctx->bkref_ents + cache_idx;
+      if (ent->str_idx > cur_str)
+	break;
       /* Is this entry ENT is appropriate?  */
       if (!re_node_set_contains (cur_nodes, ent->node))
 	continue; /* No.  */
@@ -3236,7 +3080,8 @@
 	      return err;
 	    }
 	  /* TODO: It is still inefficient...  */
-	  goto restart;
+	  cache_idx = cache_idx_start - 1;
+	  continue;
 	}
       else
 	{
@@ -3271,20 +3116,19 @@
 	    return err;
 	}
     }
-  while (ent++->more);
   return REG_NOERROR;
 }
 
 /* Build transition table for the state.
-   Return 1 if succeeded, otherwise return NULL.  */
+   Return the new table if succeeded, otherwise return NULL.  */
 
-static int
+static re_dfastate_t **
 build_trtable (dfa, state)
     re_dfa_t *dfa;
     re_dfastate_t *state;
 {
   reg_errcode_t err;
-  int i, j, ch, need_word_trtable = 0;
+  int i, j, ch;
   unsigned int elem, mask;
   int dests_node_malloced = 0, dest_states_malloced = 0;
   int ndests; /* Number of the destination states from `state'.  */
@@ -3301,20 +3145,20 @@
 #ifdef _LIBC
   if (__libc_use_alloca ((sizeof (re_node_set) + sizeof (bitset)) * SBC_MAX))
     dests_node = (re_node_set *)
-      alloca ((sizeof (re_node_set) + sizeof (bitset)) * SBC_MAX);
+		 alloca ((sizeof (re_node_set) + sizeof (bitset)) * SBC_MAX);
   else
 #endif
     {
       dests_node = (re_node_set *)
-	malloc ((sizeof (re_node_set) + sizeof (bitset)) * SBC_MAX);
+		   malloc ((sizeof (re_node_set) + sizeof (bitset)) * SBC_MAX);
       if (BE (dests_node == NULL, 0))
-	return 0;
+	return NULL;
       dests_node_malloced = 1;
     }
   dests_ch = (bitset *) (dests_node + SBC_MAX);
 
   /* Initialize transiton table.  */
-  state->word_trtable = state->trtable = NULL;
+  state->word_trtable = 0;
 
   /* At first, group all nodes belonging to `state' into several
      destinations.  */
@@ -3323,14 +3167,14 @@
     {
       if (dests_node_malloced)
 	free (dests_node);
-      /* Return 0 in case of an error, 1 otherwise.  */
+      /* Return NULL in case of an error, trtable otherwise.  */
       if (ndests == 0)
 	{
 	  state->trtable = (re_dfastate_t **)
-	    calloc (sizeof (re_dfastate_t *), SBC_MAX);
-	  return 1;
+	    calloc (sizeof (re_dfastate_t *), SBC_MAX);;
+	  return state->trtable;
 	}
-      return 0;
+      return NULL;
     }
 
   err = re_node_set_alloc (&follows, ndests + 1);
@@ -3341,12 +3185,12 @@
   if (__libc_use_alloca ((sizeof (re_node_set) + sizeof (bitset)) * SBC_MAX
 			 + ndests * 3 * sizeof (re_dfastate_t *)))
     dest_states = (re_dfastate_t **)
-      alloca (ndests * 3 * sizeof (re_dfastate_t *));
+		  alloca (ndests * 3 * sizeof (re_dfastate_t *));
   else
 #endif
     {
       dest_states = (re_dfastate_t **)
-	malloc (ndests * 3 * sizeof (re_dfastate_t *));
+		    malloc (ndests * 3 * sizeof (re_dfastate_t *));
       if (BE (dest_states == NULL, 0))
 	{
 out_free:
@@ -3357,7 +3201,7 @@
 	    re_node_set_free (dests_node + i);
 	  if (dests_node_malloced)
 	    free (dests_node);
-	  return 0;
+	  return NULL;
 	}
       dest_states_malloced = 1;
     }
@@ -3393,8 +3237,9 @@
 	  if (BE (dest_states_word[i] == NULL && err != REG_NOERROR, 0))
 	    goto out_free;
 
-	  if (dest_states[i] != dest_states_word[i] && dfa->mb_cur_max > 1)
-	    need_word_trtable = 1;
+	  if (dest_states[i] != dest_states_word[i]
+	      && dfa->mb_cur_max > 1)
+	    state->word_trtable = 1;
 
 	  dest_states_nl[i] = re_acquire_state_context (&err, dfa, &follows,
 							CONTEXT_NEWLINE);
@@ -3409,14 +3254,13 @@
       bitset_merge (acceptable, dests_ch[i]);
     }
 
-  if (!BE (need_word_trtable, 0))
+  if (!BE (state->word_trtable, 0))
     {
       /* We don't care about whether the following character is a word
 	 character, or we are in a single-byte character set so we can
 	 discern by looking at the character code: allocate a
 	 256-entry transition table.  */
-      trtable = state->trtable =
-	(re_dfastate_t **) calloc (sizeof (re_dfastate_t *), SBC_MAX);
+      trtable = (re_dfastate_t **) calloc (sizeof (re_dfastate_t *), SBC_MAX);
       if (BE (trtable == NULL, 0))
 	goto out_free;
 
@@ -3446,8 +3290,8 @@
 	 by looking at the character code: build two 256-entry
 	 transition tables, one starting at trtable[0] and one
 	 starting at trtable[SBC_MAX].  */
-      trtable = state->word_trtable =
-	(re_dfastate_t **) calloc (sizeof (re_dfastate_t *), 2 * SBC_MAX);
+      trtable = (re_dfastate_t **) calloc (sizeof (re_dfastate_t *),
+					   2 * SBC_MAX);
       if (BE (trtable == NULL, 0))
 	goto out_free;
 
@@ -3478,7 +3322,7 @@
 	  {
 	    /* k-th destination accepts newline character.  */
 	    trtable[NEWLINE_CHAR] = dest_states_nl[j];
-	    if (need_word_trtable)
+	    if (state->word_trtable)
 	      trtable[NEWLINE_CHAR + SBC_MAX] = dest_states_nl[j];
 	    /* There must be only one destination which accepts
 	       newline.  See group_nodes_into_DFAstates.  */
@@ -3496,7 +3340,8 @@
   if (dests_node_malloced)
     free (dests_node);
 
-  return 1;
+  state->trtable = trtable;
+  return trtable;
 }
 
 /* Group all nodes belonging to STATE into several destinations.
@@ -3512,7 +3357,6 @@
     bitset *dests_ch;
 {
   reg_errcode_t err;
-  int result;
   int i, j, k;
   int ndests; /* Number of the destinations from `state'.  */
   bitset accepts; /* Characters a node can accept.  */
@@ -3661,8 +3505,8 @@
 	    }
 
 	  /* Put the position in the current group. */
-	  result = re_node_set_insert (&dests_node[j], cur_nodes->elems[i]);
-	  if (BE (result < 0, 0))
+	  err = re_node_set_insert (&dests_node[j], cur_nodes->elems[i]);
+	  if (BE (err < 0, 0))
 	    goto error_return;
 
 	  /* If all characters are consumed, go to next node. */
@@ -3774,7 +3618,7 @@
     }
 
   elem_len = re_string_elem_size_at (input, str_idx);
-  if ((elem_len <= 1 && char_len <= 1) || char_len == 0)
+  if (elem_len <= 1 && char_len <= 1)
     return 0;
 
   if (node->type == COMPLEX_BRACKET)
@@ -3955,10 +3799,8 @@
       int32_t idx;
       const unsigned char *extra = (const unsigned char *)
 	_NL_CURRENT (LC_COLLATE, _NL_COLLATE_SYMB_EXTRAMB);
-      int32_t extrasize = (const unsigned char *)
-	_NL_CURRENT (LC_COLLATE, _NL_COLLATE_SYMB_EXTRAMB + 1) - extra;
 
-      for (idx = 0; idx < extrasize;)
+      for (idx = 0; ;)
 	{
 	  int mbs_cnt, found = 0;
 	  int32_t elem_mbs_len;
@@ -3988,7 +3830,6 @@
 	  /* Skip the collation sequence value.  */
 	  idx += sizeof (uint32_t);
 	}
-      return UINT_MAX;
     }
 }
 # endif /* _LIBC */
@@ -4003,20 +3844,24 @@
     const re_token_t *node;
     int idx;
 {
+  re_dfa_t *const dfa = mctx->dfa;
   unsigned char ch;
+  if (node->constraint)
+    {
+      /* The node has constraints.  Check whether the current context
+	 satisfies the constraints.  */
+      unsigned int context = re_string_context_at (&mctx->input, idx,
+						   mctx->eflags);
+      if (NOT_SATISFY_NEXT_CONSTRAINT (node->constraint, context))
+	return 0;
+    }
   ch = re_string_byte_at (&mctx->input, idx);
   switch (node->type)
     {
     case CHARACTER:
-      if (node->opr.c != ch)
-        return 0;
-      break;
-
+      return node->opr.c == ch;
     case SIMPLE_BRACKET:
-      if (!bitset_contain (node->opr.sbcset, ch))
-        return 0;
-      break;
-
+      return bitset_contain (node->opr.sbcset, ch);
 #ifdef RE_ENABLE_I18N
     case OP_UTF8_PERIOD:
       if (ch >= 0x80)
@@ -4024,26 +3869,11 @@
       /* FALLTHROUGH */
 #endif
     case OP_PERIOD:
-      if ((ch == '\n' && !(mctx->dfa->syntax & RE_DOT_NEWLINE))
-	  || (ch == '\0' && (mctx->dfa->syntax & RE_DOT_NOT_NULL)))
-	return 0;
-      break;
-
+      return !((ch == '\n' && !(dfa->syntax & RE_DOT_NEWLINE))
+	       || (ch == '\0' && (dfa->syntax & RE_DOT_NOT_NULL)));
     default:
       return 0;
     }
-
-  if (node->constraint)
-    {
-      /* The node has constraints.  Check whether the current context
-	 satisfies the constraints.  */
-      unsigned int context = re_string_context_at (&mctx->input, idx,
-						   mctx->eflags);
-      if (NOT_SATISFY_NEXT_CONSTRAINT (node->constraint, context))
-	return 0;
-    }
-
-  return 1;
 }
 
 /* Extend the buffers, if the buffers have run out.  */
@@ -4140,6 +3970,28 @@
 match_ctx_clean (mctx)
     re_match_context_t *mctx;
 {
+  match_ctx_free_subtops (mctx);
+  mctx->nsub_tops = 0;
+  mctx->nbkref_ents = 0;
+}
+
+/* Free all the memory associated with MCTX.  */
+
+static void
+match_ctx_free (mctx)
+    re_match_context_t *mctx;
+{
+  match_ctx_free_subtops (mctx);
+  re_free (mctx->sub_tops);
+  re_free (mctx->bkref_ents);
+}
+
+/* Free all the memory associated with MCTX->SUB_TOPS.  */
+
+static void
+match_ctx_free_subtops (mctx)
+     re_match_context_t *mctx;
+{
   int st_idx;
   for (st_idx = 0; st_idx < mctx->nsub_tops; ++st_idx)
     {
@@ -4159,21 +4011,6 @@
 	}
       free (top);
     }
-
-  mctx->nsub_tops = 0;
-  mctx->nbkref_ents = 0;
-}
-
-/* Free all the memory associated with MCTX.  */
-
-static void
-match_ctx_free (mctx)
-    re_match_context_t *mctx;
-{
-  /* First, free all the memory associated with MCTX->SUB_TOPS.  */
-  match_ctx_clean (mctx);
-  re_free (mctx->sub_tops);
-  re_free (mctx->bkref_ents);
 }
 
 /* Add a new backreference entry to MCTX.
@@ -4201,42 +4038,26 @@
 	      sizeof (struct re_backref_cache_entry) * mctx->abkref_ents);
       mctx->abkref_ents *= 2;
     }
-  if (mctx->nbkref_ents > 0
-      && mctx->bkref_ents[mctx->nbkref_ents - 1].str_idx == str_idx)
-    mctx->bkref_ents[mctx->nbkref_ents - 1].more = 1;
-
   mctx->bkref_ents[mctx->nbkref_ents].node = node;
   mctx->bkref_ents[mctx->nbkref_ents].str_idx = str_idx;
   mctx->bkref_ents[mctx->nbkref_ents].subexp_from = from;
   mctx->bkref_ents[mctx->nbkref_ents].subexp_to = to;
-
-  /* This is a cache that saves negative results of check_dst_limits_calc_pos.
-     If bit N is clear, means that this entry won't epsilon-transition to
-     an OP_OPEN_SUBEXP or OP_CLOSE_SUBEXP for the N+1-th subexpression.  If
-     it is set, check_dst_limits_calc_pos_1 will recurse and try to find one
-     such node.
-
-     A backreference does not epsilon-transition unless it is empty, so set
-     to all zeros if FROM != TO.  */
-  mctx->bkref_ents[mctx->nbkref_ents].eps_reachable_subexps_map
-    = (from == to ? ~0 : 0);
-
-  mctx->bkref_ents[mctx->nbkref_ents++].more = 0;
+  mctx->bkref_ents[mctx->nbkref_ents++].flag = 0;
   if (mctx->max_mb_elem_len < to - from)
     mctx->max_mb_elem_len = to - from;
   return REG_NOERROR;
 }
 
-/* Search for the first entry which has the same str_idx, or -1 if none is
-   found.  Note that MCTX->BKREF_ENTS is already sorted by MCTX->STR_IDX.  */
+/* Search for the first entry which has the same str_idx.
+   Note that MCTX->BKREF_ENTS is already sorted by MCTX->STR_IDX.  */
 
 static int
 search_cur_bkref_entry (mctx, str_idx)
      re_match_context_t *mctx;
      int str_idx;
 {
-  int left, right, mid, last;
-  last = right = mctx->nbkref_ents;
+  int left, right, mid;
+  right = mctx->nbkref_ents;
   for (left = 0; left < right;)
     {
       mid = (left + right) / 2;
@@ -4245,10 +4066,16 @@
       else
 	right = mid;
     }
-  if (left < last && mctx->bkref_ents[left].str_idx == str_idx)
-    return left;
-  else
-    return -1;
+  return left;
+}
+
+static void
+match_ctx_clear_flag (mctx)
+     re_match_context_t *mctx;
+{
+  int i;
+  for (i = 0; i < mctx->nbkref_ents; ++i)
+    mctx->bkref_ents[i].flag = 0;
 }
 
 /* Register the node NODE, whose type is OP_OPEN_SUBEXP, and which matches
@@ -4314,14 +4141,18 @@
 }
 
 static void
-sift_ctx_init (sctx, sifted_sts, limited_sts, last_node, last_str_idx)
+sift_ctx_init (sctx, sifted_sts, limited_sts, last_node, last_str_idx,
+	       check_subexp)
     re_sift_context_t *sctx;
     re_dfastate_t **sifted_sts, **limited_sts;
-    int last_node, last_str_idx;
+    int last_node, last_str_idx, check_subexp;
 {
   sctx->sifted_states = sifted_sts;
   sctx->limited_states = limited_sts;
   sctx->last_node = last_node;
   sctx->last_str_idx = last_str_idx;
+  sctx->check_subexp = check_subexp;
+  sctx->cur_bkref = -1;
+  sctx->cls_subexp_idx = -1;
   re_node_set_init_empty (&sctx->limits);
 }
--- 4.1.4/lib/regex_.h
+++ 4.0.9/lib/regex_.h
@@ -179,10 +179,6 @@
    immediately after an alternation or begin-group operator.  */
 #define RE_CONTEXT_INVALID_DUP (RE_CARET_ANCHORS_HERE << 1)
 
-/* If this bit is set, then no_sub will be set to 1 during
-   re_compile_pattern.  */
-#define RE_NO_SUB (RE_CONTEXT_INVALID_DUP << 1)
-
 /* This global variable defines the particular regexp syntax to use (for
    some interfaces).  When a regexp is compiled, the syntax used is
    stored in the pattern buffer, so changing this does not affect
@@ -302,10 +298,6 @@
 /* Like REG_NOTBOL, except for the end-of-line.  */
 #define REG_NOTEOL (1 << 1)
 
-/* Use PMATCH[0] to delimit the start and end of the search in the
-   buffer.  */
-#define REG_STARTEND (1 << 2)
-
 
 /* If any error codes are removed, changed, or added, update the
    `re_error_msg' table in regex.c.  */
@@ -321,7 +313,7 @@
   /* POSIX regcomp return error codes.  (In the order listed in the
      standard.)  */
   REG_BADPAT,		/* Invalid pattern.  */
-  REG_ECOLLATE,		/* Inalid collating element.  */
+  REG_ECOLLATE,		/* Not implemented.  */
   REG_ECTYPE,		/* Invalid character class name.  */
   REG_EESCAPE,		/* Trailing backslash.  */
   REG_ESUBREG,		/* Invalid back reference.  */
--- 4.1.4/lib/regex_internal.c
+++ 4.0.9/lib/regex_internal.c
@@ -26,6 +26,9 @@
 static int re_string_skip_chars (re_string_t *pstr, int new_raw_idx,
 				 wint_t *last_wc) internal_function;
 #endif /* RE_ENABLE_I18N */
+static re_dfastate_t *create_newstate_common (re_dfa_t *dfa,
+					      const re_node_set *nodes,
+					      unsigned int hash) internal_function;
 static reg_errcode_t register_state (re_dfa_t *dfa, re_dfastate_t *newstate,
 				     unsigned int hash) internal_function;
 static re_dfastate_t *create_ci_newstate (re_dfa_t *dfa,
@@ -186,7 +189,7 @@
   pstr->raw_mbs = (const unsigned char *) str;
   pstr->len = len;
   pstr->raw_len = len;
-  pstr->trans = (unsigned RE_TRANSLATE_TYPE) trans;
+  pstr->trans = trans;
   pstr->icase = icase ? 1 : 0;
   pstr->mbs_allocated = (trans != NULL || icase);
   pstr->mb_cur_max = dfa->mb_cur_max;
@@ -239,7 +242,7 @@
 	  for (i = 0; i < pstr->mb_cur_max && i < remain_len; ++i)
 	    {
 	      ch = pstr->raw_mbs [pstr->raw_mbs_idx + byte_idx + i];
-	      buf[i] = pstr->mbs[byte_idx + i] = pstr->trans[ch];
+	      buf[i] = pstr->trans[ch];
 	    }
 	  p = (const char *) buf;
 	}
@@ -290,8 +293,9 @@
   byte_idx = pstr->valid_len;
   end_idx = (pstr->bufs_len > pstr->len) ? pstr->len : pstr->bufs_len;
 
-  /* The following optimization assumes that ASCII characters can be
-     mapped to wide characters with a simple cast.  */
+#ifdef _LIBC
+  /* The following optimization assumes that the wchar_t encoding is
+     always ISO 10646.  */
   if (! pstr->map_notascii && pstr->trans == NULL && !pstr->offsets_needed)
     {
       while (byte_idx < end_idx)
@@ -305,7 +309,8 @@
 	      pstr->mbs[byte_idx]
 		= toupper (pstr->raw_mbs[pstr->raw_mbs_idx + byte_idx]);
 	      /* The next step uses the assumption that wchar_t is encoded
-		 ASCII-safe: all ASCII values can be converted like this.  */
+		 with ISO 10646: all ASCII values can be converted like
+		 this.  */
 	      pstr->wcs[byte_idx] = (wchar_t) pstr->mbs[byte_idx];
 	      ++byte_idx;
 	      continue;
@@ -363,11 +368,12 @@
       return REG_NOERROR;
     }
   else
+#endif
     for (src_idx = pstr->valid_raw_len; byte_idx < end_idx;)
       {
 	wchar_t wc;
 	const char *p;
-      offsets_needed:
+offsets_needed:
 	remain_len = end_idx - byte_idx;
 	prev_st = pstr->cur_state;
 	if (BE (pstr->trans != NULL, 0))
@@ -392,7 +398,7 @@
 		int mbcdlen;
 
 		wcu = towupper (wc);
-		mbcdlen = wcrtomb ((char *) buf, wcu, &prev_st);
+		mbcdlen = wcrtomb (buf, wcu, &prev_st);
 		if (BE (mbclen == mbcdlen, 1))
 		  memcpy (pstr->mbs + byte_idx, buf, mbclen);
 		else
@@ -573,7 +579,7 @@
      int idx, eflags;
 {
   int offset = idx - pstr->raw_mbs_idx;
-  if (BE (offset < 0, 0))
+  if (offset < 0)
     {
       /* Reset buffer.  */
 #ifdef RE_ENABLE_I18N
@@ -593,10 +599,10 @@
       offset = idx;
     }
 
-  if (BE (offset != 0, 1))
+  if (offset != 0)
     {
       /* Are the characters which are already checked remain?  */
-      if (BE (offset < pstr->valid_raw_len, 1)
+      if (offset < pstr->valid_raw_len
 #ifdef RE_ENABLE_I18N
 	  /* Handling this would enlarge the code too much.
 	     Accept a slowdown in that case.  */
@@ -611,7 +617,7 @@
 	    memmove (pstr->wcs, pstr->wcs + offset,
 		     (pstr->valid_len - offset) * sizeof (wint_t));
 #endif /* RE_ENABLE_I18N */
-	  if (BE (pstr->mbs_allocated, 0))
+	  if (pstr->mbs_allocated)
 	    memmove (pstr->mbs, pstr->mbs + offset,
 		     pstr->valid_len - offset);
 	  pstr->valid_len -= offset;
@@ -639,6 +645,7 @@
 	      int wcs_idx;
 	      wint_t wc = WEOF;
 
+#ifdef _LIBC
 	      if (pstr->is_utf8)
 		{
 		  const unsigned char *raw, *p, *q, *end;
@@ -678,7 +685,7 @@
 			break;
 		      }
 		}
-
+#endif
 	      if (wc == WEOF)
 		pstr->valid_len = re_string_skip_chars (pstr, idx, &wc) - idx;
 	      if (BE (pstr->valid_len, 0))
@@ -708,7 +715,7 @@
 				      ? CONTEXT_NEWLINE : 0));
 	    }
 	}
-      if (!BE (pstr->mbs_allocated, 0))
+      if (!pstr->mbs_allocated)
 	pstr->mbs += offset;
     }
   pstr->raw_mbs_idx = idx;
@@ -730,17 +737,16 @@
     }
   else
 #endif /* RE_ENABLE_I18N */
-  if (BE (pstr->mbs_allocated, 0))
     {
       if (pstr->icase)
 	build_upper_buffer (pstr);
       else if (pstr->trans != NULL)
 	re_string_translate_buffer (pstr);
+      else
+	pstr->valid_len = pstr->len;
     }
-  else
-    pstr->valid_len = pstr->len;
-
   pstr->cur_idx = 0;
+
   return REG_NOERROR;
 }
 
@@ -752,7 +758,7 @@
   int ch, off;
 
   /* Handle the common (easiest) cases first.  */
-  if (BE (!pstr->mbs_allocated, 1))
+  if (BE (!pstr->icase, 1))
     return re_string_peek_byte (pstr, idx);
 
 #ifdef RE_ENABLE_I18N
@@ -768,6 +774,8 @@
 #endif
 
   ch = pstr->raw_mbs[pstr->raw_mbs_idx + off];
+  if (pstr->trans)
+    ch = pstr->trans[ch];
 
 #ifdef RE_ENABLE_I18N
   /* Ensure that e.g. for tr_TR.UTF-8 BACKSLASH DOTLESS SMALL LETTER I
@@ -785,13 +793,15 @@
 re_string_fetch_byte_case (pstr)
      re_string_t *pstr;
 {
-  if (BE (!pstr->mbs_allocated, 1))
+  int ch;
+
+  if (BE (!pstr->icase, 1))
     return re_string_fetch_byte (pstr);
 
 #ifdef RE_ENABLE_I18N
   if (pstr->offsets_needed)
     {
-      int off, ch;
+      int off;
 
       /* For tr_TR.UTF-8 [[:islower:]] there is
 	 [[: CAPITAL LETTER I WITH DOT lower:]] in mbs.  Skip
@@ -805,6 +815,8 @@
 
       off = pstr->offsets[pstr->cur_idx];
       ch = pstr->raw_mbs[pstr->raw_mbs_idx + off];
+      if (pstr->trans)
+	ch = pstr->trans[ch];
 
       if (! isascii (ch))
 	return re_string_fetch_byte (pstr);
@@ -815,7 +827,10 @@
     }
 #endif
 
-  return pstr->raw_mbs[pstr->raw_mbs_idx + pstr->cur_idx++];
+  ch = pstr->raw_mbs[pstr->raw_mbs_idx + pstr->cur_idx++];
+  if (pstr->trans)
+    ch = pstr->trans[ch];
+  return ch;
 }
 
 static void
@@ -838,13 +853,16 @@
      int idx, eflags;
 {
   int c;
-  if (BE (idx < 0, 0))
-    /* In this case, we use the value stored in input->tip_context,
-       since we can't know the character in input->mbs[-1] here.  */
-    return input->tip_context;
-  if (BE (idx == input->len, 0))
-    return ((eflags & REG_NOTEOL) ? CONTEXT_ENDBUF
-	    : CONTEXT_NEWLINE | CONTEXT_ENDBUF);
+  if (idx < 0 || idx == input->len)
+    {
+      if (idx < 0)
+	/* In this case, we use the value stored in input->tip_context,
+	   since we can't know the character in input->mbs[-1] here.  */
+	return input->tip_context;
+      else /* (idx == input->len) */
+	return ((eflags & REG_NOTEOL) ? CONTEXT_ENDBUF
+		: CONTEXT_NEWLINE | CONTEXT_ENDBUF);
+    }
 #ifdef RE_ENABLE_I18N
   if (input->mb_cur_max > 1)
     {
@@ -1247,31 +1265,6 @@
   return 1;
 }
 
-/* Insert the new element ELEM to the re_node_set* SET.
-   SET should not already have any element greater than or equal to ELEM.
-   Return -1 if an error is occured, return 1 otherwise.  */
-
-static int
-re_node_set_insert_last (set, elem)
-     re_node_set *set;
-     int elem;
-{
-  /* Realloc if we need.  */
-  if (set->alloc == set->nelem)
-    {
-      int *new_array;
-      set->alloc = (set->alloc + 1) * 2;
-      new_array = re_realloc (set->elems, int, set->alloc);
-      if (BE (new_array == NULL, 0))
-	return -1;
-      set->elems = new_array;
-    }
-
-  /* Insert the new element.  */
-  set->elems[set->nelem++] = elem;
-  return 1;
-}
-
 /* Compare two node sets SET1 and SET2.
    return 1 if SET1 and SET2 are equivalent, return 0 otherwise.  */
 
@@ -1295,7 +1288,7 @@
      const re_node_set *set;
      int elem;
 {
-  unsigned int idx, right, mid;
+  int idx, right, mid;
   if (set->nelem <= 0)
     return 0;
 
@@ -1330,44 +1323,47 @@
    Or return -1, if an error will be occured.  */
 
 static int
-re_dfa_add_node (dfa, token)
+re_dfa_add_node (dfa, token, mode)
      re_dfa_t *dfa;
      re_token_t token;
+     int mode;
 {
-  int type = token.type;
   if (BE (dfa->nodes_len >= dfa->nodes_alloc, 0))
     {
       int new_nodes_alloc = dfa->nodes_alloc * 2;
-      int *new_nexts, *new_indices;
-      re_node_set *new_edests, *new_eclosures;
-
       re_token_t *new_array = re_realloc (dfa->nodes, re_token_t,
 					  new_nodes_alloc);
       if (BE (new_array == NULL, 0))
 	return -1;
       dfa->nodes = new_array;
-      new_nexts = re_realloc (dfa->nexts, int, new_nodes_alloc);
-      new_indices = re_realloc (dfa->org_indices, int, new_nodes_alloc);
-      new_edests = re_realloc (dfa->edests, re_node_set, new_nodes_alloc);
-      new_eclosures = re_realloc (dfa->eclosures, re_node_set, new_nodes_alloc);
-      if (BE (new_nexts == NULL || new_indices == NULL
-	      || new_edests == NULL || new_eclosures == NULL, 0))
-	return -1;
-      dfa->nexts = new_nexts;
-      dfa->org_indices = new_indices;
-      dfa->edests = new_edests;
-      dfa->eclosures = new_eclosures;
+      if (mode)
+	{
+	  int *new_nexts, *new_indices;
+	  re_node_set *new_edests, *new_eclosures, *new_inveclosures;
+
+	  new_nexts = re_realloc (dfa->nexts, int, new_nodes_alloc);
+	  new_indices = re_realloc (dfa->org_indices, int, new_nodes_alloc);
+	  new_edests = re_realloc (dfa->edests, re_node_set, new_nodes_alloc);
+	  new_eclosures = re_realloc (dfa->eclosures, re_node_set,
+				      new_nodes_alloc);
+	  new_inveclosures = re_realloc (dfa->inveclosures, re_node_set,
+					 new_nodes_alloc);
+	  if (BE (new_nexts == NULL || new_indices == NULL
+		  || new_edests == NULL || new_eclosures == NULL
+		  || new_inveclosures == NULL, 0))
+	    return -1;
+	  dfa->nexts = new_nexts;
+	  dfa->org_indices = new_indices;
+	  dfa->edests = new_edests;
+	  dfa->eclosures = new_eclosures;
+	  dfa->inveclosures = new_inveclosures;
+	}
       dfa->nodes_alloc = new_nodes_alloc;
     }
   dfa->nodes[dfa->nodes_len] = token;
+  dfa->nodes[dfa->nodes_len].opt_subexp = 0;
+  dfa->nodes[dfa->nodes_len].duplicated = 0;
   dfa->nodes[dfa->nodes_len].constraint = 0;
-#ifdef RE_ENABLE_I18N
-  dfa->nodes[dfa->nodes_len].accept_mb =
-    (type == OP_PERIOD && dfa->mb_cur_max > 1) || type == COMPLEX_BRACKET;
-#endif
-  dfa->nexts[dfa->nodes_len] = -1;
-  re_node_set_init_empty (dfa->edests + dfa->nodes_len);
-  re_node_set_init_empty (dfa->eclosures + dfa->nodes_len);
   return dfa->nodes_len++;
 }
 
@@ -1478,32 +1474,43 @@
     }
 }
 
-/* Finish initialization of the new state NEWSTATE, and using its hash value
-   HASH put in the appropriate bucket of DFA's state table.  Return value
-   indicates the error code if failed.  */
+/* Allocate memory for DFA state and initialize common properties.
+   Return the new state if succeeded, otherwise return NULL.  */
 
-static reg_errcode_t
-register_state (dfa, newstate, hash)
+static re_dfastate_t *
+create_newstate_common (dfa, nodes, hash)
      re_dfa_t *dfa;
-     re_dfastate_t *newstate;
+     const re_node_set *nodes;
      unsigned int hash;
 {
-  struct re_state_table_entry *spot;
+  re_dfastate_t *newstate;
   reg_errcode_t err;
-  int i;
-
-  newstate->hash = hash;
-  err = re_node_set_alloc (&newstate->non_eps_nodes, newstate->nodes.nelem);
+  newstate = (re_dfastate_t *) calloc (sizeof (re_dfastate_t), 1);
+  if (BE (newstate == NULL, 0))
+    return NULL;
+  err = re_node_set_init_copy (&newstate->nodes, nodes);
   if (BE (err != REG_NOERROR, 0))
-    return REG_ESPACE;
-  for (i = 0; i < newstate->nodes.nelem; i++)
     {
-      int elem = newstate->nodes.elems[i];
-      if (!IS_EPSILON_NODE (dfa->nodes[elem].type))
-        re_node_set_insert_last (&newstate->non_eps_nodes, elem);
+      re_free (newstate);
+      return NULL;
     }
+  newstate->trtable = NULL;
+  newstate->hash = hash;
+  return newstate;
+}
 
+/* Store the new state NEWSTATE whose hash value is HASH in appropriate
+   position.  Return value indicate the error code if failed.  */
+
+static reg_errcode_t
+register_state (dfa, newstate, hash)
+     re_dfa_t *dfa;
+     re_dfastate_t *newstate;
+     unsigned int hash;
+{
+  struct re_state_table_entry *spot;
   spot = dfa->state_table + (hash & dfa->state_hash_mask);
+
   if (BE (spot->alloc <= spot->num, 0))
     {
       int new_alloc = 2 * spot->num + 2;
@@ -1530,31 +1537,27 @@
   int i;
   reg_errcode_t err;
   re_dfastate_t *newstate;
-
-  newstate = (re_dfastate_t *) calloc (sizeof (re_dfastate_t), 1);
+  newstate = create_newstate_common (dfa, nodes, hash);
   if (BE (newstate == NULL, 0))
     return NULL;
-  err = re_node_set_init_copy (&newstate->nodes, nodes);
-  if (BE (err != REG_NOERROR, 0))
-    {
-      re_free (newstate);
-      return NULL;
-    }
-
   newstate->entrance_nodes = &newstate->nodes;
+
   for (i = 0 ; i < nodes->nelem ; i++)
     {
       re_token_t *node = dfa->nodes + nodes->elems[i];
       re_token_type_t type = node->type;
       if (type == CHARACTER && !node->constraint)
 	continue;
-#ifdef RE_ENABLE_I18N
-      newstate->accept_mb |= node->accept_mb;
-#endif /* RE_ENABLE_I18N */
 
       /* If the state has the halt node, the state is a halt state.  */
-      if (type == END_OF_RE)
+      else if (type == END_OF_RE)
 	newstate->halt = 1;
+#ifdef RE_ENABLE_I18N
+      else if (type == COMPLEX_BRACKET
+	       || type == OP_UTF8_PERIOD
+	       || (type == OP_PERIOD && dfa->mb_cur_max > 1))
+	newstate->accept_mb = 1;
+#endif /* RE_ENABLE_I18N */
       else if (type == OP_BACK_REF)
 	newstate->has_backref = 1;
       else if (type == ANCHOR || node->constraint)
@@ -1582,16 +1585,9 @@
   reg_errcode_t err;
   re_dfastate_t *newstate;
 
-  newstate = (re_dfastate_t *) calloc (sizeof (re_dfastate_t), 1);
+  newstate = create_newstate_common (dfa, nodes, hash);
   if (BE (newstate == NULL, 0))
     return NULL;
-  err = re_node_set_init_copy (&newstate->nodes, nodes);
-  if (BE (err != REG_NOERROR, 0))
-    {
-      re_free (newstate);
-      return NULL;
-    }
-
   newstate->context = context;
   newstate->entrance_nodes = &newstate->nodes;
 
@@ -1605,13 +1601,15 @@
 
       if (type == CHARACTER && !constraint)
 	continue;
-#ifdef RE_ENABLE_I18N
-      newstate->accept_mb |= node->accept_mb;
-#endif /* RE_ENABLE_I18N */
-
       /* If the state has the halt node, the state is a halt state.  */
-      if (type == END_OF_RE)
+      else if (type == END_OF_RE)
 	newstate->halt = 1;
+#ifdef RE_ENABLE_I18N
+      else if (type == COMPLEX_BRACKET
+	       || type == OP_UTF8_PERIOD
+	       || (type == OP_PERIOD && dfa->mb_cur_max > 1))
+	newstate->accept_mb = 1;
+#endif /* RE_ENABLE_I18N */
       else if (type == OP_BACK_REF)
 	newstate->has_backref = 1;
       else if (type == ANCHOR)
@@ -1652,15 +1650,12 @@
 free_state (state)
      re_dfastate_t *state;
 {
-  re_node_set_free (&state->non_eps_nodes);
-  re_node_set_free (&state->inveclosure);
   if (state->entrance_nodes != &state->nodes)
     {
       re_node_set_free (state->entrance_nodes);
       re_free (state->entrance_nodes);
     }
   re_node_set_free (&state->nodes);
-  re_free (state->word_trtable);
   re_free (state->trtable);
   re_free (state);
 }
--- 4.1.4/lib/regex_internal.h
+++ 4.0.9/lib/regex_internal.h
@@ -1,5 +1,5 @@
 /* Extended regular expression matching and search library.
-   Copyright (C) 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003, 2004 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Isamu Hasegawa <isamu@yamato.ibm.com>.
 
@@ -23,13 +23,11 @@
 
 #include <assert.h>
 #include <ctype.h>
+#include <limits.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 
-#if defined HAVE_LANGINFO_H || defined HAVE_LANGINFO_CODESET || defined _LIBC
-# include <langinfo.h>
-#endif
 #if defined HAVE_LOCALE_H || defined _LIBC
 # include <locale.h>
 #endif
@@ -55,7 +53,7 @@
 #endif
 
 /* This is for other GNU distributions with internationalized messages.  */
-#if (HAVE_LIBINTL_H && ENABLE_NLS) || defined _LIBC
+#if HAVE_LIBINTL_H || defined _LIBC
 # include <libintl.h>
 # ifdef _LIBC
 #  undef gettext
@@ -101,7 +99,6 @@
 # define __btowc btowc
 # define __mempcpy mempcpy
 # define __wcrtomb wcrtomb
-# define __regfree regfree
 # define attribute_hidden
 #endif /* not _LIBC */
 
@@ -143,21 +140,18 @@
 #define NEXT_NEWLINE_CONSTRAINT 0x0020
 #define PREV_BEGBUF_CONSTRAINT 0x0040
 #define NEXT_ENDBUF_CONSTRAINT 0x0080
-#define WORD_DELIM_CONSTRAINT 0x0100
-#define NOT_WORD_DELIM_CONSTRAINT 0x0200
+#define DUMMY_CONSTRAINT 0x0100
 
 typedef enum
 {
   INSIDE_WORD = PREV_WORD_CONSTRAINT | NEXT_WORD_CONSTRAINT,
   WORD_FIRST = PREV_NOTWORD_CONSTRAINT | NEXT_WORD_CONSTRAINT,
   WORD_LAST = PREV_WORD_CONSTRAINT | NEXT_NOTWORD_CONSTRAINT,
-  INSIDE_NOTWORD = PREV_NOTWORD_CONSTRAINT | NEXT_NOTWORD_CONSTRAINT,
   LINE_FIRST = PREV_NEWLINE_CONSTRAINT,
   LINE_LAST = NEXT_NEWLINE_CONSTRAINT,
   BUF_FIRST = PREV_BEGBUF_CONSTRAINT,
   BUF_LAST = NEXT_ENDBUF_CONSTRAINT,
-  WORD_DELIM = WORD_DELIM_CONSTRAINT,
-  NOT_WORD_DELIM = NOT_WORD_DELIM_CONSTRAINT
+  WORD_DELIM = DUMMY_CONSTRAINT
 } re_context_type;
 
 typedef struct
@@ -189,16 +183,15 @@
   OP_CLOSE_SUBEXP = EPSILON_BIT | 1,
   OP_ALT = EPSILON_BIT | 2,
   OP_DUP_ASTERISK = EPSILON_BIT | 3,
-  ANCHOR = EPSILON_BIT | 4,
+  OP_DUP_PLUS = EPSILON_BIT | 4,
+  OP_DUP_QUESTION = EPSILON_BIT | 5,
+  ANCHOR = EPSILON_BIT | 6,
 
   /* Tree type, these are used only by tree. */
   CONCAT = 16,
-  SUBEXP = 17,
 
   /* Token type, these are used only by token.  */
-  OP_DUP_PLUS = 18,
-  OP_DUP_QUESTION,
-  OP_OPEN_BRACKET,
+  OP_OPEN_BRACKET = 17,
   OP_CLOSE_BRACKET,
   OP_CHARSET_RANGE,
   OP_OPEN_DUP_NUM,
@@ -287,7 +280,6 @@
   unsigned int duplicated : 1;
   unsigned int opt_subexp : 1;
 #ifdef RE_ENABLE_I18N
-  unsigned int accept_mb : 1;
   /* These 2 bits can be moved into the union if needed (e.g. if running out
      of bits; move opr.c to opr.c.c and move the flags to opr.c.flags).  */
   unsigned int mb_partial : 1;
@@ -296,6 +288,8 @@
 } re_token_t;
 
 #define IS_EPSILON_NODE(type) ((type) & EPSILON_BIT)
+#define ACCEPT_MB_NODE(type) \
+  ((type) >= OP_PERIOD && (type) <= OP_UTF8_PERIOD)
 
 struct re_string_t
 {
@@ -339,7 +333,7 @@
      the beginning of the input string.  */
   unsigned int tip_context;
   /* The translation passed as a part of an argument of re_compile_pattern.  */
-  unsigned RE_TRANSLATE_TYPE trans;
+  RE_TRANSLATE_TYPE trans;
   /* Copy of re_dfa_t's word_char.  */
   re_const_bitset_ptr_t word_char;
   /* 1 if REG_ICASE.  */
@@ -390,20 +384,18 @@
 static void re_string_destruct (re_string_t *pstr) internal_function;
 # ifdef RE_ENABLE_I18N
 static int re_string_elem_size_at (const re_string_t *pstr, int idx)
-     internal_function __attribute ((pure));
+     internal_function;
 static inline int re_string_char_size_at (const re_string_t *pstr, int idx)
-     internal_function __attribute ((pure));
+     internal_function;
 static inline wint_t re_string_wchar_at (const re_string_t *pstr, int idx)
-     internal_function __attribute ((pure));
+     internal_function;
 # endif /* RE_ENABLE_I18N */
 static unsigned int re_string_context_at (const re_string_t *input, int idx,
-					  int eflags)
-     internal_function __attribute ((pure));
+					  int eflags) internal_function;
 static unsigned char re_string_peek_byte_case (const re_string_t *pstr,
-					       int idx)
-     internal_function __attribute ((pure));
+					       int idx) internal_function;
 static unsigned char re_string_fetch_byte_case (re_string_t *pstr)
-     internal_function __attribute ((pure));
+     internal_function;
 #endif
 #define re_string_peek_byte(pstr, offset) \
   ((pstr)->mbs[(pstr)->cur_idx + offset])
@@ -412,7 +404,7 @@
 #define re_string_first_byte(pstr, idx) \
   ((idx) == (pstr)->valid_len || (pstr)->wcs[idx] != WEOF)
 #define re_string_is_single_byte_char(pstr, idx) \
-  ((pstr)->wcs[idx] != WEOF && ((pstr)->valid_len == (idx) + 1 \
+  ((pstr)->wcs[idx] != WEOF && ((pstr)->valid_len == (idx) \
 				|| (pstr)->wcs[(idx) + 1] != WEOF))
 #define re_string_eoi(pstr) ((pstr)->stop <= (pstr)->cur_idx)
 #define re_string_cur_idx(pstr) ((pstr)->cur_idx)
@@ -431,14 +423,15 @@
   struct bin_tree_t *parent;
   struct bin_tree_t *left;
   struct bin_tree_t *right;
-  struct bin_tree_t *first;
-  struct bin_tree_t *next;
-
-  re_token_t token;
 
   /* `node_idx' is the index in dfa->nodes, if `type' == 0.
      Otherwise `type' indicate the type of this node.  */
+  re_token_type_t type;
   int node_idx;
+
+  int first;
+  int next;
+  re_node_set eclosure;
 };
 typedef struct bin_tree_t bin_tree_t;
 
@@ -484,10 +477,8 @@
 {
   unsigned int hash;
   re_node_set nodes;
-  re_node_set non_eps_nodes;
-  re_node_set inveclosure;
   re_node_set *entrance_nodes;
-  struct re_dfastate_t **trtable, **word_trtable;
+  struct re_dfastate_t **trtable;
   unsigned int context : 4;
   unsigned int halt : 1;
   /* If this state can accept `multi byte'.
@@ -497,9 +488,17 @@
   /* If this state has backreference node(s).  */
   unsigned int has_backref : 1;
   unsigned int has_constraint : 1;
+  unsigned int word_trtable : 1;
 };
 typedef struct re_dfastate_t re_dfastate_t;
 
+typedef struct
+{
+  /* start <= node < end  */
+  int start;
+  int end;
+} re_subexp_t;
+
 struct re_state_table_entry
 {
   int num;
@@ -546,9 +545,7 @@
   int str_idx;
   int subexp_from;
   int subexp_to;
-  char more;
-  char unused;
-  unsigned short int eps_reachable_subexps_map;
+  int flag;
 };
 
 typedef struct
@@ -580,11 +577,17 @@
 
 typedef struct
 {
+  int cur_bkref;
+  int cls_subexp_idx;
+
   re_dfastate_t **sifted_states;
   re_dfastate_t **limited_states;
+
+  re_node_set limits;
+
   int last_node;
   int last_str_idx;
-  re_node_set limits;
+  int check_subexp;
 } re_sift_context_t;
 
 struct re_fail_stack_ent_t
@@ -604,6 +607,7 @@
 
 struct re_dfa_t
 {
+  re_subexp_t *subexps;
   re_token_t *nodes;
   int nodes_alloc;
   int nodes_len;
@@ -623,15 +627,13 @@
   int str_tree_storage_idx;
 
   /* number of subexpressions `re_nsub' is in regex_t.  */
+  int subexps_alloc;
   unsigned int state_hash_mask;
   int states_alloc;
   int init_node;
   int nbackref; /* The number of backreference in this dfa.  */
-
   /* Bitmap expressing which backreference is used.  */
   unsigned int used_bkref_map;
-  unsigned int completed_bkref_map;
-
   unsigned int has_plural_match : 1;
   /* If this dfa has "multibyte node", which is a backreference or
      a node which can accept multibyte character or multi character
@@ -643,7 +645,6 @@
   int mb_cur_max;
   bitset word_char;
   reg_syntax_t syntax;
-  int *subexp_map;
 #ifdef DEBUG
   char* re_str;
 #endif
@@ -666,19 +667,15 @@
 static reg_errcode_t re_node_set_merge (re_node_set *dest,
 					const re_node_set *src) internal_function;
 static int re_node_set_insert (re_node_set *set, int elem) internal_function;
-static int re_node_set_insert_last (re_node_set *set,
-				    int elem) internal_function;
 static int re_node_set_compare (const re_node_set *set1,
-				const re_node_set *set2)
-     internal_function __attribute ((pure));
-static int re_node_set_contains (const re_node_set *set, int elem)
-     internal_function __attribute ((pure));
+				const re_node_set *set2) internal_function;
+static int re_node_set_contains (const re_node_set *set, int elem) internal_function;
 static void re_node_set_remove_at (re_node_set *set, int idx) internal_function;
 #define re_node_set_remove(set,id) \
   (re_node_set_remove_at (set, re_node_set_contains (set, id) - 1))
 #define re_node_set_empty(p) ((p)->nelem = 0)
 #define re_node_set_free(set) re_free ((set)->elems)
-static int re_dfa_add_node (re_dfa_t *dfa, re_token_t token) internal_function;
+static int re_dfa_add_node (re_dfa_t *dfa, re_token_t token, int mode) internal_function;
 static re_dfastate_t *re_acquire_state (reg_errcode_t *err, re_dfa_t *dfa,
 					const re_node_set *nodes) internal_function;
 static re_dfastate_t *re_acquire_state_context (reg_errcode_t *err,
@@ -712,7 +709,8 @@
 
 /* Inline functions for bitset operation.  */
 static inline void
-bitset_not (bitset set)
+bitset_not (set)
+     bitset set;
 {
   int bitset_i;
   for (bitset_i = 0; bitset_i < BITSET_UINTS; ++bitset_i)
@@ -720,7 +718,9 @@
 }
 
 static inline void
-bitset_merge (bitset dest, const bitset src)
+bitset_merge (dest, src)
+     bitset dest;
+     const bitset src;
 {
   int bitset_i;
   for (bitset_i = 0; bitset_i < BITSET_UINTS; ++bitset_i)
@@ -728,7 +728,9 @@
 }
 
 static inline void
-bitset_not_merge (bitset dest, const bitset src)
+bitset_not_merge (dest, src)
+     bitset dest;
+     const bitset src;
 {
   int i;
   for (i = 0; i < BITSET_UINTS; ++i)
@@ -736,7 +738,9 @@
 }
 
 static inline void
-bitset_mask (bitset dest, const bitset src)
+bitset_mask (dest, src)
+     bitset dest;
+     const bitset src;
 {
   int bitset_i;
   for (bitset_i = 0; bitset_i < BITSET_UINTS; ++bitset_i)
@@ -746,8 +750,9 @@
 #if defined RE_ENABLE_I18N && !defined RE_NO_INTERNAL_PROTOTYPES
 /* Inline functions for re_string.  */
 static inline int
-internal_function
-re_string_char_size_at (const re_string_t *pstr, int idx)
+re_string_char_size_at (pstr, idx)
+     const re_string_t *pstr;
+     int idx;
 {
   int byte_idx;
   if (pstr->mb_cur_max == 1)
@@ -759,8 +764,9 @@
 }
 
 static inline wint_t
-internal_function
-re_string_wchar_at (const re_string_t *pstr, int idx)
+re_string_wchar_at (pstr, idx)
+     const re_string_t *pstr;
+     int idx;
 {
   if (pstr->mb_cur_max == 1)
     return (wint_t) pstr->mbs[idx];
@@ -768,8 +774,9 @@
 }
 
 static int
-internal_function
-re_string_elem_size_at (const re_string_t *pstr, int idx)
+re_string_elem_size_at (pstr, idx)
+     const re_string_t *pstr;
+     int idx;
 {
 #ifdef _LIBC
   const unsigned char *p, *extra;
@@ -796,3 +803,5 @@
 #endif /* RE_ENABLE_I18N */
 
 #endif /*  _REGEX_INTERNAL_H */
+
+
--- 4.1.4/lib/utils.c
+++ 4.0.9/lib/utils.c
@@ -39,20 +39,7 @@
 
 const char *myname;
 
-/* Store information about files opened with ck_fopen
-   so that error messages from ck_fread, ck_fwrite, etc. can print the
-   name of the file that had the error */
-
-struct open_file
-  {
-    FILE *fp;
-    char *name;
-    struct open_file *link;
-    unsigned temp : 1;
-  };
-
-static struct open_file *open_files = NULL;
-static void do_ck_fclose P_((FILE *fp));
+void do_ck_fclose P_((FILE *stream));
 
 /* Print an error message and exit */
 #if !defined __STDC__ || !(__STDC__-0)
@@ -84,36 +71,32 @@
 #endif /* HAVE_VFPRINTF */
   va_end(iggy);
   putc('\n', stderr);
-
-  /* Unlink the temporary files.  */
-  while (open_files)
-    {
-      if (open_files->temp)
-	{
-	  int fd = fileno (open_files->fp);
-	  fclose (open_files->fp);
-	  errno = 0;
-	  unlink (open_files->name);
-          if (errno != 0)
-            fprintf (stderr, _("cannot remove %s: %s"), open_files->name, strerror (errno));
-	}
-
-      open_files = open_files->link;
-    }
-
   exit(4);
 }
 
 
-/* Internal routine to get a filename from open_files */
+/* Store information about files opened with ck_fopen
+   so that error messages from ck_fread, ck_fwrite, etc. can print the
+   name of the file that had the error */
+
+struct id
+  {
+    FILE *fp;
+    char *name;
+    struct id *link;
+  };
+
+static struct id *utils_id_s = NULL;
+
+/* Internal routine to get a filename from utils_id_s */
 static const char *utils_fp_name P_((FILE *fp));
 static const char *
 utils_fp_name(fp)
   FILE *fp;
 {
-  struct open_file *p;
+  struct id *p;
 
-  for (p=open_files; p; p=p->link)
+  for (p=utils_id_s; p; p=p->link)
     if (p->fp == fp)
       return p->name;
   if (fp == stdin)
@@ -131,21 +114,21 @@
 ck_fopen(name, mode, fail)
   const char *name;
   const char *mode;
-  bool fail;
+  flagT fail;
 {
   FILE *fp;
-  struct open_file *p;
+  struct id *p;
 
   fp = fopen (name, mode);
   if (!fp)
     {
       if (fail)
-        panic(_("couldn't open file %s: %s"), name, strerror(errno));
+        panic(_("Couldn't open file %s: %s"), name, strerror(errno));
 
       return NULL;
     }
 
-  for (p=open_files; p; p=p->link)
+  for (p=utils_id_s; p; p=p->link)
     {
       if (fp == p->fp)
 	{
@@ -155,55 +138,12 @@
     }
   if (!p)
     {
-      p = MALLOC(1, struct open_file);
-      p->link = open_files;
-      open_files = p;
+      p = MALLOC(1, struct id);
+      p->link = utils_id_s;
+      utils_id_s = p;
     }
   p->name = ck_strdup(name);
   p->fp = fp;
-  p->temp = false;
-  return fp;
-}
-
-FILE *
-ck_mkstemp (p_filename, tmpdir, base)
-  char **p_filename;
-  char *base, *tmpdir;
-{
-  char *template;
-  FILE *fp;
-  int fd;
-  struct open_file *p;
-
-  if (tmpdir == NULL)
-    tmpdir = getenv("TMPDIR");
-  if (tmpdir == NULL)
-    {
-      tmpdir = getenv("TMP");
-      if (tmpdir == NULL)
-#ifdef P_tmpdir
-	tmpdir = P_tmpdir;
-#else
-	tmpdir = "/tmp";
-#endif
-    }
-
-  template = xmalloc (strlen (tmpdir) + strlen (base) + 8);
-  sprintf (template, "%s/%sXXXXXX", tmpdir, base);
-
-  fd = mkstemp (template);
-  if (fd == -1)
-    panic(_("couldn't open temporary file %s: %s"), template, strerror(errno));
-
-  *p_filename = template;
-  fp = fdopen (fd, "w");
-
-  p = MALLOC(1, struct open_file);
-  p->name = ck_strdup (template);
-  p->fp = fp;
-  p->temp = true;
-  p->link = open_files;
-  open_files = p;
   return fp;
 }
 
@@ -237,22 +177,6 @@
   return nmemb;
 }
 
-size_t
-ck_getline(text, buflen, stream)
-  char **text;
-  size_t *buflen;
-  FILE *stream;
-{
-  int result;
-  if (!ferror (stream))
-    result = getline (text, buflen, stream);
-
-  if (ferror (stream))
-    panic (_("read error on %s: %s"), utils_fp_name(stream), strerror(errno));
-
-  return result;
-}
-
 /* Panic on failing fflush */
 void
 ck_fflush(stream)
@@ -260,7 +184,7 @@
 {
   clearerr(stream);
   if (fflush(stream) == EOF && errno != EBADF)
-    panic("couldn't flush %s: %s", utils_fp_name(stream), strerror(errno));
+    panic("Couldn't flush %s: %s", utils_fp_name(stream), strerror(errno));
 }
 
 /* Panic on failing fclose */
@@ -268,12 +192,12 @@
 ck_fclose(stream)
   FILE *stream;
 {
-  struct open_file r;
-  struct open_file *prev;
-  struct open_file *cur;
+  struct id r;
+  struct id *prev;
+  struct id *cur;
 
   /* a NULL stream means to close all files */
-  r.link = open_files;
+  r.link = utils_id_s;
   prev = &r;
   while ( (cur = prev->link) )
     {
@@ -288,7 +212,7 @@
 	prev = cur;
     }
 
-  open_files = r.link;
+  utils_id_s = r.link;
 
   /* Also care about stdout, because if it is redirected the
      last output operations might fail and it is important
@@ -300,49 +224,43 @@
     }
 }
 
-/* Close a single file. */
+/* Close a single file and update a count of closed files. */
 void
-do_ck_fclose(fp)
-  FILE *fp;
+do_ck_fclose(stream)
+  FILE *stream;
 {
-  int fd;
-  ck_fflush(fp);
-  clearerr(fp);
-
-  /* We want to execute both arms, so use | not ||.  */
-  if (fclose(fp) == EOF)
-    panic("couldn't close %s: %s", utils_fp_name(fp), strerror(errno));
+  ck_fflush(stream);
+  clearerr(stream);
+  if (fclose(stream) == EOF)
+    panic("Couldn't close %s: %s", utils_fp_name(stream), strerror(errno));
 }
-
 
-/* Panic on failing rename */
-void
-ck_rename (from, to, unlink_if_fail)
-  const char *from, *to;
-  const char *unlink_if_fail;
-{
-  int rd = rename (from, to);
-  if (rd != -1)
-    return;
 
-  if (unlink_if_fail)
+
+char *
+temp_file_template(tmpdir, program)
+  const char *tmpdir;    
+  char *program;
+{
+  char *template;
+  if (tmpdir == NULL)
+    tmpdir = getenv("TMPDIR");
+  if (tmpdir == NULL)
     {
-      int save_errno = errno;
-      errno = 0;
-      unlink (unlink_if_fail);
-
-      /* Failure to remove the temporary file is more severe, so trigger it first.  */
-      if (errno != 0)
-        panic (_("cannot remove %s: %s"), unlink_if_fail, strerror (errno));
-
-      errno = save_errno;
+      tmpdir = getenv("TMP");
+      if (tmpdir == NULL)
+#ifdef P_tmpdir
+	tmpdir = P_tmpdir;
+#else
+	tmpdir = "/tmp";
+#endif
     }
 
-  panic (_("cannot rename %s: %s"), from, strerror (errno));
+  template = xmalloc (strlen (tmpdir) + strlen (program) + 8);
+  sprintf (template, "%s/%sXXXXXX", tmpdir, program);
+  return (template);
 }
 
-
-
 
 /* Panic on failing malloc */
 VOID *
@@ -351,7 +269,7 @@
 {
   VOID *ret = calloc(1, size ? size : 1);
   if (!ret)
-    panic("couldn't allocate memory");
+    panic("Couldn't allocate memory");
   return ret;
 }
 
@@ -380,7 +298,7 @@
     return ck_malloc(size);
   ret = realloc(ptr, size);
   if (!ret)
-    panic("couldn't re-allocate memory");
+    panic("Couldn't re-allocate memory");
   return ret;
 }
 
@@ -472,21 +390,19 @@
   b->b = try;
 }
 
-char *
+void
 add_buffer(b, p, n)
   struct buffer *b;
   const char *p;
   size_t n;
 {
-  char *result;
   if (b->allocated - b->length < n)
     resize_buffer(b, b->length+n);
-  result = memcpy(b->b + b->length, p, n);
+  memcpy(b->b + b->length, p, n);
   b->length += n;
-  return result;
 }
 
-char *
+void
 add1_buffer(b, c)
   struct buffer *b;
   int c;
@@ -499,15 +415,10 @@
    */
   if (c != EOF)
     {
-      char *result;
       if (b->allocated - b->length < 1)
 	resize_buffer(b, b->length+1);
-      result = b->b + b->length++;
-      *result = c;
-      return result;
+      b->b[b->length++] = c;
     }
-
-  return NULL;
 }
 
 void
--- 4.1.4/lib/utils.h
+++ 4.0.9/lib/utils.h
@@ -22,14 +22,13 @@
 
 void panic P_((const char *str, ...));
 
-FILE *ck_fopen P_((const char *name, const char *mode, bool fail));
+FILE *ck_fopen P_((const char *name, const char *mode, flagT fail));
 void ck_fwrite P_((const VOID *ptr, size_t size, size_t nmemb, FILE *stream));
 size_t ck_fread P_((VOID *ptr, size_t size, size_t nmemb, FILE *stream));
 void ck_fflush P_((FILE *stream));
 void ck_fclose P_((FILE *stream));
-size_t ck_getline P_((char **text, size_t *buflen, FILE *stream));
-FILE * ck_mkstemp P_((char **p_filename, char *tmpdir, char *base));
-void ck_rename P_((const char *from, const char *to, const char *unlink_if_fail));
+
+char *temp_file_template P_((const char *tmpdir, char *program));
 
 VOID *ck_malloc P_((size_t size));
 VOID *xmalloc P_((size_t size));
@@ -41,8 +40,8 @@
 struct buffer *init_buffer P_((void));
 char *get_buffer P_((struct buffer *b));
 size_t size_buffer P_((struct buffer *b));
-char *add_buffer P_((struct buffer *b, const char *p, size_t n));
-char *add1_buffer P_((struct buffer *b, int ch));
+void add_buffer P_((struct buffer *b, const char *p, size_t n));
+void add1_buffer P_((struct buffer *b, int ch));
 void free_buffer P_((struct buffer *b));
 
 extern const char *myname;
--- 4.1.4/Makefile.am
+++ 4.0.9/Makefile.am
@@ -12,29 +12,9 @@
 noinst_HEADERS = basicdefs.h
 
 EXTRA_DIST = BUGS THANKS COPYING.DOC README.boot bootstrap.sh 	      \
-	config/texi2dvi    config/help2man
+	config/texi2dvi config/help2man
 
 html:
 	cd doc && make html
 
-DISTCHECK_CONFIGURE_FLAGS = XGETTEXT='$(SHELL) -c : dummy' $(EXTRA_DC_FLAGS)
-EXTRA_DC_FLAGS = 
 
-full-distcheck:
-	make distcheck EXTRA_DC_FLAGS='--enable-html'
-	make distcheck EXTRA_DC_FLAGS='--disable-i18n'
-	make distcheck EXTRA_DC_FLAGS='--without-included-regex'
-
-update-regex:
-	HOST=sources.redhat.com && \
-	BASEURL="http://$$HOST/cgi-bin/cvsweb.cgi/~checkout~/libc/posix" && \
-	QUERY='cvsroot=glibc&content-type=text/plain' && \
-	wget -O lib/regcomp.c "$$BASEURL/regcomp.c?$$QUERY" && \
-	wget -O lib/regexec.c "$$BASEURL/regexec.c?$$QUERY" && \
-	wget -O lib/regex.c "$$BASEURL/regex.c?$$QUERY" && \
-	wget -O lib/regex_.h "$$BASEURL/regex.h?$$QUERY" && \
-	wget -O lib/regex_internal.c "$$BASEURL/regex_internal.c?$$QUERY" && \
-	wget -O lib/regex_internal.h "$$BASEURL/regex_internal.h?$$QUERY" && \
-	wget -O testsuite/BOOST.tests "$$BASEURL/BOOST.tests?$$QUERY" && \
-	wget -O testsuite/PCRE.tests "$$BASEURL/PCRE.tests?$$QUERY" && \
-	wget -O testsuite/SPENCER.tests "$$BASEURL/rxspencer/tests?$$QUERY"
--- 4.1.4/NEWS
+++ 4.0.9/NEWS
@@ -1,115 +1,3 @@
-Sed 4.1.4
-
-* \B correctly means "not on a word boundary" rather than "inside a word"
-
-* bugfixes for platform without internationalization
-
-* more thorough testing framework for tarballs (`make full-distcheck')
-
-----------------------------------------------------------------------------
-Sed 4.1.3
-
-* regex addresses do not use leftmost-longest matching.  In other words,
-  /.\+/ only looks for a single character, and does not try to find as
-  many of them as possible like it used to do.
-
-* added a note to BUGS and the manual about changed interpretation
-  of `s|abc\|def||', and about localization issues.
-
-* fixed --disable-nls build problems on Solaris.
-
-* fixed `make check' in non-English locales.
-
-* `make check' tests the regex library by default if the included regex
-  is used (regex tests had to be enabled separately up to now).
-
-----------------------------------------------------------------------------
-Sed 4.1.2
-
-* fix bug in 'y' command in multi-byte character sets
-
-* fix severe bug in parsing of ranges with an embedded open bracket
-
-* fix off-by-one error when printing a "bad command" error
-
-----------------------------------------------------------------------------
-Sed 4.1.1
-
-* preserve permissions of in-place edited files
-
-* yield an error when running -i on terminals or other non regular files
-
-* do not interpret - as stdin when running in in-place editing mode
-
-* fix bug that prevented 's' command modifiers from working
-
-----------------------------------------------------------------------------
-Sed 4.1
-
-* // matches the last regular expression even in POSIXLY_CORRECT mode.
-
-* change the way we treat lines which are not terminated by a newline.
-Such lines are printed without the terminating newline (as before)
-but as soon as more text is sent to the same output stream, the
-missing newline is printed, so that the two lines don't concatenate.
-The behavior is now independent from POSIXLY_CORRECT because POSIX
-actually has undefined behavior in this case, and the new implementation
-arguably gives the ``least expected surprise''.  Thanks to Stepan
-Kasal for the implementation.
-
-* documentation improvements, with updated references to the POSIX.2
-specification
-
-* error messages on I/O errors are better, and -i does not leave temporary
-files around (e.g. when running ``sed -i'' on a directory).
-
-* escapes are accepted in the y command (for example: y/o/\n/ transforms
-o's into newlines)
-
-* -i option tries to set the owner and group to the same as the input file
-
-* `L' command is deprecated and will be removed in sed 4.2.
-
-* line number addresses are processed differently -- this is supposedly
-conformant to POSIX and surely more idiot-proof.  Line number addresses
-are not affected by jumping around them: they are activated and
-deactivated exactly where the script says, while previously
-    5,8b
-    1,5d
-would actually delete lines 1,2,3,4 and 9 (!).
-
-* multibyte characters are taken in consideration to compute the
-operands of s and y, provided you set LC_CTYPE correctly.  They are
-also considered by \l, \L, \u, \U, \E.
-
-* [\n] matches either backslash or 'n' when POSIXLY_CORRECT.
-
-* new option --posix, disables all GNU extensions.  POSIXLY_CORRECT only
-disables GNU extensions that violate the POSIX standard.
-
-* options -h and -V are not supported anymore, use --help and --version.
-
-* removed documentation for \s and \S which worked incorrectly
-
-* restored correct behavior for \w and \W: match [[:alnum:]_] and
-[^[:alnum:]_] (they used to match [[:alpha:]_] and [^[:alpha:]_]
-
-* the special address 0 can only be used in 0,/RE/ or 0~STEP addresses;
-other cases give an error (you are hindering portability for no reason
-if specifying 0,N and you are giving a dead command if specifying 0
-alone).
-
-* when a \ is used to escape the character that would terminate an operand
-of the s or y commands, the backslash is removed before the regex is
-compiled.  This is left undefined by POSIX; this behavior makes `s+x\+++g'
-remove occurrences of `x+', consistently with `s/x\///g'.  (However, if
-you enjoy yourself trying `s*x\***g', sed will use the `x*' regex, and you
-won't be able to pass down `x\*' while using * as the delimiter; ideas on
-how to simplify the parser in this respect, and/or gain more coherent
-semantics, are welcome).
-
-
-----------------------------------------------------------------------------
 Sed 4.0.9
 
 * 0 address behaves correctly in single-file (-i and -s) mode.
@@ -121,9 +9,9 @@
 * updated regex matcher from upstream, with many bugfixes and speedups.
 
 * the `N' command's feature that is detailed in the BUGS file was disabled
-by the first change below in sed 4.0.8.  The behavior has now been
-restored, and is only enabled if POSIXLY_CORRECT behavior is not
-requested.
+  by the first change below in sed 4.0.8.  The behavior has now been
+  restored, and is only enabled if POSIXLY_CORRECT behavior is not
+  requested.
 
 ----------------------------------------------------------------------------
 Sed 4.0.8
@@ -138,19 +26,21 @@
 
 * more comprehensive test suite (and with many expected failures...)
 
+* fix for -i option under Cygwin
+
 ----------------------------------------------------------------------------
 Sed 4.0.7
 
 * VPATH builds working on non-glibc machines
 
 * fixed bug in s///Np: was printing even if less than N matches were
-found.
+  found.
 
 * fixed infinite loop on s///N when LHS matched a null string and
-there were not enough matches in pattern space
+  there were not enough matches in pattern space
 
 * behavior of s///N is consistent with s///g when the LHS can match
-a null string (and the infinite loop did not happen :-)
+  a null string (and the infinite loop did not happen :-)
 
 * updated some translations
 
@@ -161,19 +51,17 @@
 
 * configure switch --without-included-regex to use the system regex matcher
 
-* fix for -i option under Cygwin
-
 ----------------------------------------------------------------------------
 Sed 4.0.5
 
 * portability fixes
 
 * improvements to some error messages (e.g. y/abc/defg/ incorrectly said
-`excess characters after command' instead of `y arguments have different
-lengths')
+  `excess characters after command' instead of `y arguments have different
+  lengths')
 
 * `a', `i', `l', `L', `r' accept two addresses except in POSIXLY_CORRECT
-mode.  Only `q' and `Q' do not accept two addresses in standard (GNU) mode.
+  mode.  Only `q' and `Q' do not accept two address in standard (GNU) mode.
 
 ----------------------------------------------------------------------------
 Sed 4.0.4
@@ -223,7 +111,7 @@
 * `R' command reads a single line from a file.
 
 * CR-LF pairs are always ignored under Windows, even if (under Cygwin)
-a disk is mounted as binary.
+  a disk is mounted as binary.
 
 * More attention to errors on stdout
 
--- 4.1.4/po/ChangeLog
+++ 4.0.9/po/ChangeLog
@@ -1,11 +1,3 @@
-2004-11-11  Paolo Bonzini  <bonzini@gnu.org>
-
-	* Makevars: New.
-
-2004-11-02  gettextize  <bug-gnu-utils@gnu.org>
-
-	* Makefile.in.in: Upgrade to gettext-0.10.40.
-
 2002-10-26  Paolo Bonzini  <bonzini@gnu.org>
 
 	* po/*.po: updated from Translation Project



--- 4.1.4/sed/execute.c
+++ 4.0.9/sed/execute.c
@@ -1,6 +1,6 @@
 
 /*  GNU SED, a batch stream editor.
-    Copyright (C) 1989,90,91,92,93,94,95,98,99,2002,2003
+    Copyright (C) 1989,90,91,92,93,94,95,98,99,2002,2003,2004
     Free Software Foundation, Inc.
 
     This program is free software; you can redistribute it and/or modify
--- 4.1.4/sed/Makefile.am
+++ 4.0.9/sed/Makefile.am
@@ -3,12 +3,12 @@
 
 localedir = $(datadir)/locale
 
-sed_SOURCES = sed.c compile.c execute.c regexp.c fmt.c mbcs.c
+sed_SOURCES = sed.c compile.c execute.c regexp.c fmt.c
 noinst_HEADERS = sed.h
 
 AM_CPPFLAGS = -I$(top_srcdir)/lib -I$(top_srcdir)/intl \
 	-I$(top_srcdir) -I$(top_builddir)/lib \
-	-I$(top_builddir)/intl -DLOCALEDIR=\"$(localedir)\"
+	-DLOCALEDIR=\"$(localedir)\"
 
 sed_LDADD = ../lib/libsed.a @INTLLIBS@
 sed_DEPENDENCIES = ../lib/libsed.a
--- 4.1.4/testsuite/8to7.sed
+++ 4.0.9/testsuite/8to7.sed
@@ -1 +1,4 @@
+# it isn't entirely clear how lines should be wrapped.  Plus I am
+# not sure whether sed is required to append a $ at the end of line or
+# not.
 l;d
--- 4.1.4/testsuite/bug-regex11.c
+++ 4.0.9/testsuite/bug-regex11.c
@@ -18,12 +18,8 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -98,9 +94,7 @@
   size_t i;
   int n, ret = 0;
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   for (i = 0; i < sizeof (tests) / sizeof (tests[0]); ++i)
     {
@@ -109,14 +103,14 @@
 	{
 	  char buf[500];
 	  regerror (n, &re, buf, sizeof (buf));
-	  printf ("%s: regcomp %lu failed: %s\n", tests[i].pattern, i, buf);
+	  printf ("%s: regcomp %zd failed: %s\n", tests[i].pattern, i, buf);
 	  ret = 1;
 	  continue;
 	}
 
       if (regexec (&re, tests[i].string, tests[i].nmatch, rm, 0))
 	{
-	  printf ("%s: regexec %lu failed\n", tests[i].pattern, i);
+	  printf ("%s: regexec %zd failed\n", tests[i].pattern, i);
 	  ret = 1;
 	  regfree (&re);
 	  continue;
@@ -128,7 +122,7 @@
 	  {
 	    if (tests[i].rm[n].rm_so == -1 && tests[i].rm[n].rm_eo == -1)
 	      break;
-	    printf ("%s: regexec %lu match failure rm[%d] %d..%d\n",
+	    printf ("%s: regexec %zd match failure rm[%d] %d..%d\n",
 		    tests[i].pattern, i, n, rm[n].rm_so, rm[n].rm_eo);
 	    ret = 1;
 	    break;
--- 4.1.4/testsuite/bug-regex12.c
+++ 4.0.9/testsuite/bug-regex12.c
@@ -18,12 +18,8 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -49,9 +45,7 @@
   size_t i;
   int n, ret = 0;
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   for (i = 0; i < sizeof (tests) / sizeof (tests[0]); ++i)
     {
@@ -60,7 +54,7 @@
 	{
 	  char buf[500];
 	  regerror (n, &re, buf, sizeof (buf));
-	  printf ("regcomp %lu failed: %s\n", i, buf);
+	  printf ("regcomp %zd failed: %s\n", i, buf);
 	  ret = 1;
 	  continue;
 	}
@@ -68,7 +62,7 @@
       if (! regexec (&re, tests[i].string, tests[i].nmatch,
 		     tests[i].nmatch ? rm : NULL, 0))
 	{
-	  printf ("regexec %lu incorrectly matched\n", i);
+	  printf ("regexec %zd incorrectly matched\n", i);
 	  ret = 1;
 	}
 
--- 4.1.4/testsuite/bug-regex13.c
+++ 4.0.9/testsuite/bug-regex13.c
@@ -18,12 +18,8 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -75,9 +71,7 @@
   size_t i;
   int ret = 0;
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   for (i = 0; i < sizeof (tests) / sizeof (tests[0]); ++i)
     {
--- 4.1.4/testsuite/bug-regex14.c
+++ 4.0.9/testsuite/bug-regex14.c
@@ -18,13 +18,9 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #define _REGEX_RE_COMP
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -36,9 +32,7 @@
   size_t i;
   int ret = 0;
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   for (i = 0; i < 100; ++i)
     {
--- 4.1.4/testsuite/bug-regex15.c
+++ 4.0.9/testsuite/bug-regex15.c
@@ -1,8 +1,8 @@
 /* Test for memory/CPU leak in regcomp.  */
 
-#include <sys/types.h>
-#include <sys/time.h>
+#include <error.h>
 #include <sys/resource.h>
+#include <sys/types.h>
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
--- 4.1.4/testsuite/bug-regex21.c
+++ 4.0.9/testsuite/bug-regex21.c
@@ -18,11 +18,7 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 
@@ -32,9 +28,7 @@
   int i;
   int ret = 0;
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   for (i = 0; i < 32; ++i)
     {
--- 4.1.4/testsuite/bug-regex9.c
+++ 4.0.9/testsuite/bug-regex9.c
@@ -18,12 +18,8 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -38,9 +34,7 @@
   regmatch_t rm[2];
   int n;
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   n = regcomp (&re, "^#! */.*/(k|ba||pdk|z)sh", REG_EXTENDED);
   if (n != 0)
--- 4.1.4/testsuite/insens.sed
+++ 4.0.9/testsuite/insens.sed
@@ -1,4 +1,6 @@
+# Frank Kuester reported that this does not work but I
+# could never reproduce it (Debian bug #224037)
 h
 s/Version: *//p
 g
-s/version: *//Ip
+s/Version: *//Ip
--- 4.1.4/testsuite/Makefile.am
+++ 4.0.9/testsuite/Makefile.am
@@ -10,18 +10,18 @@
 if TEST_REGEX
 check_PROGRAMS = bug-regex7 \
                  bug-regex8 bug-regex9 bug-regex10 bug-regex11 bug-regex12 \
-                 bug-regex13 bug-regex14 bug-regex15 bug-regex16 bug-regex21 \
-                 tst-pcre tst-boost runtests runptests tst-rxspencer tst-regex2
+                 bug-regex13 bug-regex14 bug-regex15 bug-regex16 \
+                 bug-regex21 tst-pcre tst-boost runtests runptests tst-rxspencer
 
 SEDTESTS += space
 endif
 
 SEDTESTS += \
-        enable sep inclib 8bit newjis xabcx dollar noeol noeolw \
-  	numsub numsub2 numsub3 numsub4 numsub5 0range bkslashes \
-  	head madding mac-mf empty xbxcx xbxcx3 recall recall2 xemacs \
-  	fasts uniq manis khadafy linecnt eval distrib 8to7 \
-	allsub cv-vars classes middle bsd stdin flipcase \
+	enable sep inclib 8bit newjis xabcx dollar noeol \
+	numsub numsub2 numsub3 numsub4 numsub5 0range bkslashes \
+	head madding mac-mf empty xbxcx xbxcx3 recall xemacs \
+	fasts uniq manis khadafy linecnt eval distrib 8to7 \
+	allsub cv-vars classes middle spencer stdin flipcase \
 	insens subwrite writeout readin \
 	help version file quiet \
 	factor binary3 binary2 binary dc
@@ -29,15 +29,14 @@
 TESTS_ENVIRONMENT = MAKE="$(MAKE)" VERSION="$(VERSION)" $(srcdir)/runtest
 
 EXTRA_DIST = \
-	PCRE.tests BOOST.tests SPENCER.tests \
+        PCRE.tests BOOST.tests SPENCER.tests \
 	runtest Makefile.tests \
-	0range.good 0range.inp 0range.sed \
+        0range.good 0range.inp 0range.sed \
 	8bit.good 8bit.inp 8bit.sed \
 	8to7.good 8to7.inp 8to7.sed \
 	allsub.good allsub.inp allsub.sed \
 	binary.good binary.inp binary.sed binary2.sed binary3.sed \
 	bkslashes.good bkslashes.inp bkslashes.sed \
-	bsd.good bsd.sh \
 	cv-vars.good cv-vars.inp cv-vars.sed \
 	classes.good classes.inp classes.sed \
 	dc.good dc.inp dc.sed \
@@ -61,7 +60,6 @@
 	middle.good middle.sed middle.inp \
 	newjis.good newjis.inp  newjis.sed \
 	noeol.good noeol.inp noeol.sed \
-	noeolw.good noeolw.1good noeolw.2good noeolw.sed \
 	numsub.good numsub.inp numsub.sed \
 	numsub2.good numsub2.inp numsub2.sed \
 	numsub3.good numsub3.inp numsub3.sed \
@@ -69,8 +67,8 @@
 	numsub5.good numsub5.inp numsub5.sed \
 	readin.good readin.in2 readin.inp readin.sed \
 	recall.good recall.inp recall.sed \
-	recall2.good recall2.inp recall2.sed \
 	sep.good sep.inp sep.sed \
+	spencer.inp spencer.sh \
 	subwrite.inp subwrite.sed  subwrt1.good subwrt2.good \
 	uniq.good uniq.inp uniq.sed \
 	version.gin \
--- 4.1.4/testsuite/Makefile.tests
+++ 4.0.9/testsuite/Makefile.tests
@@ -4,82 +4,73 @@
 
 # These are only fallback values. They are usually overridden by runtest.
 srcdir = .
-SED = ../sed/sed
-SEDENV = LC_ALL=C $(TIME)
+SED = LC_ALL=C ../sed/sed
 
 #TIME=time
 CMP=cmp
 RM=rm -f
 
 enable sep inclib 8bit 8to7 newjis xabcx dollar noeol bkslashes \
-numsub head madding mac-mf empty xbxcx xbxcx3 recall recall2 xemacs \
+numsub head madding mac-mf empty xbxcx xbxcx3 recall xemacs \
 fasts uniq manis linecnt khadafy allsub flipcase space::
-	$(SEDENV) $(SED) -f $(srcdir)/$@.sed \
+	$(TIME) $(SED) -f $(srcdir)/$@.sed \
 		< $(srcdir)/$@.inp > $@.out 
 	$(CMP) $(srcdir)/$@.good $@.out 
 	@$(RM) $@.out 
 
 0range::
-	$(SEDENV) $(SED) -s -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.out 
+	$(TIME) $(SED) -s -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.out 
 	$(CMP) $(srcdir)/$@.good $@.out 
 	@$(RM) $@.out 
 
 # This checks for a bug in 3.02 and 3.02.80
 stdin::
-	($(SEDENV) $(SED) d; $(SEDENV) $(SED) G) < $(srcdir)/numsub.inp > $@.1out 
-	$(SEDENV) cat $(srcdir)/numsub.inp | ($(SEDENV) $(SED) d; $(SEDENV) $(SED) G) > $@.2out 
+	$(TIME) ($(SED) d; $(SED) G) < $(srcdir)/numsub.inp > $@.1out 
+	$(TIME) cat $(srcdir)/numsub.inp | ($(SED) d; $(SED) G) > $@.2out 
 	$(CMP) $@.1out $@.2out 
 	@$(RM) $@.1out $@.2out 
 
 cv-vars classes middle dc distrib factor numsub2 numsub3 numsub4 numsub5 \
 insens::
-	$(SEDENV) $(SED) -n -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.out 
+	$(TIME) $(SED) -n -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.out 
 	$(CMP) $(srcdir)/$@.good $@.out 
 	@$(RM) $@.out 
 
-noeolw::
-	$(SEDENV) $(SED) -n -f $(srcdir)/$@.sed \
-	  $(srcdir)/noeol.inp $(srcdir)/noeol.inp > $@.out 
-	$(CMP) $(srcdir)/$@.good $@.out 
-	$(CMP) $(srcdir)/$@.1good $@.1out
-	$(CMP) $(srcdir)/$@.2good $@.2out
-	@$(RM) $@.1out $@.2out $@.out
-
 subwrite::
-	$(SEDENV) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.1out 
+	$(TIME) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.1out 
 	$(CMP) $(srcdir)/subwrt1.good $@.1out 
 	$(CMP) $(srcdir)/subwrt2.good $@.wout
 	@$(RM) $@.1out $@.wout
 
-bsd::
-	$(SEDENV) sh $(srcdir)/$@.sh '$(SED)' bsd.out
-	$(CMP) $(srcdir)/$@.good $@.out 
-	@$(RM) $@.out 
+spencer::
+	sh $(srcdir)/$@.sh '$(SED)' < $(srcdir)/$@.inp \
+		| $(TIME) sh | grep failed; \
+	test $$? = 1
 
 writeout::
-	$(SEDENV) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp >$@.1out 
+	$(TIME) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp >$@.1out 
 	$(CMP) $(srcdir)/wrtout1.good $@.1out 
 	$(CMP) $(srcdir)/wrtout2.good $@.wout
 	@$(RM) $@.1out $@.wout
 
 readin.in2: $(srcdir)/readin.in2
-	cat $(srcdir)/readin.in2 > $@
+	cat $< > $@
 
 readin:: readin.in2
-	$(SEDENV) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp >$@.out 
+	$(TIME) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp >$@.out 
 	$(CMP) $(srcdir)/$@.good $@.out 
 	@$(RM) $@.out 
 
 eval.in2: $(srcdir)/eval.inp
-	cat $(srcdir)/eval.inp > $@
+	cat $< > $@
 
 eval:: eval.in2
-	$(SEDENV) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.out 
+	$(TIME) $(SED) -f $(srcdir)/$@.sed < $(srcdir)/$@.inp > $@.out 
 	$(CMP) $(srcdir)/$@.good $@.out 
 	@$(RM) $@.out 
 
 binary binary2 binary3::
-	$(SEDENV) $(SED) -n -f $(srcdir)/$@.sed < $(srcdir)/binary.inp >$@.out 
+	$(TIME) $(SED) -n -f $(srcdir)/$@.sed < $(srcdir)/binary.inp >$@.out 
 	$(CMP) $(srcdir)/binary.good $@.out 
 	@$(RM) $@.out 
 
@@ -89,24 +80,28 @@
 
 help::
 	$(SED) --help | $(SED) '1s/ [^ ]* / sed /' > $@.1out 
-	$(SED) 2>&1 | $(SED) '1s/ [^ ]* / sed /' > $@.2out || :
+	$(SED) -h | $(SED) '1s/ [^ ]* / sed /' > $@.2out 
+	$(SED) 2>&1 | $(SED) '1s/ [^ ]* / sed /' > $@.3out || :
 	$(CMP) $@.1out $@.2out 
-	@$(RM) $@.1out $@.2out
+	$(CMP) $@.2out $@.3out 
+	@$(RM) $@.1out $@.2out $@.3out 
 
 version::
-	$(SED) 's^@'VERSION'@^$(VERSION)^' $(srcdir)/version.gin > $@.good 
-	$(SEDENV) $(SED) --version > $@.out 2>&1
-	$(CMP) $@.good $@.out 
-	@$(RM) $@.good $@.out
+	sed 's^@'VERSION'@^$(VERSION)^' $(srcdir)/version.gin > $@.out 
+	$(SED) --version  > $@.1out 2>&1
+	$(SED) -V > $@.2out 2>&1
+	$(CMP) $@.out $@.1out 
+	$(CMP) $@.out $@.2out 
+	@$(RM) $@.out $@.1out $@.2out 
 
 file::
-	$(SEDENV) $(SED) --file=$(srcdir)/newjis.sed \
+	$(TIME) $(SED) --file=$(srcdir)/newjis.sed \
 		< $(srcdir)/newjis.inp > $@.out 
 	$(CMP) $(srcdir)/newjis.good $@.out 
 	@$(RM) $@.out 
 
 quiet::
-	$(SEDENV) $(SED) --quiet -f $(srcdir)/cv-vars.sed \
+	$(TIME) $(SED) --quiet -f $(srcdir)/cv-vars.sed \
 		< $(srcdir)/cv-vars.inp > $@.out 
 	$(CMP) $(srcdir)/cv-vars.good $@.out 
 	@$(RM) $@.out 
@@ -116,36 +111,33 @@
 bug-regex7$(EXEEXT) bug-regex8$(EXEEXT) bug-regex9$(EXEEXT) \
 bug-regex10$(EXEEXT) bug-regex11$(EXEEXT) bug-regex12$(EXEEXT) \
 bug-regex13$(EXEEXT) bug-regex14$(EXEEXT) bug-regex15$(EXEEXT) bug-regex16$(EXEEXT) \
-bug-regex21$(EXEEXT) runtests$(EXEEXT) runptests$(EXEEXT)::
-	echo "$(SEDENV) ./$@ > `echo $@ | $(SED) s/$(EXEEXT)$$/.log/`"
-	@$(SEDENV) ./$@ > `echo $@ | $(SED) s/$(EXEEXT)$$/.log/`
-
-tst-pcre$(EXEEXT)::
-	$(SEDENV) ./tst-pcre $(srcdir)/PCRE.tests > tst-pcre.log
+bug-regex21$(EXEEXT) runtests$(EXEEXT) runptests$(EXEEXT):
+	echo "./$@ > `echo $@ | sed s/$(EXEEXT)$$/.log/`"
+	@./$@ > `echo $@ | sed s/$(EXEEXT)$$/.log/`
 
-tst-boost$(EXEEXT)::
-	$(SEDENV) ./tst-boost $(srcdir)/BOOST.tests > tst-boost.log
+tst-pcre$(EXEEXT):
+	./tst-pcre $(srcdir)/PCRE.tests > tst-pcre.log
 
-tst-rxspencer$(EXEEXT)::
-	$(SEDENV) ./tst-rxspencer $(srcdir)/SPENCER.tests > tst-spencer.log
+tst-boost$(EXEEXT):
+	./tst-boost $(srcdir)/BOOST.tests > tst-boost.log
 
-tst-regex2$(EXEEXT)::
-	$(SEDENV) ./tst-regex2 $(srcdir)/tst-regex2.c > tst-regex2.log
+tst-rxspencer$(EXEEXT):
+	./tst-rxspencer $(srcdir)/SPENCER.tests > tst-spencer.log
 
 # The following target is not used in GNU sed builds (only super-sed)
 
 pcretest$(EXEEXT)::
-	$(SEDENV) ./pcretest $(srcdir)/pcre1.inp pcre1.out
+	$(TIME) ./pcretest $(srcdir)/pcre1.inp pcre1.out
 	$(CMP) $(srcdir)/pcre1.good pcre1.out
-	#$(SEDENV) ./pcretest -p $(srcdir)/pcre1.inp pcre1p.out
+	#$(TIME) ./pcretest -p $(srcdir)/pcre1.inp pcre1p.out
 	#$(CMP) $(srcdir)/pcre1p.good pcre1p.out
-	$(SEDENV) ./pcretest -P $(srcdir)/pcre2.inp pcre2.out
+	$(TIME) ./pcretest -P $(srcdir)/pcre2.inp pcre2.out
 	$(CMP) $(srcdir)/pcre2.good pcre2.out
-	$(SEDENV) ./pcretest -P -p $(srcdir)/pcre2.inp pcre2p.out
+	$(TIME) ./pcretest -P -p $(srcdir)/pcre2.inp pcre2p.out
 	$(CMP) $(srcdir)/pcre2p.good pcre2p.out
-	$(SEDENV) ./pcretest $(srcdir)/pcre3.inp pcre3.out
+	$(TIME) ./pcretest $(srcdir)/pcre3.inp pcre3.out
 	$(CMP) $(srcdir)/pcre3.good pcre3.out
-	$(SEDENV) ./pcretest -p $(srcdir)/pcre3.inp pcre3p.out
+	$(TIME) ./pcretest -p $(srcdir)/pcre3.inp pcre3p.out
 	$(CMP) $(srcdir)/pcre3p.good pcre3p.out
 	@$(RM) pcre*.out
 
@@ -153,5 +145,5 @@
 bug-regex7$(EXEEXT) bug-regex8$(EXEEXT) bug-regex9$(EXEEXT) \
 bug-regex10$(EXEEXT) bug-regex11$(EXEEXT) bug-regex12$(EXEEXT) \
 bug-regex13$(EXEEXT) bug-regex14$(EXEEXT) bug-regex15$(EXEEXT) bug-regex16$(EXEEXT) \
-bug-regex21$(EXEEXT) runtests$(EXEEXT) runptests$(EXEEXT) tst-regex2$(EXEEXT) \
+bug-regex21$(EXEEXT) runtests$(EXEEXT) runptests$(EXEEXT) \
 tst-pcre$(EXEEXT) tst-boost$(EXEEXT) tst-rxspencer$(EXEEXT) pcretest$(EXEEXT)
--- 4.1.4/testsuite/PCRE.tests
+++ 4.0.9/testsuite/PCRE.tests
@@ -2365,22 +2365,3 @@
  0: bc123bc
  1: bc
  2: bc
-
-/^a{2,5}$/
-    aa
- 0: aa
-    aaa
- 0: aaa
-    aaaa
- 0: aaaa
-    aaaaa
- 0: aaaaa
-    *** Failers
-No match
-    a
-No match
-    b
-No match
-    aaaaab
-No match
-    aaaaaa
--- 4.1.4/testsuite/runtest
+++ 4.0.9/testsuite/runtest
@@ -2,7 +2,7 @@
 
 : ${MAKE=make}
 : ${srcdir=.}
-: ${SED="../sed/sed"}
+: ${SED="LC_ALL=C ../sed/sed"}
 
 makefile="$srcdir/Makefile.tests"
 test=`echo "$@"| sed 's,.*/,,'`
@@ -15,4 +15,4 @@
   cat tmp.test
   rm -f tmp.test
   exit $exitcode
-fi
+fi
\ No newline at end of file
--- 4.1.4/testsuite/SPENCER.tests
+++ 4.0.9/testsuite/SPENCER.tests
@@ -1,3 +1,24 @@
+# Copyright 1992, 1993, 1994, 1997 Henry Spencer.  All rights reserved.
+# This software is not subject to any license of the American Telephone
+# and Telegraph Company or of the Regents of the University of California.
+#
+# Permission is granted to anyone to use this software for any purpose on
+# any computer system, and to alter it and redistribute it, subject
+# to the following restrictions:
+#
+# 1. The author is not responsible for the consequences of use of this
+#    software, no matter how awful, even if they arise from flaws in it.
+#
+# 2. The origin of this software must not be misrepresented, either by
+#    explicit claim or by omission.  Since few users ever read sources,
+#    credits must appear in the documentation.
+#
+# 3. Altered versions must be plainly marked as such, and must not be
+#    misrepresented as being the original software.  Since few users
+#    ever read sources, credits must appear in the documentation.
+#
+# 4. This notice may not be removed or altered.
+#
 # regular expression test set
 # Lines are at least three fields, separated by one or more tabs.  "" stands
 # for an empty field.  First field is an RE.  Second field is flags.  If
@@ -505,33 +526,3 @@
 a?b	-	ab	ab
 -\{0,1\}[0-9]*$	b	-5	-5
 a*a*a*a*a*a*a*	&	aaaaaa	aaaaaa
-(\b){0}	-	x	@x	-
-\(\b\)\{0,0\}	b	abc	@abc	-
-a(\b){0}c	-	ac	ac	-
-a(.*)b(\1){0}c	-	abc	abc	@bc,-
-a(.*)b(\1){0}c	-	axbc	axbc	x,-
-
-a\(\(b*\)\)c\1d	b	abbcbbd	abbcbbd	bb,bb
-a\(\([bc]\)\)\2d	b	abcdabbd	abbd	b,b
-a\(\(\(\([bc]\)\)\3\)\)*d	b	abbccd	abbccd	cc,cc,c,c
-a(b)(c)d	-	abcd	abcd	b,c
-a(((b)))c	-	abc	abc	b,b,b
-a(((b|(((c))))))d	-	abd	abd	b,b,b,-,-,-
-a(((b*|c|e)))d	-	abbd	abbd	bb,bb,bb
-a((b|c)){0,0}d	-	ad	ad	-,-
-a((b|c)){0,1}d	-	abd	abd	b,b
-a((b|c)){0,2}d	-	abcd	abcd	c,c
-a((b+|((c)*)))+d	-	abd	abd	b,b,-,-
-a((b+|((c)*)))+d	-	abcd	abcd	c,c,c,c
-(((\b))){0}	-	x	@x	-,-,-
-a(((.*)))b((\2)){0}c	-	abc	abc	@bc,@bc,@bc,-,-
-a(((.*)))b((\1)){0}c	-	axbc	axbc	x,x,x,-,-
-
-\b	&	SaT	@aT
-\b	&	aT	@aT
-a.*\b	&	abT	ab
-\b	&	STSS
-\B	&	abc	@bc
-\B	&	aSbTc
-\B	&	SaT	@SaT
-\B	&	aSTSb	@TSb
--- 4.1.4/testsuite/tst-boost.c
+++ 4.0.9/testsuite/tst-boost.c
@@ -18,12 +18,8 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -86,9 +82,7 @@
   regex_t re;
   regmatch_t rm[20];
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   if (argc < 2)
     {
--- 4.1.4/testsuite/tst-pcre.c
+++ 4.0.9/testsuite/tst-pcre.c
@@ -18,12 +18,8 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -44,9 +40,7 @@
   int pattern_valid = 0, rm_valid = 0;
   size_t linenum;
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   if (argc < 2)
     {
@@ -103,7 +97,7 @@
 	  rm_valid = 0;
 	  if (p == NULL)
 	    {
-	      printf ("%lu: Invalid pattern line: %s\n", linenum, line);
+	      printf ("%zd: Invalid pattern line: %s\n", linenum, line);
 	      ret = 1;
 	      continue;
 	    }
@@ -112,7 +106,7 @@
 	    ignorecase = 1;
 	  else if (p[1] != '\0')
 	    {
-	      printf ("%lu: Invalid pattern line: %s\n", linenum, line);
+	      printf ("%zd: Invalid pattern line: %s\n", linenum, line);
 	      ret = 1;
 	      continue;
 	    }
@@ -122,7 +116,7 @@
 	      pattern = realloc (pattern, p - line);
 	      if (pattern == NULL)
 		{
-		  printf ("%lu: Cannot record pattern: %m\n", linenum);
+		  printf ("%zd: Cannot record pattern: %m\n", linenum);
 		  ret = 1;
 		  break;
 		}
@@ -142,7 +136,7 @@
     
 	  if (!pattern_valid)
 	    {
-	      printf ("%lu: No previous valid pattern %s\n", linenum, line);
+	      printf ("%zd: No previous valid pattern %s\n", linenum, line);
 	      continue;
 	    }
 
@@ -151,7 +145,7 @@
 	      string = realloc (string, len - 3);
 	      if (string == NULL)
 		{
-		  printf ("%lu: Cannot record search string: %m\n", linenum);
+		  printf ("%zd: Cannot record search string: %m\n", linenum);
 		  ret = 1;
 		  break;
 		}
@@ -166,7 +160,7 @@
 	    {
 	      char buf[500];
 	      regerror (n, &re, buf, sizeof (buf));
-	      printf ("%lu: regcomp failed for %s: %s\n",
+	      printf ("%zd: regcomp failed for %s: %s\n",
 		      linenum, pattern, buf);
 	      ret = 1;
 	      continue;
@@ -185,7 +179,7 @@
 
       if (!rm_valid)
 	{
-	  printf ("%lu: No preceeding pattern or search string\n", linenum);
+	  printf ("%zd: No preceeding pattern or search string\n", linenum);
 	  ret = 1;
 	  continue;
 	}
@@ -194,7 +188,7 @@
 	{
 	  if (rm[0].rm_so != -1 || rm[0].rm_eo != -1)
 	    {
-	      printf ("%lu: /%s/ on %s unexpectedly matched %d..%d\n",
+	      printf ("%zd: /%s/ on %s unexpectedly matched %d..%d\n",
 		      linenum, pattern, string, rm[0].rm_so, rm[0].rm_eo);
 	      ret = 1;
 	    }
@@ -209,7 +203,7 @@
       num = strtoul (p, &p, 10);
       if (num >= 20 || *p != ':' || p[1] != ' ')
 	{
-	  printf ("%lu: Invalid line %s\n", linenum, line);
+	  printf ("%zd: Invalid line %s\n", linenum, line);
 	  ret = 1;
 	  continue;
 	}
@@ -218,7 +212,7 @@
 	{
 	  if (strcmp (p + 2, "<unset>") != 0)
 	    {
-	      printf ("%lu: /%s/ on %s unexpectedly failed to match register %ld %d..%d\n",
+	      printf ("%zd: /%s/ on %s unexpectedly failed to match register %ld %d..%d\n",
 		      linenum, pattern, string, num,
 		      rm[num].rm_so, rm[num].rm_eo);
 	      ret = 1;
@@ -231,7 +225,7 @@
 	  || strncmp (p + 2, string + rm[num].rm_so,
 		      rm[num].rm_eo - rm[num].rm_so) != 0)
 	{
-	  printf ("%lu: /%s/ on %s unexpectedly failed to match %s for register %ld %d..%d\n",
+	  printf ("%zd: /%s/ on %s unexpectedly failed to match %s for register %ld %d..%d\n",
 		  linenum, pattern, string, p + 2, num,
 		  rm[num].rm_so, rm[num].rm_eo);
 	  ret = 1;
--- 4.1.4/testsuite/tst-rxspencer.c
+++ 4.0.9/testsuite/tst-rxspencer.c
@@ -18,12 +18,8 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include "config.h"
-
 #include <sys/types.h>
-#ifdef HAVE_MCHECK_H
 #include <mcheck.h>
-#endif
 #include <regex.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -218,7 +214,6 @@
   n = regcomp (&re, pattern, cflags);
   if (n != 0)
     {
-      char buf[500];
       if (eflags == -1)
 	{
 	  static struct { reg_errcode_t code; const char *name; } codes []
@@ -245,6 +240,7 @@
 	  return 1;
 	}
 
+      char buf[500];
       regerror (n, &re, buf, sizeof (buf));
       printf ("%s regcomp failed: %s\n", fail, buf);
       return 1;
@@ -413,9 +409,7 @@
       {NULL,	0,		NULL,		0 }
     };
 
-#ifdef HAVE_MCHECK_H
   mtrace ();
-#endif
 
   while (getopt_long (argc, argv, "", options, NULL) >= 0);
 
--- 4.1.4/po/ca.po
+++ 4.0.9/po/ca.po
@@ -1,13 +1,13 @@
 # Catalan translation of sed.
-# Copyright  2002, 2003, 2004 Free Software Foundation, Inc.
+# Copyright  2002, 2003 Free Software Foundation, Inc.
 # This file is distributed under the same license as the sed package.
-# Jordi Mallach <jordi@gnu.org>, 2002, 2003, 2004.
+# Jordi Mallach <jordi@gnu.org>, 2002, 2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.1.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-07-10 05:51+0200\n"
+"Project-Id-Version: sed 4.0.8\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-10-24 19:18+0200\n"
 "Last-Translator: Jordi Mallach <jordi@gnu.org>\n"
 "Language-Team: Catalan <ca@dodds.net>\n"
 "MIME-Version: 1.0\n"
@@ -16,168 +16,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=n!=1;\n"
 
-#: sed/compile.c:162
-msgid "multiple `!'s"
-msgstr "mltiples !"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
+msgstr "Mltiples !"
 
-#: sed/compile.c:163
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr ", inesperada"
 
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
-msgstr "no es pot utilitzar +N o ~N com a primera adrea"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
+msgstr "No es pot utilitzar +N o ~N com a primera adrea"
 
-#: sed/compile.c:165
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "{ no emparellat"
 
-#: sed/compile.c:166
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "} inesperat"
 
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "hi ha carcters extra desprs de l'ordre"
-
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
-msgstr "s'espera \\ desprs de a, c i i"
+#: sed/compile.c:177
+msgid "Extra characters after command"
+msgstr "Carcters extra desprs de l'ordre"
+
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr "S'espera \\ desprs de a, c i i"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "} no accepta cap adrea"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": no accepta cap adrea"
 
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "els comentaris no accepten cap adrea"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "Els comentaris no accepten cap adrea"
 
-#: sed/compile.c:172
-msgid "missing command"
-msgstr "cal una ordre"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Fa falta una ordre"
 
-#: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "l'ordre utilitza noms una adrea"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "L'ordre utilitza noms una adrea"
 
-#: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "l'expressi regular d'adrea no est terminada"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "L'expressi regular d'addrea no est terminada"
 
-#: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "ordre s no terminada"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "Ordre s no terminada"
 
-#: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "ordre y no terminada"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "Ordre y no terminada"
 
-#: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "opci desconeguda per a s"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "Opci desconeguda per a s"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "mltiples opcions p per a l'ordre s"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "mltiples opcions g per a l'ordre s"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "mltiples opcions numriques per a l'ordre s"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "l'opci numrica per a l'ordre s no pot ser zero"
 
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
-msgstr "les cadenes per a l'ordre y sn de longituds diferents"
-
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "el carcter delimitador no s un carcter d'un byte"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "les cadenes per a l'ordre y sn de longituds diferents"
 
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "s'esperava una versi ms nova de sed"
 
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "s de l'adrea de lnia 0 invlid"
-
-#: sed/compile.c:186
+#: sed/compile.c:236
 #, c-format
-msgid "unknown command: `%c'"
-msgstr "ordre desconeguda: %c"
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "S'ha cridat a savchar() amb una espenta inesperada (%x)"
+
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr "Ordre desconeguda:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fitxer %s lnia %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e expressi #%lu, carcter %lu: %s\n"
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "no es troba l'etiqueta per al salt a %s"
+msgid "Can't find label for jump to `%s'"
+msgstr "No es troba l'etiqueta per al bot a %s"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: no es pot llegir %s: %s\n"
 
-#: sed/execute.c:672
-#, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "no s'ha pogut editar %s: s un terminal"
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "no s'ha pogut editar %s: no s un fitxer regular"
+msgid "Couldn't open temporary file %s: %s"
+msgstr "No s'ha pogut obrir el fitxer temporal %s: %s"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "no s'ha pogut obrir el fitxer temporal %s: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "ERROR INTERN: tipus d'adrea errnia"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
-msgstr "s'ha produt un error en el subprocs"
+msgstr "error en subprocs"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "l'opci e no est suportada"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "l'ordre e no est suportada"
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "no hi ha una expressi regular prvia"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "ERROR INTERN: Ordre errnia %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "No hi ha una expressi regular prvia"
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
-msgstr "no es poden especificar modificadors en expregs buides"
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "No es poden especificar modificadors en expregs buides"
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "referncia \\%d no vlida en el costat dret de l'ordre s"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "Referncia \\%d no vlida en el costat dret de l'ordre s"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -186,121 +181,34 @@
 "                 usa la sintaxi d'expressions regulars de Perl 5 en aquesta\n"
 "                 sequncia.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-"Forma d's: %s [OPCI]... {script-noms-si-no-hi-ha-altres-scripts}\n"
-"               [fitxer-entrada]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                 suprimeix la impressi automtica de l'espai de patrons\n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e script, --expression=script\n"
-"                 afegeix el script a les ordres a executar\n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f fitxer-script, --file=fitxer-script\n"
-"                 afegeix els continguts de fitxer-script a les ordres a "
-"executar\n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[SUFIX], --in-place[=SUFIX]\n"
-"                 edita els mateixos fitxers (fa cpia de seguretat si es\n"
-"                 proveeix una extensi)\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                 especifica la longitud desitjada per a l'ajust de final de\n"
-"                 lnia per a l'ordre l\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"  --posix\n"
-"                 inhabilita totes les extensions GNU.\n"
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                 usa expressions regulars exteses en el script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                 considera els fitxers com independents, en compte d'un\n"
-"                 llarg flux continu.\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                 carrega una quantitat mnima de dades dels fitxers "
-"d'entrada\n"
-"                 i buida els bfers d'eixida ms sovint\n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help     mostra aquest missatge d'ajuda i surt\n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr "      --version  mostra la informaci de la versi i surt\n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -308,16 +216,41 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"s: %s [OPCI]... {script-noms-si-no-hi-ha-altres-scripts} [fitxer-"
+"entrada]...\n"
+"  -n, --quiet, --silent\n"
+"                 suprimeix la impressi automtica de l'espai de patrons\n"
+"  -e script, --expression=script\n"
+"                 afegeix el script a les ordres a executar\n"
+"  -f fitxer-script, --file=fitxer-script\n"
+"                 afegeix els continguts de fitxer-script a les ordres a "
+"executar\n"
+"  -i[sufix], --in-place[=sufix]\n"
+"                 edita els mateixos fitxers (fa cpia de seguretat si es\n"
+"                 proveeix una extensi)\n"
+"  -l N, --line-length=N\n"
+"                 especifica la longitud desitjada per a l'ajust de final de\n"
+"                 lnia per a l'ordre l\n"
+"  -r, --regexp-extended\n"
+"                 usa expressions regulars exteses en el script.\n"
+"%s  -s, --separate\n"
+"                 considera els fitxers com independents, en compte d'un "
+"llarg\n"
+"                 flux continu.\n"
+"  -u, --unbuffered\n"
+"\n"
+"      --help     mostra aquest missatge d'ajuda i surt\n"
+"  -V, --version  mostra la informaci de la versi i surt\n"
 "\n"
 "Si no es donen cap de les opcions -e, --expression, -f o --file, el primer\n"
 "argument no-opci es pren com el script sed a interpretar. Tots els "
 "arguments\n"
 "restants sn noms de fitxers d'entrada; si no s'especifiquen fitxers "
 "d'entrada,\n"
-"es llegeix l'entrada estndard.\n"
+"es llig l'entrada estndard.\n"
 "\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -327,26 +260,25 @@
 "Assegureu-vos d'incloure la paraula %s en alguna part del camp "
 "Assumpte:.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versi %s\n"
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"basat en GNU sed versi %s\n"
+"basat en GNU sed versi 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versi %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -359,101 +291,102 @@
 "de cpia.  No hi ha CAP garantia; ni tan sols de COMERCIABILITAT o\n"
 "ADEQUACI A UN PROPSIT PARTICULAR, fins on ho permeta la llei.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, c-format
-msgid "cannot remove %s: %s"
-msgstr "no es pot eliminar %s: %s"
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, c-format
-msgid "couldn't open file %s: %s"
-msgstr "no s'ha pogut obrir el fitxer %s: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "No s'ha pogut obrir el fitxer %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "no s'ha pogut escriure %d element a %s: %s"
 msgstr[1] "no s'han pogut escriure %d elements a %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "error de lectura en %s: %s"
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "no es pot reanomenar %s: %s"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "xit"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Sense parella"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Expressi regular no vlida"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "El carcter de comparaci no s vlid"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
-msgstr "Nom de classe de carcter no vlid"
+msgstr "Nom de clase de carcter no vlid"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Barra invertida al final"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "La referncia cap enrere no s vlida"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[ o [^ no emparellat"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "( o \\( no emparellat"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ no emparellat"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "El contingut de \\{\\} no s vlid"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "El rang final no s vlid"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Memria exhaurida"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "L'expressi regular precedent no vlida"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Fi prematur de l'expressi regular"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "L'expressi regular s massa gran"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ") o \\) no emparellat"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "No hi ha una expressi regular prvia"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "s del modificador d'adrea invlid"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Final-de-fitxer inesperat"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "expressi regular incorrecta: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "error al llegir l'entrada: %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "no s'ha pogut escriure un element a %s: %s"
--- 4.1.4/po/cs.po
+++ 4.0.9/po/cs.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 3.02.80\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2001-08-05 19:52+02:00\n"
 "Last-Translator: Vladimir Michl <Vladimir.Michl@seznam.cz>\n"
 "Language-Team: Czech <cs@li.org>\n"
@@ -14,276 +14,196 @@
 "Content-Transfer-Encoding: 8bit\n"
 "Report-Msgid-Bugs-To: \n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Vcensobn `!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Neoekvn `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "+N nebo ~N nelze pout jako prvn adresu"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Neodpovdajc `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Neoekvan `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Nadbyten znaky po pkazu"
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr ""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' nevyaduje jakoukoliv adresu"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": nechce jakoukoliv adresu"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "V komenti nen ppustn jakkoliv adresa"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Chybjc pkaz"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Pkaz pouv pouze jedinou adresu"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Neukonen adresa regulrnho vrazu"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Neukonen pkaz `s'"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Neukonen pkaz `y'"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Neznm pepna pro `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "vcensobn pouit pepnae `p' s pkazem `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "vcensobn pouit pepnae `g' s pkazem `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "pkaz `s' me mt maximln jednu selnou volbu"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "seln volba pkazu `s' neme bt nula"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "etzce pro pkaz `y' mus bt stejn dlouh"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Chybn pouit adresy modifiktoru"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Volno savchar() s neekanm pushback (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Neznm pkaz:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: soubor %s, dek %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e vraz #%lu, znak %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Nvt pro skok na `%s' nelze najt"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: %s nelze st: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Soubor %s nelze otevt"
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Soubor %s nelze otevt"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Soubor %s nelze otevt"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERN CHYBA: patn typ adresy"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr ""
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr ""
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERN CHYBA: patn pkaz %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr ""
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
 
-#: sed/sed.c:98
-#, c-format
+#: sed/sed.c:100
+#, fuzzy, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -291,8 +211,35 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Pouit: %s [PEPNA]... {skript-pouze-nen-li-jin-skript} [vst.-"
+"soubor]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 potla automatick vypisovn vzorovho loit (pattern\n"
+"                 space)\n"
+"  -e script, --expression=SKRIPT\n"
+"                 pid seznam pkaz z etzce SKRIPT k seznamu pkaz,\n"
+"                 kter maj bt vykonny\n"
+"  -f script-file, --file=SKRIPT-SOUBOR\n"
+"                 pid obsah SKRIPT-SOUBORu k seznamu pkaz, kter maj\n"
+"                 bt vykonny\n"
+"  -l N, --line-length=N\n"
+"                 zadn pozice, na kter m bt dek zalamovn, pro pkaz "
+"`l'\n"
+"  -u, --unbuffered\n"
+"                 nebufferovan vstup\n"
+"      --help     vype tuto npovdu a skon\n"
+"  -V, --version  vype oznaen verze a skon\n"
+"\n"
+"  Nebude-li dn z pepna -e, --expression, -f, nebo --file zadn, pak\n"
+"prvn argument, kter nen pepnaem, bude povaovn za sed skript, kter "
+"m\n"
+"bt interpretovn. Vechny zbyl argumenty pedstavuj jmna vstupnch "
+"soubor.\n"
+"Nebudou-li vstupn soubory zadny, bude ten standardn vstup.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -302,24 +249,23 @@
 "Kamkoliv do poloky ``Subject:'' vlote ``%s''.\n"
 "Pipomnky k pekladu zaslejte na adresu <cs@li.org> (esky).\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -333,105 +279,106 @@
 "ZRUKY,\n"
 "a to i bez zruky PRODEJNOSTI nebo VHODNOSTI PRO NJAK KONKRTN EL.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: %s nelze st: %s\n"
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+msgid "Couldn't open file %s: %s"
 msgstr "Soubor %s nelze otevt"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, fuzzy, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "%d poloek nelze do %s zapsat: %s"
 msgstr[1] "%d poloek nelze do %s zapsat: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "chyba pi ten z %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: %s nelze st: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr ""
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 #, fuzzy
 msgid "Unmatched [ or [^"
 msgstr "Neodpovdajc `{'"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 #, fuzzy
 msgid "Unmatched ( or \\("
 msgstr "Neodpovdajc `{'"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 #, fuzzy
 msgid "Unmatched \\{"
 msgstr "Neodpovdajc `{'"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr ""
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr ""
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr ""
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 #, fuzzy
 msgid "Unmatched ) or \\)"
 msgstr "Neodpovdajc `{'"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr ""
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Chybn pouit adresy modifiktoru"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Neoekvan konec souboru (EOF)"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "patn regulrn vraz: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "chyba pi ten: %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "poloku nelze do %s zapsat: %s"
--- 4.1.4/po/da.po
+++ 4.0.9/po/da.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0.8\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-10-25 08:00+0200\n"
 "Last-Translator: Byrial Ole Jensen <byrial@image.dk>\n"
 "Language-Team: Danish <dansk@klid.dk>\n"
@@ -15,186 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=n != 1;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Flere '!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Uventet ','"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Kan ikke bruge +N eller ~N som frste adresse"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Uparret '{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Uventet '}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Ekstra tegn efter kommando"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Forventede \\ efter 'a', 'c' eller 'i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "'}' vil ikke have adresser"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": vil ikke have adresser"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Kommentarer vil ikke have adresser"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Der mangler en kommando"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Kommandoen bruger kun n adresse"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Uafsluttet regulrt udtryk for adresse"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Uafsluttet 's'-kommando"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Uafsluttet 'y'-kommando"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Ukendt tilvalg til 's'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "Flere 'p'-flag til 's'-kommando"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "Flere 'g'-flag til 's'-kommando"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "Flere tal-flag til 's'-kommando"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "s-kommandoens tal-flag m ikke vre nul"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "y-kommandoens strenge har forskellige lngder"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "forventede en nyere version af sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Forkert brug af adresse-ndrer"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "savchar() kaldt med uventet tilbageskub (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Ukendt kommando:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fil %s, linje %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e udtryk nr. %lu, tegn %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Kan ikke finde etiket for hop til '%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: kan ikke lse %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "kunne ikke bne filen %s: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "kunne ikke bne filen %s: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "kunne ikke bne midlertidig fil %s: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERN FEJL: forkert adressetype"
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "fejl i underproces"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "tilvalg 'e' er ikke understttet"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "'e'-kommando er ikke understttet"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERN FEJL: Forkert vrdi af cmd %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Intet forudgende regulrt udtryk"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Der kan ikke angives ndrere til tomt regulrt udtryk"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Ugyldig reference \\%d p 's'-kommandos hjreside"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -202,96 +179,34 @@
 "  -R, --regexp-perl\n"
 "                 brug Perl 5's syntaks for regulre udtryk i skriptet\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 brug Perl 5's syntaks for regulre udtryk i skriptet\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -299,8 +214,38 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Brug: %s [TILVALG]... {skript-hvis-ingen-andre-skripter} [indfil]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 undg automatisk udskrivning af arbejdsrummet\n"
+"  -e skript, --expression=skript\n"
+"                 udfr kommandoerne i skript\n"
+"  -f skriptfil, --file=skriptfil\n"
+"                 udfr kommandoerne i filen skriptfil\n"
+"  -i[endelse], --in-place[=endelse]\n"
+"                 redigr i filer (laver sikkerhedskopi hvis endelse er "
+"givet)\n"
+"  -l N, --line-length=N\n"
+"                 angiv nsket linjedelingslngde for 'l'-kommandoen\n"
+"  -r, --regexp-extended\n"
+"                 brug udvidede regulre udtryk i skriptet\n"
+"%s  -s, --separate\n"
+"                 betragt filer som adskilte snarede end som n "
+"sammenhngende\n"
+"                 lang strm\n"
+"  -u, --unbuffered\n"
+"                 indls minimale datamngder fra inddatafiler og tm\n"
+"                 oftere uddatabuffere\n"
+"  --help         vis denne hjlp og afslut\n"
+"  -V, --version  udskriv versionsinformation og afslut\n"
+"\n"
+"Hvis der ikke er givet nogen '-e', '--expression', '-f' eller '--file'\n"
+"tilvalg, s opfattes det frste ikke-tilvalgs-argument som et sed-skript.\n"
+"Alle resterende argumenter er navne p inddatafiler; hvis ingen inddata-\n"
+"filer specificeres, lses fra standard-ind.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -309,26 +254,25 @@
 "Send fejlrapporter p engelsk pr. e-post til %s.\n"
 "Srg venligst for at skrive ordet \"%s\" et sted i \"Subject:\"-feltet.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed version %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "baseret p GNU sed version 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed version %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -341,101 +285,93 @@
 "Der er INGEN garanti; end ikke for SALGBARHED eller EGNETHED TIL NOGET\n"
 "BESTEMT FORML, i det omfang som loven tillader.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: kan ikke lse %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "kunne ikke bne filen %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "kunne ikke skrive %d element til %s: %s"
 msgstr[1] "kunne ikke skrive %d elementer til %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "lsefejl p %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: kan ikke lse %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Godt resultat"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Intet resultat"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Ugyldigt regulrt udtryk"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Ugyldigt sorteringstegn"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Ugyldigt navn p tegnklasse"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Afsluttende omvendt skrstreg"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Ugyldig reference bagud"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Uparret [ eller [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Uparret ( eller \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Uparret \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Ugyldigt indhold af \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Ugyldig slutning p omrde"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Hukommelsen opbrugt"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Ugyldigt forudgende regulrt udtryk"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Ufuldstndigt regulrt udtryk"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Regulrt udtryk for stort"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Uparret ) eller \\)"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Intet forudgende regulrt udtryk"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Forkert brug af adresse-ndrer"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Uventet Slut-p-Fil"
--- 4.1.4/po/de.po
+++ 4.0.9/po/de.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0.6\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-03-21 22:03:41+0100\n"
 "Last-Translator: Walter Koch <koch@u32.de>\n"
 "Language-Team: German <de@li.org>\n"
@@ -15,186 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n != 1);\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Mehrfache `!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Unerwartetes `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "+N oder ~N knnen nicht als erste Adresse benutzt werden"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Nicht paarweises `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Unerwartetes `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Zustzliche Zeichen nach dem Befehl"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Nach `a', `c' oder `i' wird \\ erwartet"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' erwartet keine Adressen"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr "`:' erwartet keine Adressen"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Kommentare erlauben keine Adressen"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Fehlender Befehl"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Befehl verwendet nur eine Adresse"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Nicht beendeter regulrer Adressausdruck"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Nicht beendeter `s'-Befehl"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Nicht beendeter `y'-Befehl"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Unbekannte Option betreffs `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "Mehrere 'p'-Optionen am `s'-Befehl"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "Mehrere 'g'-Optionen am `s'-Befehl"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "Mehrere numerische Optionen am `s'-Befehl"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "Numerisch Option am `s'-Befehl darf nicht Null sein"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "Unterschiedliche Lnge der Zeichenketten am `y'-Befehl"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "Neuere Version von sed erwartet"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Befehl verwendet nur eine Adresse"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Aufruf von savchar() mit unerwartetem \"pushback\" (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Unbekannter Befehl:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: Datei %s Zeile %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e Ausdruck #%lu, Zeichen %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Kann das Ziel fr den Sprung nach `%s' nicht finden"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: kann %s nicht lesen: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Datei %s kann nicht geffnet werden: %s"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Datei %s kann nicht geffnet werden: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERNER FEHLER: Falsche Adressenart"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Datei %s kann nicht geffnet werden: %s"
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "Fehler im Subprozess"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "Option `e' wird nicht untersttzt"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "`e'-Kommando wird nicht untersttzt"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERNER FEHLER: Falscher Befehl %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Kein vorheriger regulrer Ausdruck"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Auf leere regulre Ausdrcke knnen keine `modifier' angewandt werden"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Ungltiger Verweis \\%d in den Haltepuffer des `s'-Befehls"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -202,96 +179,34 @@
 "  -R, --regexp-perl\n"
 "                 Verwende die Perl 5 - Syntax fr reg.Ausdrcke im Script.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 Verwende die Perl 5 - Syntax fr reg.Ausdrcke im Script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -299,8 +214,42 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Aufruf: %s [OPTION]... {script-nur-wenn-kein-anderes-Script} "
+"[Eingabedatei]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 verhindert die automatische Ausgabe des Arbeitspuffers\n"
+"  -e script, --expression=script\n"
+"                 hngt script an die auszufhrenden Befehle an\n"
+"  -f script-Datei, --file=script-Datei\n"
+"                 hngt den Inhalt von script-Datei an die\n"
+"                 auszufhrenden Befehle an\n"
+"  -i[suffix], --in-place[=suffix]\n"
+"                 ndert die Eingabedatei (erzeugt Backup, falls Suffix\n"
+"                 angegeben wurde)\n"
+"  -l N, --line-length=N\n"
+"                 gibt die gewnschte Zeilenumbruchlnge fr den `l'-Befehl "
+"an\n"
+"  -r, --regexp-extended\n"
+"                 verwendet die erweiterten reg. Ausdrcke fr das Script.\n"
+"%s  -s, --separate\n"
+"                 die Dateien werden getrennt und nicht als gemeinsame\n"
+"                 Quelle bearbeitet.\n"
+"  -u, --unbuffered\n"
+"                 lade auf einamel nur kleinste Datenmengen aus den\n"
+"                 Eingabedateien und schreibe die Ausgabepuffer hufig "
+"zurck.\n"
+"      --help     nur diese Hilfe anzeigen\n"
+"  -V, --version  nur die Version ausgeben\n"
+"\n"
+"Falls kein -e, --expression, -f, oder --file Option angegeben ist, wird das\n"
+"erste Argument, das keine Option ist als sed-Skript verwendet.\n"
+"Alle restlichen Argumente werden als Namen von Eingabedateien betrachtet.\n"
+"Falls keine Eingabedateien angegeben sind, wird von der Standardeingabe "
+"gelesen.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -309,26 +258,25 @@
 "Fehlerberichte (in Englisch!) per E-Mail an: %s .\n"
 "Verwenden Sie dabei den Begriff ``%s'' irgendwo in der ``Betreff:''-Zeile.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "Super-sed version %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "basiert auf GNU sed Version 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed Version %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -346,101 +294,87 @@
 "Es gibt KEINE GARANTIE; nicht einmal die implizite Garantie der\n"
 "MARKTFHIGKEIT oder der ERFLLUNG EINES BESTIMMTEN ZWECKES.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: kann %s nicht lesen: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Datei %s kann nicht geffnet werden: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "Kann %d Feld nicht auf %s schreiben: %s"
 msgstr[1] "Kann %d Felder nicht auf %s schreiben: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "Lesefehler in %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: kann %s nicht lesen: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Erfolgreich"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Keine bereinstimmung"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Ungltiger regulrer Ausdruck"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Ungltiger Vergleichszeichen"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Ungltige Zeichenklassenname"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Abschliessender Backslash"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Ungltiger Rckwrtsverweis"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Nicht paarweises [ bzw. [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Nicht paarweises ( bzw. \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Nicht paarweises \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Ungltiger Inhalt in \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Ungltiges Bereichende"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Speicher erschpft"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Vorheriger regulrer Ausdruck ist ungltig"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Regulrer Ausdruck endet zu frh"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Regulrer Ausdruck ist zu gro"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Nicht paarweises ) bzw. \\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Kein vorheriger regulrer Ausdruck"
--- 4.1.4/po/el.po
+++ 4.0.9/po/el.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: GNU sed 3.02.80\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2002-03-08 12:57+0000\n"
 "Last-Translator: Simos Xenitellis <simos@hellug.gr>\n"
 "Language-Team: Greek <nls@tux.hellug.gr>\n"
@@ -14,279 +14,196 @@
 "Content-Transfer-Encoding: 8bit\n"
 "Report-Msgid-Bugs-To: \n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr " `!'s"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr " `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "      +N  ~N   "
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr " `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr " `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "    "
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr " \\    `a', `c'  `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr " `}'   "
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ":   "
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "    "
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "  "
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "     "
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "    "
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "   `s'"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "   `y'"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "    `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "  `p'   `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "  `g'   `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "     `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "     `s'     "
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "     `y'   "
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "    "
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "  savchar()    pushback (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr " :"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s:  %s  %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e  #%lu,  %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "         `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s:    %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "      %s"
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "      %s"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "      %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr " :   "
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "  "
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "    `e'"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "    `e'"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr " :   %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "    "
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "        "
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "   \\%d      `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
 
-#: sed/sed.c:98
-#, c-format
+#: sed/sed.c:100
+#, fuzzy, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -294,8 +211,32 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+": %s []... {-------} "
+"[-]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                      \n"
+"  -e /, --expression=/\n"
+"                  / /     "
+"\n"
+"  -f -, --file=-\n"
+"                        "
+"                    \n"
+"  -l N, --line-length=N\n"
+"                      \n"
+"                    `l'\n"
+"  -u, --unbuffered\n"
+"\n"
+"      --help          \n"
+"  -V, --version      \n"
+"\n"
+"    -e, --expression, -f  --file  ,   \n"
+"          sed "
+"\n"
+".         \n"
+"   ,     .\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -304,24 +245,23 @@
 "     : %s .\n"
 "     ``%s''    ``Subject:''.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -336,112 +276,245 @@
 "      ,   \n"
 "   .\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s:    %s: %s\n"
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+msgid "Couldn't open file %s: %s"
 msgstr "      %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, fuzzy, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "   %d   %s: %s"
 msgstr[1] "   %d   %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "   %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s:    %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 #, fuzzy
 msgid "Invalid regular expression"
 msgstr "    "
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 #, fuzzy
 msgid "Invalid collation character"
 msgstr "      "
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 #, fuzzy
 msgid "Invalid character class name"
 msgstr "      "
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 #, fuzzy
 msgid "Unmatched [ or [^"
 msgstr " `{'"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 #, fuzzy
 msgid "Unmatched ( or \\("
 msgstr " `{'"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 #, fuzzy
 msgid "Unmatched \\{"
 msgstr " `{'"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 #, fuzzy
 msgid "Invalid content of \\{\\}"
 msgstr "     {}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 #, fuzzy
 msgid "Invalid preceding regular expression"
 msgstr "    "
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 #, fuzzy
 msgid "Premature end of regular expression"
 msgstr "    "
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 #, fuzzy
 msgid "Regular expression too big"
 msgstr "   "
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 #, fuzzy
 msgid "Unmatched ) or \\)"
 msgstr " `{'"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "    "
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "    "
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr " -"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "  : %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "  : %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "     %s: %s"
+
+#~ msgid "Usage: pcregrep [-bepchilnsvx] pattern [file] ...\n"
+#~ msgstr ": pcregrep [-bepchilnsvx]  [] ...\n"
+
+#~ msgid "pcregrep: unknown option %c\n"
+#~ msgstr "pcregrep:   %c\n"
+
+#~ msgid "pcregrep: error in regex at offset %d: %s\n"
+#~ msgstr "pcregrep:       %d: %s\n"
+
+#~ msgid "pcregrep: error while studing regex: %s\n"
+#~ msgstr "pcregrep:       : %s\n"
+
+#~ msgid "pcregrep: failed to open %s: %s\n"
+#~ msgstr "pcregrep:   %s: %s\n"
+
+#~ msgid "\\ at end of pattern"
+#~ msgstr "\\    "
+
+#~ msgid "\\c at end of pattern"
+#~ msgstr "\\c    "
+
+#~ msgid "unrecognized character follows \\"
+#~ msgstr "     \\"
+
+#~ msgid "numbers out of order in {} quantifier"
+#~ msgstr "     {}"
+
+#~ msgid "number too big in {} quantifier"
+#~ msgstr "     {}"
+
+#~ msgid "missing terminating ] for character class"
+#~ msgstr " ["
+
+#~ msgid "range out of order in character class"
+#~ msgstr "     "
+
+#~ msgid "nothing to repeat"
+#~ msgstr "     "
+
+#~ msgid "operand of unlimited repeat could match the empty string"
+#~ msgstr ""
+#~ "            "
+#~ ""
+
+#~ msgid "internal error: unexpected repeat"
+#~ msgstr " :  "
+
+#~ msgid "unrecognized character after (?"
+#~ msgstr "     (?"
+
+#, fuzzy
+#~ msgid "unused error"
+#~ msgstr " "
+
+#~ msgid "unmatched braces"
+#~ msgstr " {  }"
+
+#~ msgid "back reference to non-existent subpattern"
+#~ msgstr "   -"
+
+#~ msgid "unknown option bit(s) set"
+#~ msgstr "/ / bit(s) "
+
+#~ msgid "missing ) after comment"
+#~ msgstr " )   "
+
+#~ msgid "parentheses nested too deeply"
+#~ msgstr "   "
+
+#~ msgid "failed to get memory"
+#~ msgstr "  "
+
+#~ msgid "unmatched parentheses"
+#~ msgstr " (  )"
+
+#~ msgid "internal error: code overflow"
+#~ msgstr " :  "
+
+#~ msgid "unrecognized character after (?<"
+#~ msgstr "     (?<"
+
+#~ msgid "lookbehind assertion is not fixed length"
+#~ msgstr "    "
+
+#~ msgid "malformed number after (?("
+#~ msgstr "     (?("
+
+#~ msgid "conditional group contains more than two branches"
+#~ msgstr "       "
+
+#~ msgid "assertion expected after (?("
+#~ msgstr "    (?("
+
+#~ msgid "(?p must be followed by )"
+#~ msgstr " (?p     )"
+
+#~ msgid "unknown POSIX class name"
+#~ msgstr "     POSIX"
+
+#~ msgid "POSIX collating elements are not supported"
+#~ msgstr "    POSIX"
+
+#~ msgid "bad condition (?(0)"
+#~ msgstr "  (?(0"
+
+#~ msgid "internal error"
+#~ msgstr " "
+
+#~ msgid "pattern error"
+#~ msgstr "  "
+
+#~ msgid "bad collating element"
+#~ msgstr "   "
+
+#~ msgid "bad escape sequence"
+#~ msgstr "  "
+
+#~ msgid "empty expression"
+#~ msgstr " "
+
+#~ msgid "bad argument"
+#~ msgstr " "
+
+#~ msgid "match failed"
+#~ msgstr " "
+
+#~ msgid "unknown error code"
+#~ msgstr "  "
+
+#~ msgid "%s at offset %-6d"
+#~ msgstr "%s   %-6d"
--- 4.1.4/po/eo.po
+++ 4.0.9/po/eo.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: GNU sed 4.0.8\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-10-26 20:57+0000\n"
 "Last-Translator: Edmund GRIMLEY EVANS <edmundo@rano.org>\n"
 "Language-Team: Esperanto <translation-team-eo@lists.sourceforge.net>\n"
@@ -15,186 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n != 1);\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Pluraj '!'oj"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Neatendita ','"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Ne eblas uzi +N a ~N kiel unuan adreson"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Neparigita '{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Neatendita '}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Kromaj signoj post komando"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Atendita \\ post 'a', 'c' a 'i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "'}' ne deziras adresojn"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": ne deziras adresojn"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Komentoj ne akceptas adresojn"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Mankas komando"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Komando uzas nur unu adreson"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Nefinita adresa regesp"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Nefinita komando 's'"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Nefinita komando 'y'"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Nekonata opcio por 's'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "pluraj 'p'-opcioj por komando 's'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "pluraj 'g'-opcioj por komando 's'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "pluraj nombro-opcioj por komando 's'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "nombro-opcio por komando 's' ne povas esti nul"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "enoj por komando 'y' havas malsamajn longojn"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "atendis pli novan version de sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Nevalida uzo de adresmodifilo"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Vokis savchar() kun neatendita pushback (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Nekonata komando:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: dosiero %s linio %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e esprimo #%lu, signo %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Ne povas trovi etikedon por salto al '%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: ne povas legi %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Ne povis malfermi dosieron %s: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Ne povis malfermi dosieron %s: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Ne povis malfermi dumtempan dosieron %s: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERNA ERARO: malbona adresspeco"
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "eraro en subprocezo"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "opcio 'e' ne realigita"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "komando 'e' ne realigita"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERNA ERARO: Malbona komando %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Mankas antaa regula esprimo"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Ne eblas specifi modifilojn e malplena regula esprimo"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Nevalida referenco \\%d e dekstra flanko de komando 's'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -202,96 +179,34 @@
 "  -R, --regexp-perl\n"
 "                 uzi sintakso de Perl 5 por regulaj esprimoj en programo.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 uzi sintakso de Perl 5 por regulaj esprimoj en programo.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -299,8 +214,39 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Uzado: %s [OPCIO]... {programo-nur-se-ne-alia-programo} [enig-dosiero]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 subpremi atomatan presadon de ablono-spaco\n"
+"  -e programo, --expression=programo\n"
+"                 aldoni la programon al la plenumotaj komandoj\n"
+"  -f programdosiero, --file=programdosiero\n"
+"                 aldoni la enhavon de programdosiero al la plenumotaj "
+"komandoj\n"
+"  -i[sufikso], --in-place[=sufikso]\n"
+"                 redakti dosierojn surloke (fari savkopion, se sufikso)\n"
+"  -l N, --line-length=N\n"
+"                 specifi la deziratan linilongon por la komando 'l'\n"
+"  -r, --regexp-extended\n"
+"                 uzi etenditajn regulajn esprimojn en la programo.\n"
+"%s  -s, --separate\n"
+"                 konsideri dosierojn kiel apartajn anstata kiel unu "
+"kontinuan\n"
+"                 longan fluon.\n"
+"  -u, --unbuffered\n"
+"                 legi minimumajn kvantojn de datenoj el la enig-dosieroj "
+"kaj\n"
+"                 malplenigi la eligobufrojn pli ofte\n"
+"      --help     montri i tiun helpon kaj eliri\n"
+"  -V, --version  montri version kaj eliri\n"
+"\n"
+"Se neniu opcio -e, --expression, -f a --file estas donita, tiam la unua\n"
+"ne-opcia argumento estas prenata kiel la sed-programeto interpretota. iuj\n"
+"restantaj argumentoj estas nomoj de enig-dosieroj; se neniu enigdosiero\n"
+"estas specifita, tiam la normala enigo estas legata.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -309,26 +255,25 @@
 "Retpotu cimo-raportojn al: %s .\n"
 "Nepre menciu la vorton '%s' ie en la temlinio.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versio %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "bazita sur \"GNU sed\" versio 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versio %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -341,101 +286,102 @@
 "NENIA GARANTIO; e ne por KOMERCA KVALITO a ADEKVATECO POR DIFINITA CELO,\n"
 "la la grado permesita de juro.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: ne povas legi %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Ne povis malfermi dosieron %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "ne povis skribi %d eron al %s: %s"
 msgstr[1] "ne povis skribi %d erojn al %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "legeraro e %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: ne povas legi %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Sukceso"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Maltrafo"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Nevalida regula esprimo"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Nevalida kunfanda signo"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nevalida nomo de signoklaso"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Malsuprenstreko e fino"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Nevalida retroreferenco"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Neparigita [ a [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Neparigita ( a \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Neparigita \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Nevalida enhavo de \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Nevalida fino de gamo"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Mankas memoro"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Nevalida antaa regula esprimo"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Neatendita fino de regula esprimo"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Regula esprimo tro granda"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Neparigita ) a \\)"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Mankas antaa regula esprimo"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Nevalida uzo de adresmodifilo"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Neatendita fino de dosiero"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "malbona regesp: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "legeraro e enigo: %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "ne povis skribi eron al %s: %s"
--- 4.1.4/po/es.po
+++ 4.0.9/po/es.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0.8\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-10-24 12:38-0500\n"
 "Last-Translator: Cristian Othn Martnez Vera <cfuga@itam.mx>\n"
 "Language-Team: Spanish <es@li.org>\n"
@@ -15,186 +15,164 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n != 1);\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "'!'s mltiples"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,' inesperada"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "No se pueden usar +N o ~N como primera direccin"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' sin pareja"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' inesperado"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Caracteres extra despus de la orden"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Se esperaba \\ despus de `a', `c'  `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' no acepta ninguna direccin"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": no acepta ninguna direccin"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Los comentarios no aceptan ninguna direccin"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Orden faltante"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "La orden solamente usa una direccin"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Direccin de expresin regular sin terminar"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Orden `s' sin terminar"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Orden `y' sin terminar"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Opcin desconocida para `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "mltiples opciones `p' para la orden `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "mltiples opciones `g' para la orden `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "mltiples opciones numricas para la orden `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "una opcin numrica para la orden `s' no puede ser cero"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "las cadenas para la orden y son de longitudes diferentes"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "se esperaba una versin ms reciente de sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Uso invlido de un modificador de direccin"
+# FUZZY: pushback -> empuje? cfuga
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "savchar() llamado con empuje inesperado (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Orden desconocida:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fichero %s lnea %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e expresin #%lu, carcter %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "No se puede encontrar la etiqueta para saltar a `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: no se puede leer %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "No se puede abrir el fichero %s: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "No se puede abrir el fichero %s: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "No se puede abrir el fichero temporal %s: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "ERROR INTERNO: tipo de direccin errneo"
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "error en el subproceso"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "no hay soporte para la opcin `e'"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "no hay soporte para el comando `e'"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "ERROR INTERNO: cmd %c errneo"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "No hay una expresin regular previa"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "No se pueden especificar modificadores en expresiones regulares vacas"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Referencia \\%d invlida en el lado derecho del comando `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -203,97 +181,34 @@
 "                 utilizar la sintaxis de expresiones regulares de Perl 5\n"
 "                 en el guin.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 utilizar la sintaxis de expresiones regulares de Perl 5\n"
-"                 en el guin.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -301,8 +216,47 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Modo de empleo: %s [OPCIN]... {guin-slo-si-no-hay-otro-guin} [fichero-"
+"entrada]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 elimina la impresin automtica del espacio de patrones\n"
+"  -e script, --expression=guin\n"
+"                 agrega el guin a las rdenes a ser ejecutadas\n"
+"  -f script-file, --file=fichero-guin\n"
+"                 agrega el contenido del fichero-guin a las rdenes a ser\n"
+"                  ejecutadas\n"
+"  -i[sufijo, --in-place[=sufijo]\n"
+"                 edita los archivos en su lugar (crea respaldos si se\n"
+"                 proporciona una extensin)\n"
+"  -l N, --line-length=N\n"
+"                 especifica la longitud deseada para el corte de la lnea "
+"para\n"
+"                 el comando `l'\n"
+"  -r, --regexp-extended\n"
+"                 usa expresiones regulares extendidas en el guin.\n"
+"%s  -s, --separate\n"
+"                 considera los ficheros por separado en lugar de un solo "
+"flujo\n"
+"                 largo y continuo.\n"
+"  -u, --unbuffered\n"
+"                 carga cantidades mnimas de datos de los ficheros de "
+"entrada\n"
+"                 y vaca con ms frecuencia los almacenamientos temporales "
+"de\n"
+"                 salida\n"
+"      --help     muestra esta ayuda y sale\n"
+"  -V, --version  muestra la informacin de la versin y sale\n"
+"\n"
+"Si no se dan las opciones -e, --expression, -f o --file, entonces se toma\n"
+"el primer argumento que no sea opcin como el guin sed a interpretar.  "
+"Todos\n"
+"los argumentos restantes son nombres de ficheros de entrada; si no se\n"
+"especifican nombres de fichero de entrada, entonces se lee la entrada "
+"estndard.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -312,26 +266,25 @@
 "Asegrese de incluir la palabra ``%s'' en algn lugar en el campo "
 "``Subject:''.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versin %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "basado en GNU sed versin 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versin %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -344,101 +297,102 @@
 "No hay NINGUNA garanta; ni siquiera de COMERCIABILIDAD o IDONEIDAD PARA UN\n"
 "FIN DETERMINADO, en la extensin permitida por ley.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: no se puede leer %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "No se puede abrir el fichero %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "no se puede escribir %d elemento a %s: %s"
 msgstr[1] "no se pueden escribir %d elementos a %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "error al leer de %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: no se puede leer %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "xito"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "No hay coincidencia"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Expresion regular invlida"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Carcter de ordenamiento invlido"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Carcter de nombre de clase invlido"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Diagonal invertida al final"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Referencia hacia atrs invlida"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[  [^ sin pareja"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "(  \\( sin pareja"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ sin pareja"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Contenido invlido de \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Final de rango invlido"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Memoria agotada"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Expresin regular precedente invlida"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Final prematuro de la expresin regular"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Expresin regular demasiado grande"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ")  \\) sin pareja"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "No hay una expresin regular previa"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Uso invlido de un modificador de direccin"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Fin de fichero inesperado"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "expresin regular errnea: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "error al leer la entrada: %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "no se puede escribir un elemento elemento a %s: %s"
--- 4.1.4/po/et.po
+++ 4.0.9/po/et.po
@@ -1,12 +1,12 @@
 # Estonian translations for GNU sed.
 # Copyright (C) 2001 Free Software Foundation, Inc.
-# Toomas Soome <Toomas.Soome@microlink.ee>, 2004.
+# Toomas Soome <Toomas.Soome@microlink.ee>, 2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.1.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-07-09 16:33+0300\n"
+"Project-Id-Version: sed 4.0.8\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-10-24 19:39+0300\n"
 "Last-Translator: Toomas Soome <Toomas.Soome@microlink.ee>\n"
 "Language-Team: Estonian <et@li.org>\n"
 "MIME-Version: 1.0\n"
@@ -15,168 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n != 1);\n"
 
-#: sed/compile.c:162
-msgid "multiple `!'s"
-msgstr "korduv `!'"
-
-#: sed/compile.c:163
-msgid "unexpected `,'"
-msgstr "ootamatu `,'"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
+msgstr "Korduv `!'"
+
+#: sed/compile.c:173
+msgid "Unexpected `,'"
+msgstr "Ootamatu `,'"
 
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "+N vi ~N ei vi kasutada esimese aadressina"
 
-#: sed/compile.c:165
-msgid "unmatched `{'"
-msgstr "liigne `{'"
-
-#: sed/compile.c:166
-msgid "unexpected `}'"
-msgstr "ootamatu `}'"
-
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "lisasmbolid peale ksku"
-
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
-msgstr "peale `a', `c' vi `i' peab olema \\"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
+msgstr "Liigne `{'"
+
+#: sed/compile.c:176
+msgid "Unexpected `}'"
+msgstr "Ootamatu `}'"
+
+#: sed/compile.c:177
+msgid "Extra characters after command"
+msgstr "Lisasmbolid peale ksku"
+
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr "Peale `a', `c' vi `i' peab olema \\"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' ei vaja aadresse"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": ei vaja aadresse"
 
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "kommentaarid ei vaja aadresse"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "Kommentaarid ei vaja aadresse"
 
-#: sed/compile.c:172
-msgid "missing command"
-msgstr "ksk puudub"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Ksk puudub"
 
-#: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "ksk kasutab vaid ht aadressi"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "Ksk kasutab vaid ht aadressi"
 
-#: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "lpetamata aadressi avaldis"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "Lpetamata aadressi avaldis"
 
-#: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "lpetamata `s' ksk"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "Lpetamata `s' ksk"
 
-#: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "lpetamata `y' ksk"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "Lpetamata `y' ksk"
 
-#: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "tundmatu vti `s' ksule"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "Tundmatu vti `s' ksule"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "korduv `p' vti `s' ksus"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "korduv `g' vti `s' ksus"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "korduvad numbrivtmed `s' ksus"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "numbrivti `s' ksus ei vi olla null"
 
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
-msgstr "sned ksus `y' on erineva pikkusega"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "sned y ksus on erineva pikkusega"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "eraldav sbol ei ole he-baidiline smbol"
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "oodati sedi uuemat versiooni"
 
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "vigane rea aadressi 0 kasutamine"
-
-#: sed/compile.c:186
+#: sed/compile.c:236
 #, c-format
-msgid "unknown command: `%c'"
-msgstr "tundmatu ksk: `%c'"
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "kutsuti savchar() ootamatu pushback (%x)"
 
-#: sed/compile.c:209
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr "Tundmatu ksk:"
+
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fail %s rida %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e avaldis #%lu, smbol %lu: %s\n"
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "ei leia mrgendit, et hpata kohale `%s'"
+msgid "Can't find label for jump to `%s'"
+msgstr "Ei leia mrgendit, et hpata kohale `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: ei saa lugeda %s: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "%s ei saa toimetada: see on terminal"
+msgid "Couldn't open temporary file %s: %s"
+msgstr "Ajutist faili %s ei saa avada: %s"
 
-#: sed/execute.c:676
-#, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "%s ei saa toimetada: see ei ole tavaline fail"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "SISEMINE VIGA: vigane aadressi tp"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "ajutist faili %s ei saa avada: %s"
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "viga alamprotsessis"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "vtit `e' ei toetata"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "ksku `e' ei toetata"
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "eelmist regulaaravaldist pole"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "SISEMINE VIGA: Halb ksk %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "Eelmist regulaaravaldist pole"
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
-msgstr "muudatusi thjale regulaaravaldisele ei saa mrata"
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "Muudatusi thjale regulaaravaldisele ei saa mrata"
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "vigane viide \\%d ksu `s' paremas pooles"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "Vigane viide \\%d ksu `s' paremas pooles"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -184,116 +179,34 @@
 "  -R, --regexp-perl\n"
 "                 kasuta skriptis Perl 5 regulaaravaldiste sntaksit.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-"Kasutamine: %s [vti]... {ainult-skript-kui-teisi-skripte-pole} [sisend-"
-"fail]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                 keela mustriruumi automaatne vljastamine\n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e skript, --expression=skript\n"
-"                 lisa tidetavate kskluste skript\n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f skripti-fail, --file=skripti-fail\n"
-"                 lisa skripti-faili sisu tidetavate kskluste hulka\n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[SUFIKS], --in-place[=SUFIKS]\n"
-"                 toimeta faile (kui kasutati sifiksit, loob ka varukoopia)\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                 mra `l' ksule soovitatav rea pikkus\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"  --posix\n"
-"                 blokeeri kik GNU laiendused.\n"
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                 kasuta skriptis laiendatud regulaaravaldiste sntaksit.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                 ksitle faile kshaaval, mitte he jtkuva voona.\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                 loe sisendfailist minimaalne kogus andmeid ja thjenda\n"
-"                 vljundpuhvreid sagedamini\n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help     vljast see abiinfo ja lpeta t\n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr "      --version  vljasta versiooniinfo ja lpeta t\n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -301,14 +214,34 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Kasuta: %s [VTI]... {skript-siis-kui-teisi-skripte-pole} [sisendfail]...\n"
 "\n"
-"Kui vtmeid -e, --expression, -f vi --file ei kasutata, loetakse\n"
-"esimene argument, mis pole vti, sed skriptiks. Kik jrgnevad argumendid "
-"on\n"
-"sisendfailide nimed; kui sisendfaile ei antud, loetakse standardsisendit.\n"
+"  -n, --quiet, --silent\n"
+"                 keela automaatne mustriruumi vljastamine\n"
+"  -e skript, --expression=skript\n"
+"                 lisa skript tidetavate kskude nimekirja\n"
+"  -f skript-fail, --file=skript-fail\n"
+"                 lisa skript-faili sisu tidetavate kskude nimekirja\n"
+"  -i[sufiks], --in-place[=sufiks]\n"
+"                 toimeta faile kohapeal (teeb varukoopia, kui on sufiks)\n"
+"  -l N, --line-length=N\n"
+"                 mra `l' ksule rea pikkus\n"
+"  -r, --regexp-extended\n"
+"                 kasuta skriptis laiendatud regulaaravaldisi\n"
+"%s  -s, --separate\n"
+"                 ksitle faile eraldi, mitte he pideva voona.\n"
+"  -u, --unbuffered\n"
+"                 puhverdamata vljund\n"
+"      --help     esita see abiinfo ja lpeta t\n"
+"  -V, --version  esita versiooniinfo ja lpeta t\n"
+"\n"
+"Kui vtit -e, --expression, -f vi --file pole antud, siis kasutatakse\n"
+"esimest mitte-vtmelist argumenti interpreteeritava sed skriptina. Kik\n"
+"lejnud argumendid on sisendfailide nimed; kui sisendfailide nimesid\n"
+"pole, loetakse info standardsisendist.\n"
 "\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -317,26 +250,25 @@
 "Postitage teated vigadest: %s .\n"
 "Lisage kindlasti sna ``%s'' ``Subject:'' reale.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versioon %s\n"
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"phineb GNU sed versioonil %s\n"
+"phineb GNU sed versioonil 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versioon %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -349,101 +281,87 @@
 "PUUDUB; ka mgiks vi mingil eesmrgil kasutamiseks, vastavalt seadustega\n"
 "lubatud piiridele.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
+#: lib/utils.c:126
 #, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s ei saa eemaldada: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "Faili %s ei saa avada: %s"
 
-#: lib/utils.c:143
-#, c-format
-msgid "couldn't open file %s: %s"
-msgstr "faili %s ei saa avada: %s"
-
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "%d elemendi faili %s kirjutamine ebannestus: %s"
 msgstr[1] "%d elemendi faili %s kirjutamine ebannestus: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "lugemisviga %s: %s"
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s ei saa mber nimetada: %s"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Edukas"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Ei leia"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Vigane regulaaravaldis"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Vigane sortimise smbol"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Vigane smbolite klassi nimi"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Lpetav langkriips"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Vigane tagasi viide"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Puudub [ vi [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Puudub ( vi \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Puudub \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Vigane \\{\\} sisu"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Vigane vahemiku lpp"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Mlu on otsas"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Vigane eelnev regulaaravaldis"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Ootamatu regulaaravaldise lpp"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Regulaaravaldis on liiga suur"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Puudub ) vi \\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Eelmist regulaaravaldist pole"
--- 4.1.4/po/fi.po
+++ 4.0.9/po/fi.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed-4.0.8\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-12-07 09:35+0200\n"
 "Last-Translator: Sami J. Laine <sami.laine@iki.fi>\n"
 "Language-Team: Finnish <translation-team-fi@lists.sourceforge.net>\n"
@@ -15,186 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=n != 1;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Useita \"!\"-merkkej"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Odottamaton \",\""
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Ensimmisen osoitteena ei voi olla +N tai ~N"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Pariton \"{\""
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Pariton \"}\""
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Ylimrisi merkkej komennon jlkeen"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "\\ odotettiin merkkien `a', `c' tai `i' jlkeen"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "\"}\" ei tarvitse osoitteita"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": ei tarvitse osoitteita"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Kommentit eivt hyvksy osoitteita"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Puuttuva komento"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Komento kytt vain yht osoitetta"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Pttymtn osoite vakiolauseessa"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Pttymtn \"s\"-komento"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Pttymtn \"y\"-komento"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Tuntematon valitsin \"s\":lle"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "useita \"p\"-valitsimia \"s\"-komennolle"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "useita \"g\"-valitsimia \"s\"-komennolle"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "useita valitsimia \"s\"-komennolle"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "numeerinen valitsin \"s\"-komennolle ei voi olla nolla"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "merkkijonot \"y\"-komennolle ovat pituudeltaan vaihtelevia"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "odotettiin uudempaa versiota sed:st"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Komento kytt vain yht osoitetta"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Kutsuttiin funktiota savchar() odottamattomalla taaksepainannalla (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Tuntematon komento:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: tiedosto %s rivi %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e lauseke #%lu, merkki %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Nimikett hypylle kohteeseen \"%s\" ei lydy"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: ei voida lukea sytett %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Tiedostoa %s ei voitu avata: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Tiedostoa %s ei voitu avata: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Vliaikaistiedostoa %s ei voitu avata: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "SISINEN VIRHE: virheellinen osoitetyyppi"
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "virhe lapsiprosessissa"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "valitsin `e' ei ole tuettu"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "komento `e' ei ole tuettu"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "SISINEN VIRHE: Virheellinen komento %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Ei aikaisempaa snnllist lausetta"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Muuttajia ei voida mritell tyhjn snnliseen lausekkeeseen"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Virheellinen viittaus \\%d komennon `s' oikealla puolella"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -203,97 +180,34 @@
 "                 kyt Perl 5:en mukaista snnllisten lauseiden\n"
 "                 syntaksia skriptiss.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 kyt Perl 5:en mukaista snnllisten lauseiden\n"
-"                 syntaksia skriptiss.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -301,8 +215,38 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Kytt: %s [VALITSIN]... {skripti-vain-jos-ei-muuta-skripti} "
+"[sytetiedosto]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                  est automaattinen kuvioavaruuden tulostus\n"
+"  -e skripti, --expression=skripti\n"
+"                  lis skriptin sislt suoritettavien komentojen joukkoon\n"
+"  -f skripti-tiedosto, --file=skriptitiedosto\n"
+"                  lis skriptitiedoston sislt suoritettavien komentojen\n"
+"                  joukkoon\n"
+"  -i[tarkenne], --in-place[=tarkenne]\n"
+"                  muokkaa tiedostoja suoraan (mikli tarkenne on annettu\n"
+"                  tekee varmuuskopio alkuperisest)\n"
+"  -l N, --line-lenght=N\n"
+"                  mrittele haluttu rivinkatkaisupituus komennolle \"l\"\n"
+"  -r, --regexp-extended\n"
+"                  kytt laajennettuja snnllisi lausekkeita skriptiss\n"
+"%s -s, --separate\n"
+"                  ksittelee tiedostoja erillisin yhtenisen jatkuvan\n"
+"                  tietovuon sijaan\n"
+"  -u, --unbuffered\n"
+"                  puskuroitu tila\n"
+"      --help      tulosta tm ohje ja lopeta ohjelman suoritus\n"
+"  -V, --version   tulosta ohjelman versiotiedot ja lopeta ohjelman suoritus\n"
+"\n"
+"Mikli -e, --expression, -f tai --file valitsinta ei anneta, ensimminen\n"
+"valitsinten jlkeinen argumentti ksitetn tulkittavaksi sed-skriptiksi.\n"
+"Kaikki loput argumentit ksitetn sytetiedostojen nimiksi; mikli\n"
+"yhtn sytetiedostoa ei ole mritelty, luetaan vakiosytt.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -311,26 +255,25 @@
 "Lhet virheraportit osoitteeseen %s .\n"
 "Sisllyt sana \"%s\" viestin aihekenttn (\"Subject\"-kenttn).\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versio %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "perustuu GNU sed versioon 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versio %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -344,101 +287,87 @@
 "kaupallisesti hyvksyttvst laadusta tai soveltuvuudesta tiettyyn\n"
 "tarkoitukseen.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: ei voida lukea sytett %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Tiedostoa %s ei voitu avata: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "%d kohdetta ei voitu kirjoittaa tulosteeseen %s: %s"
 msgstr[1] "%d kohdetta ei voitu kirjoittaa tulosteeseen %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "lukuvirhe sytteess %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: ei voida lukea sytett %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Onnistui"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Ei osumaa"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Virheellinen snnllinen lauseke"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Virheellinen vertailumerkki"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Virhellinen merkkiluokan nimi"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Seuraava kenoviiva"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Virheellinen takaisinviittaus"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Pariton \"[\" tai \"[^\""
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Pariton \"(\" tai \"\\(\""
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Pariton \"\\{\""
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Virheellinen sislt \\{\\}:ss"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Virheellinen vlin loppu"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Muisti loppu"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Virheellinen edeltv snnllinen lauseke"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Ennenaikainen snnllisen lausekkeen loppu"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Snnllinen lauseke on liian suuri"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Pariton \")\" tai \"\\)\""
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Ei aikaisempaa snnllist lausetta"
--- 4.1.4/po/fr.po
+++ 4.0.9/po/fr.po
@@ -8,9 +8,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.1.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-07-12 00:09+0200\n"
+"Project-Id-Version: sed 4.0.6\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-03-24 12:46+0200\n"
 "Last-Translator: Gal Quri <gael@lautre.net>\n"
 "Language-Team: French <traduc@traduc.org>\n"
 "MIME-Version: 1.0\n"
@@ -19,170 +19,167 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n > 1);\n"
 
-#: sed/compile.c:162
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!' multiples"
 
-#: sed/compile.c:163
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,' inattendue"
 
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
-msgstr "utilisation invalide de +N ou ~N comme premire adresse"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
+msgstr "Impossible d'utiliser +N ou ~N comme premire adresse"
 
-#: sed/compile.c:165
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' non referme"
 
-#: sed/compile.c:166
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' inattendu"
 
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "caractres inutiles aprs la commande"
+#: sed/compile.c:177
+msgid "Extra characters after command"
+msgstr "Caractres inutiles aprs la commande"
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "\\ attendu aprs `a', `c' ou `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' n'a besoin d'aucune adresse"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": n'a besoin d'aucune adresse"
 
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "les commentaires n'acceptent aucune adresse"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "Les commentaires n'acceptent aucune adresse"
 
-#: sed/compile.c:172
-msgid "missing command"
-msgstr "commande manquante"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Commande manquante"
 
-#: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "la commande n'utilise qu'une adresse"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "La commande n'utilise qu'une adresse"
 
-#: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "expression rgulire d'adresse inacheve"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "Expression rgulire d'adresse inacheve"
 
-#: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "commande `s' inacheve"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "Commande `s' inacheve"
 
-#: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "commande `y' inacheve"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "Commande `y' inacheve"
 
-#: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "option inconnue pour `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "Option inconnue pour `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "plusieurs options `p'  la commande `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "plusieurs options `g'  la commande `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "plusieurs options numriques  la commande `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "l'option numrique de la comande `s' ne peut tre nulle"
 
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
-msgstr "les chanes destines  la commande `y' ont des longueurs diffrentes"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "les chanes destines  la commande y ont des longueurs diffrentes"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "le caractre dlimiteur n'est pas un caractre  un seul octet"
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "une version plus rcente de sed est attendue"
 
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "utilisation invalide de l'adresse de ligne 0"
-
-#: sed/compile.c:186
+#: sed/compile.c:236
 #, c-format
-msgid "unknown command: `%c'"
-msgstr "commande inconnue: `%c'"
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr ""
+"La fonction savchar() a t appele avec un caractre de rebroussement\n"
+"inattendu (%x)"
 
-#: sed/compile.c:209
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr "Commande inconnue:"
+
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fichier %s ligne %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e expression n%lu, caractre %lu: %s\n"
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "impossible de trouver l'tiquette pour sauter  `%s'"
+msgid "Can't find label for jump to `%s'"
+msgstr "Impossible de trouver l'tiquette pour aller  `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: impossible de lire %s: %s\n"
 
-#: sed/execute.c:672
-#, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "impossible d'diter %s: est un terminal"
-
-#: sed/execute.c:676
-#, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "impossible d'diter %s: ce n'est pas un fichier rgulier"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "impossible d'ouvrir le fichier temporaire %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, fuzzy, c-format
+msgid "Couldn't open temporary file %s: %s"
+msgstr "Impossible d'ouvrir le fichier %s: %s"
+
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "ERREUR INTERNE: mauvais type d'adresse"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "erreur dans le sous-processus"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "l'option `e' n'est pas supporte"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "la commande `e' n'est pas supporte"
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "pas d'expression rgulire prcdente"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "ERREUR INTERNE: mauvaise commande %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "Pas d'expression rgulire prcdente"
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
-"impossible de spcifier des modifieurs sur une expression\n"
+"Impossible de spcifier des modifieurs sur une expression\n"
 "rationnelle vide"
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "rfrence \\%d invalide dans le ct droit de la commande `s'"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "Rfrence \\%d invalide dans le ct droit de la commande `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -191,123 +188,34 @@
 "                 utiliser la syntaxe des expressions rgulires\n"
 "                 de Perl 5 dans le script.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-"Utilisation: %s [OPTION]... {script-seulement-si-pas-d'autre-script}\n"
-"[fichier-d'entre]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                 supprimer l'criture automatique de l'espace des motifs\n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e script, --expression=script\n"
-"                 ajouter le script aux commandes  tre excutes\n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f fichier-script, --file=fichier-script\n"
-"                 ajouter le contenu de fichier-script aux commandes\n"
-"                  tre excutes\n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[SUFFIXE], --in-place[=SUFFIXE]\n"
-"                 diter les fichiers  leur place (fait une\n"
-"                 sauvegarde si l'extension est fournie)\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                spcifier la longueur de coupure de ligne dsire pour la\n"
-"                commande `l'\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"  --posix\n"
-"                 dsactiver toutes les extensions GNU.\n"
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                 utiliser la syntaxe des expressions rgulires\n"
-"                 tendues dans le script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                considrer les fichiers comme spars plutt que comme un\n"
-"                simple flux long et continu.\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                 charger des quantits minimales de donnes depuis les\n"
-"                 fichiers d'entre et librer les tampons de sortie plus\n"
-"                 souvent\n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help     afficher cette aide et sortir\n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-"      --version  afficher les informations de version du logiciel et sortir\n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -315,14 +223,43 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Utilisation: %s [OPTION]... {script si aucun autre n'est spcifi} "
+"[entre]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 supprimer l'criture automatique de l'espace des motifs\n"
+"  -e script, --expression=script\n"
+"                 ajouter le script aux commandes qui seront executes\n"
+"  -f fichier de script, --file=fichier de script\n"
+"                 ajouter le contenu du fichier aux commandes\n"
+"                 qui seront executes\n"
+"  -i[suffixe], --in-place[=suffix]\n"
+"                 diter les fichiers  leur place (fait une sauvegarde\n"
+"                 si l'extension est fournie)\n"
+"  -l N, --line-length=N\n"
+"                 spcifier la longueur de coupure de ligne dsire pour\n"
+"                 la commande `l'\n"
+"  -r, --regexp-extended\n"
+"                 utiliser des expressions rgulires tendues dans le\n"
+"                 script.\n"
+"%s  -s, --separate\n"
+"                 considrer que les fichiers sont spars et non un\n"
+"                 simple long flux continu.\n"
+"  -u, --unbuffered\n"
+"                 charger les quantits minimales de donnes des fichiers\n"
+"                 d'entre et vider les tampons de sortie plus souvent\n"
+"      --help     afficher cette aide et sortir\n"
+"  -V, --version  afficher les informations de version du logiciel et\n"
+"                 sortir\n"
+"\n"
+"Si aucune des options -e, --expression, -f ou --file n'est donne, le "
+"premier\n"
+"argument n'tant pas une option est interprt comme un script sed.\n"
+"Les arguments restants sont les noms des fichiers d'entre.\n"
+"Si aucun fichier d'entre n'est spcifi l'entre standard est lue.\n"
 "\n"
-"Si aucune option -e, --expression, -f ou --file n'est donne, le\n"
-"premier argument qui n'est pas une option sera pris comme tant le script\n"
-"sed  interprter. Tous les arguments restants sont les noms des fichiers\n"
-"d'entre; si aucun fichier d'entre n'est spcifie, l'entre standard\n"
-"est lue.\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -332,26 +269,23 @@
 "N'oubliez pas d'inclure le mot ``%s'' quelque-part dans la zone "
 "``Subject:''\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed version %s\n"
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
-"\n"
-msgstr ""
-"fond sur GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
+msgstr "fond sur GNU sed version 3.02.80\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed version %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -365,101 +299,87 @@
 "AUCUNE garantie n'est donne; y compris pour des RAISONS COMMERCIALES ou\n"
 "pour RPONDRE A UN BESOIN PARTICULIER,  l'tendue permise par la loi.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
+#: lib/utils.c:126
 #, c-format
-msgid "cannot remove %s: %s"
-msgstr "impossible de supprimer %s: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "Impossible d'ouvrir le fichier %s: %s"
 
-#: lib/utils.c:143
-#, c-format
-msgid "couldn't open file %s: %s"
-msgstr "impossible d'ouvrir le fichier %s: %s"
-
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "impossible d'crire %d item  %s: %s"
 msgstr[1] "impossible d'crire %d items  %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "erreur de lecture sur %s: %s"
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "impossible de renommer %s: %s"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Succs"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Pas de concordance"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Expression rgulire invalide"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Caractre de collation invalide"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nom de classe de caractres invalide"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Antislash de protection"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Rfrence arrire invalide"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[ ou [^ non referm"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "( ou \\( non referm"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ non referm"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Contenu de \\{\\} invalide"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Fin d'intervalle invalide"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Mmoire puise"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "L'expression rgulire prcdente est invalide"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Fin prmature d'une expression rgulire"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Expression rgulire trop grande"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ") ou \\) non referm"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Pas d'expression rgulire prcdente"
--- 4.1.4/po/ga.po
+++ 4.0.9/po/ga.po
@@ -1,12 +1,12 @@
 # Irish translations for sed
-# Copyright (C) 2003, 2004 Free Software Foundation, Inc.
-# Kevin Patrick Scannell <scannell@SLU.EDU>, 2003, 2004.
+# Copyright (C) 2003 Free Software Foundation, Inc.
+# Kevin Patrick Scannell <scannell@SLU.EDU>, 2003. 
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.1.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-07-07 11:04-0500\n"
+"Project-Id-Version: sed 4.0.8\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-10-24 16:00-0600\n"
 "Last-Translator: Kevin Patrick Scannell <scannell@SLU.EDU>\n"
 "Language-Team: Irish <ga@li.org>\n"
 "MIME-Version: 1.0\n"
@@ -16,171 +16,165 @@
 "Plural-Forms: nplurals=4; plural=n==1 ? 0 : (n>1 && n<7) ? 1 : (n>6 && n "
 "<11) ? 2 : 3;\n"
 
-#: sed/compile.c:162
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!'-anna iomadla"
 
-#: sed/compile.c:163
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,' gan choinne"
 
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
-msgstr "n fidir +N n ~N a sid mar an chad seoladh"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
+msgstr "N fidir +N n ~N a sid mar an chad seoladh"
 
-#: sed/compile.c:165
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' corr"
 
-#: sed/compile.c:166
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' gan choinne"
 
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "carachtair breise i ndiaidh an t-ord"
-
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
-msgstr "bhothas ag sil le \\ i ndiaidh `a', `c', n `i'"
+#: sed/compile.c:177
+msgid "Extra characters after command"
+msgstr "Carachtair breise i ndiaidh an t-ord"
+
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr "Bhothas ag sil le \\ i ndiaidh `a', `c', n `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "Nl filte roimh seolta le `}'"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr "Nl filte roimh seolta le `:'"
 
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "nl filte roimh seolta le nta trchta"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "Nl filte roimh seolta le nta trchta"
 
-#: sed/compile.c:172
-msgid "missing command"
-msgstr "ord ar iarraidh"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Ord ar iarraidh"
 
-#: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "n sidtear an t-ord ach seoladh amhin"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "Baineann an t-ord sid as seoladh amhin"
 
-#: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "seoladh regex gan chrochn"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "Seoladh regex gan chrochn"
 
-#: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "ord `s' gan chrochn"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "Ord `s' gan chrochn"
 
-#: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "ord `y' gan chrochn"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "Ord `y' gan chrochn"
 
-#: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "rogha anaithnid i ndiaidh `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "Rogha anaithnid i ndiaidh `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "an iomarca roghanna `p' i ndiaidh `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "an iomarca roghanna `g' i ndiaidh `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "an iomarca roghanna uimhrila i ndiaidh `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "n cheadatear nialas mar rogha uimhriil leis an ord `s'"
 
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "n aon fad amhin ar na teaghrin leis an ord `y'"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "t an teorantir ina charachtar ilbheart"
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "bhothas ag sil le leagan `sed' nos ire"
 
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "n fidir an seoladh lne 0 a sid"
-
-#: sed/compile.c:186
+# pushback is in FARF - KPS
+#: sed/compile.c:236
 #, c-format
-msgid "unknown command: `%c'"
-msgstr "ord anaithnid: `%c'"
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Glaodh savchar() le br siar (%x) gan choinne"
+
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr "Ord anaithnid:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: comhad %s lne %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e slonn #%lu, char %lu: %s\n"
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "nl aon fhil ar an lipad `%s' don lim"
+msgid "Can't find label for jump to `%s'"
+msgstr "Nl aon fhil ar an lipad `%s' don lim"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: n fidir %s a lamh: %s\n"
 
-# Irish is nice this way, no initial mutation on 'rud'! -- KPS
-# Include all three b/c I'm using template version of "Plural-Forms"
-#: sed/execute.c:672
-#, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "norbh fhidir %s a chur in eagar; is teirminal "
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "norbh fhidir %s a chur in eagar: n gnthcomhad "
+msgid "Couldn't open temporary file %s: %s"
+msgstr "Norbh fhidir an comhad sealadach %s a oscailt: %s"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "norbh fhidir an comhad sealadach %s a oscailt: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "EARRID INMHENACH: drochsheoladh"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "earrid i bhfo-phriseas"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "nl an rogha `e' ar fil"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "nl an t-ord `e' ar fil"
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "nl aon slonn ionadaochta roimh seo"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "EARRID INMHENACH: Drochord %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "Nl aon slonn ionadaochta roimh seo"
 
 # bunathraitheoir is in FARF - KPS
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
-msgstr "n fidir bunathraitheoir a shonr le slonn bn"
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "N fidir bunathraitheoir a chur le slonn bn"
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "tagairt neamhbhail \\%d ar dheis ord `s'"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "Tagairt neamhbhail \\%d ar dheis ord `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -188,116 +182,34 @@
 "  -R, --regexp-perl\n"
 "                 bain sid as sloinn ionadaochta at ag Perl 5.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-"sid: %s [ROGHA]... {script-mura-bhfuil-script-eile} [inchomhad]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                 stop priontil uathoibroch den sps patrin\n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e script, --expression=script\n"
-"                 cuir an script leis na horduithe le rith\n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f comhad-script, --file=comhad-script\n"
-"                 cuir na lnte i `comhad-script' leis na horduithe le rith\n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[IARMHR], --in-place[=IARMHR]\n"
-"                 cuir eagar ar comhaid san it a bhfuil siad (agus dan\n"
-"                 cltaca m t IARMHR tugtha\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                 ceap an fad timfhillte le haghaidh an ordaithe `l'\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"  --posix\n"
-"                 dchumasaigh gach feabhschn GNU.\n"
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                 sid sloinn ionadaochta feabhsaithe sa script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                 fach ar comhaid ina leith seachas mar sruth leannach.\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                 ldil canta beaga  na comhaid ionchur agus sruthlaigh\n"
-"                 na maolin aschur nos minice\n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help     taispein an chabhair seo agus irigh as\n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr "      --version  taispein eolas faoin leagan agus irigh as\n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -305,6 +217,28 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"sid: %s [ROGHA]... {script-mura-bhfuil-script-eile} [comhad-ionchuir]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 stop priontil uathoibroch den sps patrin\n"
+"  -e script, --expression=script\n"
+"                 cuir an script leis na horduithe le rith\n"
+"  -f comhad-script, --file=comhad-script\n"
+"                 cuir na lnte i `comhad-script' leis na horduithe le rith\n"
+"  -i[iarmhr], --in-place[=iarmhr]\n"
+"                 cuir eagar ar comhaid san it a bhfuil siad (agus dan\n"
+"                 cltaca m t iarmhr ann\n"
+"  -l N, --line-length=N\n"
+"                 ceap an fad timfhillte le haghaidh an ordaithe `l'\n"
+"  -r, --regexp-extended\n"
+"                 sid sloinn ionadaochta feabhsaithe sa script.\n"
+"%s  -s, --separate\n"
+"                 fach ar comhaid ina leith seachas mar sruth leannach.\n"
+"  -u, --unbuffered\n"
+"                 ldil canta beaga  na comhaid ionchur agus sruthlaigh\n"
+"                 na maolin aschur nos minice\n"
+"      --help     taispein an chabhair seo agus irigh as\n"
+"  -V, --version  taispein eolas faoin leagan agus irigh as\n"
 "\n"
 "Mura bhfuil rogha -e, --expression, -f, n --file ann, glacfar an chad\n"
 "argint nach raibh ina rogha mar an script `sed' a lirmhni.  T gach\n"
@@ -312,7 +246,7 @@
 "ligh n ionchur caighdenach.\n"
 "\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -321,26 +255,25 @@
 "Seol tuairisc fabhtanna chuig: %s .\n"
 "Cuir an focal ``%s'' it igin sa lne ``Subject:'' le do thoil.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed, leagan %s\n"
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"bunaithe ar GNU sed, leagan %s\n"
+"bunaithe ar GNU sed, leagan 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed, leagan %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -354,19 +287,14 @@
 "d'INDOLTACHT n FEILINACHT DO FHEIDHM AR LEITH, an oiread at ceadaithe\n"
 "de rir dl.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
+#: lib/utils.c:126
 #, c-format
-msgid "cannot remove %s: %s"
-msgstr "n fidir %s a scriosadh: %s"
-
-#: lib/utils.c:143
-#, c-format
-msgid "couldn't open file %s: %s"
-msgstr "norbh fhidir an comhad %s a oscailt: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "Norbh fhidir an comhad %s a oscailt: %s"
 
 # Irish is nice this way, no initial mutation on 'rud'! -- KPS
 # Include all three b/c I'm using template version of "Plural-Forms"
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
@@ -375,85 +303,76 @@
 msgstr[2] "norbh fhidir %d rud a scrobh i %s: %s"
 msgstr[3] "norbh fhidir %d rud a scrobh i %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "earrid ag lamh %s: %s"
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "n fidir %s a athainmni: %s"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Bua!"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Nl a leithid ann"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Slonn ionadaochta neamhbhail"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Carachtar cimheasa neamhbhail"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Aicme charachtair neamhbhail"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Clslais ag deireadh"
 
 # coinage - KPS
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Cltagairt neamhbhail"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[ n [^ corr"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "( n \\( corr"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ corr"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "bhar neamhbhail idir \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Deireadh raoin neamhbhail"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Cuimhne dithe"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Is neamhbhail an slonn ionadaochta roimh seo"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Deireadh le slonn ionadaochta gan choinne"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Slonn ionadaochta rmhr"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ") n \\) corr"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Nl aon slonn ionadaochta roimh seo"
--- 4.1.4/po/gl.po
+++ 4.0.9/po/gl.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2002-10-25 15:57+0200\n"
 "Last-Translator: Jacobo Tarro Barreiro <jtarrio@trasno.net>\n"
 "Language-Team: Galician <gpul-traduccion@ceu.fi.udc.es>\n"
@@ -15,186 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=n!=1;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Mltiples `!'s"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,' inesperada"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Non se pode usar +N ou ~N como primeira direccin"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' sen parella"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' inesperado"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Caracteres extra despois da instruccin"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Esperbase \\ despois de `a', `c' ou `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' non acepta un enderezo"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": non acepta un enderezo"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Os comentarios non aceptan enderezos"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Falta unha instruccin"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "A instruccin s usa un enderezo"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Expresin regular de enderezo non rematada"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Instruccin `s' non rematada"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Instruccin `y' non rematada"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Opcin de `s' descoecida"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "mltiples opcins `p' para a instruccin `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "mltiples opcins `g' para a instruccin `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "mltiples opcins numricas para a instruccin `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "unha opcin numrica para a instruccin `s' non pode ser cero"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "as cadeas para a instruccin y teen lonxitudes diferentes"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Uso non vlido de modificador de direccin"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Chamouse a savchar() cun pushback inesperado (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Instruccin descoecida:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: ficheiro %s lia %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e expresin #%lu, carcter %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Non se puido atopa-la etiqueta para saltar a `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: non se puido ler %s: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Non se puido abri-lo ficheiro %s: %s"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Non se puido abri-lo ficheiro %s: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "ERRO INTERNO: tipo de enderezo incorrecto"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Non se puido abri-lo ficheiro %s: %s"
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "erro no subproceso"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "a opcin `e' non est soportada"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "o comando `e' non est soportado"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "ERRO INTERNO: instruccin %c incorrecta"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Non hai unha expresin regular anterior"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Non se poden especificar modificadores nunha expresin regular baleira"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Referencia \\%d non vlida no lado dereito do comando `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -203,97 +180,34 @@
 "                 usa-la sintaxe de expresins regulares de Perl 5 no "
 "script.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 usa-la sintaxe de expresins regulares de Perl 5 no "
-"script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -301,8 +215,40 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Uso: %s [OPCIN]... {script-s-sen-outro-script} [ficheiro-de-entrada]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 suprime a visualizacin automtica do espacio de patrns\n"
+"  -e script, --expression=script\n"
+"                 engade o script s instruccin que sern executadas\n"
+"  -f ficheiro-do-script, --file=ficheiro-do-script\n"
+"                 engade o contido do ficheiro do script s instruccins que\n"
+"                 se han executar\n"
+"  -i[sufixo], --in-place[=sufixo]\n"
+"                 edita os ficheiros no seu sitio (facendo unha copia de\n"
+"                 seguridade se se d un sufixo)\n"
+"  -l N, --line-length=N\n"
+"                 especifica a lonxitude de lia desexada para o comando `l'\n"
+"  -r, --regexp-extended\n"
+"                 emprega expresins regulares extendidas no script.\n"
+"%s  -s, --separate\n"
+"                 trata os ficheiros coma separados no canto de coma unha\n"
+"                 longa tira de caracteres continua.\n"
+"  -u, --unbuffered\n"
+"                 carga cantidades mnimas de datos dos ficheiros de entrada\n"
+"                 e baleira os buffers de sada mis decote\n"
+"      --help     amosar esta axuda e sar\n"
+"  -V, --version  amosar informacin da versin e sar\n"
+"\n"
+"Se non se indican as opcins -e, --expression, -f, ou --file, entn o "
+"primeiro\n"
+"argumento que non sexa unha opcin tmase como o script de sed a "
+"interpretar.\n"
+"Tdolos argumentos restantes son nomes de ficheiros de entrada; se non se\n"
+"especifican ficheiros de entrada, entn lese a entrada estndar.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -312,24 +258,23 @@
 "Informe dos erros na traduccin a gpul-traduccion@ceu.fi.udc.es .\n"
 "Asegrese de inclu-la palabra ``%s'' nalgunha parte do campo ``Subject:''.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versin %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr "baseado en GNU sed versin 3.02.80\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versin %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -344,101 +289,102 @@
 "DETERMINADO,\n"
 "ata o que permite a lei.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: non se puido ler %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Non se puido abri-lo ficheiro %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "non se puido escribir %d elemento en %s: %s"
 msgstr[1] "non se puideron escribir %d elementos en %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "erro de lectura en %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: non se puido ler %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "xito"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Non se atopou"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Expresin regular non vlida"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Carcter de ordeamento non vlido"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nome de clase de caracteres non vlido"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Barra invertida  fin de lia"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Referencia cara a atrs non vlida"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[ ou [^ sen parella"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "( ou \\( sen parella"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ sen parella"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Contido de \\{\\} non vlido"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Fin de rango non vlida"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Memoria esgotada"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Expresin regular anterior non vlida"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Fin prematura da expresin regular"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Expresin regular grande de mis"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ") ou \\) sen parella"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Non hai unha expresin regular anterior"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Uso non vlido de modificador de direccin"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Fin-de-ficheiro inesperado"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "expresin regular errnea: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "erro de lectura da entrada: %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "non se puido escribir un elemento en %s: %s"
--- 4.1.4/po/he.po
+++ 4.0.9/po/he.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 3.02.80\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2001-08-04 20:37+0300\n"
 "Last-Translator: Eli Zaretskii <eliz@gnu.org>\n"
 "Language-Team: Hebrew <eliz@gnu.org>\n"
@@ -14,276 +14,196 @@
 "Content-Transfer-Encoding: 8-bit\n"
 "Report-Msgid-Bugs-To: \n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!' "
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "- `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "  ~N  +N-   "
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "-   `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "- `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "   "
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr ""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "   `}'"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr "   :"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "   "
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr " "
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "     "
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "     "
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "  `s' "
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "  `y' "
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "`s'  - "
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "`s'   `p' "
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "`s'   `g' "
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "`s'    "
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "    `s'   "
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "   `y'  "
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "   "
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "(%x) - pushback   savchar() "
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "-  "
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s  (%s   %lu ) %s \n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s  (%lu ' -e   %lu ' ) %s \n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "  `%s'  "
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s  %s  (%s) \n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "%s   "
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "%s   "
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "-   :  "
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "%s   "
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr ""
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr ""
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "%c   :  "
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr ""
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
 
-#: sed/sed.c:98
-#, c-format
+#: sed/sed.c:100
+#, fuzzy, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -291,8 +211,27 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"%s []... {---} [ ]... : \n"
+"\n"
+"                                                  -n, --quiet, --silent\n"
+"                        \n"
+"                                         -e script, --expression=script\n"
+"                            script \n"
+"                                     -f script-file, --file=script-file\n"
+"              script-file   \n"
+"                                                  -l N, --line-length=N\n"
+"                            N \n"
+"                                                       -u, --unbuffered\n"
+"\n"
+"                                             --help\n"
+"                                          -V, --version\n"
+"\n"
+"         ,--file  ,-f ,--expression ,-e  \n"
+"           . sed    \n"
+"                .    ,    ;  \n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -301,24 +240,23 @@
 "              .%s  (bugs)    \n"
 "   .(``Subject'') ``''  ``%s''    \n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -331,105 +269,106 @@
 "      ,         ; \n"
 "                                                          .  \n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s  %s  (%s) \n"
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+msgid "Couldn't open file %s: %s"
 msgstr "%s   "
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, fuzzy, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "  %d  %s-  (%s) "
 msgstr[1] "  %d  %s-  (%s) "
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "%s  (%s) "
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s  %s  (%s) \n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr ""
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 #, fuzzy
 msgid "Unmatched [ or [^"
 msgstr "-   `{'"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 #, fuzzy
 msgid "Unmatched ( or \\("
 msgstr "-   `{'"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 #, fuzzy
 msgid "Unmatched \\{"
 msgstr "-   `{'"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr ""
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr ""
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr ""
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 #, fuzzy
 msgid "Unmatched ) or \\)"
 msgstr "-   `{'"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr ""
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "   "
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "   "
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "%s   \n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "  (%s) "
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "%s-    (%s) "
--- 4.1.4/po/hr.po
+++ 4.0.9/po/hr.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 3.02a\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2002-06-14 15:17-01\n"
 "Last-Translator: Denis Lackovic <delacko@fly.srk.fer.hr>\n"
 "Language-Team: Croatian <lokalizacija@linux.hr>\n"
@@ -16,277 +16,196 @@
 "Plural-Forms: nplurals=2; plural=(n==1?0:1);\n"
 "X-Generator: TransDict server\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Viestruki `!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Neoekivani `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Ne mogu koristiti +N ili ~N kao prvu adresu"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Neuparena `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Neoekivana `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Viak znakova nakon komande"
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr ""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' ne eli nikakve adrese"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": ne eli nikakve adrese"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Komentari ne primaju adrese"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Nedostaje naredba"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Naredba koristi samo jednu adresu"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Nezavreni regularni izraz adrese"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Nezavrena `s' naredba"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Nezavrena `y' naredba"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Nepoznata opcija za `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "viestruke `p' opcije za `s' naredbu"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "viestruke `g' opcije za `s' naredbu"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "viak opcija za za `s' naredbu"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "broj opcija za naredbu `s' ne smije biti nula"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "znakovni nizovi za naredbu y su razliitih duljina"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Neispravna uporaba adresnog modifikatora"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Pozvao savchar() sa neoekivanim rezultatom (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Nepoznata naredba:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: datoteka %s redak %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e izraz #%lu, znak %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Ne mogu nai labelu na koju bi trebalo skoiti `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: ne mogu itati %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Ne mogu otvoriti datoteku %s"
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Ne mogu otvoriti datoteku %s"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Ne mogu otvoriti datoteku %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERNA GREKA: neispravan tip adrese"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr ""
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr ""
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERNA GREKA: Neispravna naredba %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Nedostaje prethodni regularni izraz"
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
 
-#: sed/sed.c:98
-#, c-format
+#: sed/sed.c:100
+#, fuzzy, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -294,8 +213,26 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Uporaba: %s [OPCIJA]... {skripta-samo-ako-nema-druge-skripte} [ulazna-"
+"datoteka]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 suzbij ispis uzoraka\n"
+"  -e script, --expression=script\n"
+"                 dodaj skriptu naredbama koje treba izvriti\n"
+"  -f script-file, --file=script-file\n"
+"                 dodaj sadraj skriptne-datoteke naredbi koju treba "
+"izvriti\n"
+"      --help     prikai ovu pomo i izai\n"
+"  -V, --version  ispii informacije o inaici i izai\n"
+"\n"
+"Ako nema -e, --expression, -f, ili --file opcije, tada se uzima prvi\n"
+"argument koji nije opcija kao sed skripta koju treba protumaiti.  Svi\n"
+"preostali argumenti su imena ulaznih datoteka; ako nema ulaznih datoteka\n"
+"tada se cita standardni ulaz.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -304,24 +241,23 @@
 "E-mail bug prijave (na engleskom) poaljite na: %s .\n"
 "Ukljuite rije ``%s'' u polju ``Subject:''.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -335,109 +271,107 @@
 " NEMA garancije;\n"
 "ak ni tvrdnje o ISPLATIVOSTI ili POGODNOSTI ZA NEKU SVRHU.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
+#: lib/utils.c:126
 #, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: ne mogu itati %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+msgid "Couldn't open file %s: %s"
 msgstr "Ne mogu otvoriti datoteku %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, fuzzy, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "Ne mogu upisati %d item%s u %s: %s"
 msgstr[1] "Ne mogu upisati %d item%s u %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "Greka u itanju na %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: ne mogu itati %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 #, fuzzy
 msgid "Invalid regular expression"
 msgstr "Nedostaje prethodni regularni izraz"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 #, fuzzy
 msgid "Unmatched [ or [^"
 msgstr "Neuparena `{'"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 #, fuzzy
 msgid "Unmatched ( or \\("
 msgstr "Neuparena `{'"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 #, fuzzy
 msgid "Unmatched \\{"
 msgstr "Neuparena `{'"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 #, fuzzy
 msgid "Invalid preceding regular expression"
 msgstr "Nedostaje prethodni regularni izraz"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 #, fuzzy
 msgid "Premature end of regular expression"
 msgstr "Nedostaje prethodni regularni izraz"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 #, fuzzy
 msgid "Regular expression too big"
 msgstr "Nedostaje prethodni regularni izraz"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 #, fuzzy
 msgid "Unmatched ) or \\)"
 msgstr "Neuparena `{'"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Nedostaje prethodni regularni izraz"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Neispravna uporaba adresnog modifikatora"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Neoekivani kraj datoteke"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "neispravan regularni izraz: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "greka pri itanju ulaza: %s"
--- 4.1.4/po/hu.po
+++ 4.0.9/po/hu.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0.8\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-10-26 09:28+0100\n"
 "Last-Translator: Mihly Gyulai <gyulai@fbi.hu>\n"
 "Language-Team: Hungarian <translation-team-hu@lists.sourceforge.net>\n"
@@ -15,186 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=1; plural=0;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Tbb `!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Vratlan `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Nem lehet hasznlni a +N-t vagy ~N-t elso cmknt"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Nincs prban `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Nincs prban `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Extra karakterek a parancs utn "
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "`a', `c' vagy `i' parancs utn \\ szksges"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' nem ignyel cmzst"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": nem ignyel cmzst"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Megjegyzsben nem lehet cmzs"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Hinyz parancs"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "A parancs csak egy cmzst hasznl"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Befejezetlen regex cm"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Befejezetlen `s' parancs"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Befejezetlen `y' parancs"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Ismeretlen `s' opci"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "tbbszrs `p' opci, `s' parancs mellett"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "tbbszrs `g' opci, `s' parancs mellett"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "tbbszrs szm opci, `s' parancs mellett"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "a(z) `s' parancs szm opcija nem lehet nulla"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "a(z) `y' parancs szvegeinek hossza klnbz"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "a 'sed' program jabb verzijra van szksg"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "A parancs csak egy cmzst hasznl"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "A meghvott savchar() egy vratlan rtkkel trt vissza (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Ismeretlen parancs:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fjl %s sor %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e kifejezs #%lu, karakter %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Az ugrshoz (`%s') nem tallom a cmkt"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: nem lehet olvasni %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Nem lehet megnyitni a(z) %s fjlt: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Nem lehet megnyitni a(z) %s fjlt: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Nem lehet megnyitni az tmeneti fjlt: %s: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "BELS HIBA: rossz cm tpus"
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "hiba az alfolyamatban"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "az `e' opci nincs tmogatva"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "az `e' parancs nincs tmogatva"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "BELS HIBA: Rossz parancs %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Nincsen elz regulris kifejezs"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Nem lehet mdostt megadni res regulris kifejezshez"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Hibs hivatkozs (\\%d) a(z) `s' parancs RHS-re"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -202,96 +179,34 @@
 "  -R --regexp-perl\n"
 "                Perl 5 regulris kifejezs nyelvtannak hasznlata.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R --regexp-perl\n"
-"                Perl 5 regulris kifejezs nyelvtannak hasznlata.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -299,8 +214,33 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Hasznlat: %s [OPCI]... {parancsok sorozata} [bemeneti fjl] ...\n"
+"\n"
+"-n, --quiet, --silent\n"
+"        elnyomja az alaprtelmezett kimenetet\n"
+"-e script, --expression=hjprogram\n"
+"        hozzadja a hjprogramot a vgrehajtand parancsokhoz \n"
+"-f hjprogram-fjl, --file=hjprogram-fjl\n"
+"        hozzadja a hjprogram fjlt a vgrehajtand parancsokhoz\n"
+"-i[vgzds], --in-place[=vgzds]\n"
+"\n"
+"-l N, --line-length=N\n"
+"        meghatrozza az 'l' parancshoz a sortrs rtkt\n"
+"-r, --regexp-extended\n"
+"        kiterjesztett regulris kifejezs hasznlata a hjprogramban\n"
+"%s -s, --separate\n"
+"        a fjlokat klnllknak tekinti\n"
+"-u, --unbuffered\n"
+"    --help     megjelenti ezt a segtsget s kilp\n"
+"-V, --version  kirja a verzi adatokat s kilp\n"
+"\n"
+"Ha nem -e, --expression, -f, vagy --file opci lett megadva, akkor az els\n"
+"nem opci paramter lesz vgrehajtva.  Az sszes maradk paramtert \n"
+"bemeneti fjlnvnek veszi; ha nincs bemeneti fjl megadva, akkor \n"
+"a szabvnyos bemenetrl olvas.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -309,26 +249,25 @@
 "A fordtsi hibkat krem a gyulai@fbi.hu cmre kldeni. \n"
 "Angolul ide: %s . A levl Trgy mezejben legyen ott a `%s' sz.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed verzi %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "A GNU 3.02.80-as sed verzin alapszik\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed verzi %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -342,101 +281,87 @@
 "SEMMILYEN garancit nem vllalunk, mg azt sem lltjuk, hogy ez a program\n"
 "KERESKEDELMI CLOKRA ALKALMAS vagy HASZNLHAT EGY ADOTT FELADATRA.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: nem lehet olvasni %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Nem lehet megnyitni a(z) %s fjlt: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "nem tudom a(z) %d elemet ide rni %s: %s"
 msgstr[1] "nem tudom a(z) %d elemeket ide rni %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "olvassi hiba %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: nem lehet olvasni %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Sikeres"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Nincs tallat"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Hibs regulris kifejezs"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "rvnytelen sszehasonlt karakter"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "rvnytelen karakterosztly-nv"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Lezr visszaperjel"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "rvnytelen vissza-hivatkozs"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Nincs prban [ vagy [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Nincs prban ( vagy \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Nincs prban \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "\\{\\}-nak rvnytelen a tartalma"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Sorozat rvnytelen vge"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Kevs a memria"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "rvnytelen megelz regulris kifejezs"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Regulris kifejezs tl korai vge"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Tl nagy regulris kifejezs"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Nincs prban ) vagy \\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Nincsen elz regulris kifejezs"
--- 4.1.4/po/id.po
+++ 4.0.9/po/id.po
@@ -1,13 +1,12 @@
-# translation of sed-4.0.9.id.po to Indonesian
-# sed 4.0.9 (Indonesian)
-# Copyright (C) 1999, 2000, 2001, 2003, 2004 Free Software Foundation, Inc.
-# Tedi Heriyanto <tedi_h@gmx.net>, 2002, 2003, 2004.
+# sed 4.0.6 (Indonesian)
+# Copyright (C) 1999, 2000, 2001, 2003 Free Software Foundation, Inc.
+# Tedi Heriyanto <tedi_h@gmx.net>, 2002, 2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.0.9\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-04-27 14:56+0700\n"
+"Project-Id-Version: sed 4.0.6\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-04-04 14:38GMT+0700\n"
 "Last-Translator: Tedi Heriyanto <tedi_h@gmx.net>\n"
 "Language-Team: Indonesian <translation-team-id@lists.sourceforge.net>\n"
 "MIME-Version: 1.0\n"
@@ -15,188 +14,165 @@
 "Content-Transfer-Encoding: 8bit\n"
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=1; plural=0;\n"
-"X-Generator: KBabel 1.3\n"
+"X-Generator: KBabel 0.9.6\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!' ganda"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,' tidak diharapkan"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Tidak dapat menggunakan +N atau ~N sebagai alamat pertama"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' tidak sesuai"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' tidak diharapkan"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Karakter tambahan setelah perintah"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Diharapkan \\ setelah `a', `c' atau `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' tidak menginginkan alamat"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": tidak menginginkan alamat"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Komentar tidak menerima alamat"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Perintah hilang"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Perintah hanya menggunakan satu alamat"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Alamat regex yang tidak selesai"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Perintah `s' tidak selesai"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Perintah `y' tidak selesai"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Opsion tidak dikenal bagi `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "opsion `p' ganda bagi perintah `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "opsion `g' ganda bagi perintah `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "opsion beragam untuk perintah `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "opsion angka untuk perintah `s' tidak boleh nol"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "string untuk perintah y dalam panjang yang berbeda"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "mengharapkan versi baru sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Penggunaan modifier alamat yang tidak valid"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Dipanggil savchar() dengan pushback (%x) yang tidak diharapkan"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Perintah tidak dikenal:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: file %s baris %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e ekspresi #%lu, char %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Tidak dapat menemukan label untuk melompat ke `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: tidak dapat membaca %s: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Tidak dapat membuka file %s %s"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Tidak dapat membuka file %s %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Tidak dapat membuka file temporer %s %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "KESALAHAN INTERNAL: tipe alamat buruk"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "kesalahan dalam subproses"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "option `e' tidak didukung"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "perintah `e' tidak didukung"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "KESALAHAN INTERNAL: Perintah %c buruk"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Tidak ada reguler ekspresi sebelumnya"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Tidak dapat menspesifikasikan modified pada regexp kosong"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Referensi tidak valid \\%d pada perintah `s' RHS"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -204,96 +180,34 @@
 "  -R, --regexp-perl\n"
 "                 gunakan sintaks reguler ekspresi Perl 5 dalam skrip.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 gunakan sintaks reguler ekspresi Perl 5 dalam skrip.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -301,8 +215,37 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Penggunaan: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 tiadakan pencetakan otomatis ruang pola\n"
+"  -e script, --expression=script\n"
+"                 tambah skrip ke perintah yang akan dieksekusi\n"
+"  -f script-file, --file=script-file\n"
+"                 tambah isi file skrip ke perintah yang akan dieksekusi\n"
+" -i[suffix], --in-place[=suffix]\n"
+"                 edit file secara langsung (buat backup jika ada ekstensi)\n"
+"  -l N, --line-length=N\n"
+"                 spesifikasikan panjang baris pemotongan yang diinginkan "
+"untuk perintah `l'\n"
+" -r, --regexp-extended\n"
+"                 gunakan extended regular expressions dalam skrip .\n"
+"%s  -s, --separate\n"
+"                 anggap file sebagai stream terpisah alih-alih continuous\n"
+"                 long stream.\n"
+"  -u, --unbuffered\n"
+"\n"
+"      --help     tampilkan bantuan ini dan keluar\n"
+"  -V, --version  tampilkan informasi versi dan keluar\n"
+"\n"
+"Jika tidak diberikan opsi -e, --expression, -f, atau --file, maka argumen\n"
+"non-opsi pertama akan dianggap sebagai skrip sed untuk diinterpretasikan.  "
+"Seluruh\n"
+"argumen sisanya adalah nama file input; jika tidak ada file input\n"
+"dispesifikasikan, maka standar input akan dibaca.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -311,26 +254,25 @@
 "Email laporan kesalahan ke: %s \n"
 "Pastikan untuk menyertakan kata \"%s\" di field \"Subject:\".\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versi %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "berdasarkan pada GNU sed versi 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versi %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -343,101 +285,93 @@
 "warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE,\n"
 "to the extent permitted by law.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: tidak dapat membaca %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Tidak dapat membuka file %s %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "tidak dapat menulis %d item ke %s: %s"
 msgstr[1] "tidak dapat menulis %d item ke %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "kesalahan pembacaan pada %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: tidak dapat membaca %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Sukses"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Tidak cocok"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Reguler ekspresi tidak valid"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Karakter kolasi tidak valid"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nama kelas karakter tidak valid"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Trailing backslash"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Referensi balik tidak valid"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[ atau [^ tidak sesuai"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "( atau \\( tidak sesuai"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ tidak sesuai"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Isi \\{\\} tidak valid"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Akhir batas tidak valid"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Memori habis"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Reguler ekspresi sebelumnya tidak valid"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Akhir reguler ekspresi prematur"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Reguler ekspresi terlalu besar"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ") atau \\) tidak sesuai"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Tidak ada reguler ekspresi sebelumnya"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Penggunaan modifier alamat yang tidak valid"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Akhir file tidak diharapkan"
--- 4.1.4/po/it.po
+++ 4.0.9/po/it.po
@@ -4,8 +4,8 @@
 # 
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.0a\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"Project-Id-Version: sed 4.0.3\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2002-11-26 12:44+0100\n"
 "Last-Translator: Paolo Bonzini <bonzini@gnu.org>\n"
 "Language-Team: Italian <tp@lists.linux.it>\n"
@@ -16,203 +16,199 @@
 "Plural-Forms: nplurals=2; plural=n != 1;\n"
 
 # sed/compile.c:166
-#: sed/compile.c:162
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!' multipli"
 
 # sed/compile.c:167
-#: sed/compile.c:163
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,' inattesa"
 
 # sed/compile.c:169
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
-msgstr "impossibile usare +N o ~N come primo indirizzo"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
+msgstr "Impossibile usare +N o ~N come primo indirizzo"
 
 # sed/compile.c:170
-#: sed/compile.c:165
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' non bilanciata"
 
 # sed/compile.c:171
-#: sed/compile.c:166
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' inattesa"
 
 # sed/compile.c:172
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "ci sono altri caratteri dopo il comando"
+#: sed/compile.c:177
+msgid "Extra characters after command"
+msgstr "Ci sono altri caratteri dopo il comando"
 
 # sed/compile.c:173
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
-msgstr "atteso \\ dopo `a', `c' o `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr "Atteso \\ dopo `a', `c' o `i'"
 
 # sed/compile.c:174
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' non accetta indirizzi"
 
 # sed/compile.c:175
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": non accetta indirizzi"
 
 # sed/compile.c:176
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "i commenti non accettano indirizzi"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "I commenti non accettano indirizzi"
 
 # sed/compile.c:177
-#: sed/compile.c:172
-msgid "missing command"
-msgstr "manca il comando"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Manca il comando"
 
 # sed/compile.c:178
-#: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "il comando usa solo un indirizzo"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "Il comando usa solo un indirizzo"
 
 # sed/compile.c:179
-#: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "espressione regolare non terminata nell'indirizzo"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "Indirizzo della regex non terminato"
 
 # sed/compile.c:180
-#: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "comando `s' non terminato"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "Comando `s' non terminato"
 
 # sed/compile.c:181
-#: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "comando `y' non terminato"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "Comando `y' non terminato"
 
 # sed/compile.c:182
-#: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "opzione di `s' sconosciuta"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "Opzione di `s' sconosciuta"
 
 # sed/compile.c:183
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "opzioni `p' multiple al comando `s'"
 
 # sed/compile.c:184
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "opzioni `g' multiple al comando `s'"
 
 # sed/compile.c:186
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "opzioni numeriche multiple al comando `s'"
 
 # sed/compile.c:188
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "l'opzione numerica del comando `s' non pu essere zero"
 
 # sed/compile.c:190
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
-msgstr "le stringhe per il comandi `y' hanno lunghezze diverse"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "le stringhe per i comandi y hanno lunghezze diverse"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "il carattere delimitatore  multi-byte"
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "attesa una versione piu' recente di sed"
 
-# sed/compile.c:178
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "utilizzo non valido dell'indirizzo 0"
+# sed/compile.c:233
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Chiamata savchar() con un pushback inatteso (%x)"
 
 # sed/compile.c:1319
-#: sed/compile.c:186
-#, c-format
-msgid "unknown command: `%c'"
-msgstr "comando sconosciuto: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr "Comando sconosciuto:"
 
 # sed/compile.c:1340
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: file %s riga %lu: %s\n"
 
 # sed/compile.c:1343
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: espressione -e #%lu, carattere %lu: %s\n"
 
 # sed/compile.c:1543
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "impossibile trovare un'etichetta per il salto a `%s'"
+msgid "Can't find label for jump to `%s'"
+msgstr "Impossibile trovare un'etichetta per il salto a `%s'"
 
 # sed/execute.c:516
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: impossibile leggere %s: %s\n"
 
-# sed/execute.c:675
-#: sed/execute.c:672
-#, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "impossibile modificare %s:  un terminale"
-
-#: sed/execute.c:676
-#, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "impossibile modificare %s: non  un file normale"
-
 # lib/utils.c:131
-#: lib/utils.c:196 sed/execute.c:683
+#: sed/execute.c:530 sed/execute.c:542
 #, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "impossibile aprire il file temporaneo %s: %s"
+msgid "Couldn't open temporary file %s: %s"
+msgstr "Impossibile aprire il file temporaneo %s: %s"
+
+# sed/execute.c:722
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERNAL ERROR: bad address type"
 
 # sed/execute.c:1003 sed/execute.c:1183
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "errore in un sottoprocesso"
 
 # sed/execute.c:1005
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "opzione `e' non supportata"
 
 # sed/execute.c:1185
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "comando `e' non supportato"
 
+# sed/execute.c:1415
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERNAL ERROR: Bad cmd %c"
+
 # lib/regcomp.c:658 sed/regex.c:47
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "occorre un'espressione regolare precedente"
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "Occorre un'espressione regolare precedente"
 
 # sed/regex.c:48
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
-msgstr "non  possibile specificare dei modificatori per l'espressione vuota"
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "Non e' possibile specificare dei modificatori per l'espressione vuota"
 
 # sed/regex.c:146
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "riferimento non valido \\%d nel secondo membro del comando `s'"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "Riferimento non valido \\%d nel secondo membro del comando `s'"
 
 # sed/sed.c:98
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -220,120 +216,35 @@
 "  -R, --regexp-perl\n"
 "                 usa la sintassi Perl 5 per le espressioni regolari\n"
 
-#: sed/sed.c:98
+# sed/sed.c:103
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-"Utilizzo: %s [OPZIONE]... {script-se-nessun-altro-specificato} [input-"
-"file]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                 sopprime la stampa automatica del pattern space\n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e script, --expression=script\n"
-"                 aggiunge lo script ai comandi da eseguire\n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f script-file, --file=file-script\n"
-"                 aggiunge il contenuto di file-script ai comandi da "
-"eseguire\n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
-"                 scrive il risultato sul file originale (facendo una copia\n"
-"                 se  fornita un'estensione)\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                 specifica la lunghezza delle linee generate dal comando "
-"`l'\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"  --posix\n"
-"                 disabilita tutte le estensioni GNU.\n"
-
-# sed/sed.c:98
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                 usa la sintassi di `egrep' per le espressioni regolari\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                 considera i file di input come separati invece che come un\n"
-"                 unico file lungo.\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                 carica e visualizza i dati una a pezzetti piu' piccoli\n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help     mostra questo aiuto ed esce\n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr "      --version  stampa le informazioni sulla versione ed esce\n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -341,6 +252,30 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Uso: %s [OPZIONE]... {script-solo-se-manca-un-altro-script} [file-input]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 sopprime la stampa automatica del pattern space\n"
+"  -e script, --expression=script\n"
+"                 aggiunge lo script ai comandi da eseguire\n"
+"  -f script-file, --file=file-script\n"
+"                 aggiunge il contenuto di file-script ai comandi da "
+"eseguire\n"
+"  -i[suffix], --in-place[=suffix]\n"
+"                 scrive il risultato sul file originale (facendo una copia\n"
+"                 di backup se si fornisce un'estensione)\n"
+"  -l N, --line-length=N\n"
+"                 specifica la lunghezza delle linee generate dal comando "
+"`l'\n"
+"  -r, --regexp-extended\n"
+"                 usa la sintassi di `egrep' per le espressioni regolari\n"
+"%s  -s, --separate\n"
+"                 considera i file di input come separati invece che come un\n"
+"                 unico file lungo.\n"
+"  -u, --unbuffered\n"
+"                 carica e visualizza i dati una a pezzetti piu' piccoli     "
+"--help      mostra questo aiuto ed esce\n"
+"     --version   stampa le informazioni sulla versione ed esce\n"
 "\n"
 "Se non  usata nessuna delle opzioni -e, --expression, -f o --file allora "
 "il\n"
@@ -351,7 +286,7 @@
 "\n"
 
 # sed/sed.c:132
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -361,29 +296,28 @@
 "Assicurarsi di includere la parola ``%s'' nell'oggetto del messaggio.\n"
 
 # sed/sed.c:255
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed versione %s\n"
 
 # sed/sed.c:256
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"basato su GNU sed versione %s\n"
+"basato su GNU sed 3.02.80\n"
 "\n"
 
 # sed/sed.c:258
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versione %s\n"
 
 # sed/sed.c:260
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -397,20 +331,14 @@
 "NON c' garanzia; neppure di COMMERCIABILITA' o IDONEITA' AD UN PARTICOLARE\n"
 "SCOPO, nei limiti permessi dalla legge.\n"
 
-# sed/execute.c:516
-#: lib/utils.c:98 lib/utils.c:336
-#, c-format
-msgid "cannot remove %s: %s"
-msgstr "impossibile rimuovere %s: %s"
-
 # lib/utils.c:131
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, c-format
-msgid "couldn't open file %s: %s"
-msgstr "impossibile aprire il file %s: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "Impossibile aprire il file %s: %s"
 
 # lib/utils.c:161
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
@@ -418,103 +346,92 @@
 msgstr[1] "Impossibile scrivere %d elementi su %s: %s"
 
 # lib/utils.c:176
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "errore di lettura su %s: %s"
 
-# sed/execute.c:516
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "impossibile rinominare %s: %s"
-
 # lib/regcomp.c:179
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Successo"
 
 # lib/regcomp.c:182
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Nessuna corrispondenza trovata"
 
 # lib/regcomp.c:185
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Espressione regolare non valida"
 
 # lib/regcomp.c:188
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Carattere di ordinamento non valido"
 
 # lib/regcomp.c:191
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nome non valido per una classe di caratteri"
 
 # lib/regcomp.c:194
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Barra rovesciata alla fine dell'espressione regolare"
 
 # lib/regcomp.c:197
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Riferimento non valido"
 
 # lib/regcomp.c:200
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "`[' non bilanciata"
 
 # lib/regcomp.c:203
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "`(' o `\\(' non bilanciata"
 
 # lib/regcomp.c:206
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "`\\{' non bilanciata"
 
 # lib/regcomp.c:209
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "numero di ripetizioni specificato tra graffe non valido"
 
 # lib/regcomp.c:212
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Fine dell'intervallo non valida"
 
 # lib/regcomp.c:215
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Memoria esaurita"
 
 # lib/regcomp.c:218
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Espressione regolare precedente non valida"
 
 # lib/regcomp.c:221
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Fine prematura dell'espressione regolare"
 
 # lib/regcomp.c:224
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Espressione regolare troppo grande"
 
 # lib/regcomp.c:227
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "`)' o `\\)' non bilanciata"
-
-# lib/regcomp.c:658 sed/regex.c:47
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Occorre un'espressione regolare precedente"
--- 4.1.4/po/ja.po
+++ 4.0.9/po/ja.po
@@ -1,6 +1,6 @@
 # Japanese messages for GNU sed
-# Copyright (C) 1999, 2002, 2003, 2004 Free Software Foundation, Inc.
-# IIDA Yosiaki <iida@gnu.org>, 1999, 2002, 2003, 2004.
+# Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
+# IIDA Yosiaki <iida@gnu.org>, 1999, 2002, 2003.
 # This file is distributed under the same license as the GNU sed package.
 # Contributed by
 # Yasuyuki Furukawa <yasu@on.cs.keio.ac.jp>, 1999.
@@ -9,8 +9,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: GNU sed 4.0.6\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-04-21 23:53+0900\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-03-25 21:22+0900\n"
 "Last-Translator: IIDA Yosiaki <iida@gnu.org>\n"
 "Language-Team: Japanese <translation-team-ja@lists.sourceforge.net>\n"
 "MIME-Version: 1.0\n"
@@ -19,186 +19,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=1; plural=0;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "+N~N"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr ""
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "\\aci"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}'"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ":"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr ""
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr ""
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr ""
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "regex"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "`s'"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "`y'"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "`s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "`s'`p'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "`s'`g'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "`s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "`s'"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "y"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr ""
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "savchar() (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr ":"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s:  %s %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e  #%lu,  %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "`%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: %s: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "%s: %s"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "%s: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr ": "
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr ": %s: %s"
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "e"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "e"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr ":  %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr ""
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "s\\%d"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -206,96 +183,34 @@
 "  -R, --regexp-perl\n"
 "                 Perl 5\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 Perl 5\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -303,8 +218,35 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+": %s []... {()} []...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 \n"
+"  -e , --expression=\n"
+"                 \n"
+"  -f script-file, --file=script-file\n"
+"  -f , --file=\n"
+"                 \n"
+"  -i[], --in-place[=]\n"
+"                  ("
+")\n"
+"  -l N, --line-length=N\n"
+"                 `l'\n"
+"  -r, --regexp-extended\n"
+"                 \n"
+"%s  -s, --separate\n"
+"                 \n"
+"  -u, --unbuffered\n"
+"                 \n"
+"      --help     \n"
+"  -V, --version  \n"
+"\n"
+"-e--expression-f--file\n"
+"sed\n"
+"\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -313,28 +255,27 @@
 ": %s\n"
 "``Subject:''``%s''\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "GNU sed 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 "GNU sed %s\n"
 "\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -355,101 +296,87 @@
 "\n"
 "\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "%s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "%d%s: %s"
 msgstr[1] "%d%s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "%s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr ""
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[[^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "(\\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "\\{\\}\""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr ""
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr ""
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr ""
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ")\\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr ""
--- 4.1.4/po/ko.po
+++ 4.0.9/po/ko.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: GNU sed 3.02.80\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2001-10-12 17:26+0900\n"
 "Last-Translator: Jong-Hoon Ryu <redhat4u@netian.com>\n"
 "Language-Team: Korean <ko@li.org>\n"
@@ -14,276 +14,196 @@
 "Content-Transfer-Encoding: 8bit\n"
 "Report-Msgid-Bugs-To: \n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!'  "
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr " `,'   "
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "  '+N'  '~N'    "
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{'   "
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr " `}'   "
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "   "
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr ""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}'     "
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ":     "
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "     "
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "  "
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "     "
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "   "
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "`s'   "
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "`y'   "
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "`s'      "
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "`s'  `p'   "
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "`s'  `g'   "
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "`s'     "
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "`s'    '0'    "
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "`y'    "
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr " (modifier)   "
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "  pushback (%x)   savchar()  "
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "   :"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: %s  %lu  : %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e expression #%lu, char %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "`%s' ()     "
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: %s ()   : %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "%s    "
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "%s    "
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "%s    "
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr " :   "
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr ""
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr ""
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr " : %c ()  "
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr ""
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
 
-#: sed/sed.c:98
-#, c-format
+#: sed/sed.c:100
+#, fuzzy, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -291,8 +211,28 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+": %s []... {-  } [-]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                      \n"
+"  -e , --expression=\n"
+"                    \n"
+"  -f -, --file=-\n"
+"                   -  \n"
+"  -l , --line-length=\n"
+"                 `l'  (line-wrap)  \n"
+"  -u, --unbuffered\n"
+"\n"
+"      --help        \n"
+"  -V, --version      \n"
+"\n"
+" -e, --expression, -f, --file     -\n"
+"   sed   .      \n"
+"   ;      \n"
+"   .\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -301,24 +241,23 @@
 "  E-mail : %s .\n"
 "``Subject:''   ``%s''    .\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -331,105 +270,106 @@
 " .        \n"
 "        .\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: %s ()   : %s\n"
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+msgid "Couldn't open file %s: %s"
 msgstr "%s    "
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, fuzzy, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "%2$s  %1$d (item)   : %3$s"
 msgstr[1] "%2$s  %1$d (item)   : %3$s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "%s    : %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: %s ()   : %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr ""
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 #, fuzzy
 msgid "Unmatched [ or [^"
 msgstr "`{'   "
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 #, fuzzy
 msgid "Unmatched ( or \\("
 msgstr "`{'   "
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 #, fuzzy
 msgid "Unmatched \\{"
 msgstr "`{'   "
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr ""
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr ""
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr ""
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 #, fuzzy
 msgid "Unmatched ) or \\)"
 msgstr "`{'   "
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr ""
+#~ msgid "Invalid use of address modifier"
+#~ msgstr " (modifier)   "
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr " (EOF) "
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr " : %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "   : %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "%s  (item)   : %s"
--- 4.1.4/po/nl.po
+++ 4.0.9/po/nl.po
@@ -1,301 +1,211 @@
-# Dutch translation of sed.
-# Copyright (C) 2004 Free Software Foundation, Inc.
-# This file is distributed under the same license as the sed package.
-# Elros Cyriatan <cyriatan@fastmail.fm>, 2004.
-# 
-# 
+# Dutch messages for GNU sed.
+# Copyright (C) 1998 Free Software Foundation, Inc.
+# Ivo Timmermans <itimmermans@bigfoot.com>, 2000.
+# Erick Branderhorst <Erick.Branderhorst@asml.nl>, 1998.
+#
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.0.9\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-04-09 21:39+0200\n"
-"Last-Translator: Elros Cyriatan <cyriatan@fastmail.fm>\n"
-"Language-Team: Dutch <vertaling@nl.linux.org>\n"
+"Project-Id-Version: sed 3.02a\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2002-10-25 01:08-04:00\n"
+"Last-Translator: Ivo Timmermans <itimmermans@bigfoot.com>\n"
+"Language-Team: Dutch <nl@li.org>\n"
 "MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=UTF-8\n"
-"Content-Transfer-Encoding: 8bit\n"
+"Content-Type: text/plain; charset=iso-8859-1\n"
+"Content-Transfer-Encoding: 8-bit\n"
 "Report-Msgid-Bugs-To: \n"
-"Plural-Forms: nplurals=2; plural=n != 1;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Meerdere `!'s"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Onverwachte `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
-msgstr "Kan niet +N of ~N als eerste adres gebruiken"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
+msgstr "U kunt +N of ~N niet als eerste adres gebruiken"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
-msgstr "Niet-overeenkomende `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
+msgstr "Onvergezelde `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Onverwachte `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Extra tekens na opdracht"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
-msgstr "Verwachtte \\ na `a', `c' of `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr ""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' wil geen adressen"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": wil geen adressen"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
-msgstr "Opmerkingen accepteren geen adres"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "Commentaren accepteren geen adressen"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
-msgstr "Ontbrekende opdracht"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Ontbrekend commando"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
-msgstr "Opdracht gebruikt slechts n adres"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "Commando gebruikt slechts een adres"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
-msgstr "Niet-afgemaakt adres reguliere uitdrukking"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "Onbeindigde reguliere expressie met adres"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
-msgstr "Niet-afgemaakte `s'-opdracht"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "`s' commando zonder einde"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
-msgstr "Niet-afgemaakte `y'-opdracht"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "`y' commando zonder einde"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Onbekende optie voor `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
-msgstr "meerdere `p'-opties voor `s'-opdracht"
+msgstr "meerdere `p' opties bij een `s' commando"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
-msgstr "meerdere `g'-opties voor `s'-opdracht"
+msgstr "meerdere `g' opties bij een `s' commando"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
-msgstr "meerdere getalopties voor `s'-opdracht"
+msgstr "meerdere nummer opties voor `s' commando"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
-msgstr "getaloptie voor `s'-opdracht mag niet nul zijn"
+msgstr "nummer optie voor `s' commando mag geen nul zijn"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
-msgstr "tekenreeksen voor `y'-opdracht zijn van verschillende lengte"
-
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "tekenreeksen voor y commando zijn van verschillende lengte"
 
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
-msgstr "verwachtte een nieuwere versie van sed"
+msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Opdracht gebruikt slechts n adres"
+# pushback?
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "savchar() aangeroepen met onverwachte pushback (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Onbekende opdracht:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: bestand %s regel %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
-msgstr "%s: -e uitdrukking #%lu, teken %lu: %s\n"
+msgstr "%s: -e expressie #%lu, teken %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "Kan label voor sprong naar `%s' niet vinden"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
+msgstr "Kan geen label vinden voor sprong naar `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: kan %s niet lezen: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Kon bestand %s niet openen: %s"
+msgid "Couldn't open temporary file %s: %s"
+msgstr "Kan bestand %s niet openen"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Kon bestand %s niet openen: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Kon tijdelijk bestand %s niet openen: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERNE FOUT: onjuist adres type"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
-msgstr "fout in deelproces"
+msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
-msgstr "optie `e' niet ondersteund"
+msgstr ""
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
-msgstr "`e'-opdracht niet ondersteund"
+msgstr ""
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
-msgstr "Geen eerdere reguliere uitdrukking"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERNE FOUT: Onjuist cmd %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "Geen voorgaande reguliere expressie"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
-msgstr "Kan geen veranderaars opgeven op lege reguliere uitdrukking"
+msgid "Cannot specify modifiers on empty regexp"
+msgstr ""
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "Ongeldige verwijzing \\%d op rechterhandzijde van `s'-opdracht"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
-"  -R, --regexp-perl\n"
-"                 de syntaxis van Perl 5 voor reguliere uitdrukkingen "
-"gebruiken in het script.\n"
 
-#: sed/sed.c:98
-#, c-format
+#: sed/sed.c:100
+#, fuzzy, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 de syntaxis van Perl 5 voor reguliere uitdrukkingen "
-"gebruiken in het script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -303,37 +213,52 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Aanroep: %s [OPTIE]... {script-indien-geen-ander-script} [invoer-"
+"bestand]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 onderdruk automatisch afdrukken van de patroonruimte\n"
+"  -e script, --expression=script\n"
+"                 voeg het script toe aan de uit te voeren opdrachten\n"
+"  -f script-file, --file=script-bestand\n"
+"                 voeg de inhoud van script-bestand toe aan de uit te\n"
+"                 voeren opdrachten\n"
+"      --help     toon deze hulptekst en beindig het programma\n"
+"  -V, --version  toon versie informatie en beindig het programma\n"
+"\n"
+"Als geen -e, --expression, -f, of --file optie is gegeven, zal het\n"
+"eerste niet-optie argument gebruikt worden als een te interpreteren\n"
+"sed-script.  Alle overblijvende argumenten zijn namen van\n"
+"invoerbestanden; indien geen invoerbestanden gegeven zijn, wordt de\n"
+"standaard invoer gelezen.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
 "Be sure to include the word ``%s'' somewhere in the ``Subject:'' field.\n"
 msgstr ""
-"Stuur foutrapporten naar: %s .\n"
-"Zorg ervoor dat het woord ``%s'' ergens in het ``Onderwerp:''-veld staat.\n"
-"Rapporteer fouten in de vertalingen bij <vertaling@nl.linux.org>.\n"
+"E-mail foutrapportages naar: %s .\n"
+"Vermeld het woord ``%s'' ergens in het ``Subject:'' veld.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
-msgstr "super-sed versie %s\n"
+msgstr ""
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"gebaseerd op GNU sed versie 3.02.80\n"
-"\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
-msgstr "GNU sed versie %s\n"
+msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -342,105 +267,114 @@
 "to the extent permitted by law.\n"
 msgstr ""
 "%s\n"
-"Dit is vrije software; zie de bron voor kopieervoorwaarden.  Er is GEEN\n"
-"garantie; zelfs niet voor VERHANDELBAARHEID of GESCHIKTHEID VOOR\n"
-"EEN BEPAALD DOEL, tot het uiterste dat door de wet wordt toegestaan.\n"
+"Dit is vrije programmatuur; zie de broncode voor distributie-\n"
+"voorwaarden.  Er is GEEN garantie; zelfs niet voor VERKOOPBAARHEID of\n"
+"GESCHIKTHEID VOOR EEN BEPAALD DOEL, zo ver als wettelijk mogelijk is.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
+#: lib/utils.c:126
 #, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: kan %s niet lezen: %s\n"
+msgid "Couldn't open file %s: %s"
+msgstr "Kan bestand %s niet openen"
 
-#: lib/utils.c:143
+#: lib/utils.c:160
 #, fuzzy, c-format
-msgid "couldn't open file %s: %s"
-msgstr "Kon bestand %s niet openen: %s"
-
-#: lib/utils.c:220
-#, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
-msgstr[0] "kon niet %d item naar %s schrijven: %s"
-msgstr[1] "kon niet %d item naar %s schrijven: %s"
+msgstr[0] "kan geen %d item%s schrijven naar %s: %s"
+msgstr[1] "kan geen %d item%s schrijven naar %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
-msgstr "leesfout op %s: %s"
-
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: kan %s niet lezen: %s\n"
+msgstr "lees fout bij %s: %s"
 
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
-msgstr "Succes"
+msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
-msgstr "Geen overeenkomst"
+msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
+#, fuzzy
 msgid "Invalid regular expression"
-msgstr "Ongeldige reguliere uitdrukking"
+msgstr "Geen voorgaande reguliere expressie"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
-msgstr "Ongeldig sorteerteken"
+msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
-msgstr "Ongeldige tekenklasse naam"
+msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
-msgstr "Backslash aan het einde"
+msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
-msgstr "Ongeldige terugverwijzing"
+msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
+#, fuzzy
 msgid "Unmatched [ or [^"
-msgstr "Niet-overeenkomende [ of [^"
+msgstr "Onvergezelde `{'"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
+#, fuzzy
 msgid "Unmatched ( or \\("
-msgstr "Niet-overeenkomende ( of \\("
+msgstr "Onvergezelde `{'"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
+#, fuzzy
 msgid "Unmatched \\{"
-msgstr "Niet-overeenkomende \\{"
+msgstr "Onvergezelde `{'"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
-msgstr "Ongeldige inhoud van \\{\\}"
+msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
-msgstr "Ongeldig bereikeinde"
+msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
-msgstr "Geheugen uitgeput"
+msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
+#, fuzzy
 msgid "Invalid preceding regular expression"
-msgstr "Ongeldige voorafgaande reguliere uitdrukking"
+msgstr "Geen voorgaande reguliere expressie"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
+#, fuzzy
 msgid "Premature end of regular expression"
-msgstr "Vroegtijdig einde van reguliere uitdrukking"
+msgstr "Geen voorgaande reguliere expressie"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
+#, fuzzy
 msgid "Regular expression too big"
-msgstr "Reguliere uitdrukking te groot"
+msgstr "Geen voorgaande reguliere expressie"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
+#, fuzzy
 msgid "Unmatched ) or \\)"
-msgstr "Niet-overeenkomende ) of \\)"
+msgstr "Onvergezelde `{'"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Geen eerdere reguliere uitdrukking"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Ongeldig gebruik van adresindicator"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Onverwacht Bestandseinde"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "foutieve reguliere expressie: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "invoer leesfout: %s"
+
+#~ msgid "Zero step size for ~ addressing is not valid"
+#~ msgstr "Nul stap grootte voor ~ adressen is niet geldig"
--- 4.1.4/po/pl.po
+++ 4.0.9/po/pl.po
@@ -1,13 +1,13 @@
 # Polish translations for GNU sed package.
-# Copyright (C) 2003, 2004 Free Software Foundation, Inc.
-# Wojciech Polak <polak@gnu.org>, 2003, 2004.
+# Copyright (C) 2003 Free Software Foundation, Inc.
+# Wojciech Polak <polak@gnu.org>, 2003.
 # corrections: Jakub Bogusz <qboosh@pld-linux.org>, 2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.1.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-07-08 19:58+0200\n"
+"Project-Id-Version: sed 4.0.8\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-10-25 01:24+0200\n"
 "Last-Translator: Wojciech Polak <polak@gnu.org>\n"
 "Language-Team: Polish <translation-team-pl@lists.sourceforge.net>\n"
 "MIME-Version: 1.0\n"
@@ -17,168 +17,163 @@
 "Plural-Forms: nplurals=3; plural=(n==1 ? 0 : n%10>=2 && n%10<=4 && (n%100<10 "
 "|| n%100>=20) ? 1 : 2);\n"
 
-#: sed/compile.c:162
-msgid "multiple `!'s"
-msgstr "wielokrotny znak `!'"
-
-#: sed/compile.c:163
-msgid "unexpected `,'"
-msgstr "nieoczekiwany znak `,'"
-
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
-msgstr "nieprawidowe uycie +N lub ~N jako pierwszego adresu"
-
-#: sed/compile.c:165
-msgid "unmatched `{'"
-msgstr "niedopasowany znak `{'"
-
-#: sed/compile.c:166
-msgid "unexpected `}'"
-msgstr "nieoczekiwany znak `}'"
-
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "dodatkowe znaki po poleceniu"
-
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
-msgstr "oczekiwano znaku \\ po `a', `c' lub `i'"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
+msgstr "Wielokrotny znak `!'"
+
+#: sed/compile.c:173
+msgid "Unexpected `,'"
+msgstr "Nieoczekiwany znak `,'"
+
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
+msgstr "Nie mona uywa +N lub ~N jako pierwszego adresu"
+
+#: sed/compile.c:175
+msgid "Unmatched `{'"
+msgstr "Niedopasowany znak `{'"
+
+#: sed/compile.c:176
+msgid "Unexpected `}'"
+msgstr "Nieoczekiwany znak `}'"
 
-#: sed/compile.c:169
+#: sed/compile.c:177
+msgid "Extra characters after command"
+msgstr "Dodatkowe znaki po poleceniu"
+
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr "Oczekiwano znaku \\ po `a', `c' lub `i'"
+
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' nie chce adnych adresw"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": nie chce adnych adresw"
 
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "komentarze nie akceptuj adnych adresw"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "Komentarze nie akceptuj adnych adresw"
 
-#: sed/compile.c:172
-msgid "missing command"
-msgstr "brakuje polecenia"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Brakuje polecenia"
 
-#: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "polecenie uywa tylko jednego adresu"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "Polecenie uywa tylko jednego adresu"
 
-#: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "niezakoczony adres wyraenia regularnego"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "Niezakoczony adres wyraenia regularnego"
 
-#: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "niezakoczone polecenie `s'"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "Niezakoczone polecenie `s'"
 
-#: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "niezakoczone polecenie `y'"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "Niezakoczone polecenie `y'"
 
-#: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "nieznana opcja dla polecenia `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "Nieznana opcja dla polecenia `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "wielokrotne opcje `p' dla polecenia `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "wielokrotne opcje `g' dla polecenia `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "wielokrotne opcje liczbowe dla polecenia `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "opcja liczbowa dla polecenia `s' nie moe by zerem"
 
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
-msgstr "acuchy dla polecenia `y' s rnych dugoci"
-
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "znak ogranicznika nie jest pojedynczym znakiem-bajtem"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "acuchy dla polecenia y s rnych dugoci"
 
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "oczekiwano nowszej wersji programu sed"
 
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "nieprawidowe uycie adresu linii 0"
-
-#: sed/compile.c:186
+#: sed/compile.c:236
 #, c-format
-msgid "unknown command: `%c'"
-msgstr "nieznane polecenie: `%c'"
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Wywoano funkcj savchar() z nieoczekiwanym zwrotem (%x)"
+
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr "Nieznane polecenie:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: plik %s linia %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e wyraenie #%lu, znak %lu: %s\n"
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "nie mona znale etykiety dla skoku do `%s'"
+msgid "Can't find label for jump to `%s'"
+msgstr "Nie mona znale etykiety dla skoku do `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: nie mona odczyta %s: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "nie mona edytowa %s: plik jest terminalem"
+msgid "Couldn't open temporary file %s: %s"
+msgstr "Nie mona otworzy tymczasowego pliku %s: %s"
 
-#: sed/execute.c:676
-#, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "nie mona edytowa %s: to nie jest regularny plik"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "nie mona otworzy tymczasowego pliku %s: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "WEWNTRZNY BD: nieprawidowy typ adresu"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "bd w podprocesie"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "opcja `e' nie jest wspierana"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "polecenie `e' nie jest wspierane"
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "brak poprzedniego wyraenia regularnego"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "WEWNTRZNY BD: Nieprawidowe polecenie %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "Brak poprzedniego wyraenia regularnego"
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
-msgstr "nie mona wyszczeglni modyfikatorw w pustym wyraeniu regularnym"
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "Nie mona wyszczeglni modyfikatorw w pustym wyraeniu regularnym"
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "nieprawidowe odwoanie \\%d po prawej stronie polecenia `s'"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "Nieprawidowe odwoanie \\%d po prawej stronie polecenia `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -187,119 +182,34 @@
 "                 uywa w skrypcie wyraenia regularne zgodne ze skadni "
 "Perl 5.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-"Uycie: %s [OPCJE] {skrypt-tylko-wtedy-gdy-aden-inny-skrypt} [plik-"
-"wejciowy]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                 powstrzymuje automatyczne drukowanie przetwarzanych linii.\n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e skrypt, --expression=skrypt\n"
-"                 dodaje skrypt do polece, ktre maj by wykonane.\n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f plik-skryptowy, --file=plik-skryptowy\n"
-"                 dodaje zawarto pliku skryptowego do polece,\n"
-"                 ktre maj by wykonane.\n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[rozszerzenie], --in-place[=rozszerzenie]\n"
-"                 edytuje pliki \"w miejscu\" (tworzy kopie zapasowe\n"
-"                 jeeli zostao podane rozszerzenie).\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                 ustala podan dugo amanych linii dla polecenia `l'.\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"      --posix\n"
-"                 wycza wszystkie rozszerzenia GNU.\n"
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                 uywa w skrypcie rozszerzonych wyrae regularnych.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                 traktuje pliki jako oddzielne, a nie jako pojedynczy,\n"
-"                 dugi i cigy strumie.\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                 aduje minimaln ilo danych z plikw wejciowych\n"
-"                 i czciej oczyszcza bufor wyjciowy.\n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help     wywietla t oto pomoc i koczy prac.\n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr "      --version  wywietla numer wersji i koczy prac.\n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -307,6 +217,31 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Uycie: %s [OPCJE] {skrypt-tylko-wtedy-gdy-aden-inny-skrypt} [plik-"
+"wejciowy]\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 powstrzymuje automatyczne drukowanie przetwarzanych linii.\n"
+"  -e script, --expression=skrypt\n"
+"                 dodaje skrypt do polece, ktre maj by wykonane.\n"
+"  -f script-file, --file=plik-skryptowy\n"
+"                 dodaje zawarto pliku skryptowego do polece,\n"
+"                 ktre maj by wykonane.\n"
+"  -i[rozszerzenie], --in-place[=rozszerzenie]\n"
+"                 edytuje pliki \"w miejscu\" (tworzy kopie zapasowe\n"
+"                 jeeli zostao podane rozszerzenie).\n"
+"  -l N, --line-length=N\n"
+"                 ustala podan dugo amanych linii dla polecenia `l'.\n"
+"  -r, --regexp-extended\n"
+"                 uywa w skrypcie rozszerzonych wyrae regularnych.\n"
+"%s  -s, --separate\n"
+"                 traktuje pliki jako oddzielne, a nie jako pojedynczy,\n"
+"                 cigy i dugi strumie.\n"
+"  -u, --unbuffered\n"
+"                 aduje minimaln ilo danych z plikw wejciowych\n"
+"                 i czciej oczyszcza bufor wyjciowy.\n"
+"      --help     wywietla t oto pomoc i koczy prac.\n"
+"  -V, --version  wywietla numer wersji i koczy prac.\n"
 "\n"
 "Jeeli nie zostan podane opcje -e, --expression, -f, lub --file,\n"
 "to wtedy pierwszy argument, ktry nie jest opcj linii polece sed,\n"
@@ -315,7 +250,7 @@
 "adne pliki wejciowe, to wtedy odczytane zostanie standardowe wejcie.\n"
 "\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -324,26 +259,25 @@
 "Ewentualne bdy prosimy zgasza na adres: %s\n"
 "W tym celu prosz doda sowo ``%s'' do tematu listu.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed wersja %s\n"
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"na podstawie wersji GNU sed %s\n"
+"na podstawie wersji GNU sed 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed wersja %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -357,17 +291,12 @@
 "w rdach. Autorzy nie daj ADNYCH gwarancji, w tym rwnie gwarancji\n"
 "PRZYDATNOCI DO SPRZEDAY LUB DO KONKRETNYCH CELW.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, c-format
-msgid "cannot remove %s: %s"
-msgstr "nie mona usun %s: %s"
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, c-format
-msgid "couldn't open file %s: %s"
-msgstr "nie mona otworzy pliku %s: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "Nie mona otworzy pliku %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
@@ -375,84 +304,75 @@
 msgstr[1] "nie mona zapisa %d elementw do %s: %s"
 msgstr[2] "nie mona zapisa %d elementw do %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "bd odczytu w %s: %s"
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "nie mona zmieni nazwy %s: %s"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Sukces"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Brak dopasowania"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Nieprawidowe wyraenie regularne"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Nieprawidowy znak porwnania"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nieprawidowa nazwa klasy znaku"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Kocowy znak backslash"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Nieprawidowe odwoanie wsteczne"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Niedopasowany znak [ lub [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Niedopasowany znak ( lub \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Niedopasowany znak \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Nieprawidowa zawarto \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Nieprawidowy koniec zakresu"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Pami wyczerpana"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Nieprawidowe poprzedzajce wyraenie regularne"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Przedwczesny koniec wyraenia regularnego"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Wyraenie regularne jest zbyt due"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Niedopasowany znak ) lub \\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Brak poprzedniego wyraenia regularnego"
--- 4.1.4/po/pt_BR.po
+++ 4.0.9/po/pt_BR.po
@@ -8,7 +8,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2002-11-08 17:44-0300\n"
 "Last-Translator: Aurlio Marinho Jargas <aurelio@verde666.org>\n"
 "Language-Team: Brazilian Portuguese <ldp-br@bazar.conectiva.com.br>\n"
@@ -18,186 +18,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n > 1);\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Exclamaes `!' mltiplas"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Vrgula `,' inesperada"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "No use +N ou ~N como o primeiro endereo"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' no terminada"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' inesperada"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "H caracteres sobrando aps o comando"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Deve haver um escape \\ depois dos comandos `a', `c' e `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' no recebe endereos"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr "`:' no recebe endereos"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Comentrios no aceitam endereos"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Falta especificar um comando ao endereo"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Este comando usa apenas um endereo"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "A expresso regular do endereo est inacabada (falta a /)"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Comando `s' inacabado (s/// - faltou delimitador)"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Comando `y' inacabado (y/// - faltou delimitador)"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Opo desconhecida para o comando `s' (s///?)"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "opes `p' mltiplas para o comando `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "opes `g' mltiplas para o comando `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "opes numricas mltiplas para o comando `s' (s///n)"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "A opo numrica para o comando `s' no pode ser zero (s///0)"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "Os textos para o comando `y' tm tamanhos diferentes (y/abc/z/)"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Uso incorreto do modificador de endereo"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Foi chamado savchar() com um retorno (%x) no esperado"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Comando desconhecido:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: arquivo %s linha %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e expresso #%lu, caractere %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "No foi possvel encontrar a marcao `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: no foi possvel ler %s: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "No foi possvel abrir o arquivo %s: %s"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "No foi possvel abrir o arquivo %s: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "ERRO INTERNO: tipo invlido de endereo"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "No foi possvel abrir o arquivo %s: %s"
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "erro no subprocesso"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "opo `e' no suportada"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "comando `e' no suportado"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "ERRO INTERNO: Comando invlido %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "No h expresso regular anterior"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "No  permitido especificar modificadores numa expresso regular vazia"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Referncia invlida \\%d na segunda parte do comando `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -205,96 +182,34 @@
 "  -R, --regexp-perl\n"
 "                 usar sintaxe de expresses regulares do Perl 5 no script.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 usar sintaxe de expresses regulares do Perl 5 no script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -302,8 +217,40 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Uso: %s [OPO]... {script-apenas-se-for-nico} [arquivo-entrada]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 suprime a impresso automtica do espao-do-padro\n"
+"  -e script, --expression=script\n"
+"                 adiciona o script aos comandos a serem executados\n"
+"  -f arquivo-script, --file=arquivo-script\n"
+"                 adiciona o contedo do arquivo-script aos comandos\n"
+"                 a serem executados\n"
+"  -i[suffix], --in-place[=suffix]\n"
+"                 altera os prprios arquivos (faz backup se extenso "
+"fornecida)\n"
+"  -l N, --line-length=N\n"
+"                 determina comprimento da quebra de linha para comando `l'\n"
+"  -r, --regexp-extended\n"
+"                 usar expresses regulares estendidas no script.\n"
+"%s  -s, --separate\n"
+"                 considera arquivos como entidades separadas, e no como um\n"
+"                 longo e nico fluxo de dados.\n"
+"  -u, --unbuffered\n"
+"                 carrega uma quantidade mnima de dados dos arquivos de "
+"entrada\n"
+"                 e descarrega os buffers de sada com mais freqncia\n"
+"      --help     mostra esta ajuda e sai\n"
+"  -V, --version  mostra informaes sobre a verso e sai\n"
+"\n"
+"Se nenhuma opo -e, --expression, -f, ou --file  dada, o primeiro\n"
+"argumento que no seja uma opo  considerado como o script sed a ser\n"
+"interpretado. Todos os argumentos restantes so considerados como\n"
+"nomes de arquivos de entrada. Caso nenhum arquivo de entrada seja\n"
+"especificado, ento a entrada padro ser lida.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -312,26 +259,25 @@
 "Envie relatrios de erros (em ingls) para: %s .\n"
 "Inclua a palavra ``%s'' no campo ``Assunto:'' ou ``Subject:''.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed verso %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "baseado no GNU sed verso 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed verso %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -344,101 +290,93 @@
 "de cpia.  NO h garantias, nem mesmo para os aspectos mercantis ou de\n"
 "atendimento a finalidades especficas, tanto quanto a lei permita.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: no foi possvel ler %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "No foi possvel abrir o arquivo %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "no foi possvel escrever %d item para %s: %s"
 msgstr[1] "no foi possvel escrever %d items para %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "erro de leitura em %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: no foi possvel ler %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Sucesso"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Nada encontrado"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Expresso regular invlida"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Caractere de ordenao invlido"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nome invlido de classe de caracteres"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Escape \\ no final"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Retrovisor \\n invlido"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[ ou [^ no terminado"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "( ou \\( no terminado"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ no terminado"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Contedo invlido no \\{\\} (permitidos nmeros e vrgula)"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Fim de intervalo (range) invlido"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Falta de memria"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Expresso regular anterior invlida"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Fim prematuro da expresso regular"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Expresso regular grande demais"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ") or \\) inesperado"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "No h expresso regular anterior"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Uso incorreto do modificador de endereo"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Fim-de-arquivo inesperado"
--- 4.1.4/po/ro.po
+++ 4.0.9/po/ro.po
@@ -7,7 +7,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0.8\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-11-22 12:00-0500\n"
 "Last-Translator: Laurentiu Buzdugan <buzdugan@voyager.net>\n"
 "Language-Team: Romanian <translation-team-ro@lists.sourceforge.net>\n"
@@ -17,186 +17,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n != 1);\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "`!'-uri multiple"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "`,' neateptat"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Nu se poate folosi +N i ~N ca prima adres"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "`{' fr pereche"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "`}' neateptat"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Extra caractere dup comand"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Este ateptat \\ dup `a', `c' sau `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' nu vrea nici o adres"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": nu vrea nici o adres"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Comentariile nu accept nici o adres"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Comand absent"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Comanda folosete numai o adres"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Adres regex neterminat"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Comand `s' neterminat"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Comand `y' neterminat"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Opiune necunoscut pentru `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "multiple opiuni `p' pentru comanda `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "multiple opiuni `g' pentru comanda `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "numr multiplu de opiuni pentru comanda `s'"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "numrul de opiuni pentru comanda `s' nu poate fi zero"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "irurile pentru comanda y au lungimi diferite"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "am ateptat o versiune mai recent de sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Comanda folosete numai o adres"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "savchar() a fost chemat cu pushback (%x) neateptat"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Comand necunoscut:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fiierul %s linia %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e expresia #%lu, caracterul %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Nu pot gsi eticheta pentru saltul la `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: nu pot citi %s: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Nu am putut deschide fiierul %s: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Nu am putut deschide fiierul %s: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Nu am putut deschide fiierul temporar %s: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "EROARE INTERN: tip de adres incorect"
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "eroare n subproces"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "opiunea `e' nu e suportat"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "comanda `e' nu e suportat"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "EROARE INTERN: comand incorect %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Nici o expresie regular anterioar"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Nu se pot specifica modificatori pentru regexp vid"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Referin invalid \\%d pentru RHS-ul comanzii `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -205,97 +182,34 @@
 "                folosete sintaxa expresiilor regulare din Perl 5 n "
 "script.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                folosete sintaxa expresiilor regulare din Perl 5 n "
-"script.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -303,8 +217,40 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Folosire: %s [OPIUNE]... {script-doar-dac-nici-un-alt-script} [fiier-"
+"intrare]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 elimin tiprire automat a spaiului de model (pattern)\n"
+"  -e script, --expression=script\n"
+"                 adaug scriptul la comenzile de executat\n"
+"  -f script-file, --file=script-file\n"
+"                 adaug coninutul fiierului-script la comenzile de "
+"executat\n"
+"  -i[suffix], --in-place[=suffix]\n"
+"                 editeaz fiierele pe loc (creaz backup dac extensia e "
+"specificat)\n"
+"  -l N, --line-length=N\n"
+"                 specific lungimea liniei pentru wrap pentru comanda `l'\n"
+"  -r, --regexp-extended\n"
+"                 folosete expresii regulare extinse n script.\n"
+"%s  -s, --separate\n"
+"                 consider fiierele ca separate n loc de un singur stream\n"
+"                 lung, continuu\n"
+"  -u, --unbuffered\n"
+"                 ncarc cantiti minime de date din fiierele de intrare\n"
+"                 i descarc (flush) buferele de ieire mai des\n"
+"      --help     afieaz acest mesaj i termin\n"
+"  -V, --version  afieaz informaia despre versiune i termin\n"
+"\n"
+"Dac nici una din opiunile -e, --expression, -f, sau --file e dat, atunci\n"
+"este luat mai nti argumentul care nu e opiune drept script sed de\n"
+"interpretat. Toate celelalte argumente sunt nume de fiiere de intrare; "
+"dac\n"
+"nici un fiier de intrare nu a fost specificat, e citit intrarea standard.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -313,26 +259,25 @@
 "Raportai bug-uri prin e-mail la: %s .\n"
 "Fii siguri c includei ``%s'' undeva n cmpul ``Subject:''.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "versiunea super-sed %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "bazat pe GNU sed versiunea 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed versiunea %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -346,101 +291,87 @@
 "Nu exist NICI o garanie; nici mcar pentru VANDABILITATE sau POTRIVIRE \n"
 "PENTRU UN ANUME SCOP, conform legilor n vigoare.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: nu pot citi %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Nu am putut deschide fiierul %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "Nu am putut scrie %d articol n %s: %s"
 msgstr[1] "Nu am putut scrie %d articole n %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "eroare citire pentru %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: nu pot citi %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Succes"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Nici o potrivire"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Expresie regular incorect"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Colaiune de caractere incorect"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Nume de clas de caractere incorect"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Backslash n coad"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Referin napoi incorect"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "[ sau [^ fr pereche"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "( sau \\( fr pereche"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "\\{ fr pereche"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Coninut incorect pentru \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Sfrit de interval incorect"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Memorie epuizat"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Expresie regular precedent incorect"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Sfrit prematur al expresiei regulare"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Expresie regular prea mare"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ") sau \\) fr pereche"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Nici o expresie regular anterioar"
--- 4.1.4/po/ru.po
+++ 4.0.9/po/ru.po
@@ -1,304 +1,212 @@
-# Translation of sed-4.1.1.po to Russian
-# Copyright (C) 1998, 2004 Free Software Foundation, Inc.
+# Russian messages for sed.
+# Copyright (C) 1998 Free Software Foundation, Inc.
 # Const Kaplinsky <const@ce.cctpu.edu.ru>, 1998.
-# Pavel Maryanov <acid_jack@ukr.net>, 2004.
+# Andrew W. Nosenko <awn@bcs.zp.ua>, 2002-2003
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed-4.1.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-07-07 17:54+0300\n"
-"Last-Translator: Pavel Maryanov <acid_jack@ukr.net>\n"
+"Project-Id-Version: sed-4.0.5\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-01-15 18:51+0200\n"
+"Last-Translator: Andrew W. Nosenko <awn@bcs.zp.ua>\n"
 "Language-Team: Russian <ru@li.org>\n"
 "MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=KOI8-R\n"
+"Content-Type: text/plain; charset=koi8-r\n"
 "Content-Transfer-Encoding: 8bit\n"
 "Report-Msgid-Bugs-To: \n"
-"Plural-Forms: nplurals=2; plural=n>1;\n"
-"X-Generator: KBabel 1.3\n"
-
-#: sed/compile.c:162
-msgid "multiple `!'s"
-msgstr "  `!'"
-
-#: sed/compile.c:163
-msgid "unexpected `,'"
-msgstr "  `,'"
-
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
-msgstr " +N  ~N     "
-
-#: sed/compile.c:165
-msgid "unmatched `{'"
-msgstr "  `{'"
-
-#: sed/compile.c:166
-msgid "unexpected `}'"
-msgstr "  `}'"
-
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "   "
-
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
-msgstr " \\  `a', `c'  `i'"
-
-#: sed/compile.c:169
-msgid "`}' doesn't want any addresses"
-msgstr "`}'    - "
-
-#: sed/compile.c:170
-msgid ": doesn't want any addresses"
-msgstr "`:'    - "
-
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "    - "
+"Plural-Forms: nplurals=3; plural=(n%10==1 && n%100!=11 ? 0 : n%10>=2 && n%"
+"10<=4 && (n%100<10 || n%100>=20) ? 1 : 2);\n"
 
 #: sed/compile.c:172
-msgid "missing command"
-msgstr " "
+msgid "Multiple `!'s"
+msgstr "  `!'"
 
 #: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "    "
+msgid "Unexpected `,'"
+msgstr "  `,'"
 
 #: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "   "
+msgid "Cannot use +N or ~N as first address"
+msgstr " +N  ~N     "
 
 #: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "  `s'"
+msgid "Unmatched `{'"
+msgstr "  `{'"
 
 #: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "  `y'"
+msgid "Unexpected `}'"
+msgstr "  `}'"
 
 #: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "   `s'"
+msgid "Extra characters after command"
+msgstr "   "
 
 #: sed/compile.c:178
-msgid "multiple `p' options to `s' command"
-msgstr "  `p'   `s'"
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr " `a', `c'  `i'  `\\'"
 
 #: sed/compile.c:179
-msgid "multiple `g' options to `s' command"
-msgstr "  `g'   `s'"
+msgid "`}' doesn't want any addresses"
+msgstr "`}'    - "
 
 #: sed/compile.c:180
-msgid "multiple number options to `s' command"
-msgstr "     `s'"
+msgid ": doesn't want any addresses"
+msgstr "`:'    - "
 
 #: sed/compile.c:181
-msgid "number option to `s' command may not be zero"
-msgstr "    `s'    "
+msgid "Comments don't accept any addresses"
+msgstr "    - "
 
 #: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
-msgstr "   `y'   "
+msgid "Missing command"
+msgstr " "
 
 #: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "-    "
+msgid "Command only uses one address"
+msgstr "    "
 
 #: sed/compile.c:184
-msgid "expected newer version of sed"
-msgstr "    sed"
+msgid "Unterminated address regex"
+msgstr "   "
 
 #: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "    0"
+msgid "Unterminated `s' command"
+msgstr "  `s'"
 
 #: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "  `y'"
+
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "   `s'"
+
+#: sed/compile.c:188
+msgid "multiple `p' options to `s' command"
+msgstr "  `p'   `s'"
+
+#: sed/compile.c:189
+msgid "multiple `g' options to `s' command"
+msgstr "  `g'   `s'"
+
+#: sed/compile.c:190
+msgid "multiple number options to `s' command"
+msgstr "     `s'"
+
+#: sed/compile.c:191
+msgid "number option to `s' command may not be zero"
+msgstr "    `s'    "
+
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "    `y'  "
+
+#: sed/compile.c:193
+msgid "expected newer version of sed"
+msgstr ""
+
+#: sed/compile.c:236
 #, c-format
-msgid "unknown command: `%c'"
-msgstr " : `%c'"
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr " savchar()     (%x)   "
+
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr " :"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s:  %s  %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e  #%lu,  %lu: %s\n"
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "      `%s'"
+msgid "Can't find label for jump to `%s'"
+msgstr "      `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
-msgstr "%s:   %s: %s\n"
+msgstr "%s:   %s: %s\n"
 
-#: sed/execute.c:672
-#, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "  %s:  "
-
-#: sed/execute.c:676
-#, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "  %s:    "
-
-#: lib/utils.c:196 sed/execute.c:683
-#, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "    %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, fuzzy, c-format
+msgid "Couldn't open temporary file %s: %s"
+msgstr "    %s: %s"
+
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr " :   "
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
-msgstr "  "
+msgstr "   "
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
-msgstr " `e'  "
+msgstr " `e'  "
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr " `e'  "
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "   "
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr " :   `%c'"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "   "
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
-msgstr "      "
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "      "
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "  \\%d  RHS  `s'"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
-"  -R, --regexp-perl\n"
-"                       "
-"Perl 5.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-": %s []... {-----} "
-"[-]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                    \n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e script, --expression=script\n"
-"                     \n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f script-file, --file=script-file\n"
-"                   -   \n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[], --in-place[=]\n"
-"                     ( ,   "
-")\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                        `l'\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"  --posix\n"
-"                    GNU.\n"
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                      .\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                 ,   ,     \n"
-"                   .\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                       \n"
-"                        \n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help         \n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr "      --version       \n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -306,42 +214,66 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+": %s []... {-----} "
+"[-]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                     .\n"
+"  -e , --expression=\n"
+"                      \n"
+"  -f -, --file=-\n"
+"                        "
+".\n"
+"  -i[], --in-place[=]\n"
+"                   \" \" ( \n"
+"                 ,   )\n"
+"  -l N, --line-length=N\n"
+"                       \n"
+"                 (line-wrap)   `l'\n"
+"  -r, --regexp-extended\n"
+"                     \n"
+"%s  -s, --separate\n"
+"                    ,    \n"
+"                  \n"
+"  -u, --unbuffered\n"
+"                         \n"
+"                      \n"
+"      --help         \n"
+"  -V, --version       \n"
 "\n"
-"  -e, --expression, -f,  --file  ,  \n"
-"     sed  . \n"
-"     ;  \n"
-"  ,    .\n"
+"       -e, --expression, -f,  --file,\n"
+"  ,   ,    \n"
+"sed-  .      \n"
+" ;    ,     \n"
+"  .\n"
 "\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
 "Be sure to include the word ``%s'' somewhere in the ``Subject:'' field.\n"
 msgstr ""
-"     : %s .\n"
-",   -   ``:''  ``%s''.\n"
+"     : %s .\n"
+"  ,       ``%s''.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
-msgstr "super-sed  %s\n"
+msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"  GNU sed  %s\n"
-"\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
-msgstr "GNU sed  %s\n"
+msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -350,106 +282,93 @@
 "to the extent permitted by law.\n"
 msgstr ""
 "%s\n"
-"   ;     \n"
-" .    ;  \n"
-"       ,   ,\n"
-"      .\n"
-
-#: lib/utils.c:98 lib/utils.c:336
-#, c-format
-msgid "cannot remove %s: %s"
-msgstr "  %s: %s"
+"  --   ;   \n"
+"   .    ; \n"
+"       ,\n"
+"  ,       .\n"
 
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, c-format
-msgid "couldn't open file %s: %s"
-msgstr "   %s: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "    %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
-msgstr[0] "  %d   %s: %s"
-msgstr[1] "  %d   %s: %s"
+msgstr[0] "   %d   %s: %s"
+msgstr[1] "   %d   %s: %s"
+msgstr[2] "   %d   %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "  %s: %s"
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "  %s: %s"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
-msgstr ""
+msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
-msgstr " "
+msgstr "  "
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
-msgstr "  "
+msgstr "  "
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
-msgstr "  "
+msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
-msgstr "    "
+msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
-msgstr "   "
+msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
-msgstr "  "
+msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
-msgstr "  [  [^"
+msgstr "  `['  `[^'"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
-msgstr "  ( or \\("
+msgstr "  `('  `\\('"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
-msgstr "  \\{"
+msgstr "  `\\{'"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
-msgstr "   \\{\\}"
+msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
-msgstr "  "
+msgstr "  "
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
-msgstr " "
+msgstr "  "
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
-msgstr "   "
+msgstr "   "
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
-msgstr "   "
+msgstr "   "
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
-msgstr "   "
+msgstr "   "
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
-msgstr "  )  \\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "   "
+msgstr "  `)'  `\\)'"
--- 4.1.4/po/sed.pot
+++ 4.0.9/po/sed.pot
@@ -1,5 +1,5 @@
 # SOME DESCRIPTIVE TITLE.
-# Copyright (C) YEAR Free Software Foundation, Inc.
+# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
 # This file is distributed under the same license as the PACKAGE package.
 # FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
 #
@@ -7,8 +7,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -17,261 +16,196 @@
 "Content-Transfer-Encoding: 8bit\n"
 "Plural-Forms: nplurals=INTEGER; plural=EXPRESSION;\n"
 
-#: sed/compile.c:162
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr ""
 
-#: sed/compile.c:163
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr ""
 
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr ""
 
-#: sed/compile.c:165
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr ""
 
-#: sed/compile.c:166
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr ""
 
-#: sed/compile.c:167
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr ""
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr ""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr ""
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ""
 
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr ""
 
-#: sed/compile.c:172
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr ""
 
-#: sed/compile.c:173
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr ""
 
-#: sed/compile.c:174
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr ""
 
-#: sed/compile.c:175
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr ""
 
-#: sed/compile.c:176
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr ""
 
-#: sed/compile.c:177
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr ""
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr ""
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr ""
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr ""
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr ""
 
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
-msgstr ""
-
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr ""
 
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
 msgstr ""
 
-#: sed/compile.c:186
-#, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr ""
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr ""
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr ""
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
+msgid "Can't find label for jump to `%s'"
 msgstr ""
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr ""
 
-#: sed/execute.c:672
-#, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr ""
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, c-format
-msgid "couldn't edit %s: not a regular file"
+msgid "Couldn't open temporary file %s: %s"
 msgstr ""
 
-#: sed/execute.c:683 lib/utils.c:196
-#, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
 msgstr ""
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr ""
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr ""
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr ""
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr ""
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -280,31 +214,30 @@
 "\n"
 msgstr ""
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
 "Be sure to include the word ``%s'' somewhere in the ``Subject:'' field.\n"
 msgstr ""
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -313,101 +246,87 @@
 "to the extent permitted by law.\n"
 msgstr ""
 
-#: lib/utils.c:98 lib/utils.c:336
-#, c-format
-msgid "cannot remove %s: %s"
-msgstr ""
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, c-format
-msgid "couldn't open file %s: %s"
+msgid "Couldn't open file %s: %s"
 msgstr ""
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] ""
 msgstr[1] ""
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr ""
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr ""
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr ""
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr ""
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr ""
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr ""
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr ""
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr ""
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr ""
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr ""
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr ""
--- 4.1.4/po/sk.po
+++ 4.0.9/po/sk.po
@@ -6,7 +6,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: GNU sed 4.0.8\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-10-25 17:22+0200\n"
 "Last-Translator: Marcel Telka <marcel@telka.sk>\n"
 "Language-Team: Slovak <sk-i18n@lists.linux.sk>\n"
@@ -16,186 +16,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=3; plural= (n==1) ? 1 : (n>=2 && n<=4) ? 2 : 0;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Viacnsobn `!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Neoakvan `,'"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "+N alebo ~N sa ned poui ako prv adresa"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Nezodpovedajca `{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Neoakvan `}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Nadbyton znaky po prkaze"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Oakvan \\ po `a', `c' alebo `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "`}' nevyaduje akkovek adresu"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": nechce akkovek adresu"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "V komentri nie je prpustn akkovek adresa"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Chbajci prkaz"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Prkaz pouva iba jednu adresu"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Neukonen regulrny vraz adresy"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Neukonen prkaz `s'"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Neukonen prkaz `y'"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Neznma voba pre `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "viacnsobn pouitie voby `p' s prkazom `s'"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "viacnsobn pouitie voby `g' s prkazom `s'"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "prkaz `s' me ma maximlne jednu seln vobu"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "seln voba prkazu `s' neme by nula"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "reazce pre prkaz `y' maj rzne dky"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "oakvan novia verzia programu sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Prkaz pouva iba jednu adresu"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Bolo volan savchar() s neakanm pushback (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Neznmy prkaz:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: sbor %s, riadok %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e vraz #%lu, znak %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Nvestie pre skok na `%s' nie je mon njs?"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: %s nie je mon ta: %s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "Nebolo mon otvori sbor %s: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Nebolo mon otvori sbor %s: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Nebolo mon otvori doasn sbor %s: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERN CHYBA: zl typ adresy"
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "chyba v podprocese"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "voba `e' nie je podporovan"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "prkaz `e' nie je podporovan"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERN CHYBA: zl prkaz %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Bez predchdzajceho regulrneho vrazu"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Nie je mon zada modifiktory pre przdny regulrny vraz"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Neplatn odkaz \\%d na `s' prkazu RHS"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -203,96 +180,34 @@
 "  -R, --regexp-perl\n"
 "                 poui syntax regulrnych vrazov z Perlu 5 v skripte.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 poui syntax regulrnych vrazov z Perlu 5 v skripte.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -300,8 +215,41 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Pouitie: %s [VOBA]... {skript-iba-ak-nie-je-in-skript} [vstupn-"
+"sbor]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 potlai automatick vpis priestoru vzorov\n"
+"  -e skript, --expression=skript\n"
+"                 prida skript k prkazom, ktor maj by vykonan\n"
+"  -f skript-sbor, --file=skript-sbor\n"
+"                 prida obsah sboru skript-sbor k prkazom, ktor maj by "
+"vykonan\n"
+"  -i[prpona], --in-place[=prpona]\n"
+"                 upravi sbory na mieste (vytvoria sa zlohy, ak je zadan "
+"prpona)\n"
+"  -l N, --line-length=N\n"
+"                 nastavi poadovan dku pre zalomenie riadkov pre prkaz "
+"`l'\n"
+"  -r, --regexp-extended\n"
+"                 poui rozren regulrne vrazy v skripte.\n"
+"%s  -s, --separate\n"
+"                 spracova sbory ako oddelen a nie ako jeden spojit\n"
+"  -u, --unbuffered\n"
+"                 nata minimlne mnostv dt zo vstupnch sborov a "
+"vyprzdova\n"
+"                 vstupn vyrovnvacie pamte astejie\n"
+"      --help     vypsa tto pomoc a skoni\n"
+"  -V, --version  vypsa informciu o verzii a skoni\n"
+"\n"
+"Ak nie je zadan iadna z volieb -e, --expression, -f, alebo --file,\n"
+"potom prv parameter, ktor nie je vobou, bude povaovan za sed skript,\n"
+"ktor m by interpretovan. Vetky ostatn parametre s nzvy vstupnch "
+"sborov.\n"
+"Ak nebud vstupn sbory zadan, bude tan tandardn vstup.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -312,26 +260,25 @@
 "Komentre k slovenskmu prekladu zasielajte na adresu <sk-i18n@lists.linux."
 "sk>.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed verzia %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "zaloen na GNU sed verzia 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed verzia %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -345,17 +292,12 @@
 "njdete v zdrojovch textoch. Toto programov vybavenie je BEZ zruky,\n"
 "a to aj bez zruky PREDAJNOSTI alebo VHODNOSTI PRE NEJAK KONKRTNY EL.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: %s nie je mon ta: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Nebolo mon otvori sbor %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
@@ -363,84 +305,75 @@
 msgstr[1] "nebolo mon zapsa %d poloku do %s: %s"
 msgstr[2] "nebolo mon zapsa %d poloky do %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "chyba pri tan z %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: %s nie je mon ta: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "spech"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Nezodpoved"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Neplatn regulrny vraz"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Neplatn znak pre porovnvanie"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Neplatn nzov triedy znakov"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Ukonovacie opan lomtko"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Neplatn sptn odkaz"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Nezodpovedajca [ alebo [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Nezodpovedajca ( alebo \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Nezodpovedajca \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Neplatn obsah \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Neplatn koniec rozsahu"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Vyerpan pam"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Neplatn predchdzajci regulrny vraz"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Neoakvan koniec regulrneho vrazu"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Regulrny vraz je prli vek"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Nezodpovedajca ) alebo \\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Bez predchdzajceho regulrneho vrazu"
--- 4.1.4/po/sl.po
+++ 4.0.9/po/sl.po
@@ -6,7 +6,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 4.0.6\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2003-04-02 17:20+0200\n"
 "Last-Translator: Primo Peterlin <primoz.peterlin@biofiz.mf.uni-lj.si>\n"
 "Language-Team: Slovenian <translation-team-sl@lists.sourceforge.net>\n"
@@ -17,186 +17,163 @@
 "Plural-Forms: nplurals=4; plural=(n%100==1 ? 1 : n%100==2 ? 2 : n%100==3 || n"
 "%100==4 ? 3 : 0);\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Veterni klicaji \"!\""
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Nepriakovana vejica \",\""
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "Obliki +N in ~N nista dovoljeni kot zaetna naslova"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Oklepaj { brez zaklepaja"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Nepriakovan zaklepaj }"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Ukazu sledijo dodatni znaki"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "Za ,a`, ,c` ali ,i` se priakuje \\"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "Zaklepaj } ne zahteva naslova"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": ne zahteva naslova"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Komentarji ne sprejemajo naslovov"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Ukaz manjka"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Ukaz uporablja le en naslov"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Regularni izraz z nezakljuenim naslovom"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Nezakljuen ukaz \"s\""
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Nezakljuen ukaz \"y\""
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "Neznane izbire pri ukazu \"s\""
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "veterne izbire \"p\" pri ukazu \"s\""
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "veterne izbire \"g\" pri ukazu \"s\""
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "veterne tevilne izbire pri ukazu \"s\""
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "tevilna izbira pri ukazu \"s\" mora biti nenielna"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "niza pri ukazu \"y\" sta razlino dolga"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "priakovana noveja izdaja programa sed"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Nepravilna uporaba modifikatorja naslova"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Klic savchar() z nepriakovanim pushback (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Neznan ukaz:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: datoteka %s vrstica %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e izraz #%lu, znak %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "Oznake za skok na \"%s\" ni mono najti"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: %s ni mono prebrati: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
+msgid "Couldn't open temporary file %s: %s"
 msgstr "Datoteke %s ni mogoe odpreti: %s"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "Datoteke %s ni mogoe odpreti: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERNA NAPAKA: pokvarjen tip naslova"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Datoteke %s ni mogoe odpreti: %s"
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "Napaka v podprocesu"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "Izbira ,e` ni podprta"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "Ukaz ,e` ni podprt"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERNA NAPAKA: Pokvarjen ukaz %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Prejnji regularni izraz manjka"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Doloanje modifikatorjev pri praznem regularnem izrazu ni mogoe"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "Neveljavni sklic \\%d na desni strani ukaza ,s`"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -204,96 +181,34 @@
 "  -R, --regexp-perl\n"
 "                 dovoli uporabo regularnih izrazov, ki jih podpira Perl 5\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 dovoli uporabo regularnih izrazov, ki jih podpira Perl 5\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -301,8 +216,37 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Uporaba: %s [IZBIRA]... [SKRIPT] [DATOTEKA]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 brez avtomatinega izpisa prostora vzorcev\n"
+"  -e SKRIPT, --expression=SKRIPT\n"
+"                 dodaj SKRIPT med ukaze, ki se izvedejo\n"
+"  -f SKRIPTNA_DATOTEKA, --file=SKRIPTNA_DATOTEKA\n"
+"                 dodaj vsebino SKRIPTNE DATOTEKE med ukaze, ki se izvedejo\n"
+"  -i[PRIPONA], --in-place[=PRIPONA]\n"
+"                 spremembe opravi v sami datoteki (ustvari varnostno kopijo "
+"z\n"
+"                 dano pripono, e je ta podana)\n"
+"  -l N, --line-length=N\n"
+"                 doloi irino vrstice za ukaz ,l` na N znakov\n"
+"  -r, --regexp-extended\n"
+"                 dovoli uporabo razirjenih regularnih izrazov\n"
+"%s  -s, --separate\n"
+"                 datoteke obravnavaj kot loene, ne pa kot neprekinjen tok\n"
+"                 podatkov\n"
+"  -u, --unbuffered\n"
+"\n"
+"      --help     ta navodila\n"
+"  -V, --version  razliica programa\n"
+"\n"
+"e izbire -e, --expression, -f ali --file niso podane, se prvi neizbirni\n"
+"argument tolmai kot skript. Vsi preostali argumenti so imena vhodnih "
+"datotek.\n"
+"e ni podano nobeno ime datoteke, se bere standardni vhod.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -311,26 +255,25 @@
 "Sporoila o napakah poljite na %s .\n"
 "Poskrbite, da bo nekje v polju ,,Subject`` nastopal izraz ,,%s``.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed, razliica %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "na osnovi GNU sed, razliica 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed, razliica %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -344,17 +287,12 @@
 "in razirjate so navedeni v izvorni kodi. Za program ni NOBENEGA JAMSTVA,\n"
 "niti jamstev USTREZNOSTI ZA PRODAJO ali PRIMERNOSTI ZA UPORABO.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: %s ni mono prebrati: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "Datoteke %s ni mogoe odpreti: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
@@ -363,84 +301,90 @@
 msgstr[2] "ni mogoe zapisati %d elementov na %s: %s"
 msgstr[3] "ni mogoe zapisati %d elementov na %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "napaka pri branju z %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: %s ni mono prebrati: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Uspeno"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Ni ujemanja"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Neveljavni regularni izraz"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Znaka izven abecede"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Neveljavno ime razreda znakov"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Zakljuna obrnjena poevnica"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Neveljavni povratni sklic"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Oklepaj [ ali [^ brez zaklepaja"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Oklepaj ( ali \\( brez zaklepaja"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Oklepaj \\{ brez zaklepaja"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Neveljavna vsebina \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Neveljavna zgornja meja intervala"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Zmanjkalo pomnilnika"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Neveljaven prejnji regularni izraz"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Predasni zakljuek regularnega izraza"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Regularni izraz prevelik"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Oklepaj ) ali \\) brez zaklepaja"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Prejnji regularni izraz manjka"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Nepravilna uporaba modifikatorja naslova"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Nepriakovan konec datoteke"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "pokvarjen regularni izraz: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "napaka pri branju: %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "ni bilo mogoe zapisati elementa na %s: %s"
--- 4.1.4/po/sr.po
+++ 4.0.9/po/sr.po
@@ -4,9 +4,9 @@
 # Aleksandar Jelenak <jelenak@netlinkplus.net>, 2003.
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.0.9\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-01-13 22:51-0500\n"
+"Project-Id-Version: sed 4.0.8\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-11-14 16:11-0500\n"
 "Last-Translator: Aleksandar Jelenak <jelenak@netlinkplus.net>\n"
 "Language-Team: Serbian <sr@li.org>\n"
 "MIME-Version: 1.0\n"
@@ -16,186 +16,164 @@
 "Plural-Forms: nplurals=3;    plural=n%10==1 && n%100!=11 ? 0 :  (n%10>=2 && n"
 "%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2);\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
-msgstr " !"
-
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
-msgstr " ,"
-
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
+msgstr " `!'"
+
+#: sed/compile.c:173
+msgid "Unexpected `,'"
+msgstr " `,'"
+
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "    +N  ~N   "
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
-msgstr " {"
-
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
-msgstr " }"
-
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
+msgstr " `{'"
+
+#: sed/compile.c:176
+msgid "Unexpected `}'"
+msgstr " `}'"
+
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "   "
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
-msgstr " \\  a, c  i"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
+msgstr " \\  `a', `c'  `i'"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
-msgstr "}    "
+msgstr "`}'    "
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ":    "
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "    "
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
-msgstr " "
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr " "
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "    "
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "  . "
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
-msgstr "  s"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "  `s'"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
-msgstr "  y"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "  `y'"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
-msgstr "   s"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "   `s'"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
-msgstr " p   s "
+msgstr " `p'   `s' "
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
-msgstr " g   s "
+msgstr " `g'   `s' "
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
-msgstr "    s "
+msgstr "    `s' "
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
-msgstr "   s    "
+msgstr "   `s'    "
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
-msgstr "   y   "
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
+msgstr "   `y'   "
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "   sed-"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "    "
+#      pushback.
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr " savchar()     (%x)"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr " :"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s:  %s  %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e  #%lu,  %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "        %s"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
+msgstr "        `%s'"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
-msgstr "%s:     %s: %s\n"
-
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "     %s: %s"
+msgstr "%s:     %s: %s\n"
 
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "     %s: %s"
-
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
+#: sed/execute.c:530 sed/execute.c:542
+#, c-format
+msgid "Couldn't open temporary file %s: %s"
 msgstr "     %s: %s"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr " :   "
+
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "  "
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
-msgstr " e  "
+msgstr " `e'  "
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
-msgstr " e  "
+msgstr " `e'  "
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr " :   %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "   "
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
-msgstr "      . "
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "       "
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "  \\%d     s"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "  \\%d     `s'"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -203,96 +181,34 @@
 "  -R, --regexp-perl\n"
 "                      5   .\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                      5   .\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -300,36 +216,67 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+": %s []... {-----} [-"
+"]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                    \n"
+"  -e , --expression=\n"
+"                     \n"
+"  -f , --file=\n"
+"                      \n"
+"  -i[], --in-place[=]\n"
+"                     (     "
+")\n"
+"  -l , --line-length=\n"
+"                       `l'\n"
+"  -r, --regexp-extended\n"
+"                      \n"
+"%s  -s, --separate\n"
+"                         \n"
+"  -u, --unbuffered\n"
+"                         "
+"\n"
+"                   \n"
+"      --help         \n"
+"  -V, --version     \n"
+"\n"
+"  -e, --expression, -f,  --file  ,   \n"
+"      sed    .  "
+"\n"
+"    ;     ,  "
+"\n"
+"  .\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
 "Be sure to include the word ``%s'' somewhere in the ``Subject:'' field.\n"
 msgstr ""
 "   : %s .\n"
-"     %s   Subject: .\n"
+"     ``%s''   ``Subject:'' .\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed  %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "   sed  3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr " sed  %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -338,21 +285,17 @@
 "to the extent permitted by law.\n"
 msgstr ""
 "%s\n"
-"   ;      .  "
-"\n"
-";        .\n"
-
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s:     %s: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+"   ;      .  "
+"\n"
+";         "
+".\n"
+
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "     %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
@@ -360,84 +303,76 @@
 msgstr[1] "  %d   %s: %s"
 msgstr[2] "  %d   %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "   %s: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s:     %s: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
-msgstr " "
+msgstr " "
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "  "
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "  "
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "   "
 
-#: lib/regcomp.c:165
+#      ?
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "   "
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "  "
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr " [  ^["
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr " (  \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr " \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "   \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "  "
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr " "
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "   "
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "   "
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "   "
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr " )  \\)"
-
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "   "
--- 4.1.4/po/sv.po
+++ 4.0.9/po/sv.po
@@ -1,12 +1,12 @@
 # Swedish messages for sed.
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004 Free Software Foundation, Inc.
-# Christian Rose <menthos@menthos.com>, 1999, 2000, 2001, 2002, 2003, 2004.
+# Copyright (C) 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
+# Christian Rose <menthos@menthos.com>, 1999, 2000, 2001, 2002, 2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.1.1\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-07-11 11:45+0200\n"
+"Project-Id-Version: sed 4.0.8\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-10-24 19:21+0200\n"
 "Last-Translator: Christian Rose <menthos@menthos.com>\n"
 "Language-Team: Swedish <sv@li.org>\n"
 "MIME-Version: 1.0\n"
@@ -15,172 +15,163 @@
 "Report-Msgid-Bugs-To: \n"
 "Plural-Forms: nplurals=2; plural=(n != 1);\n"
 
-#: sed/compile.c:162
-msgid "multiple `!'s"
-msgstr "flera \"!\""
-
-#: sed/compile.c:163
-msgid "unexpected `,'"
-msgstr "ovntat \",\""
-
-#: sed/compile.c:164
-msgid "invalid usage of +N or ~N as first address"
-msgstr "ogiltig anvndning av +N eller ~N som frsta adress"
-
-#: sed/compile.c:165
-msgid "unmatched `{'"
-msgstr "obalanserad \"{\""
-
-#: sed/compile.c:166
-msgid "unexpected `}'"
-msgstr "ovntad \"}\""
-
-#: sed/compile.c:167
-msgid "extra characters after command"
-msgstr "extra tecken efter kommandot"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
+msgstr "Flera \"!\""
+
+#: sed/compile.c:173
+msgid "Unexpected `,'"
+msgstr "Ovntat \",\""
+
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
+msgstr "+N eller ~N kan inte anvndas som frsta adress"
+
+#: sed/compile.c:175
+msgid "Unmatched `{'"
+msgstr "Ensamt \"{\""
+
+#: sed/compile.c:176
+msgid "Unexpected `}'"
+msgstr "Ovntat \"}\""
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:177
+msgid "Extra characters after command"
+msgstr "Extra tecken efter kommandot"
+
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "\\ frvntades efter \"a\", \"c\" eller \"i\""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "\"}\" vill inte ha ngra adresser"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": vill inte ha ngra adresser"
 
-#: sed/compile.c:171
-msgid "comments don't accept any addresses"
-msgstr "kommentarer accepterar inga adresser"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
+msgstr "Kommentarer accepterar inga adresser"
 
-#: sed/compile.c:172
-msgid "missing command"
-msgstr "kommando saknas"
+#: sed/compile.c:182
+msgid "Missing command"
+msgstr "Kommando saknas"
 
-#: sed/compile.c:173
-msgid "command only uses one address"
-msgstr "kommandot anvnder endast en adress"
+#: sed/compile.c:183
+msgid "Command only uses one address"
+msgstr "Kommandot anvnder endast en adress"
 
-#: sed/compile.c:174
-msgid "unterminated address regex"
-msgstr "oavslutat reguljrt uttryck fr adress"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
+msgstr "Oavslutat reguljrt uttryck fr adress"
 
-#: sed/compile.c:175
-msgid "unterminated `s' command"
-msgstr "oavslutat \"s\"-kommando"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
+msgstr "Oavslutat \"s\"-kommando"
 
-#: sed/compile.c:176
-msgid "unterminated `y' command"
-msgstr "oavslutat \"y\"-kommando"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
+msgstr "Oavslutat \"y\"-kommando"
 
-#: sed/compile.c:177
-msgid "unknown option to `s'"
-msgstr "flaggan oknd fr \"s\""
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
+msgstr "Flaggan oknd fr \"s\""
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "flera \"p\"-flaggor till \"s\"-kommandot"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "flera \"g\"-flaggor till \"s\"-kommandot"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "flera sifferflaggor till \"s\"-kommandot"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "sifferflagga till kommandot \"s\" fr inte vara noll"
 
-#: sed/compile.c:182
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "strngarna fr kommandot \"y\" r olika lnga"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr "avgrnsningstecknet r inte en ensam byte"
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "nyare version av sed frvntades"
 
-#: sed/compile.c:185
-msgid "invalid usage of line address 0"
-msgstr "felaktig anvndning av radadress 0"
-
-#: sed/compile.c:186
+#: sed/compile.c:236
 #, c-format
-msgid "unknown command: `%c'"
-msgstr "oknt kommando: \"%c\""
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "Anropade savchar() med ovntat returtecken (%x)"
 
-#: sed/compile.c:209
+#: sed/compile.c:1331
+msgid "Unknown command:"
+msgstr "Oknt kommando:"
+
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: fil %s rad %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e uttryck #%lu, tecken %lu: %s\n"
 
-#: sed/compile.c:1644
+#: sed/compile.c:1555
 #, c-format
-msgid "can't find label for jump to `%s'"
-msgstr "kan inte hitta etiketten fr hopp till \"%s\""
+msgid "Can't find label for jump to `%s'"
+msgstr "Kan inte hitta etiketten fr hopp till \"%s\""
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: kan inte lsa %s: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "kunde inte redigera %s: r en terminal"
+msgid "Couldn't open temporary file %s: %s"
+msgstr "Kunde inte ppna temporra filen %s: %s"
 
-#: sed/execute.c:676
-#, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "kunde inte redigera %s: inte en vanlig fil"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr "INTERNT FEL: felaktig addresstyp"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "kunde inte ppna temporra filen %s: %s"
-
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "fel i underprocess"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr "flaggan \"e\" stds inte"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "kommandot \"e\" stds inte"
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
-msgstr "inget tidigare reguljrt uttryck"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr "INTERNT FEL: Felaktigt kommando %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
+msgstr "Inget tidigare reguljrt uttryck"
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
-msgstr "kan inte ange modifierare p tomt reguljrt uttryck"
+msgid "Cannot specify modifiers on empty regexp"
+msgstr "Kan inte ange modifierare p tomt reguljrt uttryck"
 
-# Kommentar frn Jan Djrv:
-# Jag antar RHS str fr "right hand side".  Man kan d sga
-# "... kommandots hgersida"
-#
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
-msgstr "ogiltig referens \\%d p \"s\"-kommandots hgersida"
+msgid "Invalid reference \\%d on `s' command's RHS"
+msgstr "Ogiltig referens \\%d p \"s\"-kommandots RHS"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -188,118 +179,34 @@
 "  -R, --regexp-perl\n"
 "                 anvnd Perl 5:s syntax fr reguljra uttryck i skriptet.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-"Anvndning: %s [FLAGGA]... {skript-endast-om-inga-andra} [indatafil]...\n"
-"\n"
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-"  -n, --quiet, --silent\n"
-"                 frhindrar automatisk utskrift av mnsterutrymme\n"
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-"  -e skript, --expression=skript\n"
-"                 lgg till skript till de kommandon som ska utfras\n"
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-"  -f skriptfil, --file=skriptfil\n"
-"                 lgg till innehllet i skriptfil till de kommandon som ska\n"
-"                 utfras\n"
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-"  -i[NDELSE], --in-place[=NDELSE]\n"
-"                 redigera filer p plats (skapar skerhetskopia om ndelse\n"
-"                 tillhandahlls)\n"
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-"  -l N, --line-length=N\n"
-"                 ange nskad radbrytningslngd fr \"l\"-kommandot\n"
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-"  --posix\n"
-"                 inaktivera alla GNU-utkningar.\n"
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -r, --regexp-extended\n"
-"                 anvnd utkade reguljra uttryck i skriptet.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-"  -s, --separate\n"
-"                 betrakta filer som separata istllet fr som en\n"
-"                 kontinuerlig lng datastrm.\n"
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-"  -u, --unbuffered\n"
-"                 ls in minimala mngder data frn indatafilerna och tm\n"
-"                 utdatabufferterna oftare\n"
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr "      --help     visa denna hjlptext och avsluta\n"
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr "      --version  visa versionsinformation och avsluta\n"
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -307,14 +214,38 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Anvndning: %s [FLAGGA]... {skript-endast-om-inga-andra} [indatafil]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 frhindrar automatisk utskrift av mnsterutrymme\n"
+"  -e skript, --expression=skript\n"
+"                 lgg till skript till de kommandon som ska utfras\n"
+"  -f skriptfil, --file=skriptfil\n"
+"                 lgg till innehllet i skriptfil till de kommandon som ska\n"
+"                 utfras\n"
+"  -i[suffix], --in-place[=suffix]\n"
+"                 redigera filer p plats (skapa skerhetskopia om tillgg\n"
+"                 tillhandahlls)\n"
+"  -l N, --line-length=N\n"
+"                 ange nskad radbrytningslngd fr \"l\"-kommandot\n"
+"  -r, --regexp-extended\n"
+"                 anvnd utkade reguljra uttryck i skriptet.\n"
+"%s  -s, --separate\n"
+"                 betrakta filer som separata istllet fr en ensam och\n"
+"                 sammanhllen lng strm.\n"
+"  -u, --unbuffered\n"
+"                 ls in minimala mngder data frn indatafilerna och tm\n"
+"                 utdatabufferterna oftare\n"
+"      --help     visa denna hjlptext och avsluta\n"
+"  -V, --version  visa versionsinformation och avsluta\n"
 "\n"
 "Om ingen av flaggorna -e, --expression, -f, eller --file ges, blir det\n"
 "frsta argumentet som inte r en flagga det sed-skript som tolkas. Alla\n"
-"terstende argument r namn p indatafiler. Om inga indatafiler r angivna\n"
+"terstende argument r namn p indatafiler; om inga indatafiler r angivna\n"
 "lses standard in.\n"
 "\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -324,26 +255,25 @@
 "Ange ordet \"%s\" p ngot stlle i \"rende:\"-fltet.\n"
 "Skicka anmrkningar p versttningen till <sv@li.org>.\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed version %s\n"
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
-"baserad p GNU sed version %s\n"
+"baserad p GNU sed version 3.02.80\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed version %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -359,101 +289,102 @@
 "Det finns INGEN garanti; inte ens fr SLJBARHET eller LMPLIGHET FR NGOT\n"
 "SPECIELLT NDAML, i den omfattning som medges av gllande lag.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, c-format
-msgid "cannot remove %s: %s"
-msgstr "kan inte ta bort %s: %s"
-
-#: lib/utils.c:143
+#: lib/utils.c:126
 #, c-format
-msgid "couldn't open file %s: %s"
-msgstr "kunde inte ppna filen %s: %s"
+msgid "Couldn't open file %s: %s"
+msgstr "Kunde inte ppna filen %s: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "kunde inte skriva %d objekt till %s: %s"
 msgstr[1] "kunde inte skriva %d objekt till %s: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "lsfel vid %s: %s"
 
-#: lib/utils.c:341
-#, c-format
-msgid "cannot rename %s: %s"
-msgstr "kan inte byta namn p %s: %s"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Lyckades"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Ingen trff"
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Ogiltigt reguljrt uttryck"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Ogiltigt sorteringstecken"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Ogiltigt teckenklassnamn"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Efterslpande omvnt snedstreck"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Ogiltig baktreferens"
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
-msgstr "Obalanserad [ eller [^"
+msgstr "Ensamt [ eller [^"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
-msgstr "Obalanserad ( eller \\("
+msgstr "Ensamt ( eller \\("
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
-msgstr "Obalanserad \\{"
+msgstr "Ensamt \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "Ogiltigt innehll i \\{\\}"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Ogiltigt intervallslut"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Minnet slut"
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Ogiltigt fregende reguljrt uttryck"
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Fr tidigt slut p reguljrt uttryck"
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Reguljrt uttryck fr stort"
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
-msgstr "Obalanserad ) eller \\)"
+msgstr "Ensamt ) eller \\)"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Inget tidigare reguljrt uttryck"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Felaktig anvndning av adressmodifierare"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Ovntat filslut"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "felaktigt reguljrt uttryck: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "fel vid lsning av indata: %s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr "kunde inte skriva ett objekt till %s: %s"
--- 4.1.4/po/tr.po
+++ 4.0.9/po/tr.po
@@ -1,201 +1,178 @@
-# translation of sed-4.0.9.tr.po to Turkish
+# translation of sed-4.0.7.tr.po to Turkish
 # Copyright (C) 2003 Free Software Foundation, Inc.
-# Deniz Akkus Kanca <deniz@arayan.com>, 2001,2003, 2004.
+# Deniz Akkus Kanca <deniz@arayan.com>, 2001,2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: sed 4.0.9\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
-"PO-Revision-Date: 2004-05-19 18:06+0300\n"
+"Project-Id-Version: sed 4.0.7\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
+"PO-Revision-Date: 2003-07-12 13:05+0300\n"
 "Last-Translator: Deniz Akkus Kanca <deniz@arayan.com>\n"
 "Language-Team: Turkish <gnu-tr-u12a@lists.sourceforge.net>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
 "Report-Msgid-Bugs-To: \n"
-"X-Generator: KBabel 1.0.2\n"
+"X-Generator: KBabel 1.0\n"
 "Plural-Forms: nplurals=1; plural=0;\n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "Birden fazla '!'"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr "Beklenmeyen ','"
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr "lk adres olarak +N veya ~N kullanlamaz"
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "Elemeyen '{'"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "Beklenmeyen '}'"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr "Komuttan sonra fazla karakterler var"
 
-#: sed/compile.c:168
-#, fuzzy
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr "`a', `c' veya `i' sonras \\ beklendi"
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "'}' iin adres istenmez"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": iin hi adres istenmez"
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr "Aklamalarda adres kabul edilmez"
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr "Komut eksik"
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr "Komutta yalnzca tek adres kullanlr"
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr "Sonlandrlmam adres dzenli ifadesi"
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "Sonlandrlmam 's' komutu"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "Sonlandrlmam 'y' komutu"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "`s' komutuna bilinmeyen seenek verilmi"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "`s' komutuna birden fazla `p' seenei verilmi"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "`s' komutuna birden fazla `g' seenei verilmi"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "`s' komutuna birden fazla say seenei verilmi"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "`s' komutuna verilen say seenei sfr olamaz"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "y komutu iin dizgeler deiik uzunluklarda"
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr "sed'in daha yeni bir srm beklendi"
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr "Adres deitirici hatal kullanlm"
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr "savchar() beklenmeyen geri itme (%x) ile arlm"
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr "Bilinmeyen komut:"
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s: dosya %s satr %lu: %s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s: -e ifade #%lu, harf %lu: %s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "`%s'e atlamak iin etiket bulunamyor"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s: %s okunamyor: %s\n"
 
-#: sed/execute.c:672
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr "%d sayda e %s'e yazlamad: %s"
-
-#: sed/execute.c:676
-#, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
-msgstr "%d sayda e %s'e yazlamad: %s"
+msgid "Couldn't open temporary file %s: %s"
+msgstr "%s dosyas alamad: %s"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr "Geici dosya %s alamad: %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr " HATA: Hatal adres tr"
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr "altsrete hata"
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr " e' seenei desteklenmiyor"
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr "`e' komutu desteklenmiyor"
 
-#: sed/regexp.c:39
-#, fuzzy
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr " HATA: Hatal komut %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr "Daha nce dzenli ifade yok"
 
 #: sed/regexp.c:40
-#, fuzzy
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr "Bo dzenli ifadeye deitirici atanamaz"
 
 #: sed/regexp.c:134
-#, fuzzy, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+#, c-format
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr "`s' komutunun RHS'sinde geersiz \\%d referans"
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
@@ -203,96 +180,34 @@
 "  -R, --regexp-perl\n"
 "                 betikte Perl 5'in dzenli ifade szdizimini kullanr.\n"
 
-#: sed/sed.c:98
+#: sed/sed.c:100
 #, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, fuzzy, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-"  -R, --regexp-perl\n"
-"                 betikte Perl 5'in dzenli ifade szdizimini kullanr.\n"
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -300,8 +215,38 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"Kullanm: %s [SEENEK]... {betik-eer-baka-betik-yok-ise} [girdi-"
+"dosyas]...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 kalp uzaynn otomatik yazdrlmasn bastrr\n"
+"  -e betik, --expression=betik\n"
+"                 betii icra edilecek komutlara ekler\n"
+"  -f betik-dosyas, --file=betik-dosyas\n"
+"                 betik-dosyasnn ieriini icra edilecek komutlara ekler\n"
+"  -i[sonek], --in-place[=sonek]\n"
+"                 dosyalar yerinde dzenler (sonek varsa, yedeklerini alr\n"
+"  -l N, --line-length=N\n"
+"                 `l' komutu iin istenen satr uzunluunu ayarlar\n"
+"  -r, --regexp-extended\n"
+"                 betikte geniletilmi dzenli ifadeler kullanr.\n"
+"%s -s, --separate\n"
+"                 dosyalar tek bir girdi olarak deil, ayr ayr dosyalar\n"
+"                 halinde iler.\n"
+"  -u, --unbuffered\n"
+"                 girdi dosyalarndan az miktarda veri ykler ve kt\n"
+"                 yastklarn daha sk boaltr.\n"
+"  --help         bu yardm gsterir ve kar\n"
+"  -V, --version  srm bilgisini gsterir ve kar\n"
+"\n"
+"Eer -e, --expression, -f veya --file seeneklerinden biri verilmemise, \n"
+"bulunan ilk seenek olmayan argman, yorumlanacak sed betii olarak kabul \n"
+"edilir. Btn kalan argmanlar girdi dosyas adlardr; eer girdi dosyas "
+"ad\n"
+"belirtilmemise standart girdi okunur.\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -311,26 +256,25 @@
 "<gnu-tr-u12a@lists.sourceforge.net> adresine bildirin. \n"
 "``%s'' szcnn Konu balnda yer almasna dikkat edin. \n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr "super-sed srm %s\n"
 
-#: sed/sed.c:269
-#, fuzzy, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 "GNU sed srm 3.02.80 temel alnmtr\n"
 "\n"
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr "GNU sed srm %s\n"
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -343,109 +287,107 @@
 "Hibir garantisi yoktur; hatta SATILABLRL veya HERHANG BR AMACA\n"
 "UYGUNLUU iin bile garanti verilmez.\n"
 
-#: lib/utils.c:98 lib/utils.c:336
-#, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s: %s okunamyor: %s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+#: lib/utils.c:126
+#, c-format
+msgid "Couldn't open file %s: %s"
 msgstr "%s dosyas alamad: %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] "%d sayda e %s'e yazlamad: %s"
 msgstr[1] "%d sayda e %s'e yazlamad: %s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr "%s'de okuma hatas: %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s: %s okunamyor: %s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr "Baarl"
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr "Eleme bulunamad"
 
 #
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr "Hatal dzenli ifade"
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr "Hatal birletirme karakteri"
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr "Hatal karakter snf ismi"
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr "Sonda fazla gerikesme var"
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr "Hatal geri referans"
 
 #
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 msgid "Unmatched [ or [^"
 msgstr "Elemeyen [ veya [^"
 
 #
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 msgid "Unmatched ( or \\("
 msgstr "Elemeyen ( veya \\("
 
 #
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 msgid "Unmatched \\{"
 msgstr "Elemeyen \\{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr "\\{\\} ierii hatal"
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr "Geersiz kapsam sonu"
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr "Bellek tkendi"
 
 #
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr "Bir nceki dzenli ifade hatal"
 
 #
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr "Dzenli ifade erken sonland"
 
 #
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr "Dzenli ifade fazla byk"
 
 #
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 msgid "Unmatched ) or \\)"
 msgstr "Elemeyen ) or \\)"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr "Daha nce dzenli ifade yok"
+#~ msgid "Invalid use of address modifier"
+#~ msgstr "Adres deitirici hatal kullanlm"
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr "Beklenmeyen Dosya-Sonu"
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "Hatal dzenli ifade: %s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "girdi okuma hatas: %s"
--- 4.1.4/po/zh_CN.po
+++ 4.0.9/po/zh_CN.po
@@ -5,7 +5,7 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: sed 3.02.80\n"
-"POT-Creation-Date: 2004-11-11 15:28+0100\n"
+"POT-Creation-Date: 2004-01-10 08:46+0100\n"
 "PO-Revision-Date: 2002-08-18 11:11+0800\n"
 "Last-Translator: Wang Li <charles@linux.net.cn>\n"
 "Language-Team: Chinese (simplified) <i18n-translation@lists.linux.net.cn>\n"
@@ -14,276 +14,196 @@
 "Content-Transfer-Encoding: 8bit\n"
 "Report-Msgid-Bugs-To: \n"
 
-#: sed/compile.c:162
-#, fuzzy
-msgid "multiple `!'s"
+#: sed/compile.c:172
+msgid "Multiple `!'s"
 msgstr "!"
 
-#: sed/compile.c:163
-#, fuzzy
-msgid "unexpected `,'"
+#: sed/compile.c:173
+msgid "Unexpected `,'"
 msgstr ","
 
-#: sed/compile.c:164
-#, fuzzy
-msgid "invalid usage of +N or ~N as first address"
+#: sed/compile.c:174
+msgid "Cannot use +N or ~N as first address"
 msgstr " +N  ~N "
 
-#: sed/compile.c:165
-#, fuzzy
-msgid "unmatched `{'"
+#: sed/compile.c:175
+msgid "Unmatched `{'"
 msgstr "{"
 
-#: sed/compile.c:166
-#, fuzzy
-msgid "unexpected `}'"
+#: sed/compile.c:176
+msgid "Unexpected `}'"
 msgstr "}"
 
-#: sed/compile.c:167
-#, fuzzy
-msgid "extra characters after command"
+#: sed/compile.c:177
+msgid "Extra characters after command"
 msgstr ""
 
-#: sed/compile.c:168
-msgid "expected \\ after `a', `c' or `i'"
+#: sed/compile.c:178
+msgid "Expected \\ after `a', `c' or `i'"
 msgstr ""
 
-#: sed/compile.c:169
+#: sed/compile.c:179
 msgid "`}' doesn't want any addresses"
 msgstr "}"
 
-#: sed/compile.c:170
+#: sed/compile.c:180
 msgid ": doesn't want any addresses"
 msgstr ": "
 
-#: sed/compile.c:171
-#, fuzzy
-msgid "comments don't accept any addresses"
+#: sed/compile.c:181
+msgid "Comments don't accept any addresses"
 msgstr ""
 
-#: sed/compile.c:172
-#, fuzzy
-msgid "missing command"
+#: sed/compile.c:182
+msgid "Missing command"
 msgstr ""
 
-#: sed/compile.c:173
-#, fuzzy
-msgid "command only uses one address"
+#: sed/compile.c:183
+msgid "Command only uses one address"
 msgstr ""
 
-#: sed/compile.c:174
-#, fuzzy
-msgid "unterminated address regex"
+#: sed/compile.c:184
+msgid "Unterminated address regex"
 msgstr ""
 
-#: sed/compile.c:175
-#, fuzzy
-msgid "unterminated `s' command"
+#: sed/compile.c:185
+msgid "Unterminated `s' command"
 msgstr "s"
 
-#: sed/compile.c:176
-#, fuzzy
-msgid "unterminated `y' command"
+#: sed/compile.c:186
+msgid "Unterminated `y' command"
 msgstr "y"
 
-#: sed/compile.c:177
-#, fuzzy
-msgid "unknown option to `s'"
+#: sed/compile.c:187
+msgid "Unknown option to `s'"
 msgstr "s"
 
-#: sed/compile.c:178
+#: sed/compile.c:188
 msgid "multiple `p' options to `s' command"
 msgstr "sp"
 
-#: sed/compile.c:179
+#: sed/compile.c:189
 msgid "multiple `g' options to `s' command"
 msgstr "sg"
 
-#: sed/compile.c:180
+#: sed/compile.c:190
 msgid "multiple number options to `s' command"
 msgstr "s"
 
-#: sed/compile.c:181
+#: sed/compile.c:191
 msgid "number option to `s' command may not be zero"
 msgstr "s"
 
-#: sed/compile.c:182
-#, fuzzy
-msgid "strings for `y' command are different lengths"
+#: sed/compile.c:192
+msgid "strings for y command are different lengths"
 msgstr "y "
 
-#: sed/compile.c:183
-msgid "delimiter character is not a single-byte character"
-msgstr ""
-
-#: sed/compile.c:184
+#: sed/compile.c:193
 msgid "expected newer version of sed"
 msgstr ""
 
-#: sed/compile.c:185
-#, fuzzy
-msgid "invalid usage of line address 0"
-msgstr ""
+#: sed/compile.c:236
+#, c-format
+msgid "Called savchar() with unexpected pushback (%x)"
+msgstr ""
 
-#: sed/compile.c:186
-#, fuzzy, c-format
-msgid "unknown command: `%c'"
+#: sed/compile.c:1331
+msgid "Unknown command:"
 msgstr ""
 
-#: sed/compile.c:209
+#: sed/compile.c:1352
 #, c-format
 msgid "%s: file %s line %lu: %s\n"
 msgstr "%s %s %lu%s\n"
 
-#: sed/compile.c:212
+#: sed/compile.c:1355
 #, c-format
 msgid "%s: -e expression #%lu, char %lu: %s\n"
 msgstr "%s-e  #%lu %lu%s\n"
 
-#: sed/compile.c:1644
-#, fuzzy, c-format
-msgid "can't find label for jump to `%s'"
+#: sed/compile.c:1555
+#, c-format
+msgid "Can't find label for jump to `%s'"
 msgstr "%s"
 
-#: sed/execute.c:649
+#: sed/execute.c:505
 #, c-format
 msgid "%s: can't read %s: %s\n"
 msgstr "%s %s%s\n"
 
-#: sed/execute.c:672
-#, fuzzy, c-format
-msgid "couldn't edit %s: is a terminal"
-msgstr " %s"
-
-#: sed/execute.c:676
+#: sed/execute.c:530 sed/execute.c:542
 #, fuzzy, c-format
-msgid "couldn't edit %s: not a regular file"
+msgid "Couldn't open temporary file %s: %s"
 msgstr " %s"
 
-#: lib/utils.c:196 sed/execute.c:683
-#, fuzzy, c-format
-msgid "couldn't open temporary file %s: %s"
-msgstr " %s"
+#: sed/execute.c:728
+msgid "INTERNAL ERROR: bad address type"
+msgstr ""
 
-#: sed/execute.c:1207 sed/execute.c:1388
+#: sed/execute.c:1022 sed/execute.c:1200
 msgid "error in subprocess"
 msgstr ""
 
-#: sed/execute.c:1209
+#: sed/execute.c:1024
 msgid "option `e' not supported"
 msgstr ""
 
-#: sed/execute.c:1390
+#: sed/execute.c:1202
 msgid "`e' command not supported"
 msgstr ""
 
-#: sed/regexp.c:39
-msgid "no previous regular expression"
+#: sed/execute.c:1438
+#, c-format
+msgid "INTERNAL ERROR: Bad cmd %c"
+msgstr " %c"
+
+#: sed/regexp.c:39 lib/regcomp.c:665
+msgid "No previous regular expression"
 msgstr ""
 
 #: sed/regexp.c:40
-msgid "cannot specify modifiers on empty regexp"
+msgid "Cannot specify modifiers on empty regexp"
 msgstr ""
 
 #: sed/regexp.c:134
 #, c-format
-msgid "invalid reference \\%d on `s' command's RHS"
+msgid "Invalid reference \\%d on `s' command's RHS"
 msgstr ""
 
-#: sed/sed.c:93
+#: sed/sed.c:95
 msgid ""
 "  -R, --regexp-perl\n"
 "                 use Perl 5's regular expressions syntax in the script.\n"
 msgstr ""
 
-#: sed/sed.c:98
-#, c-format
+#: sed/sed.c:100
+#, fuzzy, c-format
 msgid ""
 "Usage: %s [OPTION]... {script-only-if-no-other-script} [input-file]...\n"
 "\n"
-msgstr ""
-
-#: sed/sed.c:102
-#, c-format
-msgid ""
 "  -n, --quiet, --silent\n"
 "                 suppress automatic printing of pattern space\n"
-msgstr ""
-
-#: sed/sed.c:104
-#, c-format
-msgid ""
 "  -e script, --expression=script\n"
 "                 add the script to the commands to be executed\n"
-msgstr ""
-
-#: sed/sed.c:106
-#, c-format
-msgid ""
 "  -f script-file, --file=script-file\n"
 "                 add the contents of script-file to the commands to be "
 "executed\n"
-msgstr ""
-
-#: sed/sed.c:108
-#, c-format
-msgid ""
-"  -i[SUFFIX], --in-place[=SUFFIX]\n"
+"  -i[suffix], --in-place[=suffix]\n"
 "                 edit files in place (makes backup if extension supplied)\n"
-msgstr ""
-
-#: sed/sed.c:110
-#, c-format
-msgid ""
 "  -l N, --line-length=N\n"
 "                 specify the desired line-wrap length for the `l' command\n"
-msgstr ""
-
-#: sed/sed.c:112
-#, c-format
-msgid ""
-"  --posix\n"
-"                 disable all GNU extensions.\n"
-msgstr ""
-
-#: sed/sed.c:114
-#, c-format
-msgid ""
 "  -r, --regexp-extended\n"
 "                 use extended regular expressions in the script.\n"
-msgstr ""
-
-#: sed/sed.c:117
-#, c-format
-msgid ""
-"  -s, --separate\n"
+"%s  -s, --separate\n"
 "                 consider files as separate rather than as a single "
 "continuous\n"
 "                 long stream.\n"
-msgstr ""
-
-#: sed/sed.c:120
-#, c-format
-msgid ""
 "  -u, --unbuffered\n"
 "                 load minimal amounts of data from the input files and "
 "flush\n"
 "                 the output buffers more often\n"
-msgstr ""
-
-#: sed/sed.c:123
-#, c-format
-msgid "      --help     display this help and exit\n"
-msgstr ""
-
-#: sed/sed.c:124
-#, c-format
-msgid "      --version  output version information and exit\n"
-msgstr ""
-
-#: sed/sed.c:125
-#, c-format
-msgid ""
+"      --help     display this help and exit\n"
+"  -V, --version  output version information and exit\n"
 "\n"
 "If no -e, --expression, -f, or --file option is given, then the first\n"
 "non-option argument is taken as the sed script to interpret.  All\n"
@@ -291,8 +211,28 @@
 "specified, then the standard input is read.\n"
 "\n"
 msgstr ""
+"%s []... {} []...\n"
+"\n"
+"  -n, --quiet, --silent\n"
+"                 \n"
+"  -e script, --expression=script\n"
+"                  script \n"
+"  -f script-file, --file=script-file\n"
+"                  script-file \n"
+"  -l N, --line-length=N\n"
+"                 l\n"
+"  -u, --unbuffered\n"
+"\n"
+"      --help     \n"
+"  -V, --version  \n"
+"\n"
+" -e--expression-f  --file \n"
+" sed \n"
+"\n"
+"\n"
+"\n"
 
-#: sed/sed.c:131
+#: sed/sed.c:129
 #, c-format
 msgid ""
 "E-mail bug reports to: %s .\n"
@@ -301,24 +241,23 @@
 "%s .\n"
 "%sSubject:\n"
 
-#: sed/sed.c:268
+#: sed/sed.c:254
 #, c-format
 msgid "super-sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:269
-#, c-format
+#: sed/sed.c:255
 msgid ""
-"based on GNU sed version %s\n"
+"based on GNU sed version 3.02.80\n"
 "\n"
 msgstr ""
 
-#: sed/sed.c:271
+#: sed/sed.c:257
 #, c-format
 msgid "GNU sed version %s\n"
 msgstr ""
 
-#: sed/sed.c:273
+#: sed/sed.c:259
 #, c-format
 msgid ""
 "%s\n"
@@ -327,105 +266,106 @@
 "to the extent permitted by law.\n"
 msgstr ""
 
-#: lib/utils.c:98 lib/utils.c:336
+#: lib/utils.c:126
 #, fuzzy, c-format
-msgid "cannot remove %s: %s"
-msgstr "%s %s%s\n"
-
-#: lib/utils.c:143
-#, fuzzy, c-format
-msgid "couldn't open file %s: %s"
+msgid "Couldn't open file %s: %s"
 msgstr " %s"
 
-#: lib/utils.c:220
+#: lib/utils.c:160
 #, fuzzy, c-format
 msgid "couldn't write %d item to %s: %s"
 msgid_plural "couldn't write %d items to %s: %s"
 msgstr[0] " %d  %s%s"
 msgstr[1] " %d  %s%s"
 
-#: lib/utils.c:235 lib/utils.c:251
+#: lib/utils.c:175
 #, c-format
 msgid "read error on %s: %s"
 msgstr " %s %s"
 
-#: lib/utils.c:341
-#, fuzzy, c-format
-msgid "cannot rename %s: %s"
-msgstr "%s %s%s\n"
-
-#: lib/regcomp.c:150
+#: lib/regcomp.c:149
 msgid "Success"
 msgstr ""
 
-#: lib/regcomp.c:153
+#: lib/regcomp.c:152
 msgid "No match"
 msgstr ""
 
-#: lib/regcomp.c:156
+#: lib/regcomp.c:155
 msgid "Invalid regular expression"
 msgstr ""
 
-#: lib/regcomp.c:159
+#: lib/regcomp.c:158
 msgid "Invalid collation character"
 msgstr ""
 
-#: lib/regcomp.c:162
+#: lib/regcomp.c:161
 msgid "Invalid character class name"
 msgstr ""
 
-#: lib/regcomp.c:165
+#: lib/regcomp.c:164
 msgid "Trailing backslash"
 msgstr ""
 
-#: lib/regcomp.c:168
+#: lib/regcomp.c:167
 msgid "Invalid back reference"
 msgstr ""
 
-#: lib/regcomp.c:171
+#: lib/regcomp.c:170
 #, fuzzy
 msgid "Unmatched [ or [^"
 msgstr "{"
 
-#: lib/regcomp.c:174
+#: lib/regcomp.c:173
 #, fuzzy
 msgid "Unmatched ( or \\("
 msgstr "{"
 
-#: lib/regcomp.c:177
+#: lib/regcomp.c:176
 #, fuzzy
 msgid "Unmatched \\{"
 msgstr "{"
 
-#: lib/regcomp.c:180
+#: lib/regcomp.c:179
 msgid "Invalid content of \\{\\}"
 msgstr ""
 
-#: lib/regcomp.c:183
+#: lib/regcomp.c:182
 msgid "Invalid range end"
 msgstr ""
 
-#: lib/regcomp.c:186
+#: lib/regcomp.c:185
 msgid "Memory exhausted"
 msgstr ""
 
-#: lib/regcomp.c:189
+#: lib/regcomp.c:188
 msgid "Invalid preceding regular expression"
 msgstr ""
 
-#: lib/regcomp.c:192
+#: lib/regcomp.c:191
 msgid "Premature end of regular expression"
 msgstr ""
 
-#: lib/regcomp.c:195
+#: lib/regcomp.c:194
 msgid "Regular expression too big"
 msgstr ""
 
-#: lib/regcomp.c:198
+#: lib/regcomp.c:197
 #, fuzzy
 msgid "Unmatched ) or \\)"
 msgstr "{"
 
-#: lib/regcomp.c:690
-msgid "No previous regular expression"
-msgstr ""
+#~ msgid "Invalid use of address modifier"
+#~ msgstr ""
+
+#~ msgid "Unexpected End-of-file"
+#~ msgstr ""
+
+#~ msgid "bad regexp: %s\n"
+#~ msgstr "%s\n"
+
+#~ msgid "input read error: %s"
+#~ msgstr "%s"
+
+#~ msgid "couldn't write an item to %s: %s"
+#~ msgstr " %s%s"
